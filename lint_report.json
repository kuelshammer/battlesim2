
> battlesim@0.1.0 lint
> eslint . --format json

[{"filePath":"/Users/max/Rust/Battlesim2/coverage/block-navigation.js","messages":[],"suppressedMessages":[{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":20,"column":35,"nodeType":"Identifier","messageId":"undef","endLine":20,"endColumn":43,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":67,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":67,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":67,"column":55,"nodeType":"Identifier","messageId":"undef","endLine":67,"endColumn":63,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":68,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":68,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":87,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":87,"endColumn":7,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/coverage/prettify.js","messages":[],"suppressedMessages":[{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":2,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":7,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'ar' is already defined.","line":2,"column":3893,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":3895,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'ar' is already defined.","line":2,"column":4061,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4063,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'at' is already defined.","line":2,"column":4089,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4091,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'ak' is already defined.","line":2,"column":4604,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4606,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'ak' is already defined.","line":2,"column":4665,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4667,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'am' is already defined.","line":2,"column":4670,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4672,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'ag' is already defined.","line":2,"column":4691,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4693,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'af' is already defined.","line":2,"column":4789,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4791,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'ak' is already defined.","line":2,"column":4854,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4856,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'am' is already defined.","line":2,"column":4859,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4861,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'ak' is already defined.","line":2,"column":4949,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4951,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'ag' is already defined.","line":2,"column":4970,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":4972,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'V' is already defined.","line":2,"column":5216,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":5217,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'U' is already defined.","line":2,"column":5220,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":5221,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'ae' is already defined.","line":2,"column":5244,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":5246,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":2,"column":5512,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":5518,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":2,"column":5539,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":5547,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":2,"column":6621,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":2,"endColumn":6635,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[6638,6656],"text":"Object.prototype.hasOwnProperty.call(ag, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7590,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7591,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7610,7611],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7610,7610],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7592,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7593,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7612,7613],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7612,7612],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7594,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7595,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7614,7615],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7614,7614],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7601,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7602,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7621,7622],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7621,7621],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7616,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7617,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7636,7637],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7636,7636],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7628,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7629,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7648,7649],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7648,7648],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7637,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7638,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7657,7658],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7657,7657],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7639,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7640,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7659,7660],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7659,7659],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7641,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7642,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7661,7662],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7661,7661],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7647,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7648,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7667,7668],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7667,7667],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7649,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7650,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7669,7670],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7669,7669],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7651,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7652,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7671,7672],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7671,7671],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7658,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7659,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7678,7679],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7678,7678],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7673,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7674,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7693,7694],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7693,7693],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7685,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7686,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7705,7706],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7705,7705],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7694,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7695,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7714,7715],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7714,7714],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7696,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7697,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7716,7717],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7716,7716],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7698,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7699,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7718,7719],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7718,7718],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7704,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7705,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7724,7725],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7724,7724],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7713,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7714,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7733,7734],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7733,7733],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7730,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7731,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7750,7751],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7750,7750],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7736,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7737,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7756,7757],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7756,7756],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7745,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7746,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7765,7766],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7765,7765],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7762,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7763,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7782,7783],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7782,7782],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7826,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7827,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7846,7847],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7846,7846],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7835,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7836,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7855,7856],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7855,7855],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7852,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7853,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7872,7873],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7872,7872],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7858,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7859,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7878,7879],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7878,7878],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7867,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7868,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7887,7888],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7887,7887],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7884,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7885,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7904,7905],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7904,7904],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":2,"column":7890,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7891,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7910,7911],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7910,7910],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":2,"column":7899,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7900,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7919,7920],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7919,7919],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":2,"column":7916,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7917,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7936,7937],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7936,7936],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7958,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7959,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7978,7979],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7978,7978],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7967,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7968,"suggestions":[{"messageId":"removeEscape","fix":{"range":[7987,7988],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[7987,7987],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":7983,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7984,"suggestions":[{"messageId":"removeEscape","fix":{"range":[8003,8004],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[8003,8003],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7989,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7990,"suggestions":[{"messageId":"removeEscape","fix":{"range":[8009,8010],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[8009,8009],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":7998,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":7999,"suggestions":[{"messageId":"removeEscape","fix":{"range":[8018,8019],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[8018,8018],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":8014,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":8015,"suggestions":[{"messageId":"removeEscape","fix":{"range":[8034,8035],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[8034,8034],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":8071,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":8072,"suggestions":[{"messageId":"removeEscape","fix":{"range":[8091,8092],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[8091,8091],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":8078,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":8079,"suggestions":[{"messageId":"removeEscape","fix":{"range":[8098,8099],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[8098,8098],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":8082,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":8083,"suggestions":[{"messageId":"removeEscape","fix":{"range":[8102,8103],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[8102,8102],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":8084,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":8085,"suggestions":[{"messageId":"removeEscape","fix":{"range":[8104,8105],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[8104,8104],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":8091,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":8092,"suggestions":[{"messageId":"removeEscape","fix":{"range":[8111,8112],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[8111,8111],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":2,"column":9231,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":9232,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9251,9252],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9251,9251],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":9235,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":9236,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9255,9256],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9255,9255],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":9237,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":9238,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9257,9258],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9257,9257],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":2,"column":9239,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":9240,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9259,9260],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9259,9259],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":2,"column":9241,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":9242,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9261,9262],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9261,9261],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\#.","line":2,"column":9243,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":9244,"suggestions":[{"messageId":"removeEscape","fix":{"range":[9263,9264],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[9263,9263],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":2,"column":9523,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":9529,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'Y' is already defined.","line":2,"column":10812,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":10813,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":2,"column":11008,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":11017,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ae' is assigned a value but never used.","line":2,"column":11414,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":11416,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'af' is assigned a value but never used.","line":2,"column":11438,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":11440,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ag' is assigned a value but never used.","line":2,"column":11471,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":11473,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-redeclare","severity":2,"message":"'W' is already defined.","line":2,"column":11501,"nodeType":"Identifier","messageId":"redeclared","endLine":2,"endColumn":11502,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":2,"column":11964,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":2,"endColumn":11978,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[11982,11999],"text":"Object.prototype.hasOwnProperty.call(t, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":2,"column":11998,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":12004,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":2,"column":12097,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":2,"endColumn":12111,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[12115,12132],"text":"Object.prototype.hasOwnProperty.call(t, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\!.","line":2,"column":12253,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12254,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12273,12274],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12273,12273],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":2,"column":12269,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12270,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12289,12290],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12289,12289],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":12685,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12686,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12705,12706],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12705,12705],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":12689,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12690,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12709,12710],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12709,12709],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":12693,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12694,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12713,12714],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12713,12713],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":12697,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12698,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12717,12718],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12717,12717],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":12701,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12702,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12721,12722],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12721,12721],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":12705,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12706,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12725,12726],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12725,12725],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":12835,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12836,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12855,12856],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12855,12855],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":12837,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12838,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12857,12858],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12857,12857],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":12849,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12850,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12869,12870],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12869,12869],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":12851,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12852,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12871,12872],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12871,12871],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":2,"column":12855,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12856,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12875,12876],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12875,12875],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":2,"column":12881,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12882,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12901,12902],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12901,12901],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":12913,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12914,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12933,12934],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12933,12933],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":12918,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12919,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12938,12939],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12938,12938],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":12923,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12924,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12943,12944],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12943,12943],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":12954,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12955,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12974,12975],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12974,12974],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":12959,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12960,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12979,12980],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12979,12979],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":12964,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12965,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12984,12985],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12984,12984],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":12998,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":12999,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13018,13019],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13018,13018],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":13000,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":13001,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13020,13021],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13020,13020],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":13038,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":13039,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13058,13059],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13058,13058],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":13043,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":13044,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13063,13064],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13063,13063],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":13048,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":13049,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13068,13069],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13068,13068],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":13080,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":13081,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13100,13101],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13100,13100],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":13085,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":13086,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13105,13106],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13105,13105],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":13090,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":13091,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13110,13111],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13110,13110],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":13125,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":13126,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13145,13146],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13145,13145],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":13127,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":13128,"suggestions":[{"messageId":"removeEscape","fix":{"range":[13147,13148],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[13147,13147],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":2,"column":14225,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":14231,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":2,"column":14293,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":14301,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":2,"column":14462,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":14470,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ae' is assigned a value but never used.","line":2,"column":14757,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":14759,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":2,"column":14799,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":14805,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'setTimeout' is not defined.","line":2,"column":15450,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":15460,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":2,"column":15491,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":15497,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":2,"column":15515,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":15521,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":2,"column":15536,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":15542,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":15786,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":15788,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":15809,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":15811,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":15835,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":15837,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":15875,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":15877,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\!.","line":2,"column":15892,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":15893,"suggestions":[{"messageId":"removeEscape","fix":{"range":[15912,15913],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[15912,15912],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":2,"column":15908,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":15909,"suggestions":[{"messageId":"removeEscape","fix":{"range":[15928,15929],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[15928,15928],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":15918,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":15920,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16362,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16364,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16410,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16412,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16453,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16455,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16498,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16500,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16551,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16553,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16574,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16576,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16597,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16599,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16646,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16648,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":16661,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16662,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16681,16682],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16681,16681],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":16676,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16677,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16696,16697],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16696,16696],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":16708,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16709,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16728,16729],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16728,16728],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16719,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16721,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":16734,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16735,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16754,16755],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16754,16754],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":16749,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16750,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16769,16770],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16769,16769],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":16781,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16782,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16801,16802],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16801,16801],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\).","line":2,"column":16817,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16818,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16837,16838],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16837,16837],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":16819,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16820,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16839,16840],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16839,16839],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":16821,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16822,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16841,16842],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16841,16841],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":16833,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":16835,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\!.","line":2,"column":16860,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16861,"suggestions":[{"messageId":"removeEscape","fix":{"range":[16880,16881],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[16880,16880],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":2,"column":16991,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":16992,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17011,17012],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17011,17011],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17026,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17028,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":2,"column":17059,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":17060,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17079,17080],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17079,17079],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17079,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17081,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17111,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17113,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17161,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17163,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17203,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17205,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":2,"column":17256,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":17257,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17276,17277],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17276,17276],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17285,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17287,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":17311,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":17312,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17331,17332],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17331,17331],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":17313,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":17314,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17333,17334],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17333,17333],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17331,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17333,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17354,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17356,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17380,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17382,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":2,"column":17435,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":17436,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17455,17456],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17455,17455],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17477,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17479,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17500,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17502,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'PR' is not defined.","line":2,"column":17526,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":17528,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\).","line":2,"column":17543,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":17544,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17563,17564],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17563,17563],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":2,"column":17545,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":17546,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17565,17566],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17565,17565],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":2,"column":17547,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":2,"endColumn":17548,"suggestions":[{"messageId":"removeEscape","fix":{"range":[17567,17568],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[17567,17567],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/coverage/sorter.js","messages":[],"suppressedMessages":[{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":12,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":12,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":28,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":28,"endColumn":37,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":29,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":29,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":36,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":60,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":60,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":128,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":128,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'window' is not defined.","line":210,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":210,"endColumn":7,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/next.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/scripts/audit_rules.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentActor' is assigned a value but never used.","line":33,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'turnUsage' is assigned a value but never used.","line":34,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":47,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'extractType' is defined but never used.","line":92,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'extractActor' is defined but never used.","line":93,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'extractRound' is defined but never used.","line":94,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'str' is defined but never used.","line":94,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\nconst path = require('path');\n\n/**\n * Rule Auditor for D&D 5e Compliance\n * Scans simulation JSON logs for logic violations.\n */\n\nconst logPath = path.join(__dirname, '../GEMINI_REPORTS/last_simulation_run.json');\n\nif (!fs.existsSync(logPath)) {\n    console.error(' No simulation log found to audit. Run \"npm run sim:log\" first.');\n    process.exit(1);\n}\n\nconst logData = JSON.parse(fs.readFileSync(logPath, 'utf8'));\nconst runs = logData.runs || [{ events: logData.events }];\n\nconst violations = [];\n\n// Helper to add violation\nfunction report(runIndex, actorId, round, message) {\n    violations.push({ runIndex, actorId, round, message });\n}\n\nconsole.log(`  Starting 5e Rule Audit across ${runs.length} runs...`);\n\nruns.forEach((run, runIndex) => {\n    const events = run.events;\n    \n    // State trackers\n    let currentRound = 0;\n    let currentActor = null;\n    let turnUsage = {\n        action: 0,\n        bonusAction: 0,\n        movement: 0,\n        spells: []\n    };\n    const roundUsage = {\n        reactions: new Map() // actorId -> count\n    };\n\n    // Global concentration map: casterId -> { spellId, startTime }\n    const activeConcentration = new Map();\n\n    events.forEach((event, index) => {\n        const type = event.type;\n        const actorId = (event.actor_id || event.attacker_id || event.caster_id || event.unit_id);\n\n        if (type === 'RoundStarted') {\n            currentRound = event.round_number;\n            roundUsage.reactions.clear();\n        }\n\n        if (type === 'TurnStarted') {\n            currentActor = actorId;\n            turnUsage = { action: 0, bonusAction: 0, movement: 0, spells: [] };\n        }\n\n        if (type === 'ConcentrationBroken') {\n            activeConcentration.delete(actorId);\n        }\n\n        if (type === 'ResourceConsumed') {\n            const resType = event.resource_type;\n            \n            if (resType === 'Reaction') {\n                const count = (roundUsage.reactions.get(actorId) || 0) + 1;\n                roundUsage.reactions.set(actorId, count);\n                if (count > 1) {\n                    report(runIndex, actorId, currentRound, `Reaction used multiple times in one round (${count})`);\n                }\n            }\n        }\n    });\n});\n\n// Final check\nconsole.log('--- Audit Results ---');\nif (violations.length === 0) {\n    console.log(` 5e Rule Compliance: High confidence (Basic checks passed across ${runs.length} runs)`);\n} else {\n    console.error(` Found ${violations.length} violations:`);\n    violations.forEach(v => {\n        console.error(`  [Run ${v.runIndex}] [Round ${v.round}] [${v.actorId}]: ${v.message}`);\n    });\n    process.exit(1);\n}\n\n// Helpers for string parsing (if needed)\nfunction extractType(str) { return str.includes('starts turn') ? 'TurnStarted' : ''; }\nfunction extractActor(str) { return str.split(' ')[0]; }\nfunction extractRound(str) { return 1; }\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/scripts/simulate_and_log.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'players' is assigned a value but never used.","line":21,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'timeline' is assigned a value but never used.","line":22,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\nconst path = require('path');\n\n/**\n * This script runs a combat simulation using the WASM backend and outputs\n * a full, raw JSON event log to GEMINI_REPORTS/ for AI self-checking.\n */\n\nasync function run() {\n    const inputPath = process.argv[2] || 'XYZ123.json';\n    const outputPath = path.join(__dirname, '../GEMINI_REPORTS/last_simulation_run.json');\n\n    console.log(`Reading scenario from: ${inputPath}`);\n    \n    if (!fs.existsSync(inputPath)) {\n        console.error(`Error: File not found ${inputPath}`);\n        process.exit(1);\n    }\n\n    const inputData = JSON.parse(fs.readFileSync(inputPath, 'utf8'));\n    const players = inputData.players || [];\n    const timeline = inputData.timeline || inputData.encounters || [];\n\n    // The wasm pkg is at simulation-wasm/pkg\n    // We need to load it. Since it's wasm-bindgen for web, \n    // it might be tricky to run directly in Node.\n    // However, we have simulation-wasm/src/bin/sim_cli.rs which is a native binary.\n    \n    console.log('Using native sim_cli for reliable JSON output...');\n    \n    const { execSync } = require('child_process');\n    try {\n        // Run sim_cli batch-log to get multiple runs for auditing\n        const command = `cd simulation-wasm && cargo run --quiet --bin sim_cli -- batch-log ../${inputPath} --count 10`;\n        const result = execSync(command, { encoding: 'utf8', maxBuffer: 10 * 1024 * 1024 });\n        \n        fs.writeFileSync(outputPath, result);\n        \n        console.log(' Computer-readable batch log generated!');\n        console.log(' File path:', outputPath);\n        \n        // Brief summary\n        const summary = JSON.parse(result);\n        console.log(' Runs recorded:', summary.runs.length);\n        console.log(' Total events recorded:', summary.runs.reduce((acc, run) => acc + run.events.length, 0));\n        \n    } catch (e) {\n        console.error(' Simulation failed:', e.message);\n        process.exit(1);\n    }\n}\n\nrun();\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/simulation-wasm/simulation_runner.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/__mocks__/wasmMock.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/combat/EventLog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getActionName' is assigned a value but never used.","line":31,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useState, useMemo } from 'react';\nimport { Event } from '@/model/model';\nimport styles from './EventLog.module.scss';\nimport { useUIToggle } from '@/model/uiToggleState';\nimport { LogFormatter } from '@/model/logFormatter';\n\ntype Props = {\n    events: Event[];\n    combatantNames: Record<string, string>; // Map ID to Name for display\n    actionNames?: Record<string, string>; // Map ActionID to Name\n    isModal?: boolean; // New prop to handle modal context\n};\n\ntype EventFilter = 'all' | 'combat' | 'spell' | 'status' | 'lifecycle';\n\nconst EventLog: FC<Props> = ({ events, combatantNames, actionNames = {}, isModal = false }) => {\n    const [filter, setFilter] = useState<EventFilter>('all');\n    const [combatLogVisible, setCombatLogVisible] = useUIToggle('combat-log');\n    const [expandedEvents, setExpandedEvents] = useState<Set<number>>(new Set());\n\n    const toggleEvent = (index: number) => {\n        const newExpanded = new Set(expandedEvents);\n        if (newExpanded.has(index)) {\n            newExpanded.delete(index);\n        } else {\n            newExpanded.add(index);\n        }\n        setExpandedEvents(newExpanded);\n    };\n\n    const getActionName = (id: string) => actionNames[id] || id;\n\n    const filteredEvents = useMemo(() => {\n        if (filter === 'all') return events;\n\n        return events.filter(e => {\n            switch (filter) {\n                case 'combat':\n                    return ['AttackHit', 'AttackMissed', 'DamageTaken', 'DamagePrevented', 'ActionStarted', 'ActionSkipped'].includes(e.type);\n                case 'spell':\n                    return ['SpellCast', 'SpellSaved', 'ConcentrationBroken', 'SpellFailed'].includes(e.type);\n                case 'status':\n                    return ['BuffApplied', 'BuffExpired', 'ConditionAdded', 'ConditionRemoved', 'HealingApplied', 'TempHPGranted'].includes(e.type);\n                case 'lifecycle':\n                    return ['UnitDied', 'TurnStarted', 'TurnEnded', 'RoundStarted', 'RoundEnded', 'EncounterStarted', 'EncounterEnded'].includes(e.type);\n                default:\n                    return true;\n            }\n        });\n    }, [events, filter]);\n\n    const renderEvent = (event: Event, index: number) => {\n        const isExpanded = expandedEvents.has(index);\n        const hasDetails = ['AttackHit', 'AttackMissed', 'ActionStarted'].includes(event.type); // Events with enriched data\n\n        let glyph = ''; // Default glyph\n        let eventClass = '';\n\n        switch (event.type) {\n            case 'ActionStarted':\n                glyph = ''; // Swords for action\n                eventClass = styles.action;\n                break;\n            case 'ActionSkipped':\n                glyph = ''; // Warning\n                eventClass = styles.skipped;\n                break;\n            case 'AttackHit':\n                glyph = ''; // Swords\n                eventClass = styles.hit;\n                break;\n            case 'AttackMissed':\n                glyph = ''; // X mark\n                eventClass = styles.miss;\n                break;\n            case 'DamageTaken':\n                glyph = ''; // Heart for damage\n                eventClass = styles.damage;\n                break;\n            case 'HealingApplied':\n                glyph = ''; // Ankh/cross for healing\n                eventClass = styles.heal;\n                break;\n            case 'UnitDied':\n                glyph = ''; // Cross/dagger\n                eventClass = styles.death;\n                break;\n            case 'RoundStarted':\n                glyph = ''; // Moon/cycle\n                eventClass = styles.round;\n                break;\n            case 'TurnStarted':\n                glyph = ''; // Arrow\n                break;\n            case 'SpellCast':\n                glyph = ''; // Star\n                eventClass = styles.spell;\n                break;\n            case 'BuffApplied':\n                glyph = ''; // Shield/buff\n                eventClass = styles.buff;\n                break;\n            case 'ConditionAdded':\n                glyph = ''; // Warning\n                eventClass = styles.buff;\n                break;\n            case 'ConditionRemoved':\n                glyph = ''; // Shield\n                eventClass = styles.buff;\n                break;\n            case 'EncounterEnded':\n                glyph = ''; // Full moon/end\n                eventClass = styles.round;\n                break;\n            case 'TurnEnded':\n            case 'RoundEnded':\n                return null;\n        }\n\n        const summary = LogFormatter.toSummary(event, combatantNames, actionNames);\n        const details = hasDetails ? LogFormatter.toDetails(event, combatantNames, actionNames) : null;\n\n        return (\n            <div\n                key={index}\n                className={`${styles.event} ${eventClass} ${hasDetails ? styles.clickable : ''}`}\n                onClick={hasDetails ? () => toggleEvent(index) : undefined}\n            >\n                <div className={styles.eventGlyph}>{glyph}</div>\n                <div className={styles.eventContent}>\n                    <div className={styles.eventSummary}>\n                        <span>{summary}</span>\n                        {hasDetails && (\n                            <span style={{ marginLeft: 'auto', fontSize: '0.8rem', opacity: 0.5 }}>\n                                {isExpanded ? '' : ''}\n                            </span>\n                        )}\n                    </div>\n                    {isExpanded && details && (\n                        <div className={styles.eventDetails}>\n                            {details}\n                        </div>\n                    )}\n                </div>\n            </div>\n        );\n    };\n\n    if (!combatLogVisible && !isModal) {\n        return (\n            <div className={styles.eventLogContainer}>\n                <div className={styles.header}>\n                    <h3>Combat Log</h3>\n                    <div className={styles.toggleContainer}>\n                        <button\n                            onClick={() => setCombatLogVisible(true)}\n                            className={styles.toggleButton}\n                            aria-label=\"Show combat log\"\n                            title=\"Show combat log\"\n                        >\n                            <span></span>\n                            <span>Show Log</span>\n                        </button>\n                    </div>\n                </div>\n                <div className={styles.emptyState}>\n                    <p style={{ fontSize: '2rem', fontFamily: '\"MedievalSharp\", cursive', opacity: 0.3 }}></p>\n                    <p>The chronicle lies hidden</p>\n                    <p className={styles.emptyHint}>Click \"Show Log\" to reveal the events</p>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className={`${styles.eventLogContainer} ${isModal ? styles.modalMode : ''}`}>\n            {!isModal && (\n                <div className={styles.header}>\n                    <h3>Combat Log</h3>\n                    <div className={styles.controls}>\n                        <div className={styles.filters}>\n                            <button className={filter === 'all' ? styles.active : ''} onClick={() => setFilter('all')}>All</button>\n                            <button className={filter === 'combat' ? styles.active : ''} onClick={() => setFilter('combat')}>Combat</button>\n                            <button className={filter === 'spell' ? styles.active : ''} onClick={() => setFilter('spell')}>Magic</button>\n                            <button className={filter === 'status' ? styles.active : ''} onClick={() => setFilter('status')}>Status</button>\n                        </div>\n                        <div className={styles.toggleContainer}>\n                            <button\n                                onClick={() => setCombatLogVisible(false)}\n                                className={styles.toggleButton}\n                                aria-label=\"Hide combat log\"\n                                title=\"Hide combat log\"\n                            >\n                                <span></span>\n                                <span>Hide Log</span>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n            <div className={styles.logBody}>\n                {filteredEvents.length === 0 ? (\n                    <div className={styles.emptyState}>\n                        <p>No events to display</p>\n                        {filter !== 'all' && (\n                            <p className={styles.emptyHint}>Try changing the filter or running a simulation</p>\n                        )}\n                    </div>\n                ) : (\n                    filteredEvents.map((e, i) => renderEvent(e, i))\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default EventLog;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/ActionCostEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'faExchange' is defined but never used.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC } from 'react'\nimport { ActionCost } from '@/model/model'\nimport { ResourceTypeList } from '@/model/enums'\nimport Select from '@/utils/select'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faTrash, faPlus, faExchange } from '@fortawesome/free-solid-svg-icons' // faExchangeAlt? faRetweet? faRandom? Using faExchange for swapping types\nimport { faRandom } from '@fortawesome/free-solid-svg-icons'\nimport styles from './actionForm.module.scss'\n\ntype Props = {\n    value: ActionCost[]\n    onChange: (newValue: ActionCost[]) => void\n}\n\nconst ActionCostEditor: FC<Props> = ({ value, onChange }) => {\n    const addCost = () => {\n        onChange([...value, { type: 'Discrete', resourceType: 'Action', amount: 1 }])\n    }\n\n    const removeCost = (index: number) => {\n        const newValue = [...value]\n        newValue.splice(index, 1)\n        onChange(newValue)\n    }\n\n    const updateCost = (index: number, newCost: ActionCost) => {\n        const newValue = [...value]\n        newValue[index] = newCost\n        onChange(newValue)\n    }\n\n    const toggleType = (index: number, cost: ActionCost) => {\n        if (cost.type === 'Discrete') {\n            updateCost(index, { type: 'Variable', resourceType: cost.resourceType, min: cost.amount, max: cost.amount })\n        } else {\n            updateCost(index, { type: 'Discrete', resourceType: cost.resourceType, amount: cost.min })\n        }\n    }\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', width: '100%', margin: '4px 0' }}>\n            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                <span style={{ fontSize: '0.9em', fontWeight: 'bold' }}>Costs:</span>\n                <button onClick={addCost} title=\"Add Cost\">\n                    <FontAwesomeIcon icon={faPlus} />\n                </button>\n            </div>\n            {value.map((cost, index) => (\n                <div key={index} className={styles.modifier} style={{ marginTop: '4px' }}>\n                    <Select\n                        value={cost.resourceType}\n                        options={ResourceTypeList.map(r => ({ value: r, label: r }))}\n                        onChange={rt => updateCost(index, { ...cost, resourceType: rt })}\n                    />\n\n                    {['SpellSlot', 'ClassResource', 'ItemCharge', 'HitDice', 'Custom'].includes(cost.resourceType) && (\n                        <input\n                            type=\"text\"\n                            value={cost.resourceVal || ''}\n                            onChange={e => updateCost(index, { ...cost, resourceVal: e.target.value })}\n                            placeholder={\n                                cost.resourceType === 'SpellSlot' ? 'Level' :\n                                    cost.resourceType === 'ClassResource' ? 'Name' :\n                                        cost.resourceType === 'ItemCharge' ? 'Item' :\n                                            cost.resourceType === 'HitDice' ? 'Die' :\n                                                'Value'\n                            }\n                            title=\"Resource Value (e.g. Spell Level, Resource Name)\"\n                            style={{ width: '80px' }}\n                        />\n                    )}\n\n                    {cost.type === 'Discrete' ? (\n                        <>\n                            <input\n                                type=\"number\"\n                                value={cost.amount}\n                                onChange={e => updateCost(index, { ...cost, amount: Number(e.target.value) })}\n                                title=\"Amount\"\n                                style={{ width: '45px' }}\n                            />\n                        </>\n                    ) : (\n                        <>\n                            <input\n                                type=\"number\"\n                                value={cost.min}\n                                onChange={e => updateCost(index, { ...cost, min: Number(e.target.value) })}\n                                placeholder=\"Min\"\n                                title=\"Min Amount\"\n                                style={{ width: '45px' }}\n                            />\n                            -\n                            <input\n                                type=\"number\"\n                                value={cost.max}\n                                onChange={e => updateCost(index, { ...cost, max: Number(e.target.value) })}\n                                placeholder=\"Max\"\n                                title=\"Max Amount\"\n                                style={{ width: '45px' }}\n                            />\n                        </>\n                    )}\n\n                    <button onClick={() => toggleType(index, cost)} title={cost.type === 'Discrete' ? \"Switch to Variable\" : \"Switch to Fixed\"}>\n                        <FontAwesomeIcon icon={faRandom} color={cost.type === 'Variable' ? '#4CAF50' : undefined} />\n                    </button>\n\n                    <button onClick={() => removeCost(index)}>\n                        <FontAwesomeIcon icon={faTrash} />\n                    </button>\n                </div>\n            ))}\n        </div>\n    )\n}\n\nexport default ActionCostEditor\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/ActionRequirementEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/ImportButton.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/ImportButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'styles' is defined but never used.","line":6,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useState } from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faFileImport } from \"@fortawesome/free-solid-svg-icons\";\nimport { Creature } from \"@/model/model\";\nimport ImportModal from \"./ImportModal\";\nimport styles from \"./creatureForm.module.scss\"; // Reuse some styles\n\ntype PropType = {\n    onImport: (creature: Creature) => void;\n    className?: string;\n}\n\nconst ImportButton: FC<PropType> = ({ onImport, className }) => {\n    const [showImport, setShowImport] = useState(false);\n\n    function handleImport(creature: Creature) {\n        onImport(creature);\n        setShowImport(false);\n    }\n\n    return (\n        <>\n            <button\n                className={className}\n                onClick={() => setShowImport(true)}\n                title=\"Import from 5e.tools\"\n            >\n                <FontAwesomeIcon icon={faFileImport} />\n            </button>\n\n            {showImport && (\n                <ImportModal \n                    onImport={handleImport} \n                    onCancel={() => setShowImport(false)} \n                />\n            )}\n        </>\n    );\n};\n\nexport default ImportButton;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/ImportModal.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/ImportModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":30,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useState } from \"react\";\nimport Modal from \"../utils/modal\";\nimport styles from \"./importModal.module.scss\";\nimport { Monster5eImportSchema } from \"@/model/import/5etools-schema\";\nimport { mapMonster5eToCreature } from \"@/model/import/5etools-mapper\";\nimport { Creature } from \"@/model/model\";\nimport { cleanJsonInput } from \"@/model/import/utils\";\n\ntype PropType = {\n    onImport: (creature: Creature) => void;\n    onCancel: () => void;\n}\n\nconst ImportModal: FC<PropType> = ({ onImport, onCancel }) => {\n    const [jsonText, setJsonText] = useState(\"\");\n    const [error, setError] = useState<string | null>(null);\n\n    const handleImport = () => {\n        setError(null);\n        try {\n            const cleaned = cleanJsonInput(jsonText);\n            if (!cleaned) {\n                setError(\"No valid JSON found in input. Please ensure you pasted the monster's JSON.\");\n                return;\n            }\n\n            let rawData;\n            try {\n                rawData = JSON.parse(cleaned);\n            } catch (e) {\n                setError(\"Failed to parse JSON syntax. Please check for missing braces or extra characters.\");\n                return;\n            }\n\n            const validation = Monster5eImportSchema.safeParse(rawData);\n            if (!validation.success) {\n                const issues = validation.error.issues.map(i => `${i.path.join('.')} (${i.message})`).join(', ');\n                setError(`Invalid format: ${issues}`);\n                return;\n            }\n\n            const creature = mapMonster5eToCreature(validation.data);\n            onImport(creature);\n        } catch (e) {\n            setError(\"An unexpected error occurred during import.\");\n            console.error(\"Import error:\", e);\n        }\n    };\n\n    return (\n        <Modal onCancel={onCancel} className={styles.importModal}>\n            <h2>Import from 5e.tools</h2>\n            <p>Paste the monster's \"View JSON\" content from 5e.tools below:</p>\n            \n            <textarea \n                className={styles.jsonInput}\n                value={jsonText}\n                onChange={(e) => {\n                    setJsonText(e.target.value);\n                    setError(null);\n                }}\n                placeholder='{ \"name\": \"Beholder\", ... }'\n            />\n\n            {error && <div className={styles.error}>{error}</div>}\n\n            <div className={styles.actions}>\n                <button className={styles.cancelBtn} onClick={onCancel}>Cancel</button>\n                <button \n                    className={styles.importBtn} \n                    onClick={handleImport}\n                    disabled={!jsonText.trim()}\n                >\n                    Import Creature\n                </button>\n            </div>\n        </Modal>\n    );\n};\n\nexport default ImportModal;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/ResourceEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/SaveBonusModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1411,1414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1411,1414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1463,1466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1463,1466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/creatureForm/SaveBonusModal.tsx\nimport { FC, useState } from 'react';\nimport { Creature } from '@/model/model';\nimport { clone } from '@/model/utils';\nimport styles from './saveBonusModal.module.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCheck } from '@fortawesome/free-solid-svg-icons';\nimport Checkbox from '@/utils/checkbox';\nimport Modal from '../utils/modal';\n\ntype Props = {\n    value: Creature;\n    onChange: (newValue: Creature) => void;\n    onClose: () => void;\n};\n\nconst SAVES = [\n    { key: 'strSaveBonus', label: 'Strength', short: 'STR' },\n    { key: 'dexSaveBonus', label: 'Dexterity', short: 'DEX' },\n    { key: 'conSaveBonus', label: 'Constitution', short: 'CON' },\n    { key: 'intSaveBonus', label: 'Intelligence', short: 'INT' },\n    { key: 'wisSaveBonus', label: 'Wisdom', short: 'WIS' },\n    { key: 'chaSaveBonus', label: 'Charisma', short: 'CHA' },\n] as const;\n\ntype SaveKey = typeof SAVES[number]['key'];\n\nconst SaveBonusModal: FC<Props> = ({ value, onChange, onClose }) => {\n    const [localValue, setLocalValue] = useState<Creature>(clone(value));\n\n    const updateSave = (key: SaveKey, newValue: number | undefined) => {\n        const updated = clone(localValue);\n        if (newValue === undefined || newValue === updated.saveBonus) {\n            // Clear the override if it matches the average\n            delete (updated as any)[key];\n        } else {\n            (updated as any)[key] = newValue;\n        }\n        setLocalValue(updated);\n    };\n\n    const handleSave = () => {\n        onChange(localValue);\n        onClose();\n    };\n\n    return (\n        <Modal onCancel={onClose} title=\"Saving Throw Bonuses\">\n            <div className={styles.content}>\n                <div className={styles.averageSection}>\n                    <label>Average Save Bonus (Used when no specific value set):</label>\n                    <input\n                        type=\"number\"\n                        value={localValue.saveBonus}\n                        onChange={e => {\n                            const updated = clone(localValue);\n                            updated.saveBonus = parseInt(e.target.value) || 0;\n                            setLocalValue(updated);\n                        }}\n                        className={styles.averageInput}\n                    />\n                </div>\n\n                <div className={styles.divider} />\n\n                <h3>Individual Saves (Optional Overrides)</h3>\n                <p className={styles.hint}>\n                    Leave blank to use the average. Set a specific value to override.\n                </p>\n\n                <div className={styles.savesGrid}>\n                    {SAVES.map(save => {\n                        const specificValue = localValue[save.key];\n                        const isOverridden = specificValue !== undefined;\n\n                        return (\n                            <div key={save.key} className={styles.saveRow}>\n                                <span className={styles.saveLabel}>\n                                    <strong>{save.short}</strong> ({save.label})\n                                </span>\n                                <input\n                                    type=\"number\"\n                                    value={specificValue ?? ''}\n                                    placeholder={String(localValue.saveBonus)}\n                                    onChange={e => {\n                                        const val = e.target.value === '' ? undefined : parseInt(e.target.value);\n                                        updateSave(save.key, val);\n                                    }}\n                                    className={`${styles.saveInput} ${isOverridden ? styles.overridden : ''}`}\n                                />\n                                {save.key === 'conSaveBonus' && (\n                                    <label className={styles.advantageLabel}>\n                                        <Checkbox\n                                            value={!!localValue.conSaveAdvantage}\n                                            onToggle={() => {\n                                                const updated = clone(localValue);\n                                                updated.conSaveAdvantage = !updated.conSaveAdvantage || undefined;\n                                                setLocalValue(updated);\n                                            }}\n                                        />\n                                        <span>Advantage (Concentration)</span>\n                                    </label>\n                                )}\n                            </div>\n                        );\n                    })}\n                </div>\n\n                <div className={styles.divider} />\n\n                <div className={styles.globalAdvantage}>\n                    <label>\n                        <Checkbox\n                            value={!!localValue.saveAdvantage}\n                            onToggle={() => {\n                                const updated = clone(localValue);\n                                updated.saveAdvantage = !updated.saveAdvantage || undefined;\n                                setLocalValue(updated);\n                            }}\n                        />\n                        <span>Advantage on ALL Saving Throws</span>\n                        <span className={styles.hint}>(e.g., Paladin Aura of Protection effect)</span>\n                    </label>\n                </div>\n            </div>\n\n            <div className={styles.footer}>\n                <button onClick={onClose} className={styles.cancelBtn}>Cancel</button>\n                <button onClick={handleSave} className={styles.saveBtn}>\n                    <FontAwesomeIcon icon={faCheck} /> Save\n                </button>\n            </div>\n        </Modal>\n    );\n};\n\nexport default SaveBonusModal;","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/StrategyBuilder.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/TagSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'faPlus' is defined but never used.","line":6,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC } from 'react'\nimport { ActionTag } from '@/model/enums'\nimport { ActionTagList } from '@/model/enums'\nimport Select from '@/utils/select'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faTimes, faPlus } from '@fortawesome/free-solid-svg-icons'\n\ntype Props = {\n    value: ActionTag[]\n    onChange: (newValue: ActionTag[]) => void\n}\n\nconst TagSelector: FC<Props> = ({ value, onChange }) => {\n    const addTag = (tag: ActionTag) => {\n        if (!value.includes(tag)) {\n            onChange([...value, tag])\n        }\n    }\n\n    const removeTag = (tagToRemove: ActionTag) => {\n        onChange(value.filter(tag => tag !== tagToRemove))\n    }\n\n    // Filter available tags to exclude already selected ones\n    const availableTags = ActionTagList.filter(tag => !value.includes(tag))\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', width: '100%', margin: '4px 0' }}>\n            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px', marginBottom: '4px' }}>\n                {value.map(tag => (\n                    <span \n                        key={tag} \n                        style={{ \n                            background: '#445', \n                            color: '#eee',\n                            borderRadius: '12px', \n                            padding: '2px 8px', \n                            fontSize: '0.85em',\n                            display: 'flex',\n                            alignItems: 'center',\n                            gap: '4px'\n                        }}\n                    >\n                        {tag}\n                        <FontAwesomeIcon \n                            icon={faTimes} \n                            style={{ cursor: 'pointer', fontSize: '0.8em' }} \n                            onClick={() => removeTag(tag)}\n                        />\n                    </span>\n                ))}\n            </div>\n            \n            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                 <span style={{ fontSize: '0.9em', fontWeight: 'bold' }}>Tags:</span>\n                 <div style={{ width: '200px' }}>\n                    <Select\n                        value={availableTags[0]} // Placeholder, essentially\n                        options={availableTags.map(t => ({ value: t, label: t }))}\n                        onChange={addTag}\n                    />\n                 </div>\n            </div>\n        </div>\n    )\n}\n\nexport default TagSelector\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/actionForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9621,9624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9621,9624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9699,9702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9699,9702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":482,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":482,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20176,20179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20176,20179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":493,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":493,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20680,20683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20680,20683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useState } from \"react\"\nimport { Action, AllyTarget, AtkAction, Buff, BuffAction, DebuffAction, DiceFormula, EnemyTarget, FinalAction, Frequency, HealAction, TemplateAction } from \"@/model/model\"\nimport styles from './actionForm.module.scss'\nimport { clone, inDevEnvironment } from \"@/model/utils\"\nimport { ActionType, BuffDuration, ActionCondition, CreatureConditionList, CreatureCondition, ActionSlots } from \"@/model/enums\"\nimport { ActionTemplates, getFinalAction } from \"@/data/actions\"\nimport { evaluateDiceFormula } from \"@/model/dice\"\n\nimport ActionCostEditor from \"./ActionCostEditor\"\nimport ActionRequirementEditor from \"./ActionRequirementEditor\"\nimport TagSelector from \"./TagSelector\"\nimport Checkbox from \"@/utils/checkbox\"\nimport Select from \"@/utils/select\"\nimport DecimalInput from \"@/utils/DecimalInput\"\nimport DiceFormulaInput from \"@/utils/diceFormulaInput\"\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faTrash, faPlus, faChevronUp, faChevronDown } from \"@fortawesome/free-solid-svg-icons\"\n\ntype PropType = {\n    value: Action,\n    onChange: (newvalue: Action) => void,\n    onDelete: () => void,\n    onMoveUp?: () => void,\n    onMoveDown?: () => void,\n}\n\ntype Options<T> = { value: T, label: string }[]\n\nconst srFreq: Frequency = { reset: \"sr\", uses: 1 }\nconst lrFreq: Frequency = { reset: \"lr\", uses: 1 }\nconst rechargeFreq: Frequency = { reset: \"recharge\", cooldownRounds: 2 }\nconst FreqOptions: Options<Frequency> = [\n    { value: 'at will', label: 'At will' },\n    { value: '1/fight', label: '1/short rest' },\n    { value: srFreq, label: 'X/short rest' },\n    { value: '1/day', label: '1/day' },\n    { value: lrFreq, label: 'X/long rest' },\n    { value: rechargeFreq, label: 'Every X rounds' },\n]\n\nconst ConditionOptions: Options<ActionCondition> = [\n    { value: 'default', label: 'Default' },\n    { value: 'ally at 0 HP', label: 'There is an ally at 0 HP' },\n    { value: 'ally under half HP', label: 'An ally has less than half their maximum HP' },\n    { value: 'is available', label: 'A use of this action is available' },\n    { value: 'is under half HP', label: 'This creature is under half its maximum HP' },\n    { value: 'has no THP', label: 'This creature has no temporary HP' },\n    { value: 'not used yet', label: 'This action has not been used yet this encounter' },\n    { value: 'enemy count one', label: 'There is only one enemy' },\n    { value: 'enemy count multiple', label: 'There are at least two enemies' },\n    // Action economy conditions - for strategic ability triggers\n    { value: 'enemy advantage', label: ' Enemy Advantage (Nova!) - Monsters have more actions/DPR' },\n    { value: 'player advantage', label: ' Player Advantage (Conserve) - Players have more actions/DPR' },\n    { value: 'even action economy', label: ' Even - Balanced action economy' },\n]\n\nconst TypeOptions: Options<ActionType> = [\n    { value: 'template', label: 'Common Spell' },\n    { value: 'atk', label: 'Attack' },\n    { value: 'heal', label: 'Heal' },\n    { value: 'buff', label: 'Buff' },\n    { value: 'debuff', label: 'Debuff' },\n]\n\nconst ActionOptions: Options<number> = Object.entries(ActionSlots).map(([label, value]) => ({ label, value }))\n\nconst TargetCountOptions: Options<number> = [\n    { value: 1, label: 'Single target' },\n    { value: 2, label: 'Multi target' },\n    { value: 3, label: '3 targets' },\n    { value: 4, label: '4 targets' },\n    { value: 5, label: '5 targets' },\n    { value: 6, label: '6 targets' },\n    { value: 7, label: '7 targets' },\n    { value: 8, label: '8 targets' },\n    { value: 9, label: '9 targets' },\n    { value: 10, label: '10 targets' },\n    { value: 11, label: '11 targets' },\n    { value: 12, label: '12 targets' },\n    { value: 13, label: '13 targets' },\n    { value: 14, label: '14 targets' },\n    { value: 15, label: '15 targets' },\n    { value: 10000, label: 'Target everything' },\n]\n\nconst HitCountOptions: Options<number> = [\n    { value: 1, label: '1 hit' },\n    { value: 2, label: '2 hits' },\n    { value: 3, label: '3 hits' },\n    { value: 4, label: '4 hits' },\n    { value: 5, label: '5 hits' },\n    { value: 6, label: '6 hits' },\n    { value: 7, label: '7 hits' },\n    { value: 8, label: '8 hits' },\n    { value: 9, label: '9 hits' },\n    { value: 10, label: '10 hits' },\n]\n\nconst EnemyTargetOptions: Options<EnemyTarget> = [\n    { value: 'enemy with least HP', label: 'Enemy with least HP' },\n    { value: 'enemy with most HP', label: 'Enemy with most HP' },\n    { value: 'enemy with highest DPR', label: 'Enemy with highest DPR' },\n    { value: 'enemy with lowest AC', label: 'Enemy with lowest AC' },\n    { value: 'enemy with highest AC', label: 'Enemy with highest AC' },\n    { value: 'enemy with highest survivability', label: 'Enemy with highest survivability' },\n]\n\nconst AllyTargetOptions: Options<AllyTarget> = [\n    { value: 'self', label: 'Self' },\n    { value: 'ally with least HP', label: 'Ally with least HP' },\n    { value: 'ally with most HP', label: 'Ally with most HP' },\n    { value: 'ally with highest DPR', label: 'Ally with highest DPR' },\n    { value: 'ally with lowest AC', label: 'Ally with lowest AC' },\n    { value: 'ally with highest AC', label: 'Ally with highest AC' },\n]\n\nconst BuffDurationOptions: Options<BuffDuration> = [\n    { value: '1 round', label: \"1 Round\" },\n    { value: 'repeat the save each round', label: \"Repeat the save each round\" },\n    { value: 'entire encounter', label: 'Entire Encounter' },\n    { value: 'until next attack taken', label: 'Until the next attack taken' },\n    { value: 'until next attack made', label: 'Until the next attack made' }\n]\n\nconst BuffStatOptions: Options<keyof Omit<Buff, 'duration' | 'concentration'>> = [\n    { value: 'condition', label: 'Condition' },\n    { value: 'ac', label: 'Armor Class' },\n    { value: 'save', label: 'Bonus to Saves' },\n    { value: 'toHit', label: 'Bonus to hit' },\n    { value: 'dc', label: 'Save DC Bonus' },\n    { value: 'damage', label: 'Extra Damage' },\n    { value: 'damageReduction', label: 'Damage Reduction' },\n    { value: 'damageMultiplier', label: 'Damage Multiplier' },\n    { value: 'damageTakenMultiplier', label: 'Damage Taken Multiplier' },\n]\n\nconst AtkOptions: Options<boolean> = [\n    { value: true, label: 'Save DC:' },\n    { value: false, label: 'To Hit:' },\n]\n\nconst BuffForm: FC<{ value: Buff, onUpdate: (newValue: Buff) => void }> = ({ value, onUpdate }) => {\n    const [modifiers, setModifiers] = useState<(keyof Omit<Buff, 'duration' | 'concentration'>)[]>(Object.keys(value).filter(key => (key !== 'duration') && (key !== 'concentration')) as Array<keyof Omit<Buff, 'duration' | 'concentration'>>)\n\n\n    function setModifier(index: number, newValue: keyof Omit<Buff, 'duration' | 'concentration'> | null) {\n        const oldModifier = modifiers[index]\n        if (oldModifier === newValue) return\n\n        const buffClone = clone(value)\n        delete buffClone[oldModifier]\n        onUpdate(buffClone)\n\n        const modifiersClone = clone(modifiers)\n        if (newValue === null) modifiersClone.splice(index, 1)\n        else modifiersClone[index] = newValue\n        setModifiers(modifiersClone)\n    }\n\n    function updateValue(modifier: keyof Omit<Buff, 'duration' | 'condition' | 'displayName' | 'concentration'>, newValue: number) {\n        const buffClone = clone(value)\n        buffClone[modifier] = newValue\n        onUpdate(buffClone)\n    }\n\n    function updateDiceFormula(modifier: string, newValue: DiceFormula) {\n        const buffClone = clone(value);\n        (buffClone as Buff & Record<string, unknown>)[modifier] = newValue\n        onUpdate(buffClone)\n    }\n\n    function updateCondition(newValue: CreatureCondition | undefined) {\n        const buffClone = clone(value)\n        buffClone.condition = newValue\n        onUpdate(buffClone)\n    }\n\n    function addModifier() {\n        const newModifier = BuffStatOptions.find(({ value }) => !modifiers.includes(value))\n        if (!newModifier) return;\n        setModifiers([...modifiers, newModifier.value])\n    }\n\n    // ... (inside BuffForm)\n    return (\n        <>\n            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem' }}>\n                <Checkbox value={!!value.concentration} onToggle={() => onUpdate({ ...value, concentration: !value.concentration })} />\n                Requires Concentration\n            </div>\n            Effects:\n            {modifiers.map((modifier, index) => (\n                <div key={modifier} className={styles.modifier}>\n                    <Select\n                        value={modifier}\n                        onChange={newValue => setModifier(index, newValue)}\n                        options={BuffStatOptions.filter(option => (modifier === option.value) || !modifiers.includes(option.value))}\n                    />\n                    {((modifier === 'damageMultiplier') || (modifier === 'damageTakenMultiplier')) ? (\n                        <DecimalInput\n                            value={value[modifier]}\n                            onChange={v => updateValue(modifier, v || 0)}\n                        />\n                    ) : (modifier === 'condition') ? (\n                        <Select\n                            value={value.condition}\n                            options={CreatureConditionList.map(condition => ({ value: condition, label: condition }))}\n                            onChange={(newCondition) => updateCondition(newCondition)}\n                        />\n                    ) : (\n                        <DiceFormulaInput\n                            value={value[modifier] as any}\n                            onChange={v => updateDiceFormula(modifier as any, v ?? '')}\n                        />\n                    )}\n                    <button onClick={() => setModifier(index, null)}>\n                        <FontAwesomeIcon icon={faTrash} />\n                    </button>\n                </div>\n            ))}\n\n            <button\n                className=\"tooltipContainer\"\n                disabled={modifiers.length === BuffStatOptions.length}\n                onClick={addModifier}>\n                <FontAwesomeIcon icon={faPlus} />\n                <div className=\"tooltip\">Add effect to the buff/debuff</div>\n            </button>\n        </>\n    )\n}\n\nconst ActionForm: FC<PropType> = ({ value, onChange, onDelete, onMoveUp, onMoveDown }) => {\n    function update(callback: (valueClone: Action) => void) {\n        const valueClone = clone(value)\n        callback(valueClone)\n        onChange(valueClone)\n    }\n\n    function updateFinalAction(callback: (valueClone: FinalAction) => void) {\n        if (value.type === 'template') return\n\n        const valueClone = clone(value)\n        callback(valueClone)\n        onChange(valueClone)\n    }\n\n    function updateTemplateAction(callback: (valueClone: TemplateAction) => void) {\n        if (value.type !== 'template') return\n\n        const valueClone = clone(value)\n        callback(valueClone)\n        onChange(valueClone)\n    }\n\n    function updateFrequency(freq: Frequency) {\n        const v = clone(value)\n\n        v.freq = (freq === v.freq) ? v.freq\n            : (typeof freq === 'string') ? freq\n                : (typeof v.freq === 'string') ? clone(freq)\n                    : (v.freq.reset !== freq.reset) ? clone(freq)\n                        : v.freq\n\n        onChange(v)\n\n    }\n\n    function updateRiderEffect(callback: (riderEffect: { dc: number, buff: Buff }) => void) {\n        update((actionClone) => {\n            const atkAction = (actionClone as AtkAction)\n            if (!atkAction.riderEffect) {\n                atkAction.riderEffect = { dc: 0, buff: { duration: '1 round' } }\n            }\n            callback(atkAction.riderEffect as { dc: number, buff: Buff })\n        })\n    }\n\n    function updateType(type: ActionType) {\n        if (type === value.type) return\n\n        const finalAction = getFinalAction(value)\n\n        const common = {\n            id: value.id,\n            name: finalAction.name,\n            actionSlot: finalAction.actionSlot,\n            cost: finalAction.cost || [],\n            requirements: finalAction.requirements || [],\n            tags: finalAction.tags || [],\n            condition: finalAction.condition,\n            freq: finalAction.freq,\n            targets: finalAction.targets,\n        }\n\n        const templateAction: TemplateAction = {\n            id: value.id,\n            type: 'template',\n            condition: finalAction.condition,\n            freq: finalAction.freq,\n            cost: finalAction.cost || [],\n            requirements: finalAction.requirements || [],\n            tags: finalAction.tags || [],\n            templateOptions: { templateName: 'Fireball', saveDC: 10, toHit: 10, target: 'enemy with least HP' },\n        }\n\n        switch (type) {\n            case \"template\": return onChange(templateAction)\n            case \"atk\": return onChange({ ...common, type, target: \"enemy with most HP\", dpr: 0, toHit: 0 })\n            case \"heal\": return onChange({ ...common, type, amount: 0, target: \"ally with least HP\" })\n            case \"buff\": return onChange({ ...common, type, target: \"ally with highest DPR\", buff: { duration: '1 round' } })\n            case \"debuff\": return onChange({ ...common, type, target: \"enemy with highest DPR\", saveDC: 10, buff: { duration: '1 round' } })\n        }\n    }\n\n    function onTemplateChange(templateName: keyof typeof ActionTemplates) {\n        if (value.type !== 'template') return\n\n        const template = ActionTemplates[templateName]\n        const enemyTarget: EnemyTarget = 'enemy with least HP'\n        const allyTarget: AllyTarget = 'ally with least HP'\n        const defaultTarget: EnemyTarget | AllyTarget = ((template.type === 'atk') || (template.type === 'debuff')) ? enemyTarget : allyTarget\n\n        onChange({\n            ...value,\n            templateOptions: {\n                templateName,\n                toHit: value.templateOptions.toHit || 0,\n                saveDC: value.templateOptions.saveDC || 0,\n                target: value.templateOptions.target || defaultTarget,\n            },\n        })\n    }\n\n    // Analyze action to provide backend feedback\n    function getBackendFeedback() {\n        const feedback = {\n            processors: [] as string[],\n            reactions: [] as string[],\n            effects: [] as string[]\n        }\n\n        // All actions are processed by ActionResolver\n        feedback.processors.push('ActionResolver')\n\n        // Analyze action type for specific backend features\n        switch (value.type) {\n            case 'atk':\n                feedback.processors.push('TargetingSystem')\n                feedback.reactions.push('OpportunityAttack')\n                if (value.riderEffect) {\n                    feedback.effects.push('SaveSystem')\n                    feedback.effects.push('EffectTracking')\n                }\n                if (evaluateDiceFormula(value.dpr, 0.5) > 0) {\n                    feedback.processors.push('DamageCalculation')\n                }\n                break\n            case 'heal':\n                feedback.processors.push('HealingSystem')\n                feedback.effects.push('HPTracking')\n                if ('tempHP' in value && value.tempHP) {\n                    feedback.effects.push('TempHPTracking')\n                }\n                break\n            case 'buff':\n            case 'debuff':\n                feedback.processors.push('BuffSystem')\n                feedback.effects.push('EffectTracking')\n                feedback.effects.push('DurationTracking')\n                if (value.type === 'debuff') {\n                    feedback.reactions.push('ConcentrationSave')\n                }\n                break\n            case 'template':\n                feedback.processors.push('TemplateSystem')\n                feedback.processors.push('SaveSystem')\n                feedback.effects.push('AreaEffect')\n                break\n        }\n\n        // Check frequency for resource management\n        if (value.freq !== 'at will') {\n            feedback.processors.push('ResourceTracking')\n        }\n\n        // Check conditions for conditional processing\n        if (value.condition !== 'default') {\n            feedback.processors.push('ConditionSystem')\n        }\n\n        return feedback\n    }\n\n    return (\n        <div className={styles.actionForm}>\n            <div className={styles.arrowBtns}>\n                <button\n                    onClick={onMoveUp}\n                    disabled={!onMoveUp}>\n                    <FontAwesomeIcon icon={faChevronUp} />\n                </button>\n                <button\n                    onClick={onMoveDown}\n                    disabled={!onMoveDown}>\n                    <FontAwesomeIcon icon={faChevronDown} />\n                </button>\n            </div>\n\n            <button onClick={onDelete}>\n                <FontAwesomeIcon icon={faTrash} />\n            </button>\n\n            {value.type !== 'template' ? (\n                <input\n                    type='text'\n                    value={value.name}\n                    onChange={(e) => updateFinalAction(v => { v.name = e.target.value.length < 100 ? e.target.value : v.name })}\n                    placeholder=\"Action name...\"\n                    style={{ minWidth: `${value.name.length}ch` }}\n                />\n            ) : null}\n\n            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', margin: '0.5rem 0' }}>\n                <Checkbox\n                    value={value.actionSlot === -3}\n                    onToggle={() => update(v => { v.actionSlot = (v.actionSlot === -3) ? 0 : -3 })}\n                />\n                <span style={{ fontSize: '0.9em' }}>Cast before combat</span>\n            </div>\n\n            <Select\n                value={value.actionSlot ?? (value.type === 'template' ? ActionTemplates[value.templateOptions.templateName].actionSlot : 0)}\n                options={ActionOptions}\n                onChange={actionSlot => update(v => { v.actionSlot = actionSlot })} />\n\n            <div style={{ width: '100%', borderTop: '1px solid #eee', marginTop: '4px', paddingTop: '4px' }}>\n                <ActionCostEditor\n                    value={value.cost || []}\n                    onChange={newCost => update(v => { v.cost = newCost })}\n                />\n                <ActionRequirementEditor\n                    value={value.requirements || []}\n                    onChange={newReqs => update(v => { v.requirements = newReqs })}\n                />\n                <TagSelector\n                    value={value.tags || []}\n                    onChange={newTags => update(v => { v.tags = newTags })}\n                />\n            </div>\n\n            <Select value={value.type} options={TypeOptions} onChange={updateType} />\n\n            {value.type === 'template' ? (\n                <Select\n                    value={value.templateOptions.templateName}\n                    options={Object.keys(ActionTemplates).map(key => ({ value: key as keyof typeof ActionTemplates, label: key }))}\n                    onChange={onTemplateChange} />\n            ) : null}\n\n            <Select\n                value={\n                    typeof value.freq === 'string' ? value.freq\n                        : value.freq.reset === 'sr' ? srFreq\n                            : value.freq.reset === 'lr' ? lrFreq\n                                : value.freq.reset === 'recharge' ? rechargeFreq\n                                    : 'at will'\n                }\n                options={FreqOptions}\n                onChange={freq => updateFrequency(freq)} />\n\n            {typeof value.freq !== 'string' ? (\n                value.freq.reset === 'recharge' ? (\n                    <>\n                        Cooldown in rounds:\n                        <input\n                            type='number'\n                            min={2}\n                            step={1}\n                            className={value.freq.cooldownRounds < 2 ? styles.invalid : ''}\n                            value={value.freq.cooldownRounds}\n                            onChange={e => update(v => { (v.freq as any).cooldownRounds = Number(e.target.value || 0) })} />\n                    </>\n                ) : (\n                    <>\n                        Uses:\n                        <input\n                            type='number'\n                            min={1}\n                            step={1}\n                            className={value.freq.uses < 1 ? styles.invalid : ''}\n                            value={value.freq.uses}\n                            onChange={e => update(v => { (v.freq as any).uses = Number(e.target.value || 0) })} />\n                    </>\n                )\n            ) : null}\n\n            {((value.type === 'atk') && (!value.useSaves)) ? (\n                <Select value={value.targets} options={HitCountOptions} onChange={targets => updateFinalAction(v => v.targets = targets)} />\n            ) : (value.type !== 'template') ? (\n                <Select value={value.targets} options={TargetCountOptions} onChange={targets => updateFinalAction(v => { v.targets = targets })} />\n            ) : null}\n            Use this action if:\n            <Select value={value.condition} options={ConditionOptions} onChange={condition => update(v => { v.condition = condition })} />\n\n            {(value.type === \"atk\") ? (\n                <>\n                    <Select\n                        value={!!value.useSaves}\n                        options={AtkOptions}\n                        onChange={useSaves => update(v => {\n                            const atk = (v as AtkAction);\n                            if (atk.useSaves !== useSaves) atk.targets = 1\n                            atk.useSaves = useSaves\n                        })} />\n                    <DiceFormulaInput value={value.toHit} onChange={toHit => update(v => { (v as AtkAction).toHit = toHit || 0 })} />\n                    Damage:\n                    <DiceFormulaInput value={value.dpr} onChange={dpr => update(v => { (v as AtkAction).dpr = dpr || 0 })} canCrit={!value.useSaves} />\n\n                    {value.useSaves ? (\n                        <>\n                            Save for half?\n                            <Select\n                                value={!!value.halfOnSave}\n                                options={[{ value: true, label: 'Yes' }, { value: false, label: 'No' }]}\n                                onChange={halfOnSave => update(v => { (v as AtkAction).halfOnSave = halfOnSave })} />\n                        </>\n                    ) : null}\n\n                    Target:\n                    <Select value={value.target} options={EnemyTargetOptions} onChange={target => updateFinalAction(v => { v.target = target })} />\n                    On Hit Effect:\n                    <Select\n                        value={value.riderEffect !== undefined}\n                        options={[{ value: true, label: 'Yes' }, { value: false, label: 'No' }]}\n                        onChange={b => {\n                            if (b) update(v => { (v as AtkAction).riderEffect ||= { dc: 0, buff: { duration: \"1 round\" } } })\n                            else update(v => { delete (v as AtkAction).riderEffect })\n                        }} />\n\n                    {(value.riderEffect) ? (\n                        <>\n                            Save DC:\n                            <DecimalInput value={value.riderEffect.dc} onChange={dc => updateRiderEffect(e => { e.dc = dc || 0 })} />\n                            Duration:\n                            <Select value={value.riderEffect.buff.duration} options={BuffDurationOptions} onChange={duration => updateRiderEffect(e => { e.buff.duration = duration })} />\n                            <BuffForm value={value.riderEffect.buff} onUpdate={newValue => updateRiderEffect(e => { e.buff = newValue })} />\n                        </>\n                    ) : null}\n                </>\n            ) : null}\n            {(value.type === \"heal\") ? (\n                <>\n                    <Select\n                        value={!!value.tempHP}\n                        options={[{ value: true, label: 'Temp HP:' }, { value: false, label: 'Heal Amount:' }]}\n                        onChange={tempHP => update(v => { (v as HealAction).tempHP = tempHP })} />\n                    <DiceFormulaInput value={value.amount} onChange={heal => update(v => { (v as HealAction).amount = heal || 0 })} />\n                    Target:\n                    <Select value={value.target} options={AllyTargetOptions} onChange={target => updateFinalAction(v => { v.target = target })} />\n                </>\n            ) : null}\n            {(value.type === \"buff\") ? (\n                <>\n                    Target:\n                    <Select value={value.target} options={AllyTargetOptions} onChange={target => updateFinalAction(v => { v.target = target })} />\n                    Duration:\n                    <Select value={value.buff.duration} options={BuffDurationOptions} onChange={duration => update(v => { (v as BuffAction).buff.duration = duration })} />\n                    <BuffForm value={value.buff} onUpdate={newValue => update(v => { (v as BuffAction).buff = newValue })} />\n                </>\n            ) : null}\n            {(value.type === \"debuff\") ? (\n                <>\n                    Target:\n                    <Select value={value.target} options={EnemyTargetOptions} onChange={target => updateFinalAction(v => { v.target = target })} />\n                    Duration:\n                    <Select value={value.buff.duration} options={BuffDurationOptions} onChange={duration => update(v => { (v as DebuffAction).buff.duration = duration })} />\n                    Save DC:\n                    <input type='number' value={value.saveDC} onChange={e => update(v => { (v as DebuffAction).saveDC = Number(e.target.value) })} />\n                    <BuffForm value={value.buff} onUpdate={newValue => update(v => { (v as DebuffAction).buff = newValue })} />\n                </>\n            ) : null}\n            {(value.type === \"template\") ? (() => {\n                const template = ActionTemplates[value.templateOptions.templateName]\n\n                const targetForm = template.target ? null : (\n                    <>\n                        Target:\n                        <Select\n                            value={value.templateOptions.target}\n                            options={((template.type === 'atk') || (template.type === 'debuff')) ? EnemyTargetOptions : AllyTargetOptions}\n                            onChange={target => updateTemplateAction(v => { v.templateOptions.target = target })} />\n                    </>\n                )\n\n                if (template.type === 'atk') return (\n                    <>\n                        {template.useSaves ? 'Save DC:' : 'To hit:'}\n                        <DiceFormulaInput value={value.templateOptions.toHit} onChange={toHit => updateTemplateAction(v => { v.templateOptions.toHit = toHit || 0 })} />\n                        {template.riderEffect ? (\n                            <>\n                                Save DC for the additional effects:\n                                <input type='number' value={value.templateOptions.saveDC} onChange={e => updateTemplateAction(v => { v.templateOptions.saveDC = Number(e.target.value) })} />\n                            </>\n                        ) : null}\n                        {targetForm}\n                    </>\n                )\n                if (template.type === 'debuff') return (\n                    <>\n                        Save DC:\n                        <input\n                            type='number'\n                            value={value.templateOptions.saveDC}\n                            onChange={e => updateTemplateAction(v => { v.templateOptions.saveDC = Number(e.target.value) })} />\n                        {targetForm}\n                    </>\n                )\n\n                return targetForm\n            })() : null}\n\n            {/* Backend Feature Feedback Panel - Only shown in dev mode */}\n            {inDevEnvironment ? (\n                <div className={styles.backendFeedback}>\n                    <div className={styles.feedbackTitle}> Backend Processing</div>\n                    <div className={styles.feedbackItems}>\n                        {(() => {\n                            const feedback = getBackendFeedback()\n                            return [\n                                ...feedback.processors.map(processor => (\n                                    <div key={processor} className={styles.feedbackItem}>\n                                         {processor}\n                                    </div>\n                                )),\n                                ...feedback.reactions.map(reaction => (\n                                    <div key={reaction} className={`${styles.feedbackItem} ${styles.reaction}`}>\n                                         {reaction}\n                                    </div>\n                                )),\n                                ...feedback.effects.map(effect => (\n                                    <div key={effect} className={`${styles.feedbackItem} ${styles.effect}`}>\n                                         {effect}\n                                    </div>\n                                ))\n                            ]\n                        })()}\n                    </div>\n                </div>\n            ) : null}\n        </div>\n    )\n}\n\nexport default ActionForm","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/creatureForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Action' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useEffect, useState, useRef } from \"react\"\nimport { Action, Creature, CreatureSchema } from \"@/model/model\"\nimport { clone } from \"@/model/utils\"\nimport styles from './creatureForm.module.scss'\nimport PlayerForm from \"./playerForm\"\nimport MonsterForm from \"./monsterForm\"\nimport CustomForm from \"./customForm\"\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faCheck, faTrash, faWrench } from \"@fortawesome/free-solid-svg-icons\"\nimport { v4 as uuid } from 'uuid'\nimport Modal from \"../utils/modal\"\nimport DecimalInput from \"@/utils/DecimalInput\"\nimport * as Dialog from \"@radix-ui/react-dialog\"\n\ntype PropType = {\n    onSubmit: (value: Creature) => void,\n    onCancel: () => void,\n\n    initialMode?: 'player'|'monster',\n    initialValue?: Creature,\n    onDelete?: () => void,\n}\n\nfunction newCreature(mode: 'player'|'monster'): Creature {\n    return {\n        id: uuid(),\n        mode,\n        name: (mode === 'player') ? 'Player Character' : 'Monster',\n        ac: 10,\n        saveBonus: 2,\n        count: 1,\n        hp: 10,\n        actions: [],\n        magicItems: [],\n        initialBuffs: [],\n    }\n}\n\nconst CreatureForm:FC<PropType> = ({ initialMode, onSubmit, onCancel, initialValue, onDelete }) => {\n    const [value, setValue] = useState<Creature>(initialValue || newCreature(initialMode || 'player'))\n    const [isValid, setIsValid] = useState(false)\n    const valueRef = useRef(value)\n    \n    // Track if fields were manually edited to avoid template overwrites\n    const isNameDirty = useRef(initialValue !== undefined && initialValue.name !== 'Player Character' && initialValue.name !== 'Monster')\n\n    useEffect(() => {\n        valueRef.current = value\n        if (!CreatureSchema.safeParse(value).success) {\n            setIsValid(false)\n            return\n        }\n\n        if (value.mode === 'player') {\n            setIsValid(!!value.class)\n        } else if (value.mode === 'monster') {\n            setIsValid(!!value.cr)\n        } else {\n            setIsValid(true)\n        }\n    }, [value])\n\n    function update(callback: (clonedValue: Creature) => void) {\n        setValue(prev => {\n            const clonedValue = clone(prev)\n            callback(clonedValue)\n            return clonedValue\n        })\n    }\n\n    const handleChildChange = (newValue: Creature) => {\n        setValue(prev => {\n            const merged = { ...newValue };\n            // If user manually edited name, preserve it unless child is specifically MonsterForm and just selected a monster\n            if (isNameDirty.current && prev.mode === newValue.mode) {\n                merged.name = prev.name;\n            }\n            return merged;\n        });\n    }\n\n    return (\n        <Modal onCancel={onCancel} className={styles.creatureForm} title={`Edit ${value.name}`} data-testid=\"creature-modal\">\n            <Dialog.Title className=\"sr-only\">Edit Creature: {value.name}</Dialog.Title>\n            <Dialog.Description className=\"sr-only\">Form to edit creature statistics, actions and game plan.</Dialog.Description>\n            \n            <div className={styles.modes} role=\"tablist\" aria-label=\"Creature type\" data-testid=\"mode-toggle\">\n                <button\n                    role=\"tab\"\n                    aria-selected={value.mode === 'player'}\n                    aria-controls=\"creature-form-panel\"\n                    className={(value.mode === 'player') ? styles.active : undefined}\n                    onClick={() => update(c => { c.mode = 'player' })}\n                    data-testid=\"mode-player\"\n                >\n                    Player Character\n                </button>\n                <button\n                    role=\"tab\"\n                    aria-selected={value.mode === 'monster'}\n                    aria-controls=\"creature-form-panel\"\n                    className={(value.mode === 'monster') ? styles.active : undefined}\n                    onClick={() => update(c => { c.mode = 'monster' })}\n                    data-testid=\"mode-monster\"\n                >\n                    Monster\n                </button>\n                <button\n                    role=\"tab\"\n                    aria-selected={value.mode === 'custom'}\n                    aria-controls=\"creature-form-panel\"\n                    className={(value.mode === 'custom') ? styles.active : undefined}\n                    onClick={() => update(c => { c.mode = 'custom' })}\n                    data-testid=\"mode-custom\"\n                >\n                    Custom\n                </button>\n            </div>\n\n            <div className={styles.form} id=\"creature-form-panel\" role=\"tabpanel\">\n                <section className={styles.commonFields}>\n                    <div className={styles.row}>\n                        <div className={styles.field}>\n                            <h3>Name</h3>\n                            <input\n                                type='text'\n                                value={value.name}\n                                onChange={e => {\n                                    isNameDirty.current = true;\n                                    update(v => { v.name = e.target.value });\n                                }}\n                                placeholder=\"Creature Name\"\n                                data-testid=\"creature-name-input\"\n                            />\n                        </div>\n                        <div className={styles.field} style={{ width: '80px' }}>\n                            <h3>Count</h3>\n                            <input\n                                type='number'\n                                min={1} max={20}\n                                value={value.count}\n                                onChange={e => update(v => { v.count = Math.max(1, Math.min(20, Math.round(Number(e.target.value)))) })}\n                                data-testid=\"count-input\"\n                            />\n                        </div>\n                    </div>\n                    <div className={styles.row}>\n                        <div className={styles.field}>\n                            <h3>Hit Points</h3>\n                            <DecimalInput min={0} value={value.hp} onChange={hp => update(v => { v.hp = hp || 0 })} data-testid=\"hp-input\" />\n                        </div>\n                        <div className={styles.field}>\n                            <h3>Armor Class</h3>\n                            <DecimalInput min={0} value={value.ac} onChange={ac => update(v => { v.ac = ac || 0 })} data-testid=\"ac-input\" />\n                        </div>\n                    </div>\n                </section>\n\n                { (value.mode === \"player\") ? (\n                    <PlayerForm\n                        value={value}\n                        onChange={handleChildChange}\n                    />\n                ) : (value.mode === \"monster\") ? (\n                    <MonsterForm\n                        value={value}\n                        onChange={(v) => {\n                            isNameDirty.current = false; // Reset dirty flag when selecting a new monster\n                            setValue(v);\n                        }}\n                    />\n                ) : (\n                    <CustomForm\n                        value={value}\n                        onChange={handleChildChange}\n                    />\n                )}\n            </div>\n\n            <div className={styles.buttons}>\n                <button\n                    onClick={onCancel}\n                    aria-label=\"Cancel\"\n                    data-testid=\"cancel-creature-btn\"\n                >\n                    Cancel\n                </button>\n                <div className=\"tooltipContainer\">\n                    <button\n                        onClick={() => {\n                            onSubmit(valueRef.current)\n                        }}\n                        disabled={!isValid}\n                        style={{ width: '100%' }}\n                        aria-label=\"Confirm changes\"\n                        data-testid=\"save-creature-btn\"\n                    >\n                        <FontAwesomeIcon icon={faCheck} />\n                        OK\n                    </button>\n                    \n                    <span className=\"tooltip\" role=\"tooltip\">\n                        { isValid \n                            ? \"Save this creature for the current encounter\"\n                            : \"Please fix the errors in the form before saving\"\n                        }\n                    </span>\n                </div>\n                { (value.mode === 'custom') ? null : (\n                    <div className=\"tooltipContainer\">\n                        <button \n                            onClick={() => setValue({...value, mode: 'custom'})} \n                            disabled={!isValid} \n                            aria-label=\"Advanced customization\"\n                        >\n                            <FontAwesomeIcon icon={faWrench} />\n                            Customize\n                        </button>\n                        <span className=\"tooltip\" role=\"tooltip\">\n                            Go to the advanced editing mode\n                        </span>\n                    </div>\n                )}\n                { !onDelete ? null : (\n                    <div className=\"tooltipContainer\">\n                        <button \n                            onClick={onDelete} \n                            aria-label=\"Delete creature\"\n                        >\n                            <FontAwesomeIcon icon={faTrash} />\n                            Delete\n                        </button>\n                        <span className=\"tooltip\" role=\"tooltip\">\n                            Remove this creature from the current encounter\n                        </span>\n                    </div>\n                )}\n            </div>\n        </Modal>\n    )\n}\n\nexport default CreatureForm","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/customForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ReactNode' is defined but never used.","line":1,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, ReactNode, useState } from \"react\"\nimport { Action, Creature } from \"@/model/model\"\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faFolder, faPlus, faSave, faCog } from \"@fortawesome/free-solid-svg-icons\"\nimport styles from './customForm.module.scss'\nimport { clone } from \"@/model/utils\"\nimport ActionForm from \"./actionForm\"\nimport ResourceEditor from \"./ResourceEditor\"\nimport StrategyBuilder from \"./StrategyBuilder\"\nimport DecimalInput from \"@/utils/DecimalInput\"\nimport DiceFormulaInput from \"@/utils/diceFormulaInput\"\nimport { DiceFormula } from \"@/model/model\"\nimport Checkbox from \"@/utils/checkbox\"\nimport { v4 as uuid } from 'uuid'\nimport LoadCreatureForm, { saveCreature } from \"./loadCreatureForm\"\nimport SaveBonusModal from \"./SaveBonusModal\"\nimport ImportButton from \"./ImportButton\"\n\ntype PropType = {\n    value: Creature,\n    onChange: (newvalue: Creature) => void,\n}\n\nconst CustomForm: FC<PropType> = ({ value, onChange }) => {\n    const [isLoading, setIsLoading] = useState(false)\n    const [isSaveModalOpen, setIsSaveModalOpen] = useState(false)\n\n    function update(callback: (valueClone: Creature) => void) {\n        const valueClone = clone(value)\n        callback(valueClone)\n        onChange(valueClone)\n    }\n\n    function handleImport(creature: Creature) {\n        onChange({\n            ...creature,\n            id: value.id, // Keep the same ID\n            mode: 'custom', // Force custom mode\n            count: value.count // Preserve count\n        });\n    }\n\n    function createAction() {\n        update(v => {\n            v.actions.push({\n                id: uuid(),\n                actionSlot: 0, // legacy field - default action\n                cost: [], // empty cost array for new actions\n                requirements: [], // empty requirements array\n                tags: [], // empty tags array\n                name: '',\n                freq: 'at will',\n                condition: 'default',\n                targets: 1,\n                type: 'atk',\n                dpr: 0,\n                toHit: 0,\n                target: 'enemy with least HP',\n            })\n        })\n    }\n\n    function updateAction(index: number, newValue: Action) {\n        update(v => { v.actions[index] = newValue })\n    }\n\n    function deleteAction(index: number) {\n        update(v => { v.actions.splice(index, 1) })\n    }\n\n    const canSaveTemplate = !!localStorage && !!localStorage.getItem('useLocalStorage')\n\n    // Check if any individual saves are overridden\n    const hasDetailedSaves = value.strSaveBonus !== undefined ||\n        value.dexSaveBonus !== undefined ||\n        value.conSaveBonus !== undefined ||\n        value.intSaveBonus !== undefined ||\n        value.wisSaveBonus !== undefined ||\n        value.chaSaveBonus !== undefined ||\n        value.conSaveAdvantage ||\n        value.saveAdvantage;\n\n    return (\n        <div className={styles.customForm}>\n            <section>\n                <div className={styles.nameContainer}>\n                    <input\n                        type='number'\n                        min={1}\n                        max={20}\n                        value={value.count}\n                        onChange={e => update(v => { v.count = Math.max(1, Math.min(20, Math.round(Number(e.target.value)))) })}\n                        data-testid=\"count-input\"\n                        className={styles.countInput}\n                        aria-label=\"Count\"\n                    />\n                    {canSaveTemplate ? (\n                        <>\n                            <button onClick={() => saveCreature(value)}>\n                                <FontAwesomeIcon icon={faSave} />\n                                <span className={styles.btnText}>Save</span>\n                            </button>\n                            <button onClick={() => setIsLoading(true)}>\n                                <FontAwesomeIcon icon={faFolder} />\n                                <span className={styles.btnText}>Load</span>\n                            </button>\n                            <ImportButton \n                                onImport={handleImport}\n                                className={styles.importBtn}\n                            />\n                        </>\n                    ) : (\n                        <ImportButton \n                            onImport={handleImport}\n                            className={styles.importBtn}\n                        />\n                    )}\n                </div>\n            </section>\n            <section>\n                <h3>Hit Points</h3>\n                <DecimalInput min={0} value={value.hp} onChange={hp => update(v => { v.hp = hp || 0 })} data-testid=\"hp-input\" />\n            </section>\n            <section>\n                <h3>Armor Class</h3>\n                <DecimalInput min={0} value={value.ac} onChange={ac => update(v => { v.ac = ac || 0 })} data-testid=\"ac-input\" />\n            </section>\n            <section className=\"tooltipContainer\">\n                <h3>Average Save Bonus</h3>\n                <div className={styles.saveRow}>\n                    <DecimalInput min={0} value={value.saveBonus} onChange={save => update(v => { v.saveBonus = save || 0 })} />\n                    <button\n                        onClick={() => setIsSaveModalOpen(true)}\n                        className={styles.detailsBtn}\n                        title=\"Configure individual saves and advantages\"\n                    >\n                        <FontAwesomeIcon icon={faCog} />\n                        <span>Details</span>\n                        {hasDetailedSaves && <span className={styles.badge}></span>}\n                    </button>\n                </div>\n                <div className=\"tooltip\">Average of all saves' bonuses. Click \"Details\" to set individual save bonuses and advantages (e.g., CON save advantage for Concentration).</div>\n            </section>\n            <section>\n                <h3>Initiative Bonus</h3>\n                <DiceFormulaInput value={value.initiativeBonus || 0} onChange={(init: DiceFormula | undefined) => update(v => { v.initiativeBonus = init || 0 })} />\n            </section>\n            <section>\n                <h3>Initiative Advantage</h3>\n                <Checkbox value={!!value.initiativeAdvantage} onToggle={() => update(v => { v.initiativeAdvantage = !v.initiativeAdvantage })} />\n            </section>\n\n            <ResourceEditor value={value} onChange={onChange} />\n\n            <StrategyBuilder\n                actions={value.actions}\n                onReorder={(newActions) => update(v => { v.actions = newActions })}\n            />\n\n            <h3 className={styles.actionsHeader}>\n                <span className={styles.label}>Actions (Detailed)</span>\n                <button\n                    onClick={createAction}\n                    className={styles.createActionBtn}>\n                    <FontAwesomeIcon icon={faPlus} />\n                </button>\n            </h3>\n            <div className={styles.actions}>\n                {value.actions.map((action, index) => (\n                    <ActionForm\n                        key={action.id}\n                        value={action}\n                        onChange={(a) => updateAction(index, a)}\n                        onDelete={() => deleteAction(index)}\n                        onMoveUp={(index <= 0) ? undefined : () => update(v => {\n                            v.actions[index] = v.actions[index - 1]\n                            v.actions[index - 1] = action\n                        })}\n                        onMoveDown={(index >= value.actions.length - 1) ? undefined : () => update(v => {\n                            v.actions[index] = v.actions[index + 1]\n                            v.actions[index + 1] = action\n                        })}\n                    />\n                ))}\n            </div>\n\n            {isLoading ? (\n                <LoadCreatureForm\n                    onLoad={(creature) => { onChange(creature); setIsLoading(false) }}\n                    onCancel={() => setIsLoading(false)} />\n            ) : null}\n\n            {isSaveModalOpen && (\n                <SaveBonusModal\n                    value={value}\n                    onChange={onChange}\n                    onClose={() => setIsSaveModalOpen(false)}\n                />\n            )}\n        </div>\n    )\n}\n\nexport default CustomForm","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/loadCreatureForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCalculatedState' is defined but never used.","line":6,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":35},{"ruleId":"no-constant-binary-expression","severity":1,"message":"Unexpected constant binary expression. Compares constantly with the right-hand side of the `===`.","line":18,"column":9,"nodeType":"UnaryExpression","messageId":"constantBinaryOperand","endLine":18,"endColumn":28},{"ruleId":"valid-typeof","severity":1,"message":"Invalid typeof comparison value.","line":18,"column":33,"nodeType":"Identifier","messageId":"invalidValue","endLine":18,"endColumn":42,"suggestions":[{"messageId":"suggestString","data":{"type":"undefined"},"fix":{"range":[642,651],"text":"\"undefined\""},"desc":"Use `\"undefined\"` instead of `undefined`."}]},{"ruleId":"no-constant-binary-expression","severity":1,"message":"Unexpected constant binary expression. Compares constantly with the right-hand side of the `===`.","line":33,"column":9,"nodeType":"UnaryExpression","messageId":"constantBinaryOperand","endLine":33,"endColumn":28},{"ruleId":"valid-typeof","severity":1,"message":"Invalid typeof comparison value.","line":33,"column":33,"nodeType":"Identifier","messageId":"invalidValue","endLine":33,"endColumn":42,"suggestions":[{"messageId":"suggestString","data":{"type":"undefined"},"fix":{"range":[1001,1010],"text":"\"undefined\""},"desc":"Use `\"undefined\"` instead of `undefined`."}]},{"ruleId":"no-constant-binary-expression","severity":1,"message":"Unexpected constant binary expression. Compares constantly with the right-hand side of the `===`.","line":62,"column":13,"nodeType":"UnaryExpression","messageId":"constantBinaryOperand","endLine":62,"endColumn":32},{"ruleId":"valid-typeof","severity":1,"message":"Invalid typeof comparison value.","line":62,"column":37,"nodeType":"Identifier","messageId":"invalidValue","endLine":62,"endColumn":46,"suggestions":[{"messageId":"suggestString","data":{"type":"undefined"},"fix":{"range":[1985,1994],"text":"\"undefined\""},"desc":"Use `\"undefined\"` instead of `undefined`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useState } from \"react\";\nimport { Creature, CreatureSchema } from \"@/model/model\";\nimport styles from './loadCreatureForm.module.scss'\nimport Modal from \"../utils/modal\";\nimport { z } from 'zod'\nimport { clone, useCalculatedState } from \"@/model/utils\";\nimport SortTable from \"@/utils/sortTable\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faFolder, faTrash } from \"@fortawesome/free-solid-svg-icons\";\nimport { v4 as uuid } from 'uuid';\n\ntype PropType = {\n    onCancel: () => void,\n    onLoad: (newCreature: Creature) => void,\n}\n\nfunction loadSaves(): Creature[] {\n    if (typeof localStorage === undefined) return []\n\n    const json = localStorage.getItem('savedCreatures')\n    if (!json) return []\n    \n    const obj = JSON.parse(json)\n    const parsed = z.array(CreatureSchema).safeParse(obj)\n\n    if (parsed.success) {\n        return parsed.data\n    }\n    return []\n}\n\nexport function saveCreature(creature: Creature) {\n    if (typeof localStorage === undefined) return\n    if (!localStorage.getItem('useLocalStorage')) return\n\n    const saves = loadSaves()\n\n    const existingIndex = saves.findIndex(save => (save.id === creature.id) && (save.name === creature.name))\n\n    if (existingIndex != -1) {\n        saves[existingIndex] = creature\n    } else {\n        saves.push(creature)\n    }\n\n    localStorage.setItem('savedCreatures', JSON.stringify(saves))\n}\n\nconst LoadCreatureForm:FC<PropType> = ({ onCancel, onLoad }) => {\n    const [selected, setSelected] = useState<Creature|undefined>(undefined)\n    const [saves, setSaves] = useState(loadSaves())\n\n    function deleteSave(creature: Creature) {\n        const index = saves.findIndex((save) => (save.id === creature.id) && (save.name === creature.name))\n        if (index === -1) return\n\n        const savesClone = clone(saves)\n        savesClone.splice(index, 1)\n        setSaves(savesClone)\n        setTimeout(() => setSelected(undefined), 0)\n\n        if (typeof localStorage === undefined) return\n        if (!localStorage.getItem('useLocalStorage')) return\n        localStorage.setItem('savedCreatures', JSON.stringify(savesClone))\n    }\n\n    return (\n        <Modal onCancel={onCancel} className={styles.loadCreature}>\n            <SortTable\n                value={selected}\n                list={saves}\n                onChange={setSelected}\n                comparators={{\n                    Name: (a, b) => a.name.localeCompare(b.name),\n                }}>\n                    { creature => (\n                        <div className={styles.creature}>\n                            <span className={styles.creatureName}>{creature.name}</span>\n                            <button onClick={() => deleteSave(creature)}><FontAwesomeIcon icon={faTrash} /></button>\n                        </div>\n                    )}\n            </SortTable>\n\n            <button\n                disabled={selected === undefined}\n                onClick={() => selected && onLoad({ ...clone(selected), id: uuid() })}>\n                    <FontAwesomeIcon icon={faFolder} />\n                    Load {selected !== undefined ? selected.name : null}\n            </button>\n        </Modal>\n    )\n}\n\nexport default LoadCreatureForm","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/monsterForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":122,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":125,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[640,643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[640,643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":92,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":126,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":129,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4053,4056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4053,4056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":97,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":74}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useEffect, useState } from \"react\"\nimport { Creature, CreatureSchema } from \"@/model/model\"\nimport styles from './monsterForm.module.scss'\nimport { ChallengeRating, ChallengeRatingList, CreatureType, CreatureTypeList, numericCR } from \"@/model/enums\"\nimport { capitalize, clone, sharedStateGenerator, useCalculatedState } from \"@/model/utils\"\nimport Range from \"@/utils/range\"\nimport SortTable from \"@/utils/sortTable\"\n\ntype PropType = {\n    value: Creature,\n    onChange: (newvalue: Creature) => void,\n}\n\nconst defaultTypeFilter: {[type in CreatureType]: boolean} = Object.fromEntries(CreatureTypeList.map(t => [t, true])) as any\n\nconst MonsterForm:FC<PropType> = ({ onChange, value }) => {\n    const useSharedState = sharedStateGenerator('monsterForm')\n    const [creatureType, setCreatureType] = useSharedState(defaultTypeFilter)\n    const [minCR, setMinCR] = useSharedState<ChallengeRating>(ChallengeRatingList[0])\n    const [maxCR, setMaxCR] = useSharedState<ChallengeRating>(ChallengeRatingList[ChallengeRatingList.length - 2])\n    const [search, setSearch] = useSharedState<string>('')\n    const [monsters, setMonsters] = useState<Creature[]>([])\n\n    useEffect(() => {\n        const loadMonsters = async () => {\n            try {\n                const response = await fetch('./data/monsters.json');\n                const data = await response.json();\n                setMonsters(data);\n            } catch (error) {\n                console.error(\"Failed to load monsters:\", error);\n            }\n        };\n        loadMonsters();\n    }, []);\n\n    const searchResults = useCalculatedState(() => monsters.filter(monster => {\n        if (!monster.name.toLocaleLowerCase().includes(search.toLocaleLowerCase())) return false\n        if (!monster.cr) return false\n        if (numericCR(monster.cr) > numericCR(maxCR)) return false\n        if (numericCR(monster.cr) < numericCR(minCR)) return false\n        if (!monster.type) return false\n        if (!creatureType[monster.type]) return false\n\n        return true\n    }), [creatureType, minCR, maxCR, search, monsters])\n    \n    function toggleCreatureType(type: CreatureType) {\n        const newValue = clone(creatureType)\n        newValue[type] = !newValue[type]\n        setCreatureType(newValue)\n    }\n\n    function selectMonster(monster: Creature) {\n        const templates = JSON.parse(localStorage.getItem('monsterTemplates') || \"{}\")\n        const monsterTemplate = CreatureSchema.safeParse(templates[monster.id])\n\n        const creature = monsterTemplate.success ? monsterTemplate.data : clone(monster)\n        \n        // Preserve parent's ID\n        creature.id = value?.id || creature.id;\n        \n        // Keep parent's count if already set\n        creature.count = value?.count || 1;\n        \n        // IMPORTANT: In monster search, selecting a monster SHOULD overwrite the Name/HP/AC\n        // unless they were dirty? No, usually you want the monster stats.\n        // We'll let onChange propagate the new monster data.\n        \n        onChange(creature)\n    }\n\n    return (\n        <div className={styles.monsterForm}>\n            <section>\n                <h3>Search Monster</h3>\n                <input \n                    type='text' \n                    value={search} \n                    onChange={e => setSearch(e.target.value)} \n                    placeholder='Bandit...'  \n                    autoFocus={true} \n                    data-testid=\"monster-search\" \n                />\n            </section>\n\n            <section>\n                <h3>Creature Type</h3>\n                <div className={styles.creatureTypes}>\n                    <button \n                        onClick={() => setCreatureType(defaultTypeFilter)} \n                        className={!Object.entries(creatureType).find(([_, b]) => !b) ? styles.active : undefined}>\n                            All\n                    </button>\n                    <button \n                        onClick={() => setCreatureType(Object.fromEntries(Object.keys(creatureType).map(t => [t, false])) as any)} \n                        className={!Object.entries(creatureType).find(([_, b]) => b) ? styles.active : undefined}>\n                            None\n                    </button>\n                    { CreatureTypeList.map(type => (\n                        <button\n                            key={type}\n                            onClick={() => toggleCreatureType(type)}\n                            className={creatureType[type] ? styles.active : undefined}>\n                                {capitalize(type)}\n                        </button>\n                    )) }\n                </div>\n            </section>\n            \n            <section className={styles.challengeRating}>\n                <h3>Challenge Rating</h3>\n                <Range\n                    values={[ChallengeRatingList.indexOf(minCR), ChallengeRatingList.indexOf(maxCR)]}\n                    min={0}\n                    max={ChallengeRatingList.length - 2}\n                    onChange={async (values: number[]) => { await setMaxCR(ChallengeRatingList[values[1]]); await setMinCR(ChallengeRatingList[values[0]]) }}\n                    label={minCR}\n                    upperLabel={maxCR}\n                />\n            </section>\n\n            <SortTable\n                value={value}\n                list={searchResults}\n                comparators={{\n                    Name: (a: Creature, b: Creature) => a.name.localeCompare(b.name),\n                    CR: (a: Creature, b: Creature) => (numericCR(a.cr!) - numericCR(b.cr!)),\n                }}\n                onChange={selectMonster}\n                data-testid=\"monster-select\">\n                    { monster => (\n                        <div className={styles.monster}>\n                            <span className={styles.name}>{monster.name}</span>\n                            <span className={styles.stats}>{monster.type}, {monster.src}</span>\n                            <span className={styles.stats}>CR {monster.cr}</span>\n                            {monster.speed_fly && <span className={styles.stats}>Speed Fly {monster.speed_fly}</span>}\n                        </div>\n                    )}\n            </SortTable>\n        </div>\n    )\n}\n\nexport default MonsterForm","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/creatureForm/playerForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":1,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2633,2636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2633,2636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2751,2754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2751,2754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3565,3568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3565,3568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6056,6059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6056,6059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6080,6083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6080,6083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6594,6597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6594,6597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7477,7480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7477,7480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7501,7504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7501,7504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8015,8018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8015,8018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8735,8738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8735,8738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8759,8762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8759,8762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9273,9276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9273,9276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9917,9920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9917,9920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9940,9943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9940,9943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10455,10458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10455,10458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11102,11105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11102,11105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11125,11128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11125,11128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":257,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11640,11643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11640,11643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useEffect, useState } from \"react\"\nimport { Creature } from \"@/model/model\"\nimport styles from './playerForm.module.scss'\nimport { Class, ClassesList } from \"@/model/enums\"\nimport { capitalize, clone, range } from \"@/model/utils\"\nimport { PlayerTemplates } from \"@/data/data\"\nimport ClassOptions from \"@/model/classOptions\"\nimport { z } from \"zod\"\nimport Checkbox from \"@/utils/checkbox\"\nimport Range from \"@/utils/range\"\n\ntype PropType = {\n    value?: Creature,\n    onChange: (newvalue: Creature) => void,\n}\n\ntype ClassForm = { type: 'artificer', options: z.infer<typeof ClassOptions.artificer> }\n    | { type: 'barbarian', options: z.infer<typeof ClassOptions.barbarian> }\n    | { type: 'bard', options: z.infer<typeof ClassOptions.bard> }\n    | { type: 'cleric', options: z.infer<typeof ClassOptions.cleric> }\n    | { type: 'druid', options: z.infer<typeof ClassOptions.druid> }\n    | { type: 'fighter', options: z.infer<typeof ClassOptions.fighter> }\n    | { type: 'monk', options: z.infer<typeof ClassOptions.monk> }\n    | { type: 'paladin', options: z.infer<typeof ClassOptions.paladin> }\n    | { type: 'ranger', options: z.infer<typeof ClassOptions.ranger> }\n    | { type: 'rogue', options: z.infer<typeof ClassOptions.rogue> }\n    | { type: 'sorcerer', options: z.infer<typeof ClassOptions.sorcerer> }\n    | { type: 'warlock', options: z.infer<typeof ClassOptions.warlock> }\n    | { type: 'wizard', options: z.infer<typeof ClassOptions.wizard> }\n\ntype ClassOptionsMap = {\n    [K in Class]: z.infer<typeof ClassOptions[K]>\n}\n\nconst DefaultOptions: ClassOptionsMap = {\n    artificer: {},\n    barbarian: { gwm: false, weaponBonus: 0 },\n    bard: {},\n    cleric: {},\n    druid: {},\n    fighter: { gwm: false, weaponBonus: 0 },\n    monk: {},\n    paladin: { gwm: false, weaponBonus: 0 },\n    ranger: { ss: false, weaponBonus: 0 },\n    rogue: { ss: false, weaponBonus: 0 },\n    sorcerer: {},\n    warlock: {},\n    wizard: {},\n}\n\nconst DefaultClass: ClassForm = { type: 'barbarian', options: DefaultOptions.barbarian }\nconst DefaultLevel = 1\n\nconst PlayerForm:FC<PropType> = ({ value, onChange }) => {\n    const chosenClass: ClassForm = (value && value.class) ? { type: value.class.type, options: value.class.options } as ClassForm : DefaultClass;\n    const level = (value && value.class) ? value.class.level : DefaultLevel;\n\n    // Apply template on first mount if no class exists\n    useEffect(() => {\n        if (value && !value.class) {\n            applyTemplate(DefaultClass.type, DefaultLevel, DefaultOptions[DefaultClass.type]);\n        }\n    }, []);\n\n    function applyTemplate(type: Class, lvl: number, options: any) {\n        const template = PlayerTemplates[type];\n        const creature = (template as (level: number, options: any) => Creature)(lvl, options);\n        creature.id = value?.id || creature.id;\n        creature.class = {\n            type: type,\n            level: lvl,\n            options: options,\n        };\n        creature.count = value?.count || 1;\n        creature.name = value?.name || creature.name;\n        \n        // If HP/AC were default 10, let template decide. Otherwise keep parent's.\n        if (value && value.hp !== 10) creature.hp = value.hp;\n        if (value && value.ac !== 10) creature.ac = value.ac;\n\n        onChange(creature);\n    }\n\n    function setClass(type: Class) {\n        applyTemplate(type, level, DefaultOptions[type]);\n    }\n\n    function setLevel(lvl: number) {\n        applyTemplate(chosenClass.type, lvl, chosenClass.options);\n    }\n\n    function setClassOptions(callback: (classOptions: any) => void) {\n        const chosenClassClone = clone(chosenClass)\n        callback(chosenClassClone.options)\n        applyTemplate(chosenClassClone.type, level, chosenClassClone.options);\n    }\n\n    return (\n        <div className={styles.playerForm}>\n            <h3>Class</h3>\n            <section className={styles.classes}>\n                { ClassesList.map(className => (\n                    <button\n                        key={className}\n                        className={`${styles.class} ${(chosenClass?.type === className) ? styles.active : ''}`}\n                        onClick={() => { setClass(className) }}\n                    >\n                        <img src={`./classes/${className}.jpeg`} />\n                        {capitalize(className)}\n                    </button>\n                )) }\n            </section>\n            \n            <h3>Level</h3>\n            <section className={styles.levels}>\n                { range(20).map(i => i+1).map(lvl => (\n                    <button\n                        key={lvl}\n                        className={`${styles.level} ${(level === lvl) ? styles.active : ''}`}\n                        onClick={() => setLevel(lvl)}\n                    >\n                        {lvl}\n                    </button>\n                )) }\n            </section>\n\n            <h3>Hit Dice (e.g., \"3d8+5d10\")</h3>\n            <section>\n                <input\n                    type=\"text\"\n                    value={value?.hitDice || ''}\n                    onChange={(e) => {\n                        onChange({ ...value!, hitDice: e.target.value || undefined });\n                    }}\n                />\n            </section>\n\n            <h3>Constitution Modifier</h3>\n            <section>\n                <input\n                    type=\"number\"\n                    value={value?.conModifier || 0}\n                    onChange={(e) => {\n                        onChange({ ...value!, conModifier: parseFloat(e.target.value) || 0 });\n                    }}\n                />\n            </section>\n\n            { !chosenClass ? null : (\n                (chosenClass.type === 'barbarian') ? (\n                    <>\n                        <h3>Barbarian-specific Options</h3>\n                        <section className={styles.classOptions}>\n                            <Checkbox \n                                value={chosenClass.options.gwm} \n                                onToggle={() => setClassOptions(options => { (options as any).gwm = !(options as any).gwm })}>\n                                Use Great Weapon Master\n                            </Checkbox>\n                            <div className={styles.option}>\n                                Weapon:\n                                <Range\n                                    min={0}\n                                    max={3}\n                                    value={chosenClass.options.weaponBonus}\n                                    onChange={(newValue) => setClassOptions(options => { (options as any).weaponBonus = newValue })}\n                                    label={`+${chosenClass.options.weaponBonus}`}\n                                />\n                            </div>\n                        </section>\n                    </>\n                ) : (chosenClass.type === 'bard') ? (\n                    <></>\n                ) : (chosenClass.type === 'cleric') ? (\n                    <></>\n                ) : (chosenClass.type === 'druid') ? (\n                    <></>\n                ) : (chosenClass.type === 'fighter') ? (\n                    <>\n                        <h3>Fighter-specific Options</h3>\n                        <section className={styles.classOptions}>\n                            <Checkbox \n                                value={chosenClass.options.gwm} \n                                onToggle={() => setClassOptions(options => { (options as any).gwm = !(options as any).gwm })}>\n                                Use Great Weapon Master\n                            </Checkbox>\n                            <div className={styles.option}>\n                                Weapon:\n                                <Range\n                                    min={0}\n                                    max={3}\n                                    value={chosenClass.options.weaponBonus}\n                                    onChange={(newValue) => setClassOptions(options => { (options as any).weaponBonus = newValue })}\n                                    label={`+${chosenClass.options.weaponBonus}`}\n                                />\n                            </div>\n                        </section>\n                    </>\n                ) : (chosenClass.type === 'monk') ? (\n                    <></>\n                ) : (chosenClass.type === 'paladin') ? (\n                    <>\n                        <h3>Paladin-specific Options</h3>\n                        <section className={styles.classOptions}>\n                            <Checkbox \n                                value={chosenClass.options.gwm} \n                                onToggle={() => setClassOptions(options => { (options as any).gwm = !(options as any).gwm })}>\n                                Use Great Weapon Master\n                            </Checkbox>\n                            <div className={styles.option}>\n                                Weapon:\n                                <Range\n                                    min={0}\n                                    max={3}\n                                    value={chosenClass.options.weaponBonus}\n                                    onChange={(newValue) => setClassOptions(options => { (options as any).weaponBonus = newValue })}\n                                    label={`+${chosenClass.options.weaponBonus}`}\n                                />\n                            </div>\n                        </section>\n                    </>\n                 ) : (chosenClass.type === 'ranger') ? (\n                     <>\n                         <h3>Ranger-specific Options</h3>\n                         <section className={styles.classOptions}>\n                             <Checkbox \n                                 value={chosenClass.options.ss} \n                                 onToggle={() => setClassOptions(options => { (options as any).ss = !(options as any).ss })}>\n                                 Use Sharpshooter\n                             </Checkbox>\n                             <div className={styles.option}>\n                                 Weapon:\n                                 <Range\n                                     min={0}\n                                     max={3}\n                                     value={chosenClass.options.weaponBonus}\n                                     onChange={(newValue) => setClassOptions(options => { (options as any).weaponBonus = newValue })}\n                                     label={`+${chosenClass.options.weaponBonus}`}\n                                 />\n                             </div>\n                         </section>\n                     </>\n                 ) : (chosenClass.type === 'rogue') ? (\n                     <>\n                         <h3>Rogue-specific Options</h3>\n                         <section className={styles.classOptions}>\n                             <Checkbox \n                                 value={chosenClass.options.ss} \n                                 onToggle={() => setClassOptions(options => { (options as any).ss = !(options as any).ss })}>\n                                 Use Sharpshooter\n                             </Checkbox>\n                             <div className={styles.option}>\n                                 Weapon:\n                                 <Range\n                                     min={0}\n                                     max={3}\n                                     value={chosenClass.options.weaponBonus}\n                                     onChange={(newValue) => setClassOptions(options => { (options as any).weaponBonus = newValue })}\n                                     label={`+${chosenClass.options.weaponBonus}`}\n                                 />\n                             </div>\n                         </section>\n                     </>\n                 ) : (chosenClass.type === 'sorcerer') ? (\n                    <></>\n                ) : (chosenClass.type === 'warlock') ? (\n                    <></>\n                ) : (chosenClass.type === 'wizard') ? (\n                    <></>\n                ) : null\n            ) }\n        </div>\n    )\n}\n\nexport default PlayerForm","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/debug/PerformanceDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":8,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":53},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":1,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":119,"column":27,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":119,"endColumn":77,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[3462,3512],"text":"// @ts-expect-error - performance.memory is non-standard"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3591,3594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3591,3594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3659,3662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3659,3662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4001,4004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4001,4004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":1,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":182,"column":7,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":182,"endColumn":81,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[5479,5553],"text":"// @ts-expect-error - performance.memory is non-standard but available in Chrome"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5618,5621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5618,5621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5723,5726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5723,5726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Performance Dashboard Component\n *\n * Displays real-time performance metrics for the simulation engine.\n * Only visible in development mode.\n */\n\nimport React, { FC, useEffect, useState, useCallback } from 'react'\nimport styles from './PerformanceDashboard.module.scss'\n\nexport interface PerformanceMetrics {\n  lastSimulationTime: number // Total time for last simulation in ms\n  averageRoundTime: number // Average time per round in ms\n  slowestRound: number // Slowest round time in ms\n  fastestRound: number // Fastest round time in ms\n  totalRounds: number // Total number of rounds\n  wasmSize: number // WASM bundle size in bytes\n  memoryUsage: number // Memory usage in bytes (if available)\n}\n\ninterface RoundTime {\n  round: number\n  duration: number\n}\n\nconst EMPTY_METRICS: PerformanceMetrics = {\n  lastSimulationTime: 0,\n  averageRoundTime: 0,\n  slowestRound: 0,\n  fastestRound: 0,\n  totalRounds: 0,\n  wasmSize: 0,\n  memoryUsage: 0,\n}\n\nexport interface PerformanceDashboardProps {\n  /**\n   * Whether the dashboard is visible\n   */\n  isVisible: boolean\n\n  /**\n   * Callback to close the dashboard\n   */\n  onClose?: () => void\n}\n\n/**\n * Format bytes to human readable string\n */\nfunction formatBytes(bytes: number): string {\n  if (bytes === 0) return '0 B'\n  const k = 1024\n  const sizes = ['B', 'KB', 'MB', 'GB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return `${(bytes / Math.pow(k, i)).toFixed(i === 0 ? 0 : 1)} ${sizes[i]}`\n}\n\n/**\n * Format milliseconds to human readable string\n */\nfunction formatDuration(ms: number): string {\n  if (ms < 1) return `${(ms * 1000).toFixed(1)}s`\n  if (ms < 1000) return `${ms.toFixed(1)}ms`\n  return `${(ms / 1000).toFixed(2)}s`\n}\n\nconst PerformanceDashboard: FC<PerformanceDashboardProps> = ({ isVisible, onClose }) => {\n  const [metrics, setMetrics] = useState<PerformanceMetrics>(EMPTY_METRICS)\n  const [roundTimes, setRoundTimes] = useState<RoundTime[]>([])\n\n  // Fetch WASM size\n  useEffect(() => {\n    const fetchWasmSize = async () => {\n      try {\n        const response = await fetch('/pkg/simulation_wasm_bg.wasm')\n        if (response.ok) {\n          const blob = await response.blob()\n          setMetrics((prev) => ({ ...prev, wasmSize: blob.size }))\n        }\n      } catch (error) {\n        console.error('Failed to fetch WASM size:', error)\n      }\n    }\n\n    if (isVisible) {\n      fetchWasmSize()\n    }\n  }, [isVisible])\n\n  // Listen for performance events from the simulation\n  useEffect(() => {\n    if (!isVisible) return\n\n    const handleSimulationComplete = (event: Event) => {\n      const customEvent = event as CustomEvent<{\n        totalTime: number\n        roundTimes: RoundTime[]\n      }>\n\n      if (customEvent.detail) {\n        const { totalTime, roundTimes: newRoundTimes } = customEvent.detail\n\n        const roundDurations = newRoundTimes.map((r) => r.duration)\n        const avgRoundTime =\n          roundDurations.length > 0\n            ? roundDurations.reduce((a, b) => a + b, 0) / roundDurations.length\n            : 0\n        const slowestRound = roundDurations.length > 0 ? Math.max(...roundDurations) : 0\n        const fastestRound = roundDurations.length > 0 ? Math.min(...roundDurations) : 0\n\n        setMetrics({\n          lastSimulationTime: totalTime,\n          averageRoundTime: avgRoundTime,\n          slowestRound,\n          fastestRound,\n          totalRounds: newRoundTimes.length,\n          wasmSize: metrics.wasmSize,\n          memoryUsage: 0, // @ts-ignore - performance.memory is non-standard\n          ...(typeof performance !== 'undefined' &&\n          (performance as any).memory &&\n          {\n            memoryUsage: (performance as any).memory.usedJSHeapSize,\n          }),\n        })\n\n        setRoundTimes(newRoundTimes)\n      }\n    }\n\n    // Listen for custom event from simulation\n    window.addEventListener('simulationComplete', handleSimulationComplete)\n\n    // Also listen for console logs (from Rust)\n    const originalLog = console.log\n    console.log = (...args: any[]) => {\n      originalLog.apply(console, args)\n\n      // Parse performance logs\n      const message = args.join(' ')\n      const roundMatch = message.match(/Round (\\d+) completed in ([\\d.]+)(ms|s)/)\n      const encounterMatch = message.match(/Encounter completed in ([\\d.]+)(ms|s|s)/)\n\n      if (roundMatch) {\n        const round = parseInt(roundMatch[1])\n        const duration = parseFloat(roundMatch[2])\n        const unit = roundMatch[3]\n        const durationMs = unit === 's' ? duration / 1000 : duration\n\n        setRoundTimes((prev) => {\n          const existing = prev.find((r) => r.round === round)\n          if (existing) {\n            return prev.map((r) => (r.round === round ? { ...r, duration: durationMs } : r))\n          }\n          return [...prev, { round, duration: durationMs }]\n        })\n      }\n\n      if (encounterMatch) {\n        const duration = parseFloat(encounterMatch[1])\n        const unit = encounterMatch[2]\n        const durationMs = unit === 's' ? duration * 1000 : unit === 's' ? duration / 1000 : duration\n\n        setMetrics((prev) => ({\n          ...prev,\n          lastSimulationTime: durationMs,\n        }))\n      }\n    }\n\n    return () => {\n      window.removeEventListener('simulationComplete', handleSimulationComplete)\n      console.log = originalLog\n    }\n  }, [isVisible, metrics.wasmSize])\n\n  // Get memory usage periodically\n  useEffect(() => {\n    if (!isVisible) return\n\n    const interval = setInterval(() => {\n      // @ts-ignore - performance.memory is non-standard but available in Chrome\n      if (typeof performance !== 'undefined' && (performance as any).memory) {\n        setMetrics((prev) => ({\n          ...prev,\n          memoryUsage: (performance as any).memory.usedJSHeapSize,\n        }))\n      }\n    }, 1000)\n\n    return () => clearInterval(interval)\n  }, [isVisible])\n\n  const maxRoundTime = Math.max(...roundTimes.map((r) => r.duration), 1)\n\n  if (!isVisible) return null\n\n  return (\n    <div className={styles.dashboard}>\n      <div className={styles.header}>\n        <h4>Performance Dashboard</h4>\n        {onClose && (\n          <button className={styles.closeButton} onClick={onClose}>\n            \n          </button>\n        )}\n      </div>\n\n      <div className={styles.metrics}>\n        <div className={styles.metric}>\n          <span className={styles.label}>Last Simulation:</span>\n          <span className={styles.value}>{formatDuration(metrics.lastSimulationTime)}</span>\n        </div>\n\n        <div className={styles.metric}>\n          <span className={styles.label}>Avg Round:</span>\n          <span className={styles.value}>{formatDuration(metrics.averageRoundTime)}</span>\n        </div>\n\n        <div className={styles.metric}>\n          <span className={styles.label}>Slowest Round:</span>\n          <span className={styles.value}>{formatDuration(metrics.slowestRound)}</span>\n        </div>\n\n        <div className={styles.metric}>\n          <span className={styles.label}>Fastest Round:</span>\n          <span className={styles.value}>{formatDuration(metrics.fastestRound)}</span>\n        </div>\n\n        <div className={styles.metric}>\n          <span className={styles.label}>Total Rounds:</span>\n          <span className={styles.value}>{metrics.totalRounds}</span>\n        </div>\n\n        <div className={styles.metric}>\n          <span className={styles.label}>WASM Bundle:</span>\n          <span\n            className={`${styles.value} ${\n              metrics.wasmSize > 1024 * 1024 ? styles.warning : ''\n            }`}\n          >\n            {formatBytes(metrics.wasmSize)}\n            {metrics.wasmSize > 1024 * 1024 && ' '}\n          </span>\n        </div>\n\n        <div className={styles.metric}>\n          <span className={styles.label}>Memory:</span>\n          <span className={styles.value}>{formatBytes(metrics.memoryUsage)}</span>\n        </div>\n      </div>\n\n      {roundTimes.length > 0 && (\n        <div className={styles.chartContainer}>\n          <h5>Round Times</h5>\n          <div className={styles.chart}>\n            {roundTimes.map((roundTime) => (\n              <div\n                key={roundTime.round}\n                className={styles.bar}\n                style={{\n                  height: `${(roundTime.duration / maxRoundTime) * 100}%`,\n                  width: `${100 / Math.max(roundTimes.length, 1)}%`,\n                }}\n                title={`Round ${roundTime.round}: ${formatDuration(roundTime.duration)}`}\n              />\n            ))}\n          </div>\n          <div className={styles.chartLabels}>\n            <span>R1</span>\n            <span>R{roundTimes.length}</span>\n          </div>\n        </div>\n      )}\n\n      {metrics.wasmSize > 1024 * 1024 && (\n        <div className={styles.alert}>\n           WASM bundle is larger than 1MB. Consider:\n          <ul>\n            <li>Removing unused dependencies</li>\n            <li>Enabling LTO (Link Time Optimization)</li>\n            <li>Using wasm-opt for size optimization</li>\n          </ul>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default PerformanceDashboard\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/debug/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/AccessibilityContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/AccessibilityToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/ActionEconomyDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Combattant' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useMemo } from \"react\"\nimport { Combattant, Round } from \"@/model/model\"\nimport styles from './ActionEconomyDisplay.module.scss'\n\n// Action economy state enum\ntype ActionEconomyState = 'EnemyAdvantage' | 'Even' | 'PlayerAdvantage'\n\ninterface ActionEconomyStatus {\n  playerCount: number\n  monsterCount: number\n  roundsToKillMonsters: number\n  roundsToKillPlayers: number\n  combinedRatio: number\n  actionRatio: number\n  timeRatio: number\n  state: ActionEconomyState\n}\n\n// Calculate action economy status from current combatants\nfunction calculateActionEconomy(round: Round): ActionEconomyStatus {\n  const consciousPlayers = round.team1.filter(c => c.initialState.currentHp > 0)\n  const consciousMonsters = round.team2.filter(c => c.initialState.currentHp > 0)\n\n  const playerCount = consciousPlayers.length\n  const monsterCount = consciousMonsters.length\n\n  // Handle edge cases\n  if (monsterCount === 0) {\n    return {\n      playerCount,\n      monsterCount: 0,\n      roundsToKillMonsters: 0,\n      roundsToKillPlayers: Infinity,\n      combinedRatio: Infinity,\n      actionRatio: Infinity,\n      timeRatio: 0,\n      state: 'PlayerAdvantage',\n    }\n  }\n\n  if (playerCount === 0) {\n    return {\n      playerCount: 0,\n      monsterCount,\n      roundsToKillMonsters: Infinity,\n      roundsToKillPlayers: 0,\n      combinedRatio: 0,\n      actionRatio: 0,\n      timeRatio: Infinity,\n      state: 'EnemyAdvantage',\n    }\n  }\n\n  // Calculate total HP\n  const totalPlayerHp = consciousPlayers.reduce((sum, c) => sum + c.initialState.currentHp, 0)\n  const totalMonsterHp = consciousMonsters.reduce((sum, c) => sum + c.initialState.currentHp, 0)\n\n  // Estimate DPR using simple heuristics (action count + average damage)\n  // In a full implementation, this would use the CombatantStats from the backend\n  const playerDpr = consciousPlayers.length * 15 // Rough estimate\n  const monsterDpr = consciousMonsters.length * 10 // Rough estimate\n\n  // Calculate rounds to exhaustion\n  const roundsToKillMonsters = playerDpr > 0 ? totalMonsterHp / playerDpr : Infinity\n  const roundsToKillPlayers = monsterDpr > 0 ? totalPlayerHp / monsterDpr : Infinity\n\n  // Calculate ratios\n  const actionRatio = playerCount / monsterCount\n  const timeRatio = roundsToKillMonsters / roundsToKillPlayers\n  const combinedRatio = Math.sqrt(actionRatio * timeRatio)\n\n  // Determine state\n  let state: ActionEconomyState\n  if (combinedRatio < 0.6) {\n    state = 'EnemyAdvantage'\n  } else if (combinedRatio > 1.5) {\n    state = 'PlayerAdvantage'\n  } else {\n    state = 'Even'\n  }\n\n  return {\n    playerCount,\n    monsterCount,\n    roundsToKillMonsters,\n    roundsToKillPlayers,\n    combinedRatio,\n    actionRatio,\n    timeRatio,\n    state,\n  }\n}\n\n// Get display info for state\nfunction getStateInfo(state: ActionEconomyState) {\n  switch (state) {\n    case 'EnemyAdvantage':\n      return {\n        icon: '',\n        label: 'Enemy Advantage',\n        recommendation: 'Nova! Use AoE and burst damage to reduce their action count fast.',\n      }\n    case 'Even':\n      return {\n        icon: '',\n        label: 'Even',\n        recommendation: 'Normal tactics. Balance damage and resource conservation.',\n      }\n    case 'PlayerAdvantage':\n      return {\n        icon: '',\n        recommendation: 'Conserve! Use cantrips and basic attacks. Save resources for harder fights.',\n      }\n  }\n}\n\ntype PropType = {\n  round: Round\n}\n\nconst ActionEconomyDisplay: FC<PropType> = ({ round }) => {\n  const status = useMemo(() => calculateActionEconomy(round), [round])\n  const stateInfo = getStateInfo(status.state)\n\n  // Get state class for styling\n  const stateClass = `${styles.actionEconomy} ${styles[status.state.toLowerCase()]}`\n\n  return (\n    <div className={stateClass}>\n      <div className={styles.header}>\n        <span className={styles.icon}>{stateInfo.icon}</span>\n        <span className={styles.label}>Action Economy: {stateInfo.label}</span>\n      </div>\n\n      <div className={styles.details}>\n        <span className={styles.counts}>\n          ({status.playerCount} vs {status.monsterCount})\n        </span>\n        <span className={styles.rounds}>\n          You {status.roundsToKillMonsters.toFixed(1)} rounds | Them {status.roundsToKillPlayers.toFixed(1)} rounds\n        </span>\n      </div>\n\n      <div className={styles.recommendation}>\n        {stateInfo.recommendation}\n      </div>\n    </div>\n  )\n}\n\nexport default ActionEconomyDisplay\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/AdjustmentPreview.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[371,374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[371,374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[696,699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[696,699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest';\nimport { render, screen, fireEvent } from '@testing-library/react';\nimport AdjustmentPreview from './AdjustmentPreview';\nimport React from 'react';\n\ndescribe('AdjustmentPreview Component', () => {\n    const mockOriginalMonsters = [\n        { id: 'm1', name: 'Goblin', hp: 7, ac: 15, saveBonus: 0, actions: [] }\n    ] as any;\n\n    const mockAdjustmentResult = {\n        monsters: [\n            { id: 'm1', name: 'Goblin', hp: 12.4, ac: 16, saveBonus: 1, actions: [] }\n        ],\n        analysis: {\n            scenarioName: 'Optimized',\n            totalRuns: 100,\n            deciles: [],\n            battleDurationRounds: 3\n        }\n    } as any;\n\n    it('should display original and optimized stats', () => {\n        render(\n            <AdjustmentPreview\n                originalMonsters={mockOriginalMonsters}\n                adjustmentResult={mockAdjustmentResult}\n                onApply={vi.fn()}\n                onCancel={vi.fn()}\n            />\n        );\n\n        expect(screen.getByText('Goblin')).toBeDefined();\n        expect(screen.getByText('7')).toBeDefined(); // Original HP\n        expect(screen.getByText('12')).toBeDefined(); // Optimized HP (rounded)\n        expect(screen.getByText('15')).toBeDefined(); // Original AC\n        expect(screen.getByText('16')).toBeDefined(); // Optimized AC\n    });\n\n    it('should call onApply when apply button is clicked', () => {\n        const onApply = vi.fn();\n        render(\n            <AdjustmentPreview\n                originalMonsters={mockOriginalMonsters}\n                adjustmentResult={mockAdjustmentResult}\n                onApply={onApply}\n                onCancel={vi.fn()}\n            />\n        );\n\n        fireEvent.click(screen.getByText(/Apply Changes/i));\n        expect(onApply).toHaveBeenCalled();\n    });\n\n    it('should call onCancel when cancel button is clicked', () => {\n        const onCancel = vi.fn();\n        render(\n            <AdjustmentPreview\n                originalMonsters={mockOriginalMonsters}\n                adjustmentResult={mockAdjustmentResult}\n                onApply={vi.fn()}\n                onCancel={onCancel}\n            />\n        );\n\n        fireEvent.click(screen.getByText(/Cancel/i));\n        expect(onCancel).toHaveBeenCalled();\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/AdjustmentPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/AnalysisComponents.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DecileStats' is defined but never used.","line":2,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CombatantVisualization' is defined but never used.","line":2,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Vitals' is defined but never used.","line":2,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":70},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9230,9233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9230,9233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9299,9302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9299,9302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getHpBarColor' is assigned a value but never used.","line":299,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":299,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, memo, useMemo } from \"react\"\nimport { AggregateOutput, DecileStats, CombatantVisualization, Vitals } from \"@/model/model\"\nimport styles from './encounterResult.module.scss'\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { \n    faBrain, faTrophy, faCheckCircle, faExclamationTriangle, \n    faBolt, faSkull, faGasPump, faCompass, faExclamationCircle \n} from \"@fortawesome/free-solid-svg-icons\"\n\nconst formatLabel = (label: string): string => {\n    switch (label) {\n        case 'EpicChallenge': return 'The Epic Challenge';\n        case 'TacticalGrinder': return 'The Tactical Grinder';\n        case 'ActionMovie': return 'The Action Movie';\n        case 'TheTrap': return 'The Trap';\n        case 'TheSlog': return 'The Slog';\n        case 'Standard': return 'Standard Encounter';\n        case 'TrivialMinions': return 'Trivial / Minions';\n        case 'TPKRisk': return 'High TPK Risk';\n        case 'Broken': return 'Broken / Impossible';\n        default: return label;\n    }\n};\n\nconst formatTier = (tier: string): string => {\n    switch (tier) {\n        case 'Tier1': return 'Tier 1 (Trivial)';\n        case 'Tier2': return 'Tier 2 (Light)';\n        case 'Tier3': return 'Tier 3 (Moderate)';\n        case 'Tier4': return 'Tier 4 (Heavy)';\n        case 'Tier5': return 'Tier 5 (Extreme)';\n        default: return tier;\n    }\n};\n\nexport const ValidationNotice: FC<{ \n    analysis: AggregateOutput | null, \n    targetRole?: string,\n    isDaySummary?: boolean \n}> = memo(({ analysis, targetRole, isDaySummary }) => {\n    if (!analysis || !analysis.vitals) return null;\n\n    const { vitals } = analysis;\n    const { attritionScore } = vitals;\n\n    const warnings: string[] = [];\n\n    // 1. Role Mismatch Validation\n    if (targetRole) {\n        const costPct = attritionScore * 100;\n        let expectedCategory = \"\";\n        \n        if (costPct < 8) expectedCategory = \"Skirmish\";\n        else if (costPct < 20) expectedCategory = \"Standard\";\n        else if (costPct < 45) expectedCategory = \"Elite\";\n        else expectedCategory = \"Boss\";\n\n        if (targetRole !== expectedCategory) {\n            warnings.push(`You labeled this '${targetRole}', but it burns ${Math.round(costPct)}% budget, typical of a '${expectedCategory}' encounter.`);\n        }\n    }\n\n    // 2. Budget Overflow Validation (Day Summary only)\n    if (isDaySummary && analysis.tdnw > 0) {\n        const totalCost = (analysis.globalMedian?.totalHpLost || 0) / analysis.tdnw;\n        if (totalCost > 1.0) {\n            warnings.push(`This adventuring day is projected to burn ${Math.round(totalCost * 100)}% of the daily budget. Total failure is mathematically likely.`);\n        }\n    }\n\n    if (warnings.length === 0) return null;\n\n    return (\n        <div className={styles.validationNotice}>\n            {warnings.map((w, i) => (\n                <div key={i} className={styles.warningItem}>\n                    <FontAwesomeIcon icon={faExclamationCircle} /> {w}\n                </div>\n            ))}\n        </div>\n    );\n});\n\nexport const VitalsDashboard: FC<{ analysis: AggregateOutput | null, isPreliminary?: boolean }> = memo(({ analysis, isPreliminary }) => {\n    if (!analysis || !analysis.vitals) return null;\n\n    const { vitals } = analysis;\n    const { lethalityIndex, attritionScore, doomHorizon, difficultyGrade, tpkRisk, deathsDoorIndex, pacingLabel, crisisParticipationRate, nearDeathSurvivors } = vitals;\n\n    const getGradeColor = (grade: string) => {\n        switch (grade) {\n            case 'S': return '#10b981'; // Emerald\n            case 'A': return '#22c55e'; // Green\n            case 'B': return '#3b82f6'; // Blue\n            case 'C': return '#f59e0b'; // Amber\n            case 'D': return '#ef4444'; // Red\n            case 'F': return '#7f1d1d'; // Dark Red\n            default: return '#6b7280';\n        }\n    };\n\n    const getLethalityText = (index: number) => {\n        if (index === 0) return \"Safe\";\n        if (index < 0.05) return \"Negligible\";\n        if (index < 0.15) return \"Easy\";\n        if (index < 0.30) return \"Moderate\";\n        if (index < 0.50) return \"Risky\";\n        return \"Lethal\";\n    };\n\n    const getAttritionText = (score: number) => {\n        if (score < 0.08) return \"Free\";\n        if (score < 0.20) return \"Standard\";\n        if (score < 0.45) return \"Taxing\";\n        if (score < 0.60) return \"Heavy\";\n        return \"Nova\";\n    };\n\n    const getThrillingText = (index: number) => {\n        if (index === 0) return \"Boring\";\n        if (index < 0.5) return \"Chilled\";\n        if (index < 1.5) return \"Tense\";\n        if (index < 3.0) return \"Thrilling\";\n        return \"Adrenaline\";\n    };\n\n    return (\n        <div className={`${styles.vitalsDashboard} ${isPreliminary ? styles.isUpdating : ''}`}>\n            <div className={styles.vitalsGrid}>\n                {/* 1. Lethality Section */}\n                <div className={styles.vitalsCard}>\n                    <div className={styles.cardHeader}>\n                        <FontAwesomeIcon icon={faSkull} className={styles.iconLethality} />\n                        <span>Lethality</span>\n                    </div>\n                    <div className={styles.cardValue}>\n                        {Math.round(lethalityIndex * 100)}%\n                    </div>\n                    <div className={styles.cardLabel}>{getLethalityText(lethalityIndex)}</div>\n                    <div className={styles.riskBarContainer}>\n                        <div \n                            className={styles.riskBarFill} \n                            style={{ width: `${lethalityIndex * 100}%`, backgroundColor: getGradeColor(difficultyGrade) }} \n                        />\n                    </div>\n                    {tpkRisk > 0.05 && (\n                        <div className={styles.tpkWarning}>\n                            <FontAwesomeIcon icon={faExclamationTriangle} /> {Math.round(tpkRisk * 100)}% TPK Risk\n                        </div>\n                    )}\n                </div>\n\n                {/* 2. Attrition Section */}\n                <div className={styles.vitalsCard}>\n                    <div className={styles.cardHeader}>\n                        <FontAwesomeIcon icon={faGasPump} className={styles.iconAttrition} />\n                        <span>Attrition</span>\n                    </div>\n                    <div className={styles.cardValue}>\n                        {Math.round(attritionScore * 100)}%\n                    </div>\n                    <div className={styles.cardLabel}>{getAttritionText(attritionScore)}</div>\n                    <div className={styles.subtext}>Of Daily Budget</div>\n                </div>\n\n                {/* 3. Thrilling Section */}\n                <div className={styles.vitalsCard}>\n                    <div className={styles.cardHeader}>\n                        <FontAwesomeIcon icon={faBolt} className={styles.iconThrilling} />\n                        <span>Thrilling</span>\n                    </div>\n                    <div className={styles.cardValue}>\n                        {deathsDoorIndex.toFixed(1)}\n                    </div>\n                    <div className={styles.cardLabel}>{getThrillingText(deathsDoorIndex)}</div>\n                    <div className={styles.subtext}>Rounds at Death's Door</div>\n                </div>\n\n                {/* 4. Experience Section */}\n                <div className={styles.vitalsCard}>\n                    <div className={styles.cardHeader}>\n                        <FontAwesomeIcon icon={faBrain} className={styles.iconExperience} />\n                        <span>Experience</span>\n                    </div>\n                    <div className={styles.cardValue}>\n                        {crisisParticipationRate ? Math.round(crisisParticipationRate * 100) : 0}%\n                    </div>\n                    <div className={styles.cardLabel}>Engagement</div>\n                    <div className={styles.subtext}>{nearDeathSurvivors ? nearDeathSurvivors.toFixed(1) : 0} Near-Death</div>\n                </div>\n\n                {/* 5. Forecast Section */}\n                <div className={styles.vitalsCard}>\n                    <div className={styles.cardHeader}>\n                        <FontAwesomeIcon icon={faCompass} className={styles.iconForecast} />\n                        <span>Forecast ({pacingLabel})</span>\n                    </div>\n                    <div className={styles.cardValue}>\n                        {doomHorizon > 10 ? '' : doomHorizon.toFixed(1)}\n                    </div>\n                    <div className={styles.cardLabel}>Encounters</div>\n                    <div className={styles.subtext}>Until Failure</div>\n                </div>\n            </div>\n        </div>\n    );\n});\n\nexport const EncounterRating: FC<{ analysis: AggregateOutput | null, isPreliminary?: boolean, label?: string, isShortRest?: boolean }> = memo(({ analysis, isPreliminary, label = \"ENCOUNTER\", isShortRest }) => {\n    const isDaySummary = label.toLowerCase().includes(\"day\");\n\n    const ratingInfo = useMemo(() => {\n        if (!analysis || !analysis.deciles?.length) return null;\n\n        const { encounterLabel, intensityTier, analysisSummary, isGoodDesign, pacing, vitals } = analysis as any;\n        const safetyGrade = vitals?.safetyGrade || (analysis as any).safetyGrade;\n        \n        const getGradeColor = (grade: string) => {\n            if (isShortRest) return \"#2c5282\"; // Blue for short rest\n            if (grade?.startsWith('A')) return \"#28a745\"; // Green\n            if (grade?.startsWith('B')) return \"#fd7e14\"; // Orange\n            return \"#dc3545\"; // Red for C, D, F\n        };\n\n        let displayLabel = isShortRest ? \"SHORT REST\" : formatLabel(encounterLabel);\n        let statusIcon = null;\n\n        if (isDaySummary && pacing) {\n            displayLabel = pacing.archetype.toUpperCase();\n            if (safetyGrade === 'A' && intensityTier === 'Tier4') {\n                statusIcon = faTrophy;\n            } else if (isGoodDesign) {\n                statusIcon = faCheckCircle;\n            }\n            else {\n                statusIcon = faExclamationTriangle;\n            }\n        }\n\n        const boltCount = intensityTier === 'Tier5' ? 4 : Math.max(0, parseInt(intensityTier.replace('Tier', '')) - 1);\n\n        return {\n            title: displayLabel,\n            tier: formatTier(intensityTier || \"Tier1\"),\n            summary: analysisSummary,\n            color: getGradeColor(String(safetyGrade || 'A')),\n            statusIcon,\n            stars: boltCount\n        };\n    }, [analysis, isDaySummary, isShortRest]);\n\n    if (!ratingInfo) return null;\n\n    return (\n        <div className={styles.encounterRating} style={{ backgroundColor: ratingInfo.color }}>\n            <div className={styles.ratingHeader}>\n                {ratingInfo.statusIcon && <FontAwesomeIcon icon={ratingInfo.statusIcon} className={styles.statusIcon} />}\n                <span className={styles.ratingTitle}>\n                    {ratingInfo.title}\n                </span>\n                {!isShortRest && (\n                    <div className={styles.intensityBolts}>\n                        {Array.from({ length: 4 }).map((_, i) => (\n                            <FontAwesomeIcon \n                                key={i} \n                                icon={faBolt} \n                                className={i < ratingInfo.stars ? styles.boltFilled : styles.boltEmpty} \n                            />\n                        ))}\n                    </div>\n                )}\n                {isPreliminary && <span className={styles.preliminaryNotice}> (ESTIMATING...)</span>}\n            </div>\n            \n            {!isShortRest && (\n                <div className={styles.ratingSubline}>\n                    <span>{ratingInfo.tier}</span>\n                </div>\n            )}\n\n            <div className={styles.ratingDetails}>\n                <span>{ratingInfo.summary}</span>\n            </div>\n        </div>\n    );\n});\n\nexport const MedianPerformanceDisplay: FC<{ analysis: AggregateOutput | null, isPreliminary?: boolean, isDaySummary?: boolean }> = memo(({ analysis, isPreliminary, isDaySummary }) => {\n    const medianDecile = useMemo(() => {\n        if (!analysis) return null;\n        if (analysis.globalMedian) return analysis.globalMedian;\n        if (!analysis.deciles?.length) return null;\n        const medianIndex = analysis.deciles.length === 10 ? 4 : Math.floor(analysis.deciles.length / 2);\n        return analysis.deciles[medianIndex];\n    }, [analysis]);\n\n    if (!medianDecile) return null;\n\n    const getHpBarColor = (hpPercentage: number, isDead: boolean): string => {\n        if (isDead) return styles.dead;\n        if (hpPercentage <= 20) return styles.danger;\n        if (hpPercentage <= 50) return styles.bloodied;\n        return styles.healthy;\n    };\n\n    const renderHpBar = (currentHp: number, startHp: number, maxHp: number) => {\n        if (!maxHp || maxHp <= 0) return [];\n        const totalSegments = 10;\n        \n        const greenCount = Math.floor((currentHp / maxHp) * totalSegments);\n        const redCount = isDaySummary \n            ? totalSegments - greenCount \n            : Math.floor((Math.max(0, startHp - currentHp) / maxHp) * totalSegments);\n        \n        const greyCount = totalSegments - greenCount - redCount;\n\n        return [\n            ...Array(greenCount).fill('green'),\n            ...Array(redCount).fill('red'),\n            ...Array(greyCount).fill('grey')\n        ];\n    };\n\n    return (\n        <div className={`${styles.bestDecileDisplay} ${isPreliminary ? styles.isEstimating : ''}`}>\n            <h4>\n                {isDaySummary ? 'TYPICAL DAY END STATE' : 'TYPICAL ENCOUNTER END STATE'}\n                {isPreliminary && <small>(REFINE IN PROGRESS...)</small>}\n            </h4>\n            \n            <div className={styles.bestDecileHeader}>\n                <div className={styles.survivorsBadge}>\n                    {medianDecile.medianSurvivors} / {medianDecile.partySize} Survivors\n                </div>\n                <div className={styles.winRateBadge}>\n                    {Math.round(medianDecile.winRate)}% Survival Rate\n                </div>\n            </div>\n\n            <div className={styles.bestDecileCombatants}>\n                {medianDecile.medianRunVisualization.map((c, i) => (\n                    <div key={i} className={styles.bestDecileCombatant}>\n                        <div className={styles.combatantName}>\n                            {c.name} {c.isDead && <span className={styles.deathIndicator}>(KO)</span>}\n                        </div>\n                        <div className={styles.hpBar}>\n                            <div className={styles.hpBarContainer}>\n                                <div className={styles.hpBarVisual}>\n                                    {renderHpBar(c.currentHp, c.startHp, c.maxHp).map((color, idx) => (\n                                        <span key={idx} className={\n                                            color === 'green' ? styles.segmentGreen :\n                                            color === 'red' ? styles.segmentRed :\n                                            styles.segmentGrey\n                                        }></span>\n                                    ))}\n                                </div>\n                                <div className={styles.hpText}>\n                                    {c.currentHp} / {c.maxHp} HP\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                ))}\n            </div>\n\n            <div className={styles.bestDecileMetrics}>\n                <div className={styles.metric}>\n                    Cost: <strong>{Math.round(medianDecile.hpLostPercent)}%</strong> daily budget\n                </div>\n                <div className={styles.metric}>\n                    Duration: <strong>{medianDecile.battleDurationRounds}</strong> rounds\n                </div>\n            </div>\n        </div>\n    );\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/AssistantSummary.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[325,328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[325,328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[853,856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[853,856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1325,1328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1325,1328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1792,1795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1792,1795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { render, screen } from '@testing-library/react';\nimport AssistantSummary from './AssistantSummary';\nimport React from 'react';\n\ndescribe('AssistantSummary Component', () => {\n    it('should display \"Balanced\" message for green status', () => {\n        const pacingData: any = {\n            actualSegments: [{ type: 'combat', percent: 25 }, { type: 'combat', percent: 25 }],\n            plannedSegments: [{ type: 'combat', percent: 25 }, { type: 'combat', percent: 25 }],\n            finalResources: 50\n        };\n        render(<AssistantSummary pacingData={pacingData} />);\n        expect(screen.getByText(/Balanced/i)).toBeDefined();\n        expect(screen.getByText(/50%/)).toBeDefined();\n    });\n\n    it('should display \"Minor Pacing Drift\" for yellow status', () => {\n        const pacingData: any = {\n            actualSegments: [{ type: 'combat', percent: 32 }, { type: 'combat', percent: 25 }],\n            plannedSegments: [{ type: 'combat', percent: 25 }, { type: 'combat', percent: 25 }],\n            finalResources: 43\n        };\n        render(<AssistantSummary pacingData={pacingData} />);\n        expect(screen.getByText(/Minor Pacing Drift/i)).toBeDefined();\n    });\n\n    it('should display \"Overtuned\" for delta > 10%', () => {\n        const pacingData: any = {\n            actualSegments: [{ type: 'combat', percent: 40 }, { type: 'combat', percent: 25 }],\n            plannedSegments: [{ type: 'combat', percent: 25 }, { type: 'combat', percent: 25 }],\n            finalResources: 35\n        };\n        render(<AssistantSummary pacingData={pacingData} />);\n        expect(screen.getByText(/Overtuned/i)).toBeDefined();\n    });\n\n    it('should display \"Impossible Day\" for red status', () => {\n        const pacingData: any = {\n            actualSegments: [{ type: 'combat', percent: 60 }, { type: 'combat', percent: 50 }],\n            plannedSegments: [{ type: 'combat', percent: 50 }, { type: 'combat', percent: 50 }],\n            finalResources: 0\n        };\n        render(<AssistantSummary pacingData={pacingData} />);\n        expect(screen.getByText(/Impossible Day/i)).toBeDefined();\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/AssistantSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/BalancerBandOverlay.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'chartId' is assigned a value but never used.","line":49,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * BalancerBandOverlay - Horizontal band overlay showing target ranges for encounter tiers\n *\n * Shows target HP/resource ranges:\n * - Safe: 70-100% (green band)\n * - Challenging: 50-80% (yellow band)\n * - Boss: 20-60% (red band)\n *\n * Provides visual feedback when bucket values fall outside target range\n */\n\nimport React, { memo, useRef, useEffect, useCallback } from 'react';\nimport styles from './balancerBandOverlay.module.scss';\n\nexport interface BalancerBandOverlayProps {\n    /** Width of the chart */\n    width: number;\n    /** Height of the chart */\n    height: number;\n    /** Chart identifier */\n    chartId?: string;\n    /** Chart padding */\n    padding?: { top: number; right: number; bottom: number; left: number };\n    /** Current encounter tier */\n    tier: 'Safe' | 'Challenging' | 'Boss' | 'Failed';\n    /** Highlight out-of-range buckets */\n    showOutOfRange?: boolean;\n    /** Bucket data to check against target range */\n    bucketData?: { bucketIndex: number; value: number }[] | null;\n    className?: string;\n}\n\n/**\n * Target ranges for each encounter tier (HP % or resource %)\n */\nconst TIER_RANGES = {\n    Safe: { min: 70, max: 100, color: 'rgba(107, 207, 127, 0.15)', borderColor: 'rgba(107, 207, 127, 0.4)' },\n    Challenging: { min: 50, max: 80, color: 'rgba(212, 175, 55, 0.15)', borderColor: 'rgba(212, 175, 55, 0.4)' },\n    Boss: { min: 20, max: 60, color: 'rgba(255, 107, 107, 0.15)', borderColor: 'rgba(255, 107, 107, 0.4)' },\n    Failed: { min: 0, max: 30, color: 'rgba(150, 150, 150, 0.1)', borderColor: 'rgba(150, 150, 150, 0.3)' },\n};\n\n/**\n * Balancer band overlay component\n */\nconst BalancerBandOverlay: React.FC<BalancerBandOverlayProps> = memo(({\n    width,\n    height,\n    chartId = 'unknown',\n    padding = { top: 20, right: 10, bottom: 30, left: 40 },\n    tier,\n    showOutOfRange = false,\n    bucketData,\n    className,\n}) => {\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n\n    const render = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = setupCanvas(canvas, width, height);\n        if (!ctx) return;\n\n        // Clear entire canvas\n        ctx.clearRect(0, 0, width, height);\n\n        const chartWidth = width - padding.left - padding.right;\n        const chartHeight = height - padding.top - padding.bottom;\n\n        // Get target range for current tier\n        const range = TIER_RANGES[tier];\n\n        // Calculate Y positions for the band\n        const minY = padding.top + chartHeight - (range.max / 100) * chartHeight;\n        const maxY = padding.top + chartHeight - (range.min / 100) * chartHeight;\n        const bandHeight = maxY - minY;\n\n        // Draw target band\n        ctx.fillStyle = range.color;\n        ctx.fillRect(padding.left, minY, chartWidth, bandHeight);\n\n        // Draw band border\n        ctx.strokeStyle = range.borderColor;\n        ctx.lineWidth = 1;\n        ctx.setLineDash([2, 2]);\n\n        // Top border\n        ctx.beginPath();\n        ctx.moveTo(padding.left, minY);\n        ctx.lineTo(padding.left + chartWidth, minY);\n        ctx.stroke();\n\n        // Bottom border\n        ctx.beginPath();\n        ctx.moveTo(padding.left, maxY);\n        ctx.lineTo(padding.left + chartWidth, maxY);\n        ctx.stroke();\n\n        ctx.setLineDash([]);\n\n        // Draw tier label\n        ctx.fillStyle = range.borderColor;\n        ctx.font = 'bold 11px Georgia';\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'middle';\n        ctx.fillText(`${tier} Zone`, padding.left + 5, minY + bandHeight / 2);\n\n        // Draw range labels on Y-axis\n        ctx.font = '9px Courier New';\n        ctx.fillStyle = 'rgba(232, 224, 208, 0.7)';\n        ctx.textAlign = 'right';\n        ctx.textBaseline = 'middle';\n\n        // Max value label\n        ctx.fillText(`${range.max}%`, padding.left - 5, minY);\n        // Min value label\n        ctx.fillText(`${range.min}%`, padding.left - 5, maxY);\n\n        // Highlight out-of-range buckets if enabled\n        if (showOutOfRange && bucketData && bucketData.length > 0) {\n            const bucketWidth = chartWidth / bucketData.length;\n\n            bucketData.forEach(({ bucketIndex, value }) => {\n                // Check if value is outside target range\n                if (value < range.min || value > range.max) {\n                    const x = padding.left + (bucketIndex - 1) * bucketWidth;\n                    const y = padding.top + chartHeight - (value / 100) * chartHeight;\n\n                    // Draw warning indicator\n                    ctx.fillStyle = 'rgba(255, 107, 107, 0.8)';\n                    ctx.beginPath();\n                    ctx.arc(x + bucketWidth / 2, y, 3, 0, Math.PI * 2);\n                    ctx.fill();\n                }\n            });\n        }\n\n    }, [width, height, padding, tier, showOutOfRange, bucketData]);\n\n    useEffect(() => {\n        render();\n    }, [render]);\n\n    return (\n        <div className={`${styles.bandOverlay} ${className || ''}`}>\n            <canvas\n                ref={canvasRef}\n                width={width}\n                height={height}\n                className={styles.bandCanvas}\n                style={{ pointerEvents: 'none' }}\n                aria-hidden=\"true\"\n            />\n        </div>\n    );\n});\n\nBalancerBandOverlay.displayName = 'BalancerBandOverlay';\n\n/**\n * Setup canvas with high-DPI scaling\n */\nfunction setupCanvas(canvas: HTMLCanvasElement, width: number, height: number) {\n    const dpr = window.devicePixelRatio || 1;\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n        ctx.scale(dpr, dpr);\n    }\n    return ctx;\n}\n\nexport default BalancerBandOverlay;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/CombatReplayModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'faArrowRight' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'faCheck' is defined but never used.","line":25,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getActionSummary' is assigned a value but never used.","line":181,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6328,6331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6328,6331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6461,6464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6461,6464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6662,6665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6662,6665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":202,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6862,6865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6862,6865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":208,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7049,7052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7049,7052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7248,7251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7248,7251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7445,7448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7445,7448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8821,8824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8821,8824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":267,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9041,9044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9041,9044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":363,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11663,11666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11663,11666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":365,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":365,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11782,11785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11782,11785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":371,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11979,11982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11979,11982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":377,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12179,12182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12179,12182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":383,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12360,12363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12360,12363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":388,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":388,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12528,12531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12528,12531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actorId' is defined but never used.","line":406,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":406,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionMap' is assigned a value but never used.","line":664,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":664,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showGlobalEvents' is assigned a value but never used.","line":753,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":753,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowGlobalEvents' is assigned a value but never used.","line":753,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":753,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'play' is assigned a value but never used.","line":768,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":768,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'pause' is assigned a value but never used.","line":769,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":769,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":24,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useState, useRef, useEffect, useMemo } from 'react'\nimport * as Dialog from '@radix-ui/react-dialog'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport {\n  faPlay,\n  faPause,\n  faStepForward,\n  faStepBackward,\n  faTimes,\n  faClock,\n  faHistory,\n  faShieldAlt,\n  faSkull,\n  faHeart,\n  faArrowRight,\n  faMagic,\n  faBolt,\n  faUser,\n  faCrosshairs,\n  faGavel,\n  faExchangeAlt,\n  faUserFriends,\n  faList,\n  faCheck,\n  faHand,\n  faChevronDown,\n  faFire\n} from '@fortawesome/free-solid-svg-icons'\nimport { useCombatPlayback, type FlattenedAction } from '@/hooks/useCombatPlayback'\nimport type { Replay, ReplayAction } from '@/model/replayTypes'\nimport type { Event } from '@/model/model'\nimport { PlayerTemplates } from '@/data/data'\n\ninterface CombatReplayModalProps {\n  /** The replay data to visualize */\n  replay: Replay | null\n  /** Whether the modal is open */\n  open: boolean\n  /** Callback when modal open state changes */\n  onOpenChange: (open: boolean) => void\n}\n\n/**\n * Extract target ID from sub-events\n */\nconst extractTargetId = (subEvents: Event[]): string | null => {\n  if (!subEvents || subEvents.length === 0) return null\n\n  // Priority order: AttackHit > AttackMissed > DamageTaken > HealingApplied > BuffApplied > ConditionAdded\n  const targetEvent = subEvents.find(event => {\n    return event.type === 'AttackHit' ||\n           event.type === 'AttackMissed' ||\n           event.type === 'DamageTaken' ||\n           event.type === 'HealingApplied' ||\n           event.type === 'BuffApplied' ||\n           event.type === 'ConditionAdded'\n  })\n\n  if (targetEvent) {\n    if ('target_id' in targetEvent) return targetEvent.target_id as string\n  }\n\n  return null\n}\n\n/**\n * Extract interaction type between actor and target\n */\nconst getInteractionType = (subEvents: Event[]): 'attack' | 'heal' | 'buff' | 'self' | null => {\n  if (!subEvents || subEvents.length === 0) return null\n\n  const types = subEvents.map(e => e.type)\n\n  if (types.includes('AttackHit') || types.includes('AttackMissed')) return 'attack'\n  if (types.includes('HealingApplied')) return 'heal'\n  if (types.includes('BuffApplied') || types.includes('ConditionAdded')) return 'buff'\n\n  return null\n}\n\n/**\n * Helper component to render individual sub-events with appropriate icons and colors\n */\nconst SubEventCard: FC<{ event: Event; index: number }> = ({ event, index }) => {\n  const getEventColor = () => {\n    switch (event.type) {\n      case 'AttackHit': return 'from-red-600/20 to-orange-600/20 border-red-500/30'\n      case 'AttackMissed': return 'from-slate-600/20 to-slate-600/20 border-slate-500/30'\n      case 'DamageTaken': return 'from-red-700/30 to-rose-700/30 border-red-400/40'\n      case 'HealingApplied': return 'from-emerald-600/20 to-green-600/20 border-emerald-500/30'\n      case 'TempHPGranted': return 'from-cyan-600/20 to-blue-600/20 border-cyan-500/30'\n      case 'BuffApplied': return 'from-amber-600/20 to-yellow-600/20 border-amber-500/30'\n      case 'ConditionAdded': return 'from-purple-600/20 to-violet-600/20 border-purple-500/30'\n      case 'UnitDied': return 'from-gray-700/30 to-slate-700/30 border-gray-500/40'\n      default: return 'from-slate-700/20 to-slate-800/20 border-slate-600/30'\n    }\n  }\n\n  const getEventIcon = () => {\n    switch (event.type) {\n      case 'AttackHit':\n      case 'AttackMissed':\n        return faBolt\n      case 'DamageTaken':\n        return faSkull\n      case 'HealingApplied':\n      case 'TempHPGranted':\n        return faHeart\n      case 'BuffApplied':\n        return faMagic\n      case 'ConditionAdded':\n        return faShieldAlt\n      case 'UnitDied':\n        return faSkull\n      default:\n        return faClock\n    }\n  }\n\n  const getEventLabel = () => {\n    switch (event.type) {\n      case 'AttackHit':\n        return `${event.attacker_id} hit ${event.target_id}`\n      case 'AttackMissed':\n        return `${event.attacker_id} missed ${event.target_id}`\n      case 'DamageTaken':\n        return `${event.target_id} took ${event.damage} ${event.damage_type || 'damage'}`\n      case 'HealingApplied':\n        return `${event.target_id} healed for ${event.amount}`\n      case 'TempHPGranted':\n        return `${event.target_id} gained ${event.amount} temp HP`\n      case 'BuffApplied':\n        return `${event.buff_id} applied to ${event.target_id}`\n      case 'ConditionAdded':\n        return `${event.condition} added to ${event.target_id}`\n      case 'UnitDied':\n        return `${event.unit_id} was slain`\n      default:\n        return event.type\n    }\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, x: -10 }}\n      animate={{ opacity: 1, x: 0 }}\n      transition={{ delay: index * 0.05 }}\n      className={`relative overflow-hidden rounded-lg border bg-gradient-to-r ${getEventColor()} backdrop-blur-sm`}\n    >\n      <div className=\"flex items-start gap-3 p-3\">\n        <div className=\"mt-0.5 flex-shrink-0 w-8 h-8 rounded-full bg-slate-900/50 flex items-center justify-center\">\n          <FontAwesomeIcon\n            icon={getEventIcon()}\n            className=\"text-xs\"\n            style={{ color: event.type === 'AttackHit' || event.type === 'DamageTaken' ? '#f87171' : '#94a3b8' }}\n          />\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-sm font-medium text-slate-200 truncate\">{getEventLabel()}</p>\n          {event.type === 'AttackHit' && event.damage_roll && (\n            <p className=\"text-xs text-slate-400 font-mono mt-0.5\">\n              {event.damage_roll.formula} = {event.damage_roll.total}\n            </p>\n          )}\n          {event.type === 'AttackHit' && event.attack_roll && (\n            <p className=\"text-xs text-slate-400 font-mono\">\n              vs AC {event.target_ac}\n            </p>\n          )}\n        </div>\n        <span className=\"text-[10px] text-slate-500 font-mono self-start\">#{index + 1}</span>\n      </div>\n    </motion.div>\n  )\n}\n\n/**\n * Generate a brief summary for an action's sub-events\n */\nconst getActionSummary = (subEvents: Event[]): string => {\n  if (!subEvents || subEvents.length === 0) return 'No events'\n\n  const types = subEvents.map(e => e.type)\n\n  if (types.includes('AttackHit')) {\n    const hit = subEvents.find(e => e.type === 'AttackHit')\n    const target = (hit as any)?.target_id || 'unknown'\n    const damage = subEvents.find(e => e.type === 'DamageTaken')\n    const amount = damage ? (damage as any).damage : 0\n    return `Hit ${target} for ${amount} damage`\n  }\n\n  if (types.includes('AttackMissed')) {\n    const miss = subEvents.find(e => e.type === 'AttackMissed')\n    const target = (miss as any)?.target_id || 'unknown'\n    return `Missed ${target}`\n  }\n\n  if (types.includes('HealingApplied')) {\n    const heal = subEvents.find(e => e.type === 'HealingApplied')\n    const amount = (heal as any)?.amount || 0\n    return `Healed for ${amount}`\n  }\n\n  if (types.includes('BuffApplied')) {\n    const buff = subEvents.find(e => e.type === 'BuffApplied')\n    const buffId = (buff as any)?.buff_id || 'buff'\n    return `Applied ${buffId}`\n  }\n\n  if (types.includes('ConditionAdded')) {\n    const cond = subEvents.find(e => e.type === 'ConditionAdded')\n    const condition = (cond as any)?.condition || 'condition'\n    return `Added ${condition}`\n  }\n\n  if (types.includes('SpellCast')) {\n    const spell = subEvents.find(e => e.type === 'SpellCast')\n    const spellId = (spell as any)?.spell_id || 'spell'\n    return `Cast ${spellId}`\n  }\n\n  return `${subEvents.length} events`\n}\n\n/**\n * Get action icon based on action type or sub-events\n */\nconst getActionIcon = (actionId: string, subEvents: Event[]) => {\n  // Check action ID first\n  if (actionId.toLowerCase().includes('attack')) return faBolt\n  if (actionId.toLowerCase().includes('spell') || actionId.toLowerCase().includes('cast')) return faMagic\n  if (actionId.toLowerCase().includes('dodge')) return faShieldAlt\n  if (actionId.toLowerCase().includes('dash')) return faClock\n  if (actionId.toLowerCase().includes('heal')) return faHeart\n  if (actionId.toLowerCase().includes('help')) return faHand\n\n  // Check sub-events\n  const types = subEvents.map(e => e.type)\n  if (types.includes('AttackHit') || types.includes('AttackMissed')) return faBolt\n  if (types.includes('HealingApplied')) return faHeart\n  if (types.includes('BuffApplied') || types.includes('ConditionAdded')) return faShieldAlt\n  if (types.includes('SpellCast')) return faMagic\n\n  return faGavel // Default action icon\n}\n\n/**\n * Calculate damage dealt, taken, and healing for an action\n */\nconst calculateActionStats = (actorId: string, subEvents: Event[]) => {\n  let damageDealt = 0\n  let damageTaken = 0\n  let healingDone = 0\n\n  for (const event of subEvents) {\n    if (event.type === 'DamageTaken') {\n      const evt = event as any\n      if (evt.target_id === actorId) {\n        damageTaken += evt.damage || 0\n      } else {\n        damageDealt += evt.damage || 0\n      }\n    }\n    if (event.type === 'HealingApplied') {\n      const evt = event as any\n      if (evt.target_id === actorId) {\n        healingDone += evt.amount || 0\n      } else {\n        healingDone += evt.amount || 0\n      }\n    }\n  }\n\n  return { damageDealt, damageTaken, healingDone }\n}\n\n/**\n * Calculate stats for all actions in a turn\n */\nconst calculateTurnStats = (actorId: string, actions: ReplayAction[]) => {\n  let totalDamageDealt = 0\n  let totalDamageTaken = 0\n  let totalHealingDone = 0\n\n  for (const action of actions) {\n    const stats = calculateActionStats(actorId, action.subEvents)\n    totalDamageDealt += stats.damageDealt\n    totalDamageTaken += stats.damageTaken\n    totalHealingDone += stats.healingDone\n  }\n\n  return { totalDamageDealt, totalDamageTaken, totalHealingDone }\n}\n\n/**\n * Determine faction (PC vs Enemy) based on unitId\n * Checks if unitId matches any PlayerTemplate key\n */\nconst getUnitFaction = (unitId: string): 'pc' | 'enemy' | 'neutral' => {\n  // Check if unitId matches any PlayerTemplate name\n  const templateNames = Object.keys(PlayerTemplates)\n  const isPc = templateNames.some(name =>\n    name.toLowerCase() === unitId.toLowerCase() ||\n    unitId.toLowerCase().includes(name.toLowerCase())\n  )\n\n  if (isPc) return 'pc'\n\n  // Common enemy patterns\n  const enemyPatterns = ['goblin', 'orc', 'dragon', 'zombie', 'skeleton', 'bandit', 'wolf', 'bear']\n  const isEnemy = enemyPatterns.some(pattern => unitId.toLowerCase().includes(pattern))\n\n  return isEnemy ? 'enemy' : 'neutral'\n}\n\n/**\n * Get color classes for faction\n */\nconst getFactionColors = (faction: 'pc' | 'enemy' | 'neutral', isActive: boolean) => {\n  if (isActive) {\n    return {\n      border: 'border-purple-500/50',\n      background: 'from-purple-900/30 to-purple-800/10',\n      text: 'text-purple-300',\n      icon: 'text-purple-400'\n    }\n  }\n\n  switch (faction) {\n    case 'pc':\n      return {\n        border: 'border-cyan-500/30',\n        background: 'from-cyan-900/20 to-cyan-800/10',\n        text: 'text-cyan-300',\n        icon: 'text-cyan-400'\n      }\n    case 'enemy':\n      return {\n        border: 'border-red-500/30',\n        background: 'from-red-900/20 to-red-800/10',\n        text: 'text-red-300',\n        icon: 'text-red-400'\n      }\n    default:\n      return {\n        border: 'border-slate-600/30',\n        background: 'from-slate-800/20 to-slate-700/10',\n        text: 'text-slate-300',\n        icon: 'text-slate-400'\n      }\n  }\n}\n\n/**\n * Get compact action result text\n */\nconst getActionResultText = (subEvents: Event[]): string => {\n  const types = subEvents.map(e => e.type)\n\n  if (types.includes('AttackHit')) {\n    const hit = subEvents.find(e => e.type === 'AttackHit') as any\n    const target = hit?.target_id || 'unknown'\n    const damage = subEvents.find(e => e.type === 'DamageTaken') as any\n    const amount = damage?.damage || 0\n    return ` ${target} Hit ${amount}dmg`\n  }\n\n  if (types.includes('AttackMissed')) {\n    const miss = subEvents.find(e => e.type === 'AttackMissed') as any\n    const target = miss?.target_id || 'unknown'\n    return ` ${target} Missed`\n  }\n\n  if (types.includes('HealingApplied')) {\n    const heal = subEvents.find(e => e.type === 'HealingApplied') as any\n    const amount = heal?.amount || 0\n    return `Heal ${amount}hp`\n  }\n\n  if (types.includes('BuffApplied')) {\n    const buff = subEvents.find(e => e.type === 'BuffApplied') as any\n    return `Applied ${buff?.buff_id || 'buff'}`\n  }\n\n  if (types.includes('ConditionAdded')) {\n    const cond = subEvents.find(e => e.type === 'ConditionAdded') as any\n    return `Added ${cond?.condition || 'condition'}`\n  }\n\n  return ''\n}\n\n/**\n * ActionCard - Individual action within a turn card\n */\ninterface ActionCardProps {\n  action: ReplayAction\n  actorId: string\n  actionIndex: number // Flattened index for seeking\n  isActive: boolean\n  onSeek: (index: number) => void\n}\n\nconst ActionCard: FC<ActionCardProps> = ({ action, actorId, actionIndex, isActive, onSeek }) => {\n  const icon = getActionIcon(action.actionId, action.subEvents)\n  const resultText = getActionResultText(action.subEvents)\n\n  return (\n    <motion.button\n      layout\n      initial={{ opacity: 0, x: -10 }}\n      animate={{ opacity: 1, x: 0 }}\n      whileHover={{ scale: 1.01, x: 2 }}\n      whileTap={{ scale: 0.99 }}\n      onClick={() => onSeek(actionIndex)}\n      className={`w-full text-left px-3 py-2 rounded-lg border transition-all text-xs ${\n        isActive\n          ? 'bg-purple-600/20 border-purple-500/40'\n          : 'bg-slate-800/30 border-slate-700/30 hover:bg-slate-700/40'\n      }`}\n    >\n      <div className=\"flex items-center gap-2\">\n        <FontAwesomeIcon icon={icon} className={`text-xs ${isActive ? 'text-purple-400' : 'text-slate-500'}`} />\n        <span className={`font-medium truncate ${isActive ? 'text-white' : 'text-slate-300'}`}>\n          {action.actionId}\n        </span>\n        {resultText && (\n          <span className={`text-[10px] font-mono truncate ml-auto ${isActive ? 'text-purple-300' : 'text-slate-500'}`}>\n            {resultText}\n          </span>\n        )}\n      </div>\n    </motion.button>\n  )\n}\n\n/**\n * TurnCard - Collapsible card for a single turn\n */\ninterface TurnCardProps {\n  id?: string // Optional id for scroll-into-view\n  roundNumber: number\n  turnIndex: number\n  unitId: string\n  actions: ReplayAction[]\n  firstActionIndex: number // Flattened index for seeking to turn start\n  isExpanded: boolean\n  isActive: boolean\n  onToggleExpand: () => void\n  onSeek: (index: number) => void\n}\n\nconst TurnCard: FC<TurnCardProps> = ({\n  id,\n  roundNumber,\n  turnIndex,\n  unitId,\n  actions,\n  firstActionIndex,\n  isExpanded,\n  isActive,\n  onToggleExpand,\n  onSeek\n}) => {\n  const faction = getUnitFaction(unitId)\n  const colors = getFactionColors(faction, isActive)\n  const stats = calculateTurnStats(unitId, actions)\n\n  return (\n    <motion.div\n      id={id}\n      layout\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={`relative overflow-hidden rounded-xl border-l-4 ${colors.border} bg-gradient-to-br ${colors.background} backdrop-blur-sm`}\n    >\n      {/* Pulse animation for active turn */}\n      {isActive && (\n        <motion.div\n          className=\"absolute inset-0 pointer-events-none\"\n          animate={{\n            boxShadow: [\n              '0 0 0 0px rgba(168, 85, 247, 0.4)',\n              '0 0 0 8px rgba(168, 85, 247, 0)'\n            ]\n          }}\n          transition={{ duration: 2, repeat: Infinity }}\n        />\n      )}\n\n      {/* Header - Always visible */}\n      <motion.button\n        layout\n        whileHover={{ scale: isExpanded ? 1 : 1.01, x: isExpanded ? 0 : 2 }}\n        whileTap={{ scale: 0.99 }}\n        onClick={() => isExpanded ? onToggleExpand() : onSeek(firstActionIndex)}\n        className=\"w-full px-4 py-3 flex items-center justify-between\"\n      >\n        {/* Left: Round/Turn badge + Unit name */}\n        <div className=\"flex items-center gap-3 min-w-0 flex-1\">\n          {/* Round/Turn badge */}\n          <span className={`flex-shrink-0 px-2 py-1 rounded text-[10px] font-mono font-semibold ${\n            isActive\n              ? 'bg-purple-500 text-white'\n              : 'bg-slate-700 text-slate-400'\n          }`}>\n            R{roundNumber}  T{turnIndex + 1}\n          </span>\n\n          {/* Unit name with faction color */}\n          <span className={`font-medium truncate ${colors.text}`}>\n            {unitId}\n          </span>\n\n          {/* Faction badge */}\n          <span className={`flex-shrink-0 px-1.5 py-0.5 rounded text-[9px] font-semibold uppercase ${\n            faction === 'pc' ? 'bg-cyan-500/20 text-cyan-400' :\n            faction === 'enemy' ? 'bg-red-500/20 text-red-400' :\n            'bg-slate-500/20 text-slate-400'\n          }`}>\n            {faction === 'pc' ? 'PC' : faction === 'enemy' ? 'NPC' : '?'}\n          </span>\n        </div>\n\n        {/* Right: Expand/collapse indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 ml-2\"\n        >\n          <FontAwesomeIcon icon={faChevronDown} className={`text-xs ${isActive ? 'text-purple-400' : 'text-slate-500'}`} />\n        </motion.div>\n      </motion.button>\n\n      {/* Expanded content */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            layout\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ type: 'spring', stiffness: 300, damping: 30 }}\n          >\n            {/* Action list */}\n            <div className=\"px-3 pb-2 space-y-1\">\n              {actions.map((action, idx) => (\n                <ActionCard\n                  key={idx}\n                  action={action}\n                  actorId={unitId}\n                  actionIndex={firstActionIndex + idx}\n                  isActive={false}\n                  onSeek={onSeek}\n                />\n              ))}\n            </div>\n\n            {/* Footer stats */}\n            <div className=\"px-3 pb-3 pt-2 border-t border-slate-700/30\">\n              <div className=\"flex items-center justify-center gap-4 text-[10px]\">\n                {stats.totalDamageDealt > 0 && (\n                  <div className=\"flex items-center gap-1\">\n                    <FontAwesomeIcon icon={faFire} className=\"text-red-400\" />\n                    <span className=\"text-slate-300\">{stats.totalDamageDealt}</span>\n                  </div>\n                )}\n                {stats.totalDamageTaken > 0 && (\n                  <div className=\"flex items-center gap-1\">\n                    <FontAwesomeIcon icon={faShieldAlt} className=\"text-amber-400\" />\n                    <span className=\"text-slate-300\">{stats.totalDamageTaken}</span>\n                  </div>\n                )}\n                {stats.totalHealingDone > 0 && (\n                  <div className=\"flex items-center gap-1\">\n                    <FontAwesomeIcon icon={faHeart} className=\"text-emerald-400\" />\n                    <span className=\"text-slate-300\">{stats.totalHealingDone}</span>\n                  </div>\n                )}\n                {stats.totalDamageDealt === 0 && stats.totalDamageTaken === 0 && stats.totalHealingDone === 0 && (\n                  <span className=\"text-slate-500 italic\">No damage/healing</span>\n                )}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  )\n}\n\n/**\n * SyncLogPanel - Card-based turn-by-turn combat log\n *\n * Displays turns as collapsible cards with:\n * - Round/Turn information\n * - Unit identification with faction coloring\n * - Action list (when expanded)\n * - Damage/healing summary\n * - Click-to-seek functionality\n * - Auto-expand for active turn during playback\n */\ninterface SyncLogPanelProps {\n  /** Replay data */\n  replay: Replay | null\n  /** Flattened actions for seeking */\n  actions: readonly FlattenedAction[]\n  /** Current action index */\n  currentIndex: number\n  /** Seek callback when user clicks an action */\n  onSeek: (index: number) => void\n  /** Whether playback is active (for auto-scroll) */\n  isPlaying: boolean\n}\n\nconst SyncLogPanel: FC<SyncLogPanelProps> = ({\n  replay,\n  actions,\n  currentIndex,\n  onSeek,\n  isPlaying\n}) => {\n  const listRef = useRef<HTMLDivElement>(null)\n\n  // Expansion state: Set of turn keys (roundNumber-turnIndex) that are expanded\n  const [expandedTurns, setExpandedTurns] = useState<Set<string>>(new Set())\n\n  // Auto-expand current turn during playback\n  useEffect(() => {\n    if (actions.length > 0 && currentIndex >= 0 && currentIndex < actions.length) {\n      const currentAction = actions[currentIndex]\n      const turnKey = `${currentAction.roundNumber}-${currentAction.turnIndex}`\n      setExpandedTurns(prev => new Set([...prev, turnKey]))\n    }\n  }, [currentIndex, actions])\n\n  // Auto-scroll to current turn during playback\n  useEffect(() => {\n    if (isPlaying && actions.length > 0 && currentIndex >= 0) {\n      const currentAction = actions[currentIndex]\n      const turnKey = `turn-${currentAction.roundNumber}-${currentAction.turnIndex}`\n      const element = document.getElementById(turnKey)\n      if (element) {\n        element.scrollIntoView({ behavior: 'smooth', block: 'nearest' })\n      }\n    }\n  }, [currentIndex, isPlaying, actions])\n\n  const toggleTurn = (turnKey: string) => {\n    setExpandedTurns(prev => {\n      const next = new Set(prev)\n      if (next.has(turnKey)) {\n        next.delete(turnKey)\n      } else {\n        next.add(turnKey)\n      }\n      return next\n    })\n  }\n\n  // Build a lookup map: actionIndex  FlattenedAction\n  const actionMap = useMemo(() => {\n    const map = new Map<number, FlattenedAction>()\n    actions.forEach(a => map.set(a.index, a))\n    return map\n  }, [actions])\n\n  // Get current action info for highlighting\n  const currentAction = actions.length > 0 && currentIndex >= 0 && currentIndex < actions.length\n    ? actions[currentIndex]\n    : null\n\n  if (!replay) {\n    return (\n      <div className=\"h-full flex flex-col bg-slate-900/40 border-r border-slate-800/50\">\n        <div className=\"flex items-center gap-2 px-4 py-3 border-b border-slate-800/50 bg-slate-900/60\">\n          <FontAwesomeIcon icon={faList} className=\"text-purple-400 text-xs\" />\n          <h3 className=\"text-sm font-medium text-slate-300\">Sync Log</h3>\n        </div>\n        <div className=\"flex-1 flex items-center justify-center\">\n          <p className=\"text-slate-500 text-sm\">No replay data</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"h-full flex flex-col bg-slate-900/40 border-r border-slate-800/50\">\n      {/* Header */}\n      <div className=\"flex items-center gap-2 px-4 py-3 border-b border-slate-800/50 bg-slate-900/60\">\n        <FontAwesomeIcon icon={faList} className=\"text-purple-400 text-xs\" />\n        <h3 className=\"text-sm font-medium text-slate-300\">Combat Log</h3>\n        <span className=\"text-xs text-slate-500\">({replay.rounds.length} rounds)</span>\n      </div>\n\n      {/* Scrollable Turn Cards */}\n      <div ref={listRef} className=\"flex-1 overflow-auto overflow-x-hidden\">\n        <div className=\"p-3 space-y-2\">\n          {replay.rounds.map((round) => (\n            <div key={round.roundNumber}>\n              {round.turns.map((turn, turnIdx) => {\n                const turnKey = `${round.roundNumber}-${turnIdx}`\n                const isExpanded = expandedTurns.has(turnKey)\n\n                // Check if this turn contains the current action\n                const isActive = currentAction &&\n                  currentAction.roundNumber === round.roundNumber &&\n                  currentAction.turnIndex === turnIdx\n\n                // Find the first action index for this turn\n                const firstAction = actions.find(a =>\n                  a.roundNumber === round.roundNumber && a.turnIndex === turnIdx\n                )\n                const firstActionIndex = firstAction?.index ?? 0\n\n                return (\n                  <TurnCard\n                    key={turnKey}\n                    id={`turn-${round.roundNumber}-${turnIdx}`}\n                    roundNumber={round.roundNumber}\n                    turnIndex={turnIdx}\n                    unitId={turn.unitId}\n                    actions={turn.actions}\n                    firstActionIndex={firstActionIndex}\n                    isExpanded={isExpanded}\n                    isActive={isActive ?? false}\n                    onToggleExpand={() => toggleTurn(turnKey)}\n                    onSeek={onSeek}\n                  />\n                )\n              })}\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n/**\n * Combat Replay Modal - \"Chronomancer's Table\"\n *\n * A modal component for visualizing and navigating through combat replays.\n * Features a focus stage in the center and timeline scrubber in the header.\n */\nexport const CombatReplayModal: FC<CombatReplayModalProps> = ({\n  replay,\n  open,\n  onOpenChange\n}) => {\n  const [showGlobalEvents, setShowGlobalEvents] = useState(false)\n\n  const playback = useCombatPlayback(replay, {\n    autoAdvanceInterval: 800\n  })\n\n  const {\n    currentAction,\n    currentRoundIndex,\n    isPlaying,\n    totalActions,\n    totalRounds,\n    progress,\n    nextAction,\n    prevAction,\n    play,\n    pause,\n    togglePlay,\n    seekToStart,\n    seekToEnd,\n    seekToRound\n  } = playback\n\n  // Format action info for display\n  const actionInfo = currentAction\n    ? `R${currentAction.roundNumber}  ${currentAction.unitId}`\n    : 'No action selected'\n\n  return (\n    <Dialog.Root open={open} onOpenChange={onOpenChange}>\n      <AnimatePresence>\n        {open && (\n          <>\n            {/* Backdrop */}\n            <Dialog.Overlay asChild>\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"fixed inset-0 bg-black/90 backdrop-blur-md z-50\"\n              />\n            </Dialog.Overlay>\n\n            {/* Modal Content */}\n            <Dialog.Content asChild>\n              <motion.div\n                initial={{ opacity: 0, scale: 0.95, y: 20 }}\n                animate={{ opacity: 1, scale: 1, y: 0 }}\n                exit={{ opacity: 0, scale: 0.95, y: 20 }}\n                transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n                className=\"fixed inset-4 md:inset-8 lg:inset-12 flex flex-col bg-gradient-to-br from-slate-950 via-slate-900 to-zinc-950 border border-slate-700/50 rounded-2xl shadow-2xl z-50 overflow-hidden\"\n              >\n                {/* Header - Timeline Scrubber */}\n                <div className=\"flex flex-col border-b border-slate-800/50 bg-slate-900/60 backdrop-blur-xl\">\n                  {/* Title Bar */}\n                  <div className=\"flex items-center justify-between px-6 py-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <motion.div\n                        animate={{ rotate: isPlaying ? 360 : 0 }}\n                        transition={{ duration: 2, repeat: Infinity, ease: 'linear' }}\n                        className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-600/30 via-purple-500/20 to-blue-600/30 border border-purple-500/40 flex items-center justify-center shadow-lg shadow-purple-500/10\"\n                      >\n                        <FontAwesomeIcon icon={faClock} className=\"text-purple-400 text-base\" />\n                      </motion.div>\n                      <div>\n                        <Dialog.Title className=\"text-lg font-semibold text-white tracking-wide\">\n                          Chronomancer's Table\n                        </Dialog.Title>\n                        <Dialog.Description className=\"sr-only\">\n                          Navigate through combat replay timeline with playback controls, view detailed action events and sub-events\n                        </Dialog.Description>\n                        <p className=\"text-xs text-slate-400\">\n                          {totalActions} actions across {totalRounds} rounds\n                        </p>\n                      </div>\n                    </div>\n\n                    <Dialog.Close asChild>\n                      <motion.button\n                        whileHover={{ scale: 1.1, rotate: 90 }}\n                        whileTap={{ scale: 0.9 }}\n                        className=\"w-10 h-10 rounded-xl bg-slate-800/50 hover:bg-red-600/20 border border-slate-700/50 hover:border-red-500/30 text-slate-400 hover:text-red-400 transition-all flex items-center justify-center\"\n                      >\n                        <FontAwesomeIcon icon={faTimes} />\n                      </motion.button>\n                    </Dialog.Close>\n                  </div>\n\n                  {/* Playback Controls */}\n                  <div className=\"px-6 pb-4\">\n                    {/* Timeline Progress */}\n                    <div className=\"mb-4\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-xs text-slate-400 font-mono\">\n                          {currentAction?.index ?? 0} / {totalActions}\n                        </span>\n                        <span className=\"text-xs text-purple-400 font-mono\">\n                          {actionInfo}\n                        </span>\n                      </div>\n                      <div\n                        className=\"h-2.5 bg-slate-800/80 rounded-full overflow-hidden cursor-pointer group relative\"\n                        onClick={(e) => {\n                          const rect = e.currentTarget.getBoundingClientRect()\n                          const percent = (e.clientX - rect.left) / rect.width\n                          playback.seek(Math.floor(percent * (totalActions - 1)))\n                        }}\n                      >\n                        <motion.div\n                          className=\"h-full bg-gradient-to-r from-purple-600 via-purple-500 to-blue-500 rounded-full relative\"\n                          initial={{ width: 0 }}\n                          animate={{ width: `${progress * 100}%` }}\n                          transition={{ duration: 0.15 }}\n                        >\n                          <motion.div\n                            className=\"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-lg\"\n                            initial={{ scale: 0 }}\n                            animate={{ scale: progress > 0 ? 1 : 0 }}\n                            transition={{ type: 'spring', stiffness: 500 }}\n                          />\n                        </motion.div>\n                      </div>\n                    </div>\n\n                    {/* Control Buttons */}\n                    <div className=\"flex items-center justify-center gap-2\">\n                      <motion.button\n                        whileHover={{ scale: 1.1 }}\n                        whileTap={{ scale: 0.95 }}\n                        onClick={seekToStart}\n                        className=\"px-3 py-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 border border-slate-700/50 text-slate-400 hover:text-white transition-all text-xs\"\n                        title=\"Go to start\"\n                      >\n                        <FontAwesomeIcon icon={faHistory} className=\"fa-flip-horizontal\" />\n                      </motion.button>\n\n                      <motion.button\n                        whileHover={{ scale: 1.1 }}\n                        whileTap={{ scale: 0.95 }}\n                        onClick={prevAction}\n                        className=\"px-4 py-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 border border-slate-700/50 text-slate-400 hover:text-white transition-all\"\n                        title=\"Previous action\"\n                      >\n                        <FontAwesomeIcon icon={faStepBackward} />\n                      </motion.button>\n\n                      <motion.button\n                        whileHover={{ scale: 1.05 }}\n                        whileTap={{ scale: 0.95 }}\n                        onClick={togglePlay}\n                        className={`px-8 py-3 rounded-xl border transition-all ${\n                          isPlaying\n                            ? 'bg-amber-600/20 border-amber-500/50 text-amber-400 hover:bg-amber-600/30'\n                            : 'bg-emerald-600/20 border-emerald-500/50 text-emerald-400 hover:bg-emerald-600/30'\n                        }`}\n                        title={isPlaying ? 'Pause' : 'Play'}\n                      >\n                        <FontAwesomeIcon icon={isPlaying ? faPause : faPlay} />\n                      </motion.button>\n\n                      <motion.button\n                        whileHover={{ scale: 1.1 }}\n                        whileTap={{ scale: 0.95 }}\n                        onClick={nextAction}\n                        className=\"px-4 py-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 border border-slate-700/50 text-slate-400 hover:text-white transition-all\"\n                        title=\"Next action\"\n                      >\n                        <FontAwesomeIcon icon={faStepForward} />\n                      </motion.button>\n\n                      <motion.button\n                        whileHover={{ scale: 1.1 }}\n                        whileTap={{ scale: 0.95 }}\n                        onClick={seekToEnd}\n                        className=\"px-3 py-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 border border-slate-700/50 text-slate-400 hover:text-white transition-all text-xs\"\n                        title=\"Go to end\"\n                      >\n                        <FontAwesomeIcon icon={faHistory} />\n                      </motion.button>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Body - Side-by-side Layout */}\n                <div className=\"flex-1 flex overflow-hidden\">\n                  {/* Sync Log Panel - Left (40%) */}\n                  <SyncLogPanel\n                    replay={replay}\n                    actions={playback.actions}\n                    currentIndex={currentAction?.index ?? -1}\n                    onSeek={playback.seek}\n                    isPlaying={isPlaying}\n                  />\n\n                  {/* Focus Stage - Right (60%) */}\n                  <div className=\"flex-1 overflow-auto p-6\">\n                  {currentAction ? (\n                    <div className=\"h-full flex flex-col gap-4\">\n                      {/* Action Header - Actor vs Target */}\n                      <motion.div\n                        initial={{ opacity: 0, y: -10 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        className=\"relative overflow-hidden rounded-2xl border border-purple-500/30 bg-gradient-to-br from-purple-900/20 via-slate-900/50 to-blue-900/20 backdrop-blur-sm\"\n                      >\n                        {/* Top border accent */}\n                        <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 via-purple-400 to-blue-500\" />\n\n                        <div className=\"p-6\">\n                          {/* Round & Turn Badge */}\n                          <div className=\"absolute top-4 right-4 flex flex-col items-end\">\n                            <div className=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-900/60 border border-purple-500/30\">\n                              <FontAwesomeIcon icon={faClock} className=\"text-purple-400 text-xs\" />\n                              <span className=\"text-sm font-mono text-purple-300\">\n                                R{currentAction.roundNumber}  T{currentAction.turnIndex + 1}\n                              </span>\n                            </div>\n                          </div>\n\n                          {/* Actor vs Target Layout */}\n                          <div className=\"relative flex items-stretch gap-6\">\n                            {/* Actor Panel */}\n                            <motion.div\n                              initial={{ opacity: 0, x: -20 }}\n                              animate={{ opacity: 1, x: 0 }}\n                              transition={{ delay: 0.1 }}\n                              className=\"relative z-10 flex-1 bg-gradient-to-br from-purple-900/40 to-purple-800/20 border-2 border-purple-500/40 rounded-xl p-5\"\n                            >\n                              <div className=\"flex items-center gap-3 mb-3\">\n                                <div className=\"w-12 h-12 rounded-lg bg-purple-600/30 border border-purple-500/50 flex items-center justify-center\">\n                                  <FontAwesomeIcon icon={faUser} className=\"text-purple-400 text-lg\" />\n                                </div>\n                                <div>\n                                  <p className=\"text-xs text-purple-400 font-mono uppercase tracking-wider\">Actor</p>\n                                  <p className=\"text-lg font-semibold text-white\">{currentAction.unitId}</p>\n                                </div>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <FontAwesomeIcon icon={faGavel} className=\"text-purple-400/70 text-sm\" />\n                                <span className=\"text-sm text-slate-300\">Action: </span>\n                                <span className=\"text-sm font-mono text-purple-300 bg-purple-500/20 px-2 py-0.5 rounded\">\n                                  {currentAction.action.actionId}\n                                </span>\n                              </div>\n                            </motion.div>\n\n                            {/* Interaction Arrow */}\n                            {(() => {\n                              const targetId = extractTargetId(currentAction.action.subEvents)\n                              const interactionType = getInteractionType(currentAction.action.subEvents)\n\n                              if (!targetId || !interactionType) return null\n\n                              const arrowColor = interactionType === 'attack' ? 'text-red-400' :\n                                                  interactionType === 'heal' ? 'text-emerald-400' :\n                                                  interactionType === 'buff' ? 'text-amber-400' : 'text-purple-400'\n\n                              return (\n                                <motion.div\n                                  initial={{ opacity: 0, scale: 0.5 }}\n                                  animate={{ opacity: 1, scale: 1 }}\n                                  transition={{ delay: 0.2 }}\n                                  className=\"relative z-20 flex-shrink-0 flex items-center justify-center self-center\"\n                                >\n                                  <div className={`w-14 h-14 rounded-full bg-slate-900/80 border-2 ${arrowColor.replace('text', 'border')} flex items-center justify-center shadow-lg`}>\n                                    <FontAwesomeIcon\n                                      icon={interactionType === 'attack' ? faBolt :\n                                             interactionType === 'heal' ? faHeart :\n                                             interactionType === 'buff' ? faMagic : faExchangeAlt}\n                                      className={`${arrowColor} text-lg`}\n                                    />\n                                  </div>\n                                </motion.div>\n                              )\n                            })()}\n\n                            {/* Target Panel */}\n                            {(() => {\n                              const targetId = extractTargetId(currentAction.action.subEvents)\n                              const interactionType = getInteractionType(currentAction.action.subEvents)\n\n                              if (!targetId || !interactionType) return null\n\n                              const borderColor = interactionType === 'attack' ? 'border-red-500/40' :\n                                                  interactionType === 'heal' ? 'border-emerald-500/40' :\n                                                  interactionType === 'buff' ? 'border-amber-500/40' : 'border-purple-500/40'\n\n                              const bgGradient = interactionType === 'attack' ? 'from-red-900/40 to-rose-800/20' :\n                                                interactionType === 'heal' ? 'from-emerald-900/40 to-green-800/20' :\n                                                interactionType === 'buff' ? 'from-amber-900/40 to-yellow-800/20' : 'from-purple-900/40 to-purple-800/20'\n\n                              const iconColor = interactionType === 'attack' ? 'text-red-400' :\n                                              interactionType === 'heal' ? 'text-emerald-400' :\n                                              interactionType === 'buff' ? 'text-amber-400' : 'text-purple-400'\n\n                              return (\n                                <motion.div\n                                  initial={{ opacity: 0, x: 20 }}\n                                  animate={{ opacity: 1, x: 0 }}\n                                  transition={{ delay: 0.15 }}\n                                  className={`relative z-10 flex-1 bg-gradient-to-br ${bgGradient} border-2 ${borderColor} rounded-xl p-5`}\n                                >\n                                  <div className=\"flex items-center gap-3 mb-3\">\n                                    <div className={`w-12 h-12 rounded-lg bg-slate-900/40 border ${borderColor.replace('/40', '/50')} flex items-center justify-center`}>\n                                      <FontAwesomeIcon icon={faUserFriends} className={`${iconColor} text-lg`} />\n                                    </div>\n                                    <div>\n                                      <p className={`text-xs font-mono uppercase tracking-wider ${iconColor}`}>Target</p>\n                                      <p className=\"text-lg font-semibold text-white\">{targetId}</p>\n                                    </div>\n                                  </div>\n                                  <div className=\"flex items-center gap-2\">\n                                    <FontAwesomeIcon icon={faCrosshairs} className={`${iconColor.replace('400', '400/70')} text-sm`} />\n                                    <span className=\"text-sm text-slate-300\">Interaction: </span>\n                                    <span className={`text-sm font-medium capitalize ${iconColor}`}>\n                                      {interactionType}\n                                    </span>\n                                  </div>\n                                </motion.div>\n                              )\n                            })()}\n                          </div>\n                        </div>\n                      </motion.div>\n\n                      {/* Sub-Events Timeline */}\n                      <motion.div\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ delay: 0.1 }}\n                        className=\"flex-1 overflow-auto\"\n                      >\n                        <div className=\"flex items-center gap-2 mb-3\">\n                          <FontAwesomeIcon icon={faMagic} className=\"text-purple-400 text-xs\" />\n                          <h3 className=\"text-sm font-medium text-slate-300\">Sub-Events</h3>\n                          <span className=\"text-xs text-slate-500\">({currentAction.action.subEvents.length})</span>\n                        </div>\n                        <div className=\"space-y-2 pr-2\">\n                          {currentAction.action.subEvents.length > 0 ? (\n                            currentAction.action.subEvents.map((event, index) => (\n                              <SubEventCard key={index} event={event} index={index} />\n                            ))\n                          ) : (\n                            <div className=\"flex flex-col items-center justify-center py-12 text-slate-500\">\n                              <FontAwesomeIcon icon={faClock} className=\"text-2xl mb-2\" />\n                              <p className=\"text-sm\">No sub-events recorded</p>\n                            </div>\n                          )}\n                        </div>\n                      </motion.div>\n                    </div>\n                  ) : (\n                    <div className=\"h-full min-h-[300px] rounded-2xl border-2 border-dashed border-slate-700/50 bg-slate-800/10 flex flex-col items-center justify-center\">\n                      <motion.div\n                        initial={{ opacity: 0, y: 10 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        transition={{ delay: 0.2 }}\n                        className=\"text-center\"\n                      >\n                        <div className=\"w-20 h-20 rounded-full bg-slate-800/30 border border-slate-700/50 flex items-center justify-center mb-4 mx-auto\">\n                          <FontAwesomeIcon icon={faClock} className=\"text-3xl text-slate-600\" />\n                        </div>\n                        <h3 className=\"text-xl font-medium text-slate-300 mb-2\">No Action Selected</h3>\n                        <p className=\"text-sm text-slate-500 max-w-md mx-auto\">\n                          Use the playback controls to navigate through the combat timeline.\n                        </p>\n                      </motion.div>\n                    </div>\n                  )}\n                </div>\n                </div>\n\n                {/* Footer - Round Navigator */}\n                <div className=\"border-t border-slate-800/50 px-6 py-4 bg-slate-900/60 backdrop-blur-xl\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <FontAwesomeIcon icon={faHistory} className=\"text-slate-500 text-xs\" />\n                      <span className=\"text-xs text-slate-400 font-medium\">Round Navigator</span>\n                    </div>\n                    <div className=\"flex gap-1.5 flex-wrap justify-end\">\n                      {Array.from({ length: Math.min(totalRounds, 12) }).map((_, i) => (\n                        <motion.button\n                          key={i}\n                          whileHover={{ scale: 1.05 }}\n                          whileTap={{ scale: 0.95 }}\n                          onClick={() => seekToRound(i)}\n                          className={`relative w-9 h-9 rounded-lg text-xs font-mono font-semibold transition-all border ${\n                            currentRoundIndex === i\n                              ? 'bg-gradient-to-br from-purple-600 to-purple-700 text-white border-purple-500 shadow-lg shadow-purple-500/20'\n                              : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50 hover:text-white border-slate-700/30'\n                          }`}\n                        >\n                          {i + 1}\n                          {currentRoundIndex === i && (\n                            <motion.div\n                              layoutId=\"activeRound\"\n                              className=\"absolute inset-0 rounded-lg bg-white/10\"\n                              transition={{ type: 'spring', stiffness: 300, damping: 30 }}\n                            />\n                          )}\n                        </motion.button>\n                      ))}\n                      {totalRounds > 12 && (\n                        <div className=\"flex items-center gap-1 px-2\">\n                          <span className=\"text-xs text-slate-500\">+</span>\n                          <span className=\"text-xs text-slate-400 font-mono\">{totalRounds - 12}</span>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </motion.div>\n            </Dialog.Content>\n          </>\n        )}\n      </AnimatePresence>\n    </Dialog.Root>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/CrosshairContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/CrosshairLine.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CrosshairState' is defined but never used.","line":9,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'chartId' is assigned a value but never used.","line":30,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'chartWidth' is assigned a value but never used.","line":52,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * CrosshairLine - Vertical line overlay synchronized across all charts\n *\n * Renders a vertical dashed line at the hovered bucket position\n * Shows bucket number and median values in tooltip\n */\n\nimport React, { memo, useRef, useEffect, useCallback, useState } from 'react';\nimport { useCrosshair, CrosshairState } from './CrosshairContext';\nimport styles from './crosshairLine.module.scss';\n\nexport interface CrosshairLineProps {\n    /** Width of the chart (must match parent canvas width) */\n    width: number;\n    /** Height of the chart (must match parent canvas height) */\n    height: number;\n    /** Chart identifier (for logging/debugging) */\n    chartId?: string;\n    /** Left padding (where chart data starts) */\n    padding?: { top: number; right: number; bottom: number; left: number };\n    className?: string;\n}\n\n/**\n * Crosshair line overlay component\n */\nconst CrosshairLine: React.FC<CrosshairLineProps> = memo(({\n    width,\n    height,\n    chartId = 'unknown',\n    padding = { top: 20, right: 10, bottom: 30, left: 40 },\n    className,\n}) => {\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n    const { state } = useCrosshair();\n\n    const render = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = setupCanvas(canvas, width, height);\n        if (!ctx) return;\n\n        // Clear entire canvas\n        ctx.clearRect(0, 0, width, height);\n\n        // Only render if we have a valid hover position\n        if (state.xPosition === null || state.bucketIndex === null) {\n            return;\n        }\n\n        const chartWidth = width - padding.left - padding.right;\n        const x = padding.left + state.xPosition;\n\n        // Draw vertical crosshair line\n        ctx.strokeStyle = 'rgba(212, 175, 55, 0.8)';\n        ctx.lineWidth = 1;\n        ctx.setLineDash([4, 4]);\n\n        // Draw line from top to bottom\n        ctx.beginPath();\n        ctx.moveTo(x, padding.top);\n        ctx.lineTo(x, height - padding.bottom);\n        ctx.stroke();\n\n        ctx.setLineDash([]);\n\n        // Draw bucket indicator at bottom\n        ctx.fillStyle = 'rgba(212, 175, 55, 0.9)';\n        ctx.font = 'bold 10px Courier New';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'top';\n\n        // Background for label\n        const label = `P${state.bucketIndex}`;\n        const labelWidth = ctx.measureText(label).width + 8;\n\n        ctx.fillStyle = 'rgba(26, 26, 26, 0.9)';\n        ctx.fillRect(x - labelWidth / 2, height - padding.bottom, labelWidth, 16);\n\n        // Label text\n        ctx.fillStyle = '#d4af37';\n        ctx.fillText(label, x, height - padding.bottom + 2);\n\n    }, [state, width, height, padding]);\n\n    useEffect(() => {\n        render();\n    }, [render]);\n\n    return (\n        <div className={`${styles.crosshairOverlay} ${className || ''}`} data-testid=\"crosshair-line\">\n            <canvas\n                ref={canvasRef}\n                width={width}\n                height={height}\n                className={styles.crosshairCanvas}\n                style={{ pointerEvents: 'none' }}\n                aria-hidden=\"true\"\n            />\n        </div>\n    );\n});\n\nCrosshairLine.displayName = 'CrosshairLine';\n\n/**\n * Setup canvas with high-DPI scaling\n */\nfunction setupCanvas(canvas: HTMLCanvasElement, width: number, height: number) {\n    const dpr = window.devicePixelRatio || 1;\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n        ctx.scale(dpr, dpr);\n    }\n    return ctx;\n}\n\n/**\n * Render spell slot breakdown as compact string\n * e.g., \"L1: 2/4, L3: 1/2\"\n */\nfunction formatSpellSlots(slots: { level: number; remaining: number; max: number }[] | undefined): string | null {\n    if (!slots || slots.length === 0) return null;\n    return slots.map(s => `L${s.level}: ${s.remaining}/${s.max}`).join(', ');\n}\n\n/**\n * Render feature list as compact string\n */\nfunction formatFeatures(features: string[] | undefined): string | null {\n    if (!features || features.length === 0) return null;\n    return features.join(', ');\n}\n\n/**\n * Crosshair tooltip showing bucket details with full resource breakdown\n */\nexport const CrosshairTooltip: React.FC = memo(() => {\n    const { state } = useCrosshair();\n    const { bucketData, mouseX, mouseY } = state;\n    const tooltipRef = useRef<HTMLDivElement>(null);\n    const [style, setStyle] = useState<React.CSSProperties>({ opacity: 0 });\n\n    useEffect(() => {\n        if (!tooltipRef.current || !bucketData || mouseX === null || mouseY === null) return;\n\n        const padding = 15;\n        const tooltipWidth = tooltipRef.current.offsetWidth;\n        const tooltipHeight = tooltipRef.current.offsetHeight;\n        const viewportWidth = window.innerWidth;\n        const viewportHeight = window.innerHeight;\n\n        let finalX = mouseX + padding;\n        let finalY = mouseY + padding;\n\n        // Flip horizontally if overflow\n        if (finalX + tooltipWidth > viewportWidth) {\n            finalX = mouseX - tooltipWidth - padding;\n        }\n\n        // Flip vertically if overflow\n        if (finalY + tooltipHeight > viewportHeight) {\n            finalY = mouseY - tooltipHeight - padding;\n        }\n\n        setStyle({\n            left: Math.max(padding, finalX),\n            top: Math.max(padding, finalY),\n            opacity: 1\n        });\n    }, [mouseX, mouseY, bucketData]);\n\n    if (!bucketData || !bucketData.bucket || mouseX === null || mouseY === null) {\n        return null;\n    }\n\n    const { bucket, characters } = bucketData;\n\n    return (\n        <div\n            ref={tooltipRef}\n            className={styles.tooltip}\n            style={style}\n            role=\"tooltip\"\n            data-testid=\"crosshair-tooltip\"\n        >\n            <div className={styles.tooltipHeader}>\n                <span className={styles.percentile}>Percentile {bucket.percentile}</span>\n                <span className={styles.deaths}>{bucket.deathCount} deaths</span>\n            </div>\n\n            <div className={styles.characterList}>\n                {Object.values(characters).map(char => {\n                    const hpData = char.hp;\n                    const resData = char.resources;\n\n                    // Extract resource breakdown\n                    const breakdown = resData?.resourceBreakdown;\n\n                    return (\n                        <div key={char.name} className={styles.characterRow}>\n                            <div className={styles.charName}>{char.name}</div>\n\n                            {/* HP and overall resource percentage */}\n                            <div className={styles.metrics}>\n                                <span className={`${styles.metric} ${styles.hp}`}>\n                                    HP: {hpData?.hpPercent.toFixed(0) || 'N/A'}%\n                                </span>\n                                <span className={`${styles.metric} ${styles.resources}`}>\n                                    Res: {resData?.resourcePercent.toFixed(0) || 'N/A'}%\n                                </span>\n                            </div>\n\n                            {/* Detailed resource breakdown */}\n                            {breakdown && (\n                                <div className={styles.resourceBreakdown}>\n                                    {/* Spell slots */}\n                                    {breakdown.spellSlots && breakdown.spellSlots.length > 0 && (\n                                        <div className={styles.breakdownRow}>\n                                            <span className={styles.breakdownLabel}>Slots:</span>\n                                            <span className={styles.breakdownValue}>\n                                                {formatSpellSlots(breakdown.spellSlots)}\n                                            </span>\n                                        </div>\n                                    )}\n\n                                    <div className={styles.breakdownGrid}>\n                                        {/* Short rest features */}\n                                        {breakdown.shortRestFeatures && breakdown.shortRestFeatures.length > 0 && (\n                                            <div className={styles.breakdownRow}>\n                                                <span className={styles.breakdownLabel}>Short Rest:</span>\n                                                <span className={styles.breakdownValue}>\n                                                    {formatFeatures(breakdown.shortRestFeatures)}\n                                                </span>\n                                            </div>\n                                        )}\n\n                                        {/* Long rest features */}\n                                        {breakdown.longRestFeatures && breakdown.longRestFeatures.length > 0 && (\n                                            <div className={styles.breakdownRow}>\n                                                <span className={styles.breakdownLabel}>Long Rest:</span>\n                                                <span className={styles.breakdownValue}>\n                                                    {formatFeatures(breakdown.longRestFeatures)}\n                                                </span>\n                                            </div>\n                                        )}\n\n                                        {/* Hit dice */}\n                                        {breakdown.hitDiceMax > 0 && (\n                                            <div className={styles.breakdownRow}>\n                                                <span className={styles.breakdownLabel}>Hit Dice:</span>\n                                                <span className={styles.breakdownValue}>\n                                                    {breakdown.hitDice}/{breakdown.hitDiceMax}\n                                                </span>\n                                            </div>\n                                        )}\n\n                                        {/* EHP */}\n                                        {breakdown.maxEhp > 0 && (\n                                            <div className={styles.breakdownRow}>\n                                                <span className={styles.breakdownLabel}>EHP:</span>\n                                                <span className={styles.breakdownValue}>\n                                                    {breakdown.totalEhp}/{breakdown.maxEhp}\n                                                </span>\n                                            </div>\n                                        )}\n                                    </div>\n                                </div>\n                            )}\n\n                            {/* Death info */}\n                            {(hpData?.deathRound || resData?.deathRound) && (\n                                <div className={styles.deathRow}>\n                                     Round {hpData?.deathRound || resData?.deathRound}\n                                </div>\n                            )}\n                        </div>\n                    );\n                })}\n            </div>\n        </div>\n    );\n});\n\nCrosshairTooltip.displayName = 'CrosshairTooltip';\n\nexport default CrosshairLine;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/DeathBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/DeltaBadge.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/DeltaBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/DescentGraph.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'screen' is defined but never used.","line":2,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[241,244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[241,244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[450,453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[450,453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1860,1863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1860,1863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { render, screen } from '@testing-library/react';\nimport DescentGraph from './DescentGraph';\nimport React from 'react';\n\ndescribe('DescentGraph Component', () => {\n    const mockDeciles: any[] = [\n        {}, {}, { vitalityTimeline: [100, 80], powerTimeline: [100, 90] },\n        {}, {}, {}, {},\n        { vitalityTimeline: [100, 90], powerTimeline: [100, 95] }\n    ];\n\n    const mockPacingData: any = {\n        plannedTimeline: [100, 80],\n        labels: ['Start', 'E1'],\n        vitalityTimeline: [100, 85],\n        powerTimeline: [100, 92]\n    };\n\n    it('should render an SVG element', () => {\n        const { container } = render(\n            <DescentGraph \n                deciles={mockDeciles} \n                pacingData={mockPacingData} \n            />\n        );\n        expect(container.querySelector('svg')).toBeDefined();\n    });\n\n    it('should render the plan line', () => {\n        const { container } = render(\n            <DescentGraph \n                deciles={mockDeciles} \n                pacingData={mockPacingData} \n            />\n        );\n        const planLine = container.querySelector('path[stroke-dasharray]');\n        expect(planLine).toBeDefined();\n    });\n\n    it('should render the risk areas', () => {\n        const { container } = render(\n            <DescentGraph \n                deciles={mockDeciles} \n                pacingData={mockPacingData} \n            />\n        );\n        const riskAreas = container.querySelectorAll('path[class*=\"riskArea\"]');\n        expect(riskAreas.length).toBeGreaterThan(0);\n    });\n\n    it('should handle empty timelines', () => {\n        const { container } = render(\n            <DescentGraph \n                deciles={[]} \n                pacingData={{ plannedTimeline: [], labels: [], vitalityTimeline: [], powerTimeline: [] } as any} \n            />\n        );\n        expect(container.querySelector('svg')).toBeDefined();\n    });\n});","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/DescentGraph.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/FuelGauge.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[301,304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[301,304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[784,787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[784,787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { render, screen } from '@testing-library/react';\nimport FuelGauge from './FuelGauge';\nimport React from 'react';\n\ndescribe('FuelGauge Component', () => {\n    it('should render planned segments based on weights', () => {\n        const pacingData: any = {\n            plannedSegments: [{ type: 'combat', percent: 25, label: 'Enc 1' }],\n            vitalitySegments: [{ type: 'combat', percent: 20, label: 'Enc 1' }],\n            powerSegments: [{ type: 'combat', percent: 10, label: 'Enc 1' }]\n        };\n        render(<FuelGauge pacingData={pacingData} />);\n        expect(screen.getByText(/Daily Budget Plan/i)).toBeDefined();\n    });\n\n    it('should render vitality and power attrition bars', () => {\n        const pacingData: any = {\n            plannedSegments: [{ type: 'combat', percent: 25, label: 'Enc 1' }],\n            vitalitySegments: [{ type: 'combat', percent: 20, label: 'Enc 1' }],\n            powerSegments: [{ type: 'combat', percent: 10, label: 'Enc 1' }]\n        };\n        render(<FuelGauge pacingData={pacingData} />);\n        expect(screen.getByText(/Vitality Attrition/i)).toBeDefined();\n        expect(screen.getByText(/Power Attrition/i)).toBeDefined();\n    });\n});","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/FuelGauge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/HPSkyline.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkylineCanvas' is defined but never used.","line":12,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[854,857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[854,857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleBucketClick' is assigned a value but never used.","line":357,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":357,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":357,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12383,12386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12383,12386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * HPSkyline - HP area chart visualization for Skyline Spectrogram UI\n *\n * HEIGHT = % HP remaining (Y-axis: 0-100%)\n * COLOR = diverging red-blue palette (colorblind-safe)\n * X-axis = 100 buckets (1% worst to 100% best)\n *\n * Per-character: 4 side-by-side cards, each with HP skyline\n */\n\nimport React, { memo, useCallback, useMemo } from 'react';\nimport SkylineCanvas from './SkylineCanvas';\nimport styles from './hpSkyline.module.scss';\nimport {\n    SkylineAnalysis,\n    CharacterBucketData,\n    valueToColor,\n    DEFAULT_SKYLINE_COLORS,\n    SkylineInteractionState,\n    ColorScale,\n} from '@/model/skylineTypes';\n\nexport interface HPSkylineProps {\n    /** Full analysis data or single character bucket data */\n    data: SkylineAnalysis | CharacterBucketData[];\n    onHover?: (state: SkylineInteractionState) => void;\n    onBucketClick?: (bucket: any) => void;\n    className?: string;\n    /**\n     * Character IDs to display (default: all characters from data)\n     */\n    characterFilter?: string[];\n    // Single character mode props\n    characterName?: string;\n    characterId?: string;\n    width?: number;\n    height?: number;\n    colors?: typeof DEFAULT_SKYLINE_COLORS;\n}\n\nexport interface SingleCharacterSkylineProps {\n    characterData: CharacterBucketData[];\n    characterName: string;\n    width: number;\n    height: number;\n    colors: { hp: ColorScale };\n    onHover?: (bucket: number | null) => void;\n    hoveredBucket?: number | null;\n}\n\n/**\n * Render HP skyline for a single character\n */\nexport const SingleCharacterSkyline: React.FC<SingleCharacterSkylineProps> = memo(({\n    characterData,\n    characterName,\n    width,\n    height,\n    colors,\n    onHover,\n    hoveredBucket,\n}) => {\n    const canvasRef = React.useRef<HTMLCanvasElement>(null);\n    const [displayData, setDisplayData] = React.useState(characterData);\n    const animationRef = React.useRef<number | null>(null);\n\n    // Smooth data transition\n    React.useEffect(() => {\n        const startTime = performance.now();\n        const duration = 400;\n        const startData = displayData;\n        const targetData = characterData;\n\n        if (startData.length !== targetData.length) {\n            setDisplayData(targetData);\n            return;\n        }\n\n        const animate = (currentTime: number) => {\n            const elapsed = currentTime - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n            const ease = progress * (2 - progress);\n\n            if (progress < 1) {\n                const interpolated = targetData.map((target, i) => {\n                    const start = startData[i];\n                    return {\n                        ...target,\n                        hpPercent: start.hpPercent + (target.hpPercent - start.hpPercent) * ease\n                    };\n                });\n                setDisplayData(interpolated);\n                animationRef.current = requestAnimationFrame(animate);\n            } else {\n                setDisplayData(targetData);\n            }\n        };\n\n        animationRef.current = requestAnimationFrame(animate);\n        return () => {\n            if (animationRef.current) cancelAnimationFrame(animationRef.current);\n        };\n    }, [characterData]);\n\n    const render = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas || displayData.length === 0) return;\n\n        const ctx = setupCanvas(canvas, width, height);\n        if (!ctx) return;\n\n        const padding = { top: 20, right: 10, bottom: 30, left: 40 };\n        const chartWidth = width - padding.left - padding.right;\n        const chartHeight = height - padding.top - padding.bottom;\n\n        // Clear canvas with dark background\n        ctx.fillStyle = 'rgba(26, 26, 26, 0.95)';\n        ctx.fillRect(0, 0, width, height);\n\n        // Draw grid lines (horizontal at 0%, 25%, 50%, 75%, 100%)\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';\n        ctx.lineWidth = 1;\n        [0, 25, 50, 75, 100].forEach(pct => {\n            const y = padding.top + chartHeight - (pct / 100) * chartHeight;\n            ctx.beginPath();\n            ctx.moveTo(padding.left, y);\n            ctx.lineTo(width - padding.right, y);\n            ctx.stroke();\n\n            // Y-axis labels\n            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';\n            ctx.font = '10px Courier New';\n            ctx.textAlign = 'right';\n            ctx.fillText(`${pct}%`, padding.left - 5, y + 3);\n        });\n\n        // Draw HP area chart using vertical segments\n        const bucketWidth = chartWidth / displayData.length;\n\n        // Create path for area fill\n        ctx.beginPath();\n        ctx.moveTo(padding.left, padding.top + chartHeight); // Start at bottom-left\n\n        displayData.forEach((bucket, i) => {\n            const x = padding.left + i * bucketWidth;\n            const hpHeight = (bucket.hpPercent / 100) * chartHeight;\n            const y = padding.top + chartHeight - hpHeight;\n\n            if (i === 0) {\n                ctx.moveTo(x, y);\n            } else {\n                ctx.lineTo(x, y);\n            }\n        });\n\n        // Complete the area path\n        const lastX = padding.left + (displayData.length - 1) * bucketWidth;\n        ctx.lineTo(lastX, padding.top + chartHeight);\n        ctx.closePath();\n\n        // Fill area with gradient (based on overall HP trend)\n        const avgHp = displayData.reduce((sum, b) => sum + b.hpPercent, 0) / displayData.length;\n        const baseColor = valueToColor(avgHp, colors.hp);\n\n        ctx.fillStyle = baseColor + '40'; // 25% opacity\n        ctx.fill();\n\n        // Draw each bucket segment with its own color\n        displayData.forEach((bucket, i) => {\n            const x = padding.left + i * bucketWidth;\n            const hpHeight = (bucket.hpPercent / 100) * chartHeight;\n            const y = padding.top + chartHeight - hpHeight;\n\n            // Get color for this bucket's HP value\n            const color = valueToColor(bucket.hpPercent, colors.hp);\n\n            // Draw vertical bar\n            ctx.fillStyle = color;\n            ctx.fillRect(x, y, bucketWidth - 1, hpHeight);\n\n            // Highlight hovered bucket\n            if (hoveredBucket === i + 1) {\n                ctx.strokeStyle = 'rgba(212, 175, 55, 0.8)';\n                ctx.lineWidth = 2;\n                ctx.strokeRect(x, y, bucketWidth - 1, hpHeight);\n            }\n        });\n\n        // Draw crosshair line if hovering\n        if (hoveredBucket && hoveredBucket >= 1 && hoveredBucket <= displayData.length) {\n            const i = hoveredBucket - 1;\n            const x = padding.left + i * bucketWidth + bucketWidth / 2;\n\n            ctx.strokeStyle = 'rgba(212, 175, 55, 0.8)';\n            ctx.lineWidth = 1;\n            ctx.setLineDash([4, 4]);\n            ctx.beginPath();\n            ctx.moveTo(x, padding.top);\n            ctx.lineTo(x, height - padding.bottom);\n            ctx.stroke();\n            ctx.setLineDash([]);\n        }\n\n        // X-axis labels (percentiles at 1%, 50%, 100%)\n        ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';\n        ctx.font = '10px Courier New';\n        ctx.textAlign = 'center';\n\n        [1, 50, 100].forEach(pct => {\n            const idx = pct - 1;\n            if (idx < displayData.length) {\n                const x = padding.left + idx * bucketWidth + bucketWidth / 2;\n                ctx.fillText(`${pct}%`, x, height - padding.bottom + 15);\n            }\n        });\n    }, [displayData, width, height, colors, hoveredBucket]);\n\n    // Re-render on data/hover change\n    React.useEffect(() => {\n        render();\n    }, [render]);\n\n    return (\n        <div className={styles.characterCard}>\n            <div className={styles.characterName}>{characterName}</div>\n            <canvas\n                ref={canvasRef}\n                width={width}\n                height={height}\n                className={styles.skylineCanvas}\n                onMouseMove={(e) => {\n                    const rect = e.currentTarget.getBoundingClientRect();\n                    const x = e.clientX - rect.left;\n                    const padding = { left: 40, right: 10 };\n                    const chartWidth = width - padding.left - padding.right;\n                    const bucketWidth = chartWidth / characterData.length;\n                    const bucket = Math.floor((x - padding.left) / bucketWidth) + 1;\n                    if (bucket >= 1 && bucket <= characterData.length) {\n                        onHover?.(bucket);\n                    }\n                }}\n                onMouseLeave={() => onHover?.(null)}\n                role=\"img\"\n                aria-label={`${characterName} HP skyline across ${characterData.length} percentile buckets`}\n            />\n        </div>\n    );\n});\n\nSingleCharacterSkyline.displayName = 'SingleCharacterSkyline';\n\n/**\n * Setup canvas with high-DPI scaling (copied from base component)\n */\nfunction setupCanvas(canvas: HTMLCanvasElement, width: number, height: number) {\n    const dpr = window.devicePixelRatio || 1;\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n        ctx.scale(dpr, dpr);\n    }\n    return ctx;\n}\n\n/**\n * Main HPSkyline component\n */\nconst HPSkyline: React.FC<HPSkylineProps> = memo(({\n    data,\n    onHover,\n    onBucketClick,\n    className,\n    characterFilter,\n    characterName,\n    characterId,\n    width,\n    height,\n    colors = DEFAULT_SKYLINE_COLORS,\n}) => {\n    const [hoveredBucket, setHoveredBucket] = React.useState<number | null>(null);\n    const [hoveredCharId, setHoveredCharId] = React.useState<string | null>(null);\n\n    // If we are in single character mode (passed from SkylineSpectrogram)\n    if (Array.isArray(data) && characterId) {\n        return (\n            <SingleCharacterSkyline\n                characterData={data}\n                characterName={characterName || 'Unknown'}\n                width={width || 200}\n                height={height || 150}\n                colors={{ hp: colors }}\n                onHover={(bucket) => {\n                    setHoveredBucket(bucket);\n                    onHover?.({ hoveredBucket: bucket, hoveredCharacter: characterId });\n                }}\n                hoveredBucket={hoveredBucket}\n            />\n        );\n    }\n\n    // Otherwise, we are in multi-character mode\n    const analysisData = data as SkylineAnalysis;\n\n    // Transform data: buckets -> characters\n    const characterArrays = useMemo(() => {\n        if (!analysisData.buckets || analysisData.buckets.length === 0) return [];\n\n        // Get character IDs from first bucket\n        const charIds = characterFilter || analysisData.buckets[0].characters.map(c => c.id);\n\n        return charIds.map(charId => {\n            const characterData: CharacterBucketData[] = analysisData.buckets.map(bucket => {\n                const char = bucket.characters.find(c => c.id === charId);\n                return char || {\n                    name: 'Unknown',\n                    id: charId,\n                    maxHp: 0,\n                    hpPercent: 0,\n                    resourcePercent: 0,\n                    resourceBreakdown: {\n                        spellSlots: [],\n                        shortRestFeatures: [],\n                        longRestFeatures: [],\n                        hitDice: 0,\n                        hitDiceMax: 0,\n                        totalEhp: 0,\n                        maxEhp: 0,\n                    },\n                    deathRound: null,\n                    isDead: false,\n                };\n            });\n\n            const firstChar = characterData[0];\n            return {\n                charId,\n                characterName: firstChar?.name || charId,\n                data: characterData,\n            };\n        });\n    }, [analysisData.buckets, characterFilter]);\n\n    const handleBucketHover = useCallback((bucketIndex: number | null, charId: string) => {\n        setHoveredBucket(bucketIndex);\n        if (bucketIndex === null) {\n            setHoveredCharId(null);\n            onHover?.({ hoveredBucket: null, hoveredCharacter: null });\n        } else {\n            setHoveredCharId(charId);\n            onHover?.({ hoveredBucket: bucketIndex, hoveredCharacter: charId });\n        }\n    }, [onHover]);\n\n    const handleBucketClick = useCallback((bucket: any) => {\n        onBucketClick?.(bucket);\n    }, [onBucketClick]);\n\n    const canvasWidth = 200; // Per character\n    const canvasHeight = 150;\n\n    return (\n        <div className={`${styles.hpSkylineContainer} ${className || ''}`}>\n            <div className={styles.skylineTitle}>\n                HP Skyline - {analysisData.totalRuns} runs, {analysisData.buckets.length} buckets\n            </div>\n\n            <div className={styles.charactersGrid}>\n                {characterArrays.map(({ charId, characterName, data: charData }) => (\n                    <SingleCharacterSkyline\n                        key={charId}\n                        characterData={charData}\n                        characterName={characterName}\n                        width={canvasWidth}\n                        height={canvasHeight}\n                        colors={{ hp: DEFAULT_SKYLINE_COLORS }}\n                        onHover={(bucket) => handleBucketHover(bucket, charId)}\n                        hoveredBucket={hoveredCharId === charId ? hoveredBucket : null}\n                    />\n                ))}\n            </div>\n        </div>\n    );\n});\n\nHPSkyline.displayName = 'HPSkyline';\n\nexport default HPSkyline;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/HeartbeatGraph.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used.","line":39,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { FC, useMemo } from 'react';\nimport { AggregateOutput } from '@/model/model';\nimport styles from './heartbeatGraph.module.scss';\n\ninterface HeartbeatGraphProps {\n    encounters: AggregateOutput[];\n    className?: string;\n}\n\nconst HeartbeatGraph: FC<HeartbeatGraphProps> = ({ encounters, className }) => {\n    const width = 600;\n    const height = 120;\n    const padding = { top: 20, right: 40, bottom: 20, left: 40 };\n\n    const points = useMemo(() => {\n        if (!encounters || encounters.length === 0) return [];\n\n        const chartWidth = width - padding.left - padding.right;\n        const chartHeight = height - padding.top - padding.bottom;\n\n        // X steps\n        const stepX = chartWidth / Math.max(1, encounters.length);\n\n        return encounters.map((enc, i) => {\n            const lethality = enc.vitals?.lethalityIndex || 0;\n            // Map lethality 0..1 to height 0..chartHeight (inverted for SVG)\n            const y = padding.top + chartHeight - (lethality * chartHeight);\n            const x = padding.left + (i + 0.5) * stepX;\n            return { x, y, lethality, label: `E${i + 1}` };\n        });\n    }, [encounters]);\n\n    const pathData = useMemo(() => {\n        if (points.length === 0) return \"\";\n        \n        // Start at left baseline\n        let d = `M ${padding.left} ${height - padding.bottom}`;\n        \n        points.forEach((p, i) => {\n            // Straight lines for \"heartbeat\" feel or curves?\n            // Let's use simple lines for now\n            d += ` L ${p.x} ${p.y}`;\n        });\n\n        // End at right baseline\n        d += ` L ${width - padding.right} ${height - padding.bottom}`;\n        \n        return d;\n    }, [points]);\n\n    return (\n        <div className={`${styles.heartbeatGraph} ${className || ''}`}>\n            <svg viewBox={`0 0 ${width} ${height}`} preserveAspectRatio=\"xMidYMid meet\">\n                {/* Background Zones */}\n                <rect x={padding.left} y={padding.top} width={width - padding.left - padding.right} height={(height - padding.top - padding.bottom) * 0.5} fill=\"rgba(239, 68, 68, 0.05)\" /> {/* Red Zone */}\n                <rect x={padding.left} y={padding.top + (height - padding.top - padding.bottom) * 0.5} width={width - padding.left - padding.right} height={(height - padding.top - padding.bottom) * 0.3} fill=\"rgba(245, 158, 11, 0.05)\" /> {/* Yellow Zone */}\n                <rect x={padding.left} y={padding.top + (height - padding.top - padding.bottom) * 0.8} width={width - padding.left - padding.right} height={(height - padding.top - padding.bottom) * 0.2} fill=\"rgba(34, 197, 94, 0.05)\" /> {/* Green Zone */}\n\n                {/* Grid Lines */}\n                <line x1={padding.left} y1={height - padding.bottom} x2={width - padding.right} y2={height - padding.bottom} stroke=\"rgba(255,255,255,0.1)\" strokeWidth=\"1\" />\n                \n                {/* Tension Line */}\n                <path d={pathData} fill=\"none\" stroke=\"#d4af37\" strokeWidth=\"2\" strokeLinejoin=\"round\" className={styles.tensionPath} />\n\n                {/* Nodes */}\n                {points.map((p, i) => (\n                    <g key={i} className={styles.node}>\n                        <circle cx={p.x} cy={p.y} r=\"4\" fill={p.lethality > 0.5 ? '#ef4444' : p.lethality > 0.2 ? '#f59e0b' : '#22c55e'} />\n                        <text x={p.x} y={height - 5} textAnchor=\"middle\" className={styles.axisLabel}>{p.label}</text>\n                    </g>\n                ))}\n\n                {/* Y-Axis Labels */}\n                <text x={padding.left - 5} y={padding.top + 5} textAnchor=\"end\" className={styles.axisLabel}>Lethal</text>\n                <text x={padding.left - 5} y={height - padding.bottom} textAnchor=\"end\" className={styles.axisLabel}>Safe</text>\n            </svg>\n            <div className={styles.title}>Projected Tension Arc</div>\n        </div>\n    );\n};\n\nexport default HeartbeatGraph;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/OnboardingTour.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/PartyOverview.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CrosshairTooltip' is defined but never used.","line":5,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cIdx' is defined but never used.","line":133,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":71}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { FC, useRef, useEffect, useMemo, useState, useCallback } from 'react'\nimport { SkylineAnalysis, PlayerSlot, CharacterBucketData } from '@/model/model'\nimport styles from './PartyOverview.module.scss'\nimport { useCrosshair, useCrosshairBucketRegistration } from './CrosshairContext'\nimport CrosshairLine, { CrosshairTooltip } from './CrosshairLine'\n\ninterface PartyOverviewProps {\n    skyline: SkylineAnalysis\n    partySlots: PlayerSlot[]\n    playerNames?: Map<string, string>\n    className?: string\n}\n\n/**\n * Robust character lookup to handle prefixing and ID/Name mismatches\n */\nexport const findCharacterInBucket = (bucketCharacters: CharacterBucketData[], playerId: string, fallbackIndex?: number) => {\n    if (!playerId || typeof playerId !== 'string' || playerId.trim() === '') {\n        if (fallbackIndex !== undefined && bucketCharacters && bucketCharacters[fallbackIndex]) {\n            return bucketCharacters[fallbackIndex]\n        }\n        return undefined\n    }\n\n    const pid = playerId.toLowerCase()\n    \n    // 1. Try exact match on ID or Name\n    let found = bucketCharacters.find(c => {\n        if (!c) return false\n        const cid = (c.id || '').toLowerCase()\n        const cname = (c.name || '').toLowerCase()\n        return cid === pid || cname === pid\n    })\n\n    // 2. Try partial match\n    if (!found) {\n        found = bucketCharacters.find(c => {\n            if (!c) return false\n            const cid = (c.id || '').toLowerCase()\n            const cname = (c.name || '').toLowerCase()\n            return (cid && cid.includes(pid)) || \n                   (pid && pid.includes(cid)) || \n                   (cname && cname.includes(pid)) || \n                   (pid && pid.includes(cname))\n        })\n    }\n\n    // 3. Fallback to index if still not found and index is provided\n    if (!found && fallbackIndex !== undefined && bucketCharacters && bucketCharacters[fallbackIndex]) {\n        return bucketCharacters[fallbackIndex]\n    }\n\n    return found\n}\n\n/**\n * PartyOverview displays two grouped stacked bar charts (Vitality and Power).\n */\nconst PartyOverview: FC<PartyOverviewProps> = ({ skyline, partySlots, playerNames, className }) => {\n    const canvasRef = useRef<HTMLCanvasElement>(null)\n    const containerRef = useRef<HTMLDivElement>(null)\n    const [width, setWidth] = useState(0)\n    \n    // State for smoothed data\n    const [displayBuckets, setDisplayBuckets] = useState(skyline.buckets)\n    const animationRef = useRef<number | null>(null)\n\n    const { state: crosshairState, setCrosshair, setHoveredCharacter, clearCrosshair } = useCrosshair()\n\n    useEffect(() => {\n        if (!containerRef.current) return\n        const resizeObserver = new ResizeObserver((entries) => {\n            for (const entry of entries) {\n                if (entry.contentRect) {\n                    setWidth(Math.floor(entry.contentRect.width))\n                }\n            }\n        })\n        resizeObserver.observe(containerRef.current)\n        return () => resizeObserver.disconnect()\n    }, [])\n\n    const partySize = skyline.partySize || partySlots.length\n    const RUNS_COUNT = 100\n    const BAND_HEIGHT = 60\n    const LABEL_HEIGHT = 20\n    const TOTAL_HEIGHT = (BAND_HEIGHT * 2) + LABEL_HEIGHT\n    const bucketGap = 1\n    \n    // Effective width of a bucket including its gap (except for the last one)\n    const getBucketFullWidth = useCallback((totalWidth: number) => {\n        return (totalWidth + bucketGap) / RUNS_COUNT\n    }, [])\n\n    const groupWidth = useMemo(() => {\n        return (width - (RUNS_COUNT - 1) * bucketGap) / RUNS_COUNT\n    }, [width])\n\n    // Register buckets for tooltips\n    useCrosshairBucketRegistration(`party-overview-${skyline.encounterIndex ?? 'overall'}`, skyline.buckets)\n\n    const sortedPlayers = useMemo(() => {\n        return [...partySlots].sort((a, b) => (b.survivabilityScore || 0) - (a.survivabilityScore || 0))\n    }, [partySlots])\n\n    // Smooth data transition\n    useEffect(() => {\n        const startTime = performance.now();\n        const duration = 400; // 400ms transition\n        const startBuckets = displayBuckets;\n        const targetBuckets = skyline.buckets;\n\n        // If counts differ (e.g. initial load), skip animation\n        if (startBuckets.length !== targetBuckets.length) {\n            setDisplayBuckets(targetBuckets);\n            return;\n        }\n\n        const animate = (currentTime: number) => {\n            const elapsed = currentTime - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n            \n            // Easing function (easeOutQuad)\n            const ease = progress * (2 - progress);\n\n            if (progress < 1) {\n                const interpolated = targetBuckets.map((target, bIdx) => {\n                    const start = startBuckets[bIdx];\n                    return {\n                        ...target,\n                        partyHpPercent: start.partyHpPercent + (target.partyHpPercent - start.partyHpPercent) * ease,\n                        partyResourcePercent: start.partyResourcePercent + (target.partyResourcePercent - start.partyResourcePercent) * ease,\n                        characters: target.characters.map((tChar, cIdx) => {\n                            const sChar = start.characters.find(c => c.id === tChar.id) || tChar;\n                            return {\n                                ...tChar,\n                                hpPercent: sChar.hpPercent + (tChar.hpPercent - sChar.hpPercent) * ease,\n                                resourcePercent: sChar.resourcePercent + (tChar.resourcePercent - sChar.resourcePercent) * ease\n                            }\n                        })\n                    };\n                });\n                setDisplayBuckets(interpolated);\n                animationRef.current = requestAnimationFrame(animate);\n            } else {\n                setDisplayBuckets(targetBuckets);\n            }\n        };\n\n        animationRef.current = requestAnimationFrame(animate);\n        return () => {\n            if (animationRef.current) cancelAnimationFrame(animationRef.current);\n        };\n    }, [skyline.buckets]);\n\n    const sortedBuckets = useMemo(() => {\n        return [...displayBuckets].sort((a, b) => {\n            const sA = partySize - a.deathCount\n            const sB = partySize - b.deathCount\n            if (sA !== sB) return sA - sB\n            if (a.partyHpPercent !== b.partyHpPercent) return a.partyHpPercent - b.partyHpPercent\n            return a.partyResourcePercent - b.partyResourcePercent\n        })\n    }, [displayBuckets, partySize])\n\n    useEffect(() => {\n        const canvas = canvasRef.current\n        if (!canvas || width === 0) return\n        const ctx = canvas.getContext('2d')\n        if (!ctx) return\n\n        const dpr = window.devicePixelRatio || 1\n        \n        canvas.width = width * dpr\n        canvas.height = TOTAL_HEIGHT * dpr\n        canvas.style.width = `${width}px`\n        canvas.style.height = `${TOTAL_HEIGHT}px`\n        ctx.scale(dpr, dpr)\n\n        ctx.clearRect(0, 0, width, TOTAL_HEIGHT)\n\n        // Backgrounds\n        ctx.fillStyle = '#0a0a0a'\n        ctx.fillRect(0, 0, width, BAND_HEIGHT) // Vitality band\n        ctx.fillRect(0, BAND_HEIGHT, width, BAND_HEIGHT) // Power band\n\n        const hoveredBucket = crosshairState.bucketIndex;\n        const hoveredCharId = crosshairState.hoveredCharacterId;\n\n        sortedBuckets.forEach((bucket, runIdx) => {\n            const groupX = runIdx * (groupWidth + bucketGap)\n            const isBucketHovered = hoveredBucket === runIdx + 1;\n            const stripeWidth = groupWidth / partySize\n            \n            sortedPlayers.forEach((playerSlot, playerIdx) => {\n                const charData = findCharacterInBucket(bucket.characters, playerSlot.playerId, playerIdx)\n                const stripeX = groupX + (playerIdx * stripeWidth)\n                const drawWidth = Math.max(0.5, stripeWidth)\n\n                if (!charData) return\n\n                const isCharHovered = hoveredCharId === charData.id;\n                const opacity = (hoveredCharId && !isCharHovered && !isBucketHovered) ? 0.3 : 1.0;\n\n                // --- Vitality Band (HP) ---\n                if (charData.isDead) {\n                    ctx.fillStyle = isBucketHovered ? '#ff0000' : (isCharHovered ? '#ff4d4d' : `rgba(0, 0, 0, ${opacity})`)\n                    ctx.fillRect(stripeX, 0, drawWidth, BAND_HEIGHT)\n                } else {\n                    const hpPct = Math.max(0, Math.min(100, charData.hpPercent)) / 100\n                    const hpH = BAND_HEIGHT * hpPct\n                    \n                    ctx.fillStyle = isBucketHovered ? '#44ff44' : `rgba(34, 197, 94, ${opacity})`\n                    ctx.fillRect(stripeX, BAND_HEIGHT - hpH, drawWidth, hpH)\n                    \n                    ctx.fillStyle = isBucketHovered ? '#ff4444' : `rgba(239, 68, 68, ${opacity})`\n                    ctx.fillRect(stripeX, 0, drawWidth, BAND_HEIGHT - hpH)\n                }\n\n                // --- Power Band (Resources) ---\n                const resPct = Math.max(0, Math.min(100, charData.resourcePercent)) / 100\n                const resH = BAND_HEIGHT * resPct\n                \n                ctx.fillStyle = isBucketHovered ? '#66b2ff' : `rgba(59, 130, 246, ${opacity})`\n                ctx.fillRect(stripeX, BAND_HEIGHT, drawWidth, resH)\n                \n                ctx.fillStyle = isBucketHovered ? '#ffff66' : `rgba(234, 179, 8, ${opacity})`\n                ctx.fillRect(stripeX, BAND_HEIGHT + resH, drawWidth, BAND_HEIGHT - resH)\n            })\n\n            // Labels\n            if (runIdx % 20 === 0 || runIdx === 99) {\n                const labelX = groupX + groupWidth / 2\n                ctx.fillStyle = isBucketHovered ? '#d4af37' : 'rgba(232, 224, 208, 0.5)'\n                ctx.font = isBucketHovered ? 'bold 10px \"Courier New\", monospace' : '10px \"Courier New\", monospace'\n                ctx.textAlign = 'center'\n                ctx.fillText(`P${runIdx === 99 ? 100 : runIdx}`, labelX, TOTAL_HEIGHT - 4)\n            }\n        })\n\n        // Axis divider lines\n        ctx.strokeStyle = 'rgba(212, 175, 55, 0.3)'\n        ctx.lineWidth = 1\n        ctx.beginPath()\n        ctx.moveTo(0, BAND_HEIGHT)\n        ctx.lineTo(width, BAND_HEIGHT)\n        ctx.stroke()\n\n    }, [sortedBuckets, sortedPlayers, partySize, width, groupWidth, crosshairState.bucketIndex, crosshairState.hoveredCharacterId])\n\n    const handleMouseMove = useCallback((e: React.MouseEvent) => {\n        const rect = e.currentTarget.getBoundingClientRect()\n        const x = e.clientX - rect.left\n        \n        // Find bucket using consistent math\n        const fullBucketWidth = getBucketFullWidth(width)\n        const bucketIdx = Math.floor(x / fullBucketWidth)\n        \n        if (bucketIdx >= 0 && bucketIdx < RUNS_COUNT) {\n            // Find specific character stripe within bucket\n            const stripeX = x % fullBucketWidth\n            let charId: string | null = null\n            \n            const stripeWidth = groupWidth / partySize\n            const playerIdx = Math.floor(stripeX / stripeWidth)\n            const bucket = sortedBuckets[bucketIdx]\n            const playerSlot = sortedPlayers[playerIdx]\n            const charData = findCharacterInBucket(bucket.characters, playerSlot?.playerId, playerIdx)\n            charId = charData?.id || null\n\n            setCrosshair(bucketIdx + 1, x, e.clientX, e.clientY)\n            setHoveredCharacter(charId)\n        } else {\n            clearCrosshair()\n        }\n    }, [partySize, width, groupWidth, getBucketFullWidth, setCrosshair, setHoveredCharacter, clearCrosshair, sortedBuckets, sortedPlayers])\n\n    return (\n        <div className={`${styles.partyOverview} ${className || ''}`} data-testid=\"party-overview\">\n            <div className={styles.header}>\n                <h4 className={styles.title}>Survival Spectrogram</h4>\n                <div className={styles.subtext}>100 Timelines  Grouped by Player</div>\n            </div>\n\n            <div className={styles.legend} data-testid=\"party-overview-legend\">\n                <span className={styles.legendLabel}>Cohort:</span>\n                <div className={styles.legendGroup}>\n                    {sortedPlayers.map((p, i) => {\n                        const displayName = playerNames?.get(p.playerId) || p.playerId || `Player ${i + 1}`\n                        const isHovered = crosshairState.hoveredCharacterId === p.playerId\n                        return (\n                            <span \n                                key={`${p.playerId}-${p.position}`} \n                                className={`${styles.playerTag} ${isHovered ? styles.hovered : ''}`}\n                                onMouseEnter={() => setHoveredCharacter(p.playerId)}\n                                onMouseLeave={() => setHoveredCharacter(null)}\n                                data-testid={`player-tag-${p.playerId}`}\n                            >\n                                {i === 0 && <span className={styles.roleIcon}></span>}\n                                {i === sortedPlayers.length - 1 && <span className={styles.roleIcon}></span>}\n                                {displayName}\n                            </span>\n                        )\n                    })}\n                </div>\n            </div>\n\n            <div \n                ref={containerRef} \n                className={styles.canvasContainer}\n                onMouseMove={handleMouseMove}\n                onMouseLeave={clearCrosshair}\n                style={{ overflow: 'hidden' }}\n                data-testid=\"party-overview-canvas-container\"\n            >\n                <div className={styles.labelVitality}>Vitality</div>\n                <div className={styles.labelPower}>Power</div>\n                <canvas ref={canvasRef} data-testid=\"party-overview-canvas\" />\n                <CrosshairLine \n                    width={width} \n                    height={TOTAL_HEIGHT} \n                    padding={{ top: 0, right: 0, bottom: 0, left: 0 }}\n                />\n            </div>\n            \n            <div className={styles.colorKey} data-testid=\"party-overview-color-key\">\n                <div className={styles.keyItem}><div className={`${styles.swatch} ${styles.green}`} data-testid=\"swatch-life\" /> Life</div>\n                <div className={styles.keyItem}><div className={`${styles.swatch} ${styles.red}`} data-testid=\"swatch-wounds\" /> Wounds</div>\n                <div className={styles.separator} />\n                <div className={styles.keyItem}><div className={`${styles.swatch} ${styles.blue}`} data-testid=\"swatch-power\" /> Power</div>\n                <div className={styles.keyItem}><div className={`${styles.swatch} ${styles.yellow}`} data-testid=\"swatch-spent\" /> Spent</div>\n                <div className={styles.separator} />\n                <div className={styles.keyItem}><div className={`${styles.swatch} ${styles.dead}`} data-testid=\"swatch-fallen\" /> Fallen</div>\n            </div>\n        </div>\n    )\n}\n\nexport default PartyOverview","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/PlayerGraphs.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'percentile' is defined but never used.","line":100,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":100,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useMemo } from 'react'\nimport { SkylineAnalysis, PlayerSlot } from '@/model/model'\nimport { findCharacterInBucket } from './PartyOverview'\nimport styles from './PlayerGraphs.module.scss'\nimport { useCrosshair } from './CrosshairContext'\n\ninterface PlayerGraphsProps {\n    skyline: SkylineAnalysis\n    partySlots: PlayerSlot[]\n    playerNames?: Map<string, string>\n}\n\n/**\n * PlayerGraphs displays detailed individual statistics for each player.\n */\nconst PlayerGraphs: FC<PlayerGraphsProps> = ({ skyline, partySlots, playerNames }) => {\n    const { state: crosshairState, setHoveredCharacter } = useCrosshair()\n\n    const sortedPlayers = useMemo(() => {\n        return [...partySlots].sort((a, b) => (b.survivabilityScore || 0) - (a.survivabilityScore || 0))\n    }, [partySlots])\n\n    return (\n        <div className={styles.playerGraphs}>\n            <h4 className={styles.title}>Individual Performance Breakdown</h4>\n\n            <div className={styles.grid}>\n                {sortedPlayers.map((slot, playerIdx) => {\n                    const isHovered = crosshairState.hoveredCharacterId === slot.playerId;\n\n                    // Create a list of buckets with this specific player's data attached\n                    const playerBuckets = skyline.buckets.map((bucket) => {\n                        const character = findCharacterInBucket(bucket.characters, slot.playerId, playerIdx)\n                        return { percentile: bucket.percentile, character: character || null }\n                    })\n\n                    // Sort these buckets based on THIS player's performance\n                    // Criteria: Dead (worst) -> Death Round (earlier is worse) -> HP% (lower is worse) -> Resource% (lower is worse)\n                    playerBuckets.sort((a, b) => {\n                        const charA = a.character\n                        const charB = b.character\n\n                        // 1. Death Status (Dead < Alive)\n                        // If one is dead and other is alive, the dead one comes first (lower index)\n                        const deadA = charA?.isDead ?? false\n                        const deadB = charB?.isDead ?? false\n                        if (deadA !== deadB) return deadA ? -1 : 1\n\n                        // 2. Death Round (Earlier < Later)\n                        if (deadA && deadB) {\n                            const roundA = charA?.deathRound ?? 0\n                            const roundB = charB?.deathRound ?? 0\n                            if (roundA !== roundB) return roundA - roundB\n                        }\n\n                        // 3. HP % (Lower < Higher)\n                        const hpA = charA?.hpPercent ?? 0\n                        const hpB = charB?.hpPercent ?? 0\n                        if (hpA !== hpB) return hpA - hpB\n\n                        // 4. Resource % (Lower < Higher)\n                        const resA = charA?.resourcePercent ?? 0\n                        const resB = charB?.resourcePercent ?? 0\n                        return resA - resB\n                    })\n\n                    const deathCount = playerBuckets.filter((b) => b.character?.isDead).length\n                    const deathRate = (deathCount / skyline.buckets.length) * 100\n                    const hpValues = playerBuckets.map((b) => b.character?.hpPercent ?? 0).filter((hp) => hp > 0)\n                    const avgHp = hpValues.length > 0 ? hpValues.reduce((sum, hp) => sum + hp, 0) / hpValues.length : 0\n\n                    const displayName = playerNames?.get(slot.playerId) || slot.playerId || `Player ${playerIdx + 1}`\n                    const ehpValue = slot.survivabilityScore\n                    const displayEHP = (ehpValue === undefined || ehpValue === null || isNaN(ehpValue)) ? '---' : ehpValue\n\n                    return (\n                        <div \n                            key={`${slot.playerId}-${slot.position}`} \n                            className={`${styles.playerCard} ${isHovered ? styles.hovered : ''}`}\n                            onMouseEnter={() => setHoveredCharacter(slot.playerId)}\n                            onMouseLeave={() => setHoveredCharacter(null)}\n                        >\n                            <div className={styles.cardHeader}>\n                                <div className={styles.playerInfo}>\n                                    <h5 className={styles.playerName}>{displayName}</h5>\n                                    <div className={styles.survivabilityBadge}>EHP: {displayEHP}</div>\n                                </div>\n                                <div className={styles.roleIcon}>\n                                    {slot.position === 0 && <span title=\"Shield Wall\"></span>}\n                                    {slot.position === partySlots.length - 1 && partySlots.length > 1 && <span title=\"Glass Cannon\"></span>}\n                                </div>\n                            </div>\n\n                            <div className={styles.statsSummary}>\n                                <div className={styles.statItem}><span className={styles.statLabel}>Casualty Rate:</span> <span className={deathRate > 50 ? styles.highDeath : styles.lowDeath}>{deathRate.toFixed(1)}%</span></div>\n                                <div className={styles.statItem}><span className={styles.statLabel}>Avg Vitality:</span> <span className={styles.statValue}>{avgHp.toFixed(0)}%</span></div>\n                            </div>\n\n                            <div className={styles.hpVisualization}>\n                                {playerBuckets.map(({ percentile, character }, idx) => {\n                                    const hpPct = character?.hpPercent ?? 0\n                                    const resPct = character?.resourcePercent ?? 0\n                                    const isDead = character?.isDead ?? false\n\n                                    return (\n                                        <div key={idx} className={styles.barGroup}>\n                                            <div \n                                                className={styles.hpBar} \n                                                style={{ \n                                                    height: '50%', \n                                                    bottom: '50%',\n                                                    background: isDead ? '#000' : `linear-gradient(0deg, #22c55e ${hpPct}%, #ef4444 ${hpPct}%)` \n                                                }} \n                                            />\n                                            <div \n                                                className={styles.resBar} \n                                                style={{ \n                                                    height: '50%', \n                                                    top: '50%',\n                                                    background: `linear-gradient(180deg, #3b82f6 ${resPct}%, #eab308 ${resPct}%)` \n                                                }} \n                                            />\n                                        </div>\n                                    )\n                                })}\n                            </div>\n\n                            <div className={styles.miniLegend}>\n                                <span className={styles.legendLabel}>Worst Runs</span>\n                                <span className={styles.legendLabel}>Best Runs</span>\n                            </div>\n                        </div>\n                    )\n                })}\n            </div>\n        </div>\n    )\n}\n\nexport default PlayerGraphs","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/ResourcePanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":11,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2083,2086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2083,2086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5201,5204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5201,5204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/simulation/ResourcePanel.tsx\nimport { FC, memo } from 'react';\nimport { Combattant } from '@/model/model';\nimport styles from './resourcePanel.module.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { \n    faBolt, faDiceD6, faHandPaper, faHatWizard, \n    faHeart, faPlus, faStar, faShoePrints,\n    faMagic, faShieldHalved\n} from '@fortawesome/free-solid-svg-icons';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { clsx, type ClassValue } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nfunction cn(...inputs: ClassValue[]) {\n    return twMerge(clsx(inputs));\n}\n\ntype ResourcePanelProps = {\n    combatant: Combattant;\n};\n\nconst ResourcePanel: FC<ResourcePanelProps> = memo(({ combatant }) => {\n    const { creature, finalState } = combatant;\n    const { resources } = finalState;\n\n    const currentHP = finalState.currentHp;\n    const maxHP = creature.hp;\n    const tempHP = finalState.tempHp || 0;\n\n    const parseResourceKey = (key: string) => {\n        if (key === 'Action') return { type: 'Action', label: 'Action', icon: faBolt, color: '#FFD700' };\n        if (key === 'BonusAction') return { type: 'BonusAction', label: 'Bonus', icon: faPlus, color: '#FF8C00' };\n        if (key === 'Reaction') return { type: 'Reaction', label: 'Reaction', icon: faHandPaper, color: '#BA55D3' };\n        if (key === 'Movement') return { type: 'Movement', label: 'Movement', icon: faShoePrints, color: '#90EE90' };\n\n        if (key.startsWith('SpellSlot')) {\n            const level = key.match(/\\((\\d+)\\)/)?.[1] || '?';\n            return { type: 'SpellSlot', label: `L${level}`, icon: faHatWizard, sort: parseInt(level), color: '#4facfe' };\n        }\n\n        if (key.startsWith('ClassResource')) {\n            const name = key.match(/\\(\"(.+)\"\\)/)?.[1] || key.match(/\\((.+)\\)/)?.[1] || 'Resource';\n            return { type: 'ClassResource', label: name, icon: faStar, color: '#f093fb' };\n        }\n\n        return { type: 'Other', label: key, icon: faDiceD6, color: '#aaa' };\n    };\n\n    const groups: Record<string, any[]> = {\n        'Main': [],\n        'SpellSlot': [],\n        'ClassResource': [],\n        'Other': []\n    };\n\n    Object.entries(resources.current).forEach(([key, value]) => {\n        const max = resources.max[key] || 0;\n        const parsed = parseResourceKey(key);\n        const item = { key, value, max, ...parsed };\n\n        if (['Action', 'BonusAction', 'Reaction', 'Movement'].includes(parsed.type)) {\n            groups['Main'].push(item);\n        } else if (parsed.type === 'SpellSlot') {\n            groups['SpellSlot'].push(item);\n        } else if (parsed.type === 'ClassResource') {\n            groups['ClassResource'].push(item);\n        } else {\n            groups['Other'].push(item);\n        }\n    });\n\n    groups['SpellSlot'].sort((a, b) => (a.sort || 0) - (b.sort || 0));\n    const mainOrder = ['Action', 'BonusAction', 'Reaction', 'Movement'];\n    groups['Main'].sort((a, b) => mainOrder.indexOf(a.type) - mainOrder.indexOf(b.type));\n\n    const containerVariants = {\n        hidden: { opacity: 0, scale: 0.95, y: 10 },\n        visible: { \n            opacity: 1, \n            scale: 1, \n            y: 0,\n            transition: { \n                staggerChildren: 0.05,\n                delayChildren: 0.1\n            }\n        }\n    };\n\n    const itemVariants = {\n        hidden: { opacity: 0, x: -10 },\n        visible: { opacity: 1, x: 0 }\n    };\n\n    return (\n        <motion.div \n            className={styles.arcaneVellum}\n            variants={containerVariants}\n            initial=\"hidden\"\n            animate=\"visible\"\n        >\n            <div className={styles.vellumHeader}>\n                <span className={styles.sigil}><FontAwesomeIcon icon={faMagic} /></span>\n                <h4>{creature.name}</h4>\n            </div>\n\n            <div className={styles.statsGrid}>\n                <motion.div variants={itemVariants} className={styles.statPill}>\n                    <FontAwesomeIcon icon={faHeart} className={styles.hpIcon} />\n                    <span className={styles.statValue}>{currentHP}/{maxHP}</span>\n                    {tempHP > 0 && <span className={styles.tempHP}>+{tempHP}</span>}\n                </motion.div>\n                {finalState.arcaneWardHp !== undefined && finalState.arcaneWardHp > 0 && (\n                    <motion.div variants={itemVariants} className={cn(styles.statPill, styles.wardPill)}>\n                        <FontAwesomeIcon icon={faShieldHalved} />\n                        <span className={styles.statValue}>{finalState.arcaneWardHp}</span>\n                    </motion.div>\n                )}\n            </div>\n\n            <div className={styles.resourceGroups}>\n                {groups['Main'].length > 0 && (\n                    <div className={styles.mainGroup}>\n                        {groups['Main'].map(res => (\n                            <motion.div \n                                key={res.key} \n                                variants={itemVariants}\n                                className={cn(styles.mainIcon, res.value <= 0 && styles.depleted)}\n                                style={{ '--glow-color': res.color } as any}\n                                title={`${res.label}: ${res.value}/${res.max}`}\n                            >\n                                <FontAwesomeIcon icon={res.icon} />\n                            </motion.div>\n                        ))}\n                    </div>\n                )}\n\n                {groups['SpellSlot'].length > 0 && (\n                    <div className={styles.spellGroup}>\n                        <div className={styles.divider}><span>Weave Sockets</span></div>\n                        <div className={styles.slotsGrid}>\n                            {groups['SpellSlot'].map(res => (\n                                <motion.div \n                                    key={res.key} \n                                    variants={itemVariants}\n                                    className={cn(styles.slotNode, res.value <= 0 && styles.empty)}\n                                    title={`${res.label}: ${res.value}/${res.max}`}\n                                >\n                                    <span className={styles.levelLabel}>{res.label}</span>\n                                    <div className={styles.nodeTrack}>\n                                        <div \n                                            className={styles.nodeFill} \n                                            style={{ width: `${(res.value / res.max) * 100}%` }} \n                                        />\n                                    </div>\n                                </motion.div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n\n                {groups['ClassResource'].length > 0 && (\n                    <div className={styles.classGroup}>\n                        <div className={styles.divider}><span>Essence</span></div>\n                        {groups['ClassResource'].map(res => (\n                            <motion.div \n                                key={res.key} \n                                variants={itemVariants}\n                                className={styles.essenceItem}\n                            >\n                                <FontAwesomeIcon icon={res.icon} style={{ color: res.color }} />\n                                <span className={styles.essenceName}>{res.label}</span>\n                                <span className={styles.essenceCount}>{res.value}/{res.max}</span>\n                            </motion.div>\n                        ))}\n                    </div>\n                )}\n            </div>\n        </motion.div>\n    );\n});\n\nexport default ResourcePanel;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/ResourceSkyline.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[903,906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[903,906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleBucketClick' is assigned a value but never used.","line":344,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":344,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12012,12015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12012,12015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ResourceSkyline - Resource area chart visualization for Skyline Spectrogram UI\n *\n * HEIGHT = % Resources remaining (Y-axis: 0-100%)\n * COLOR = diverging red-blue palette (colorblind-safe)\n * X-axis = 100 buckets (1% worst to 100% best)\n *\n * Resources weighted sum: spell slots * 1.6^level + features + potions\n * Hover shows detailed breakdown per resource type\n */\n\nimport React, { memo, useCallback, useMemo } from 'react';\nimport styles from './resourceSkyline.module.scss';\nimport {\n    SkylineAnalysis,\n    CharacterBucketData,\n    valueToColor,\n    DEFAULT_SKYLINE_COLORS,\n    SkylineInteractionState,\n    ColorScale,\n} from '@/model/skylineTypes';\n\nexport interface ResourceSkylineProps {\n    /** Full analysis data or single character bucket data */\n    data: SkylineAnalysis | CharacterBucketData[];\n    onHover?: (state: SkylineInteractionState) => void;\n    onBucketClick?: (bucket: any) => void;\n    className?: string;\n    characterFilter?: string[];\n    // Single character mode props\n    characterName?: string;\n    characterId?: string;\n    width?: number;\n    height?: number;\n    colors?: typeof DEFAULT_SKYLINE_COLORS;\n}\n\nexport interface SingleCharacterResourceSkylineProps {\n    characterData: CharacterBucketData[];\n    characterName: string;\n    width: number;\n    height: number;\n    colors: { resources: ColorScale };\n    onHover?: (bucket: number | null) => void;\n    hoveredBucket?: number | null;\n}\n\n/**\n * Render resource skyline for a single character\n */\nexport const SingleCharacterResourceSkyline: React.FC<SingleCharacterResourceSkylineProps> = memo(({\n    characterData,\n    characterName,\n    width,\n    height,\n    colors,\n    onHover,\n    hoveredBucket,\n}) => {\n    const canvasRef = React.useRef<HTMLCanvasElement>(null);\n    const [displayData, setDisplayData] = React.useState(characterData);\n    const animationRef = React.useRef<number | null>(null);\n\n    // Smooth data transition\n    React.useEffect(() => {\n        const startTime = performance.now();\n        const duration = 400;\n        const startData = displayData;\n        const targetData = characterData;\n\n        if (startData.length !== targetData.length) {\n            setDisplayData(targetData);\n            return;\n        }\n\n        const animate = (currentTime: number) => {\n            const elapsed = currentTime - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n            const ease = progress * (2 - progress);\n\n            if (progress < 1) {\n                const interpolated = targetData.map((target, i) => {\n                    const start = startData[i];\n                    return {\n                        ...target,\n                        resourcePercent: start.resourcePercent + (target.resourcePercent - start.resourcePercent) * ease\n                    };\n                });\n                setDisplayData(interpolated);\n                animationRef.current = requestAnimationFrame(animate);\n            } else {\n                setDisplayData(targetData);\n            }\n        };\n\n        animationRef.current = requestAnimationFrame(animate);\n        return () => {\n            if (animationRef.current) cancelAnimationFrame(animationRef.current);\n        };\n    }, [characterData]);\n\n    const render = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas || displayData.length === 0) return;\n\n        const ctx = setupCanvas(canvas, width, height);\n        if (!ctx) return;\n\n        const padding = { top: 20, right: 10, bottom: 30, left: 40 };\n        const chartWidth = width - padding.left - padding.right;\n        const chartHeight = height - padding.top - padding.bottom;\n\n        // Clear canvas with dark background\n        ctx.fillStyle = 'rgba(26, 26, 26, 0.95)';\n        ctx.fillRect(0, 0, width, height);\n\n        // Draw grid lines\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';\n        ctx.lineWidth = 1;\n        [0, 25, 50, 75, 100].forEach(pct => {\n            const y = padding.top + chartHeight - (pct / 100) * chartHeight;\n            ctx.beginPath();\n            ctx.moveTo(padding.left, y);\n            ctx.lineTo(width - padding.right, y);\n            ctx.stroke();\n\n            // Y-axis labels\n            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';\n            ctx.font = '10px Courier New';\n            ctx.textAlign = 'right';\n            ctx.fillText(`${pct}%`, padding.left - 5, y + 3);\n        });\n\n        // Draw resource area chart using vertical segments\n        const bucketWidth = chartWidth / displayData.length;\n\n        // Create path for area fill\n        ctx.beginPath();\n        ctx.moveTo(padding.left, padding.top + chartHeight);\n\n        displayData.forEach((bucket, i) => {\n            const x = padding.left + i * bucketWidth;\n            const resourceHeight = (bucket.resourcePercent / 100) * chartHeight;\n            const y = padding.top + chartHeight - resourceHeight;\n\n            if (i === 0) {\n                ctx.moveTo(x, y);\n            } else {\n                ctx.lineTo(x, y);\n            }\n        });\n\n        // Complete area and fill\n        const lastX = padding.left + (displayData.length - 1) * bucketWidth;\n        ctx.lineTo(lastX, padding.top + chartHeight);\n        ctx.closePath();\n\n        const avgResource = displayData.reduce((sum, b) => sum + b.resourcePercent, 0) / displayData.length;\n        const baseColor = valueToColor(avgResource, colors.resources);\n\n        ctx.fillStyle = baseColor + '40';\n        ctx.fill();\n\n        // Draw each bucket segment\n        displayData.forEach((bucket, i) => {\n            const x = padding.left + i * bucketWidth;\n            const resourceHeight = (bucket.resourcePercent / 100) * chartHeight;\n            const y = padding.top + chartHeight - resourceHeight;\n\n            const color = valueToColor(bucket.resourcePercent, colors.resources);\n\n            ctx.fillStyle = color;\n            ctx.fillRect(x, y, bucketWidth - 1, resourceHeight);\n\n            if (hoveredBucket === i + 1) {\n                ctx.strokeStyle = 'rgba(212, 175, 55, 0.8)';\n                ctx.lineWidth = 2;\n                ctx.strokeRect(x, y, bucketWidth - 1, resourceHeight);\n            }\n        });\n\n        // Crosshair\n        if (hoveredBucket && hoveredBucket >= 1 && hoveredBucket <= displayData.length) {\n            const i = hoveredBucket - 1;\n            const x = padding.left + i * bucketWidth + bucketWidth / 2;\n\n            ctx.strokeStyle = 'rgba(212, 175, 55, 0.8)';\n            ctx.lineWidth = 1;\n            ctx.setLineDash([4, 4]);\n            ctx.beginPath();\n            ctx.moveTo(x, padding.top);\n            ctx.lineTo(x, height - padding.bottom);\n            ctx.stroke();\n            ctx.setLineDash([]);\n        }\n\n        // X-axis labels\n        ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';\n        ctx.font = '10px Courier New';\n        ctx.textAlign = 'center';\n\n        [1, 50, 100].forEach(pct => {\n            const idx = pct - 1;\n            if (idx < displayData.length) {\n                const x = padding.left + idx * bucketWidth + bucketWidth / 2;\n                ctx.fillText(`${pct}%`, x, height - padding.bottom + 15);\n            }\n        });\n    }, [displayData, width, height, colors, hoveredBucket]);\n\n    React.useEffect(() => {\n        render();\n    }, [render]);\n\n    return (\n        <div className={styles.characterCard}>\n            <div className={styles.characterName}>{characterName}</div>\n            <canvas\n                ref={canvasRef}\n                width={width}\n                height={height}\n                className={styles.skylineCanvas}\n                onMouseMove={(e) => {\n                    const rect = e.currentTarget.getBoundingClientRect();\n                    const x = e.clientX - rect.left;\n                    const padding = { left: 40, right: 10 };\n                    const chartWidth = width - padding.left - padding.right;\n                    const bucketWidth = chartWidth / characterData.length;\n                    const bucket = Math.floor((x - padding.left) / bucketWidth) + 1;\n                    if (bucket >= 1 && bucket <= characterData.length) {\n                        onHover?.(bucket);\n                    }\n                }}\n                onMouseLeave={() => onHover?.(null)}\n                role=\"img\"\n                aria-label={`${characterName} Resource skyline across ${characterData.length} percentile buckets`}\n            />\n        </div>\n    );\n});\n\nSingleCharacterResourceSkyline.displayName = 'SingleCharacterResourceSkyline';\n\nfunction setupCanvas(canvas: HTMLCanvasElement, width: number, height: number) {\n    const dpr = window.devicePixelRatio || 1;\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n        ctx.scale(dpr, dpr);\n    }\n    return ctx;\n}\n\n/**\n * Main ResourceSkyline component\n */\nconst ResourceSkyline: React.FC<ResourceSkylineProps> = memo(({\n    data,\n    onHover,\n    onBucketClick,\n    className,\n    characterFilter,\n    characterName,\n    characterId,\n    width,\n    height,\n    colors = DEFAULT_SKYLINE_COLORS,\n}) => {\n    const [hoveredBucket, setHoveredBucket] = React.useState<number | null>(null);\n    const [hoveredCharId, setHoveredCharId] = React.useState<string | null>(null);\n\n    // If we are in single character mode (passed from SkylineSpectrogram)\n    if (Array.isArray(data) && characterId) {\n        return (\n            <SingleCharacterResourceSkyline\n                characterData={data}\n                characterName={characterName || 'Unknown'}\n                width={width || 200}\n                height={height || 150}\n                colors={{ resources: colors }}\n                onHover={(bucket) => {\n                    setHoveredBucket(bucket);\n                    onHover?.({ hoveredBucket: bucket, hoveredCharacter: characterId });\n                }}\n                hoveredBucket={hoveredBucket}\n            />\n        );\n    }\n\n    // Otherwise, we are in multi-character mode\n    const analysisData = data as SkylineAnalysis;\n\n    const characterArrays = useMemo(() => {\n        if (!analysisData.buckets || analysisData.buckets.length === 0) return [];\n\n        const charIds = characterFilter || analysisData.buckets[0].characters.map(c => c.id);\n\n        return charIds.map(charId => {\n            const characterData: CharacterBucketData[] = analysisData.buckets.map(bucket => {\n                const char = bucket.characters.find(c => c.id === charId);\n                return char || {\n                    name: 'Unknown',\n                    id: charId,\n                    maxHp: 0,\n                    hpPercent: 0,\n                    resourcePercent: 0,\n                    resourceBreakdown: {\n                        spellSlots: [],\n                        shortRestFeatures: [],\n                        longRestFeatures: [],\n                        hitDice: 0,\n                        hitDiceMax: 0,\n                        totalEhp: 0,\n                        maxEhp: 0,\n                    },\n                    deathRound: null,\n                    isDead: false,\n                };\n            });\n\n            const firstChar = characterData[0];\n            return {\n                charId,\n                characterName: firstChar?.name || charId,\n                data: characterData,\n            };\n        });\n    }, [analysisData.buckets, characterFilter]);\n\n    const handleBucketHover = useCallback((bucketIndex: number | null, charId: string) => {\n        setHoveredBucket(bucketIndex);\n        if (bucketIndex === null) {\n            setHoveredCharId(null);\n            onHover?.({ hoveredBucket: null, hoveredCharacter: null });\n        } else {\n            setHoveredCharId(charId);\n            onHover?.({ hoveredBucket: bucketIndex, hoveredCharacter: charId });\n        }\n    }, [onHover]);\n\n    const handleBucketClick = useCallback((bucket: any) => {\n        onBucketClick?.(bucket);\n    }, [onBucketClick]);\n\n    const canvasWidth = 200;\n    const canvasHeight = 150;\n\n    return (\n        <div className={`${styles.resourceSkylineContainer} ${className || ''}`}>\n            <div className={styles.skylineTitle}>\n                Resource Skyline - {analysisData.totalRuns} runs, {analysisData.buckets.length} buckets\n            </div>\n\n            <div className={styles.charactersGrid}>\n                {characterArrays.map(({ charId, characterName, data: charData }) => (\n                    <SingleCharacterResourceSkyline\n                        key={charId}\n                        characterData={charData}\n                        characterName={characterName}\n                        width={canvasWidth}\n                        height={canvasHeight}\n                        colors={{ resources: DEFAULT_SKYLINE_COLORS }}\n                        onHover={(bucket) => handleBucketHover(bucket, charId)}\n                        hoveredBucket={hoveredCharId === charId ? hoveredBucket : null}\n                    />\n                ))}\n            </div>\n        </div>\n    );\n});\n\nResourceSkyline.displayName = 'ResourceSkyline';\n\nexport default ResourceSkyline;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/SkylineCanvas.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'valueToColor' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getCanvasSize' is defined but never used.","line":36,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rect' is assigned a value but never used.","line":38,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'x' is assigned a value but never used.","line":131,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'y' is assigned a value but never used.","line":132,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":132,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'event' is defined but never used.","line":159,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":159,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * SkylineCanvas - Base Canvas component for Skyline Spectrogram UI\n *\n * Handles:\n * - High-DPI (Retina) scaling\n * - Canvas rendering lifecycle\n * - Mouse interaction (hover, crosshair)\n * - Performance optimization\n */\n\nimport React, { useRef, useEffect, memo, useCallback } from 'react';\nimport styles from './skylineCanvas.module.scss';\nimport {\n    SkylineCanvasProps,\n    DEFAULT_SKYLINE_COLORS,\n    SkylineInteractionState,\n    valueToColor,\n} from '@/model/skylineTypes';\n\nconst DEFAULT_CONFIG: SkylineCanvasProps['config'] = {\n    width: 800,\n    height: 400,\n    padding: { top: 20, right: 20, bottom: 40, left: 60 },\n    colors: {\n        hp: DEFAULT_SKYLINE_COLORS,\n        resources: DEFAULT_SKYLINE_COLORS,\n        death: '#ff4444',\n        grid: 'rgba(255, 255, 255, 0.1)',\n        crosshair: 'rgba(212, 175, 55, 0.8)',\n    },\n};\n\n/**\n * Get high-DPI scaled canvas dimensions\n */\nfunction getCanvasSize(canvas: HTMLCanvasElement, width: number, height: number) {\n    const dpr = window.devicePixelRatio || 1;\n    const rect = canvas.getBoundingClientRect();\n\n    return {\n        // Display size (CSS pixels)\n        displayWidth: width,\n        displayHeight: height,\n        // Actual canvas size (scaled for DPI)\n        canvasWidth: width * dpr,\n        canvasHeight: height * dpr,\n        pixelRatio: dpr,\n    };\n}\n\n/**\n * Setup canvas with high-DPI scaling\n */\nfunction setupCanvas(canvas: HTMLCanvasElement, width: number, height: number) {\n    const dpr = window.devicePixelRatio || 1;\n\n    // Set display size (CSS pixels)\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n\n    // Set actual canvas size (scaled)\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n\n    // Normalize coordinate system\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n        ctx.scale(dpr, dpr);\n    }\n\n    return ctx;\n}\n\nconst SkylineCanvas: React.FC<SkylineCanvasProps> = memo(({\n    data,\n    config: partialConfig,\n    onHover,\n    onBucketClick,\n    className,\n}) => {\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n    const interactionRef = useRef<SkylineInteractionState>({\n        hoveredBucket: null,\n        hoveredCharacter: null,\n    });\n\n    const config = { ...DEFAULT_CONFIG, ...partialConfig };\n\n    /**\n     * Main render function - draws the Skyline visualization\n     */\n    const render = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = setupCanvas(canvas, config.width!, config.height!);\n        if (!ctx) return;\n\n        // Clear canvas\n        ctx.clearRect(0, 0, config.width!, config.height!);\n\n        // Draw background\n        ctx.fillStyle = 'rgba(26, 26, 26, 0.95)';\n        ctx.fillRect(0, 0, config.width!, config.height!);\n\n        // TODO: Render implementation will be added by dependent components:\n        // - HP Skyline (2xt)\n        // - Death Bar overlay (ycg)\n        // - Resource Skyline (5sj)\n        // - Crosshair interaction (pd0)\n\n        // For now, draw placeholder text\n        ctx.fillStyle = 'rgba(212, 175, 55, 0.5)';\n        ctx.font = '14px Courier New';\n        ctx.textAlign = 'center';\n        ctx.fillText(\n            `Skyline Canvas Base - ${data.buckets.length} buckets, ${data.partySize} characters`,\n            config.width! / 2,\n            config.height! / 2\n        );\n    }, [data, config]);\n\n    /**\n     * Handle mouse move for hover/crosshair\n     */\n    const handleMouseMove = useCallback((event: React.MouseEvent<HTMLCanvasElement>) => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const rect = canvas.getBoundingClientRect();\n        const x = event.clientX - rect.left;\n        const y = event.clientY - rect.top;\n\n        // TODO: Calculate bucket from X position\n        // const bucket = Math.floor((x - padding.left) / availableWidth * 100) + 1;\n\n        // interactionRef.current.hoveredBucket = bucket;\n        // onHover?.(interactionRef.current);\n\n        // Trigger re-render for crosshair\n        // requestAnimationFrame(render);\n    }, [config, onHover]);\n\n    /**\n     * Handle mouse leave\n     */\n    const handleMouseLeave = useCallback(() => {\n        interactionRef.current = {\n            hoveredBucket: null,\n            hoveredCharacter: null,\n        };\n        onHover?.(interactionRef.current);\n        requestAnimationFrame(render);\n    }, [onHover, render]);\n\n    /**\n     * Handle click for bucket selection\n     */\n    const handleClick = useCallback((event: React.MouseEvent<HTMLCanvasElement>) => {\n        const bucketIndex = interactionRef.current.hoveredBucket;\n        if (bucketIndex && bucketIndex >= 1 && bucketIndex <= data.buckets.length) {\n            onBucketClick?.(data.buckets[bucketIndex - 1]);\n        }\n    }, [data.buckets, onBucketClick]);\n\n    // Initial render and re-render on data/config change\n    useEffect(() => {\n        render();\n    }, [render]);\n\n    // Handle window resize\n    useEffect(() => {\n        const handleResize = () => {\n            render();\n        };\n\n        window.addEventListener('resize', handleResize);\n        return () => window.removeEventListener('resize', handleResize);\n    }, [render]);\n\n    return (\n        <div className={`${styles.canvasContainer} ${className || ''}`}>\n            <canvas\n                ref={canvasRef}\n                width={config.width}\n                height={config.height}\n                className={styles.canvas}\n                onMouseMove={handleMouseMove}\n                onMouseLeave={handleMouseLeave}\n                onClick={handleClick}\n                role=\"img\"\n                aria-label={`Skyline Spectrogram showing ${data.totalRuns} simulation runs across ${data.buckets.length} percentile buckets`}\n            />\n        </div>\n    );\n});\n\nSkylineCanvas.displayName = 'SkylineCanvas';\n\nexport default SkylineCanvas;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/SkylineE2E.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'beforeEach' is defined but never used.","line":14,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'vi' is defined but never used.","line":14,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fireEvent' is defined but never used.","line":15,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used.","line":15,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ResourceBreakdown' is defined but never used.","line":19,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'deathCount' is assigned a value but never used.","line":281,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":281,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * End-to-end tests for Skyline Spectrogram UI components\n *\n * Tests:\n * - Component rendering\n * - Data accuracy\n * - Color encoding\n * - Crosshair interaction\n * - Accessibility features\n * - Balancer band overlay\n * - Performance with 100 buckets\n */\n\nimport { describe, it, expect, beforeEach, vi } from 'vitest';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport React from 'react';\nimport { CrosshairProvider, useCrosshair } from './CrosshairContext';\nimport { AccessibilityProvider, useAccessibility } from './AccessibilityContext';\nimport { PercentileBucket, CharacterBucketData, ResourceBreakdown } from '@/model/skylineTypes';\n\n// Mock data for testing\nconst createMockBucket = (\n    percentile: number,\n    hpPercent: number,\n    resourcePercent: number,\n    deathRound: number | null = null\n): PercentileBucket => ({\n    percentile,\n    runCount: 1,\n    characters: [\n        {\n            name: 'Fighter',\n            id: 'char1',\n            maxHp: 100,\n            hpPercent,\n            resourcePercent,\n            resourceBreakdown: {\n                spellSlots: [\n                    { level: 1, remaining: 3, max: 4 },\n                    { level: 2, remaining: 2, max: 3 },\n                ],\n                shortRestFeatures: ['Second Wind'],\n                longRestFeatures: ['Action Surge'],\n                hitDice: 8,\n                hitDiceMax: 10,\n                totalEhp: 150,\n                maxEhp: 180,\n            },\n            deathRound,\n            isDead: deathRound !== null,\n        } as CharacterBucketData,\n        {\n            name: 'Cleric',\n            id: 'char2',\n            maxHp: 80,\n            hpPercent: hpPercent - 10,\n            resourcePercent: resourcePercent + 5,\n            resourceBreakdown: {\n                spellSlots: [\n                    { level: 1, remaining: 2, max: 4 },\n                    { level: 2, remaining: 1, max: 3 },\n                    { level: 3, remaining: 0, max: 2 },\n                ],\n                shortRestFeatures: ['Channel Divinity'],\n                longRestFeatures: ['Destroy Undead'],\n                hitDice: 6,\n                hitDiceMax: 8,\n                totalEhp: 120,\n                maxEhp: 140,\n            },\n            deathRound: null,\n            isDead: false,\n        } as CharacterBucketData,\n    ],\n    partyHpPercent: hpPercent - 5,\n    partyResourcePercent: resourcePercent + 3,\n    deathCount: deathRound !== null ? 1 : 0,\n});\n\nconst createMockBuckets = (count: number = 100): PercentileBucket[] => {\n    return Array.from({ length: count }, (_, i) => {\n        const percentile = i + 1;\n        // Simulate difficulty curve: worse outcomes at low percentiles\n        const baseHp = 30 + (percentile / 100) * 60; // 30% to 90%\n        const baseRes = 20 + (percentile / 100) * 70; // 20% to 90%\n        const deathRound = percentile < 10 ? 5 : null; // Deaths in worst 10%\n        return createMockBucket(percentile, baseHp, baseRes, deathRound);\n    });\n};\n\ndescribe('Skyline UI - E2E Tests', () => {\n    describe('Data Structure Validation', () => {\n        it('should create valid buckets with correct percentile ordering', () => {\n            const buckets = createMockBuckets(100);\n\n            expect(buckets).toHaveLength(100);\n            expect(buckets[0].percentile).toBe(1);\n            expect(buckets[99].percentile).toBe(100);\n\n            // Verify percentile is sequential\n            for (let i = 0; i < 100; i++) {\n                expect(buckets[i].percentile).toBe(i + 1);\n            }\n        });\n\n        it('should correctly aggregate character data', () => {\n            const bucket = createMockBucket(50, 70, 60);\n\n            expect(bucket.characters).toHaveLength(2);\n            expect(bucket.characters[0].name).toBe('Fighter');\n            expect(bucket.characters[1].name).toBe('Cleric');\n            expect(bucket.partyHpPercent).toBe(65); // 70 - 5\n            expect(bucket.partyResourcePercent).toBe(63); // 60 + 3\n        });\n\n        it('should accurately track death data', () => {\n            const buckets = createMockBuckets(100);\n\n            const deathCount = buckets.filter(b => b.deathCount > 0).length;\n            expect(deathCount).toBe(9); // First 9 buckets have deaths\n\n            const firstDeath = buckets.find(b => b.deathCount > 0);\n            expect(firstDeath?.deathCount).toBe(1);\n            expect(firstDeath?.characters[0].deathRound).toBe(5);\n        });\n\n        it('should correctly encode resource breakdown', () => {\n            const bucket = createMockBucket(50, 70, 60);\n            const fighter = bucket.characters[0];\n\n            const breakdown = (fighter as CharacterBucketData).resourceBreakdown;\n            expect(breakdown.spellSlots).toHaveLength(2);\n            expect(breakdown.spellSlots[0].remaining).toBe(3);\n            expect(breakdown.spellSlots[0].max).toBe(4);\n            expect(breakdown.shortRestFeatures).toContain('Second Wind');\n            expect(breakdown.hitDice).toBe(8);\n            expect(breakdown.hitDiceMax).toBe(10);\n        });\n    });\n\n    describe('CrosshairContext', () => {\n        it('should provide crosshair state to consumers', async () => {\n            const TestChild = () => {\n                const { state } = useCrosshair();\n                return (\n                    <div>\n                        <span data-testid=\"bucket\">{state.bucketIndex === null ? 'null' : state.bucketIndex}</span>\n                    </div>\n                );\n            };\n\n            const { getByTestId } = render(\n                <CrosshairProvider>\n                    <TestChild />\n                </CrosshairProvider>\n            );\n\n            expect(getByTestId('bucket').textContent).toBe('null');\n        });\n\n        it('should register bucket data sources', () => {\n            const buckets = createMockBuckets(100);\n\n            const TestChild = () => {\n                const { registerBuckets } = useCrosshair();\n                React.useEffect(() => {\n                    registerBuckets('test-source', buckets);\n                }, [registerBuckets]);\n                return <div>Registered</div>;\n            };\n\n            render(\n                <CrosshairProvider>\n                    <TestChild />\n                </CrosshairProvider>\n            );\n\n            // Component should render without errors\n            expect(screen.getByText('Registered')).toBeDefined();\n        });\n    });\n\n    describe('AccessibilityContext', () => {\n        it('should provide accessibility state', () => {\n            const TestChild = () => {\n                const { highContrast, patternDensity } = useAccessibility();\n                return (\n                    <div>\n                        <span data-testid=\"contrast\">{highContrast.toString()}</span>\n                        <span data-testid=\"density\">{patternDensity}</span>\n                    </div>\n                );\n            };\n\n            const { getByTestId } = render(\n                <AccessibilityProvider>\n                    <TestChild />\n                </AccessibilityProvider>\n            );\n\n            expect(getByTestId('contrast').textContent).toBe('false');\n            expect(getByTestId('density').textContent).toBe('medium');\n        });\n\n        it('should toggle high contrast mode', () => {\n            const TestChild = () => {\n                const { highContrast, toggleHighContrast } = useAccessibility();\n                return (\n                    <button onClick={toggleHighContrast}>\n                        Contrast: {highContrast.toString()}\n                    </button>\n                );\n            };\n\n            const { getByRole } = render(\n                <AccessibilityProvider>\n                    <TestChild />\n                </AccessibilityProvider>\n            );\n\n            const button = getByRole('button');\n            expect(button.textContent).toBe('Contrast: false');\n        });\n    });\n\n    describe('Color Encoding', () => {\n        it('should use Okabe-Ito colorblind-safe palette', () => {\n            // Test that colors are within expected ranges\n            const testColors = {\n                low: '#d73027',    // Red\n                midLow: '#fc8d59', // Orange-Red\n                mid: '#f0f0f0',     // Off-white\n                midHigh: '#91bfdb', // Light Blue\n                high: '#4575b4',    // Deep Blue\n            };\n\n            // Verify colors are valid hex\n            const hexRegex = /^#[0-9A-Fa-f]{6}$/;\n            Object.values(testColors).forEach(color => {\n                expect(color).toMatch(hexRegex);\n            });\n        });\n\n        it('should correctly interpolate between colors', () => {\n            // Simple interpolation test\n            const interpolateColor = (c1: string, c2: string, t: number): string => {\n                const hexToRgb = (hex: string) => {\n                    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n                    return result ? {\n                        r: parseInt(result[1], 16),\n                        g: parseInt(result[2], 16),\n                        b: parseInt(result[3], 16),\n                    } : null;\n                };\n\n                const rgb1 = hexToRgb(c1);\n                const rgb2 = hexToRgb(c2);\n\n                if (!rgb1 || !rgb2) return c1;\n\n                const r = Math.round(rgb1.r + (rgb2.r - rgb1.r) * t);\n                const g = Math.round(rgb1.g + (rgb2.g - rgb1.g) * t);\n                const b = Math.round(rgb1.b + (rgb2.b - rgb1.b) * t);\n\n                return `#${[r, g, b].map(x => x.toString(16).padStart(2, '0')).join('')}`;\n            };\n\n            const mid = interpolateColor('#d73027', '#4575b4', 0.5);\n            expect(mid).toMatch(/^#[0-9a-f]{6}$/);\n        });\n    });\n\n    describe('Performance', () => {\n        it('should handle 100 buckets efficiently', () => {\n            const buckets = createMockBuckets(100);\n            const startTime = performance.now();\n\n            // Simulate rendering overhead\n            const totalHp = buckets.reduce((sum, b) => sum + b.partyHpPercent, 0);\n            const totalRes = buckets.reduce((sum, b) => sum + b.partyResourcePercent, 0);\n            const deathCount = buckets.reduce((sum, b) => sum + b.deathCount, 0);\n\n            const endTime = performance.now();\n            const duration = endTime - startTime;\n\n            // Should process 100 buckets efficiently\n            expect(duration).toBeLessThan(100);\n            expect(totalHp).toBeGreaterThan(0);\n            expect(totalRes).toBeGreaterThan(0);\n        });\n\n        it('should calculate aggregate metrics efficiently', () => {\n            const buckets = createMockBuckets(100);\n            const startTime = performance.now();\n\n            // Calculate percentiles\n            const p1 = buckets[0].partyHpPercent;\n            const p50 = buckets[49].partyHpPercent;\n            const p99 = buckets[98].partyHpPercent;\n\n            const endTime = performance.now();\n            const duration = endTime - startTime;\n\n            expect(duration).toBeLessThan(50);\n            expect(p1).toBeLessThan(p50);\n            expect(p50).toBeLessThan(p99);\n        });\n    });\n\n    describe('Balancer Band Integration', () => {\n        it('should correctly identify tier ranges', () => {\n            const tierRanges = {\n                Safe: { min: 70, max: 100 },\n                Challenging: { min: 50, max: 80 },\n                Boss: { min: 20, max: 60 },\n                Failed: { min: 0, max: 30 },\n            };\n\n            // Test Safe range\n            const safeValue = 85;\n            expect(safeValue).toBeGreaterThanOrEqual(tierRanges.Safe.min);\n            expect(safeValue).toBeLessThanOrEqual(tierRanges.Safe.max);\n\n            // Test Challenging range\n            const challengingValue = 65;\n            expect(challengingValue).toBeGreaterThanOrEqual(tierRanges.Challenging.min);\n            expect(challengingValue).toBeLessThanOrEqual(tierRanges.Challenging.max);\n\n            // Test Boss range\n            const bossValue = 40;\n            expect(bossValue).toBeGreaterThanOrEqual(tierRanges.Boss.min);\n            expect(bossValue).toBeLessThanOrEqual(tierRanges.Boss.max);\n        });\n\n        it('should detect out-of-range values', () => {\n            const tier = { min: 50, max: 80 };\n\n            const inRange = 65;\n            const outOfRangeLow = 40;\n            const outOfRangeHigh = 85;\n\n            expect(inRange >= tier.min && inRange <= tier.max).toBe(true);\n            expect(outOfRangeLow >= tier.min && outOfRangeLow <= tier.max).toBe(false);\n            expect(outOfRangeHigh >= tier.min && outOfRangeHigh <= tier.max).toBe(false);\n        });\n    });\n\n    describe('Data Accuracy', () => {\n        it('should maintain sorting order across all buckets', () => {\n            const buckets = createMockBuckets(100);\n\n            // HP should be monotonically increasing (worst to best)\n            for (let i = 1; i < 100; i++) {\n                expect(buckets[i].partyHpPercent).toBeGreaterThanOrEqual(\n                    buckets[i - 1].partyHpPercent - 1 // Allow small variance\n                );\n            }\n        });\n\n        it('should correctly calculate death rates', () => {\n            const buckets = createMockBuckets(100);\n            const totalDeaths = buckets.reduce((sum, b) => sum + b.deathCount, 0);\n            const deathRate = (totalDeaths / (buckets.length * 2)) * 100; // 2 chars per bucket\n\n            // Should have ~4.5% death rate (9 deaths / 200 characters)\n            expect(deathRate).toBeGreaterThan(4);\n            expect(deathRate).toBeLessThan(5);\n        });\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/SkylineHeatmap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkylineCanvasConfig' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'barWidth' is assigned a value but never used.","line":31,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3696,3699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3696,3699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useRef, useEffect } from 'react'\nimport { SkylineAnalysis, Combattant } from '@/model/model'\nimport { SkylineCanvasConfig } from '@/model/skylineTypes'\nimport styles from './SkylineHeatmap.module.scss'\n\ninterface SkylineHeatmapProps {\n    skyline: SkylineAnalysis\n    players: Combattant[]\n}\n\nconst SkylineHeatmap: FC<SkylineHeatmapProps> = ({ skyline, players }) => {\n    const canvasRef = useRef<HTMLCanvasElement>(null)\n\n    useEffect(() => {\n        const canvas = canvasRef.current\n        if (!canvas) return\n\n        const ctx = canvas.getContext('2d')\n        if (!ctx) return\n\n        // Clear canvas\n        ctx.clearRect(0, 0, canvas.width, canvas.height)\n\n        const { width, height } = canvas\n        const padding = { top: 30, right: 20, bottom: 40, left: 60 }\n        const chartWidth = width - padding.left - padding.right\n        const chartHeight = 200 // Fixed height for the 100px upper + 100px lower\n\n        const numBuckets = skyline.buckets.length\n        const bucketWidth = chartWidth / numBuckets\n        const barWidth = bucketWidth * 0.9 // 90% of bucket width for the bar\n\n        // Find matching characters for each player\n        const playerData = players.map(player => {\n            const charData = skyline.buckets.map(bucket =>\n                bucket.characters.find(c => c.id === player.creature.id || c.name === player.creature.name)\n            ).filter(Boolean)\n\n            return {\n                name: player.creature.name,\n                data: charData\n            }\n        }).filter(p => p.data.length > 0)\n\n        if (playerData.length === 0) return\n\n        const playerSectionHeight = chartHeight + 60 // 200 for bars + 60 for labels/spacing\n        const playersPerRow = Math.ceil(Math.sqrt(playerData.length))\n        const rowHeight = playerSectionHeight\n\n        // Colors\n        const colors = {\n            green: '#44ff44',   // remaining HP\n            red: '#ff4444',     // damage taken\n            blue: '#4488ff',    // remaining resources\n            yellow: '#ffcc00'   // used resources\n        }\n\n        playerData.forEach((player, playerIdx) => {\n            const row = Math.floor(playerIdx / playersPerRow)\n            const col = playerIdx % playersPerRow\n\n            const offsetX = padding.left + col * (chartWidth / playersPerRow)\n            const offsetY = padding.top + row * (rowHeight + 40)\n\n            // Draw player name\n            ctx.fillStyle = '#fff'\n            ctx.font = 'bold 12px sans-serif'\n            ctx.textAlign = 'left'\n            ctx.fillText(player.name, offsetX, offsetY - 10)\n\n            const cellWidth = (chartWidth / playersPerRow) - 20\n            const effectiveBucketWidth = cellWidth / numBuckets\n            const effectiveBarWidth = effectiveBucketWidth * 0.9\n\n            // Draw x-axis line in the middle\n            const axisY = offsetY + 100\n            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)'\n            ctx.lineWidth = 2\n            ctx.beginPath()\n            ctx.moveTo(offsetX, axisY)\n            ctx.lineTo(offsetX + cellWidth, axisY)\n            ctx.stroke()\n\n            // Draw Y axis labels\n            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)'\n            ctx.font = '9px sans-serif'\n            ctx.textAlign = 'right'\n            ctx.fillText('100%', offsetX - 5, offsetY + 5) // HP top\n            ctx.fillText('50%', offsetX - 5, offsetY + 50) // HP middle\n            ctx.fillText('0%', offsetX - 5, axisY + 3) // HP bottom / axis\n            ctx.fillText('50%', offsetX - 5, axisY + 53) // Resources middle\n            ctx.fillText('100%', offsetX - 5, offsetY + 200) // Resources bottom\n\n            player.data.forEach((charData: any, bucketIdx: number) => {\n                if (!charData) return\n\n                const x = offsetX + bucketIdx * effectiveBucketWidth\n\n                // HP bar (upper square, grows UP from axis)\n                // Green at bottom (near axis), red at top\n                const hpHeight = (charData.hpPercent / 100) * 100\n                const damageHeight = 100 - hpHeight\n\n                // Draw green (remaining HP) from axis upward\n                ctx.fillStyle = colors.green\n                ctx.fillRect(x, axisY - hpHeight, effectiveBarWidth, hpHeight)\n\n                // Draw red (damage taken) above green\n                ctx.fillStyle = colors.red\n                ctx.fillRect(x, offsetY, effectiveBarWidth, damageHeight)\n\n                // Resources bar (lower square, grows DOWN from axis)\n                // Blue near axis, yellow away from axis\n                const resHeight = (charData.resourcePercent / 100) * 100\n                const usedHeight = 100 - resHeight\n\n                // Draw blue (remaining resources) from axis downward\n                ctx.fillStyle = colors.blue\n                ctx.fillRect(x, axisY, effectiveBarWidth, resHeight)\n\n                // Draw yellow (used resources) below blue\n                ctx.fillStyle = colors.yellow\n                ctx.fillRect(x, axisY + resHeight, effectiveBarWidth, usedHeight)\n            })\n\n            // Draw X-axis labels (every 20 buckets)\n            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)'\n            ctx.font = '8px sans-serif'\n            ctx.textAlign = 'center'\n            for (let i = 0; i <= numBuckets; i += 20) {\n                const x = offsetX + (i - 1) * effectiveBucketWidth + effectiveBucketWidth / 2\n                ctx.fillText(`P${i}`, x, offsetY + 215)\n            }\n        })\n\n        // Draw legend\n        const legendY = height - 15\n        const legendItems = [\n            { color: colors.green, label: 'HP (remaining)' },\n            { color: colors.red, label: 'Damage taken' },\n            { color: colors.blue, label: 'Resources (remaining)' },\n            { color: colors.yellow, label: 'Resources used' }\n        ]\n\n        legendItems.forEach((item, idx) => {\n            const x = padding.left + idx * 100\n            ctx.fillStyle = item.color\n            ctx.fillRect(x, legendY, 12, 12)\n            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)'\n            ctx.font = '11px sans-serif'\n            ctx.textAlign = 'left'\n            ctx.fillText(item.label, x + 18, legendY + 10)\n        })\n\n    }, [skyline, players])\n\n    const canvasWidth = 1200 // Wide enough for 100 buckets side-by-side\n    const playersPerRow = Math.ceil(Math.sqrt(players.length))\n    const canvasHeight = 50 + (playersPerRow * 270) // 200px bars + 60px labels + spacing per row\n\n    return (\n        <div className={styles.skylineHeatmap}>\n            <h4>Skyline Heatmap (All 100 Buckets)</h4>\n            <canvas\n                ref={canvasRef}\n                width={canvasWidth}\n                height={canvasHeight}\n                className={styles.canvas}\n            />\n        </div>\n    )\n}\n\nexport default SkylineHeatmap\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/SkylineSpectrogram.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'patternDensity' is assigned a value but never used.","line":54,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * SkylineSpectrogram - Main container for Skyline visualization\n *\n * Assembles:\n * - 4 HPSkyline charts (one per character)\n * - 4 ResourceSkyline charts (one per character)\n * - 4 DeathBar overlays\n * - CrosshairLine (synchronized across all charts)\n * - BalancerBandOverlay (target zones)\n * - AccessibilityToggle (high-contrast mode)\n */\n\nimport React, { memo, useMemo } from 'react';\nimport { CrosshairProvider, useCrosshairBucketRegistration } from './CrosshairContext';\nimport { AccessibilityProvider, useAccessibility } from './AccessibilityContext';\nimport HPSkyline from './HPSkyline';\nimport ResourceSkyline from './ResourceSkyline';\nimport DeathBar from './DeathBar';\nimport CrosshairLine from './CrosshairLine';\nimport BalancerBandOverlay from './BalancerBandOverlay';\nimport AccessibilityToggle from './AccessibilityToggle';\nimport { SkylineAnalysis } from '@/model/skylineTypes';\nimport styles from './skylineSpectrogram.module.scss';\n\nexport interface SkylineSpectrogramProps {\n    /** Skyline data from WASM analysis */\n    data: SkylineAnalysis;\n    /** Chart width (default: 600px) */\n    width?: number;\n    /** Chart height (default: 200px) */\n    height?: number;\n    /** Current encounter tier for balancer overlay */\n    encounterTier?: 'Safe' | 'Challenging' | 'Boss' | 'Failed';\n    /** Show balancer band overlay */\n    showBalancerBand?: boolean;\n    /** Show accessibility controls */\n    showAccessibilityControls?: boolean;\n    /** Additional className */\n    className?: string;\n}\n\n/**\n * Inner component with providers\n */\nconst SkylineSpectrogramInner: React.FC<SkylineSpectrogramProps> = memo(({\n    data,\n    width = 600,\n    height = 200,\n    encounterTier = 'Challenging',\n    showBalancerBand = true,\n    showAccessibilityControls = true,\n    className,\n}) => {\n    const { highContrast, patternDensity } = useAccessibility();\n\n    // Register bucket data for crosshair tooltips\n    useCrosshairBucketRegistration('skyline-main', data.buckets);\n\n    // Calculate chart dimensions\n    const chartWidth = width;\n    const chartHeight = height;\n\n    // Extract character data\n    const characters = useMemo(() => {\n        if (data.buckets.length === 0) return [];\n        const firstBucket = data.buckets[0];\n        return firstBucket.characters;\n    }, [data.buckets]);\n\n    // Transform data for each character\n    const characterHPData = useMemo(() => {\n        return characters.map(char => {\n            return data.buckets.map(bucket => {\n                const charData = bucket.characters.find(c => c.id === char.id);\n                return charData || {\n                    name: char.name,\n                    id: char.id,\n                    maxHp: char.maxHp || 100,\n                    hpPercent: 100,\n                    resourcePercent: 100,\n                    resourceBreakdown: char.resourceBreakdown,\n                    deathRound: null,\n                    isDead: false,\n                };\n            });\n        });\n    }, [data.buckets, characters]);\n\n    const characterResourceData = useMemo(() => {\n        return characters.map(char => {\n            return data.buckets.map(bucket => {\n                const charData = bucket.characters.find(c => c.id === char.id);\n                return charData || {\n                    name: char.name,\n                    id: char.id,\n                    maxHp: char.maxHp || 100,\n                    hpPercent: 100,\n                    resourcePercent: 100,\n                    resourceBreakdown: char.resourceBreakdown,\n                    deathRound: null,\n                    isDead: false,\n                };\n            });\n        });\n    }, [data.buckets, characters]);\n\n    // Default colors (Okabe-Ito palette)\n    const colors = {\n        hp: {\n            low: '#d73027',     // Red (0%)\n            midLow: '#fc8d59',  // Orange-Red (25%)\n            mid: '#f0f0f0',     // Off-white (50%)\n            midHigh: '#91bfdb', // Light Blue (75%)\n            high: '#4575b4',    // Deep Blue (100%)\n        },\n        resources: {\n            low: '#d73027',\n            midLow: '#fc8d59',\n            mid: '#f0f0f0',\n            midHigh: '#91bfdb',\n            high: '#4575b4',\n        },\n    };\n\n    return (\n        <div className={`${styles.skylineSpectrogram} ${highContrast ? styles.highContrast : ''} ${className || ''}`}>\n            {/* Header with controls */}\n            <div className={styles.header}>\n                <h3 className={styles.title}>\n                    {data.encounterIndex !== null\n                        ? `Encounter ${data.encounterIndex + 1} Skyline`\n                        : 'Skyline Analysis'}\n                </h3>\n                <span className={styles.subtitle}>\n                    {data.totalRuns} iterations  {data.partySize} characters\n                </span>\n            </div>\n\n            {/* Accessibility controls */}\n            {showAccessibilityControls && (\n                <div className={styles.accessibilitySection}>\n                    <AccessibilityToggle />\n                </div>\n            )}\n\n            {/* Charts grid */}\n            <div className={styles.chartsGrid}>\n                {characters.map((char, idx) => (\n                    <div key={char.id} className={styles.characterColumn}>\n                        {/* Character name */}\n                        <div className={styles.characterName}>{char.name}</div>\n\n                        {/* HP Skyline */}\n                        <div className={styles.chartRow}>\n                            <span className={styles.chartLabel}>HP</span>\n                            <div className={styles.chartWrapper}>\n                                <HPSkyline\n                                    data={characterHPData[idx]}\n                                    characterName={char.name}\n                                    characterId={char.id}\n                                    width={chartWidth}\n                                    height={chartHeight / 2 - 10}\n                                    colors={colors.hp}\n                                />\n                                <DeathBar\n                                    data={characterHPData[idx]}\n                                    width={chartWidth}\n                                />\n                                {showBalancerBand && (\n                                    <BalancerBandOverlay\n                                        width={chartWidth}\n                                        height={chartHeight / 2 - 10}\n                                        tier={encounterTier}\n                                        showOutOfRange={true}\n                                        bucketData={data.buckets.map((b, i) => ({\n                                            bucketIndex: i + 1,\n                                            value: b.characters.find(c => c.id === char.id)?.hpPercent || 100,\n                                        }))}\n                                    />\n                                )}\n                                <CrosshairLine\n                                    width={chartWidth}\n                                    height={chartHeight / 2 - 10}\n                                    chartId={`hp-${char.id}`}\n                                />\n                            </div>\n                        </div>\n\n                        {/* Resource Skyline */}\n                        <div className={styles.chartRow}>\n                            <span className={styles.chartLabel}>RES</span>\n                            <div className={styles.chartWrapper}>\n                                <ResourceSkyline\n                                    data={characterResourceData[idx]}\n                                    characterName={char.name}\n                                    characterId={char.id}\n                                    width={chartWidth}\n                                    height={chartHeight / 2 - 10}\n                                    colors={colors.resources}\n                                />\n                                <DeathBar\n                                    data={characterResourceData[idx]}\n                                    width={chartWidth}\n                                />\n                                {showBalancerBand && (\n                                    <BalancerBandOverlay\n                                        width={chartWidth}\n                                        height={chartHeight / 2 - 10}\n                                        tier={encounterTier}\n                                        showOutOfRange={true}\n                                        bucketData={data.buckets.map((b, i) => ({\n                                            bucketIndex: i + 1,\n                                            value: b.characters.find(c => c.id === char.id)?.resourcePercent || 100,\n                                        }))}\n                                    />\n                                )}\n                                <CrosshairLine\n                                    width={chartWidth}\n                                    height={chartHeight / 2 - 10}\n                                    chartId={`res-${char.id}`}\n                                />\n                            </div>\n                        </div>\n                    </div>\n                ))}\n            </div>\n\n            {/* Legend */}\n            <div className={styles.legend}>\n                <span className={styles.legendItem}>\n                    <span className={`${styles.legendColor} ${styles.legendLow}`}></span>\n                    0% (Depleted)\n                </span>\n                <span className={styles.legendItem}>\n                    <span className={`${styles.legendColor} ${styles.legendMid}`}></span>\n                    50% (Half)\n                </span>\n                <span className={styles.legendItem}>\n                    <span className={`${styles.legendColor} ${styles.legendHigh}`}></span>\n                    100% (Full)\n                </span>\n                {highContrast && (\n                    <span className={styles.legendItem}>\n                        <span className={styles.legendPattern}></span>\n                        Pattern Overlay\n                    </span>\n                )}\n            </div>\n        </div>\n    );\n});\n\nSkylineSpectrogramInner.displayName = 'SkylineSpectrogramInner';\n\n/**\n * SkylineSpectrogram container with providers\n */\nconst SkylineSpectrogram: React.FC<SkylineSpectrogramProps> = memo((props) => {\n    return (\n        <CrosshairProvider>\n            <AccessibilityProvider initialHighContrast={false}>\n                <SkylineSpectrogramInner {...props} />\n            </AccessibilityProvider>\n        </CrosshairProvider>\n    );\n});\n\nSkylineSpectrogram.displayName = 'SkylineSpectrogram';\n\nexport default SkylineSpectrogram;\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/adventuringDayForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onEditingChange' is defined but never used.","line":64,"column":104,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":119},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":220,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":220,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":242,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":242,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":279,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":279,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":304,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":304,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useState, useEffect, useCallback } from \"react\"\nimport { Creature, CreatureSchema, TimelineEvent, TimelineEventSchema } from \"@/model/model\"\nimport styles from './adventuringDayForm.module.scss'\nimport { z } from 'zod'\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faDownload, faSave, faTrash, faUpload, faPlus, faPen, faTimes, faBed } from \"@fortawesome/free-solid-svg-icons\"\nimport { PlayerTemplates } from \"@/data/data\"\nimport { getMonster } from \"@/data/monsters\"\nimport Modal from \"../utils/modal\"\nimport Checkbox from \"@/utils/checkbox\"\nimport PlayerForm from \"../creatureForm/playerForm\"\nimport { v4 as uuidv4 } from 'uuid';\nimport MonsterForm from \"../creatureForm/monsterForm\"\nimport { clone } from \"@/model/utils\"\n\n// Sanitization utility: regenerate all creature IDs to prevent duplicates\nfunction sanitizeSaveData(players: Creature[], timeline: TimelineEvent[]): { players: Creature[], timeline: TimelineEvent[] } {\n    // Sanitize players - regenerate IDs for duplicates\n    const playerIds = new Set<string>();\n    const sanitizedPlayers = players.map(p => {\n        if (playerIds.has(p.id)) {\n            return { ...p, id: uuidv4() };\n        }\n        playerIds.add(p.id);\n        return p;\n    });\n\n    // Sanitize timeline monsters - regenerate IDs for duplicates\n    const sanitizedTimeline = timeline.map(item => {\n        if (item.type !== 'combat') return item;\n\n        const monsterIds = new Set<string>();\n        const sanitizedMonsters = item.monsters.map(m => {\n            if (monsterIds.has(m.id)) {\n                return { ...m, id: uuidv4() };\n            }\n            monsterIds.add(m.id);\n            return m;\n        });\n\n        return { ...item, monsters: sanitizedMonsters };\n    });\n\n    return { players: sanitizedPlayers, timeline: sanitizedTimeline };\n}\n\ntype PropType = {\n    currentPlayers: Creature[],\n    currentTimeline: TimelineEvent[],\n    onCancel: () => void,\n    onApplyChanges: (newPlayers: Creature[], newTimeline: TimelineEvent[]) => void,\n    onEditingChange?: (isEditing: boolean) => void,\n}\n\nconst SaveFileSchema = z.object({\n    updated: z.number(),\n    name: z.string(),\n    filename: z.string().optional(),\n    players: z.array(CreatureSchema),\n    timeline: z.array(TimelineEventSchema),\n})\ntype SaveFile = z.infer<typeof SaveFileSchema>\n\nconst AdventuringDayForm: FC<PropType> = ({ currentPlayers, currentTimeline, onCancel, onApplyChanges, onEditingChange }) => {\n    const [editedPlayers, setEditedPlayers] = useState<Creature[]>(currentPlayers);\n    const [editedTimeline, setEditedTimeline] = useState<TimelineEvent[]>(currentTimeline);\n    const [saveName, setSaveName] = useState(\"\");\n    const [error, setError] = useState<string | null>(null);\n    const [loading, setLoading] = useState(false);\n    const [savedDays, setSavedDays] = useState<SaveFile[]>([]);\n    \n    const [editingPlayer, setEditingPlayer] = useState<Creature | null>(null);\n    const [editingMonster, setEditingMonster] = useState<Creature | null>(null);\n    const [editingMonsterEncounterIndex, setEditingMonsterEncounterIndex] = useState<number | null>(null);\n\n    const fetchSaves = useCallback(async () => {\n        setLoading(true);\n        try {\n            const response = await fetch('/api/adventuring-days');\n            if (response.ok) {\n                const data = await response.json();\n                setSavedDays(data);\n            }\n        } catch (e) {\n            console.error(\"Failed to fetch saves:\", e);\n        } finally {\n            setLoading(false);\n        }\n    }, []);\n\n    useEffect(() => {\n        fetchSaves();\n    }, [fetchSaves]);\n\n    // Sync external changes\n    useEffect(() => {\n        setEditedPlayers(currentPlayers);\n    }, [currentPlayers]);\n\n    useEffect(() => {\n        setEditedTimeline(currentTimeline);\n    }, [currentTimeline]);\n\n    function addPlayer() {\n        const newPlayer = PlayerTemplates.barbarian(1, { gwm: false, weaponBonus: 0 }); \n        newPlayer.id = uuidv4();\n        setEditedPlayers([...editedPlayers, newPlayer]);\n    }\n\n    function updatePlayer(updatedPlayer: Creature) {\n        setEditedPlayers(editedPlayers.map(p => p.id === updatedPlayer.id ? updatedPlayer : p));\n        setEditingPlayer(null); \n    }\n\n    function removePlayer(id: string) {\n        setEditedPlayers(editedPlayers.filter(p => p.id !== id));\n    }\n\n    function addEncounter() {\n        const newEncounter: TimelineEvent = {\n            type: 'combat',\n            id: uuidv4(),\n            monsters: [],\n            playersSurprised: false,\n            monstersSurprised: false,\n            playersPrecast: false,\n            monstersPrecast: false,\n            targetRole: 'Standard',\n        };\n        setEditedTimeline([...editedTimeline, newEncounter]);\n    }\n\n    function addShortRest() {\n        const newRest: TimelineEvent = {\n            type: 'shortRest',\n            id: uuidv4(),\n        };\n        setEditedTimeline([...editedTimeline, newRest]);\n    }\n\n    function updateTimelineItem(index: number, updatedEvent: TimelineEvent) {\n        setEditedTimeline(editedTimeline.map((e, i) => i === index ? updatedEvent : e));\n    }\n\n    function removeTimelineItem(index: number) {\n        setEditedTimeline(editedTimeline.filter((_, i) => i !== index));\n    }\n\n    function swapTimelineItems(idx1: number, idx2: number) {\n        if (idx1 < 0 || idx1 >= editedTimeline.length || idx2 < 0 || idx2 >= editedTimeline.length) return;\n        const newTimeline = [...editedTimeline];\n        [newTimeline[idx1], newTimeline[idx2]] = [newTimeline[idx2], newTimeline[idx1]];\n        setEditedTimeline(newTimeline);\n    }\n\n    function addMonsterToEncounter(timelineIndex: number) {\n        const item = editedTimeline[timelineIndex];\n        if (item?.type !== 'combat') return;\n\n        const bandit = getMonster('Bandit');\n        if (!bandit) return;\n        const newMonster = clone(bandit);\n        newMonster.id = uuidv4();\n        \n        const updatedTimeline = editedTimeline.map((event, i) => {\n            if (i === timelineIndex && event.type === 'combat') {\n                return { ...event, monsters: [...event.monsters, newMonster] };\n            }\n            return event;\n        });\n        setEditedTimeline(updatedTimeline);\n    }\n\n    function updateMonsterInEncounter(timelineIndex: number, updatedMonster: Creature) {\n        const updatedTimeline = editedTimeline.map((event, i) => {\n            if (i === timelineIndex && event.type === 'combat') {\n                return {\n                    ...event,\n                    monsters: event.monsters.map(m => m.id === updatedMonster.id ? updatedMonster : m)\n                };\n            }\n            return event;\n        });\n        setEditedTimeline(updatedTimeline);\n        setEditingMonster(null); \n        setEditingMonsterEncounterIndex(null);\n    }\n\n    function removeMonsterFromEncounter(timelineIndex: number, monsterId: string) {\n        const updatedTimeline = editedTimeline.map((event, i) => {\n            if (i === timelineIndex && event.type === 'combat') {\n                return {\n                    ...event,\n                    monsters: event.monsters.filter(m => m.id !== monsterId)\n                };\n            }\n            return event;\n        });\n        setEditedTimeline(updatedTimeline);\n    }\n\n    const isValidSaveName = !!saveName\n\n    async function applyAndSave() {\n        onApplyChanges(editedPlayers, editedTimeline);\n        \n        if (isValidSaveName) {\n            try {\n                await fetch('/api/adventuring-days', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        updated: Date.now(),\n                        name: saveName,\n                        players: editedPlayers,\n                        timeline: editedTimeline,\n                    })\n                })\n                fetchSaves()\n            } catch (e) {\n                setError('Failed to save')\n            }\n        }\n    }\n\n    function loadSavedDay(save: SaveFile) {\n        const sanitized = sanitizeSaveData(save.players, save.timeline);\n        setEditedPlayers(sanitized.players);\n        setEditedTimeline(sanitized.timeline);\n        setSaveName(save.name);\n        onApplyChanges(sanitized.players, sanitized.timeline);\n    }\n\n    async function deleteSave(filename: string) {\n        try {\n            const response = await fetch(`/api/adventuring-days/${filename}`, {\n                method: 'DELETE'\n            })\n            if (response.ok) {\n                fetchSaves()\n            }\n        } catch (e) {\n            setError('Failed to delete')\n        }\n    }\n\n    async function onDownload() {\n        const newSaveFile: SaveFile = {\n            updated: Date.now(),\n            name: saveName,\n            players: editedPlayers,\n            timeline: editedTimeline,\n        }\n\n        const file = new Blob([JSON.stringify(newSaveFile)], { type: 'json' })\n        const a = document.createElement(\"a\")\n        const url = URL.createObjectURL(file)\n        a.href = url\n        a.download = `${newSaveFile.name}.json`\n        document.body.appendChild(a)\n        a.click()\n        setTimeout(() => {\n            document.body.removeChild(a)\n            window.URL.revokeObjectURL(url)\n        }, 0)\n    }\n\n    async function onUpload(files: FileList | null) {\n        if (!files || !files.length) { setError('No files uploaded'); return }\n\n        const file = files[0]\n        if (!file) { setError('No file uploaded'); return }\n\n        const json = await file.text()\n        if (!json) return\n\n        let obj\n        try { obj = JSON.parse(json) }\n        catch (e) { setError('File is not valid JSON'); return }\n\n        const parsed = SaveFileSchema.safeParse(obj)\n        if (!parsed.success) { setError('Invalid schema'); return }\n\n        const newSave: SaveFile = parsed.data\n\n        // Sanitize data to prevent duplicate IDs\n        const sanitized = sanitizeSaveData(newSave.players, newSave.timeline);\n\n        try {\n            await fetch('/api/adventuring-days', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    name: newSave.name,\n                    players: sanitized.players,\n                    timeline: sanitized.timeline,\n                })\n            })\n            fetchSaves()\n            onApplyChanges(sanitized.players, sanitized.timeline)\n            setEditedPlayers(sanitized.players);\n            setEditedTimeline(sanitized.timeline);\n            setSaveName(newSave.name);\n        } catch (e) {\n            setError('Failed to upload')\n        }\n    }\n\n\n    return (\n        <Modal onCancel={onCancel} className={styles.adventuringDayEditor}>\n            <h1>Adventuring Day Editor</h1>\n\n            {/* Save/Load Toolbar */}\n            <section className={styles.toolbar}>\n                <h3>Save Name:</h3>\n                <input type=\"text\" value={saveName} onChange={e => setSaveName(e.target.value)} />\n                <button disabled={!isValidSaveName} onClick={applyAndSave}>\n                    <FontAwesomeIcon icon={faSave} /> Save\n                </button>\n                <button className=\"tooltipContainer\" onClick={onDownload}>\n                    <FontAwesomeIcon icon={faDownload} /> Download\n                </button>\n                <label htmlFor=\"file\" className=\"tooltipContainer\">\n                    <FontAwesomeIcon icon={faUpload} /> Upload\n                </label>\n                <input\n                    type=\"file\"\n                    id=\"file\"\n                    accept=\"application/json\"\n                    style={{ display: \"none\" }}\n                    onChange={(e) => onUpload(e.target.files)} />\n            </section>\n\n            {/* Existing Save Files List */}\n            <section className={styles.saveFilesList}>\n                <h3>Saved Days:</h3>\n                {loading ? <p>Loading saves...</p> : \n                 savedDays.length === 0 ? <p>No saved adventuring days found.</p> :\n                 savedDays.map(save => (\n                    <div key={save.name} className={styles.saveItem}>\n                        <span>{save.name} ({new Date(save.updated).toLocaleDateString()})</span>\n                        <button onClick={() => loadSavedDay(save)}>Load</button>\n                        <button onClick={() => deleteSave(save.filename || save.name)}>Delete</button>\n                    </div>\n                ))}\n            </section>\n\n            {/* Players Section */}\n            <section className={styles.playersSection}>\n                <h2>Players</h2>\n                <button onClick={addPlayer}><FontAwesomeIcon icon={faPlus} /> Add Player</button>\n                <div className={styles.playerList}>\n                    {editedPlayers.map(player => (\n                        <div key={player.id} className={styles.playerItem}>\n                            <span>{player.name} (Lvl {player.class?.level} {player.class?.type})</span>\n                            <button onClick={() => setEditingPlayer(player)}><FontAwesomeIcon icon={faPen} /> Edit</button>\n                            <button onClick={() => removePlayer(player.id)}><FontAwesomeIcon icon={faTimes} /> Remove</button>\n                        </div>\n                    ))}\n                </div>\n            </section>\n\n            {/* Timeline Section */}\n            <section className={styles.encountersSection}>\n                <h2>Timeline</h2>\n                <div className={styles.timelineControls}>\n                    <button onClick={addEncounter}><FontAwesomeIcon icon={faPlus} /> Add Combat</button>\n                    <button onClick={addShortRest} className={styles.restBtn}><FontAwesomeIcon icon={faBed} /> Add Short Rest</button>\n                </div>\n                \n                <div className={styles.encounterList}>\n                    {editedTimeline.map((item, index) => (\n                        <div key={item.id} className={item.type === 'combat' ? styles.encounterItem : styles.restItem}>\n                            <div className={styles.itemHeader}>\n                                <h3>{item.type === 'combat' ? `Encounter ${index + 1}` : 'Short Rest'}</h3>\n                                <div className={styles.itemControls}>\n                                    <button onClick={() => swapTimelineItems(index, index - 1)} disabled={index === 0}></button>\n                                    <button onClick={() => swapTimelineItems(index, index + 1)} disabled={index === editedTimeline.length - 1}></button>\n                                    <button onClick={() => removeTimelineItem(index)} className={styles.deleteBtn}><FontAwesomeIcon icon={faTrash} /></button>\n                                </div>\n                            </div>\n\n                            {item.type === 'combat' ? (\n                                <>\n                                    <div className={styles.encounterSettings}>\n                                        <Checkbox value={item.playersSurprised || false} onToggle={() => updateTimelineItem(index, { ...item, playersSurprised: !item.playersSurprised })}>Players Surprised</Checkbox>\n                                        <Checkbox value={item.monstersSurprised || false} onToggle={() => updateTimelineItem(index, { ...item, monstersSurprised: !item.monstersSurprised })}>Monsters Surprised</Checkbox>\n                                        <Checkbox value={item.playersPrecast || false} onToggle={() => updateTimelineItem(index, { ...item, playersPrecast: !item.playersPrecast })}>Players Precast</Checkbox>\n                                        <Checkbox value={item.monstersPrecast || false} onToggle={() => updateTimelineItem(index, { ...item, monstersPrecast: !item.monstersPrecast })}>Monsters Precast</Checkbox>\n                                    </div>\n                                    <h4>Monsters</h4>\n                                    <button onClick={() => addMonsterToEncounter(index)}><FontAwesomeIcon icon={faPlus} /> Add Monster</button>\n                                    <div className={styles.monsterList}>\n                                        {item.monsters.map(monster => (\n                                            <div key={monster.id} className={styles.monsterItem}>\n                                                <span>{monster.name} (x{monster.count})</span>\n                                                <button onClick={() => { setEditingMonster(monster); setEditingMonsterEncounterIndex(index); }}><FontAwesomeIcon icon={faPen} /> Edit</button>\n                                                <button onClick={() => removeMonsterFromEncounter(index, monster.id)}><FontAwesomeIcon icon={faTimes} /> Remove</button>\n                                            </div>\n                                        ))}\n                                    </div>\n                                </>\n                            ) : (\n                                <div className={styles.restBody}>\n                                    <p><FontAwesomeIcon icon={faBed} size=\"2x\" /></p>\n                                    <p>Standard 1-hour rest. Characters spend Hit Dice to recover HP and reset \"Short Rest\" resources.</p>\n                                </div>\n                            )}\n                        </div>\n                    ))}\n                </div>\n            </section>\n\n            {/* Player Edit Modal */}\n            {editingPlayer && (\n                <Modal onCancel={() => setEditingPlayer(null)}>\n                    <PlayerForm value={editingPlayer} onChange={updatePlayer} />\n                </Modal>\n            )}\n\n            {/* Monster Edit Modal */}\n            {editingMonster && editingMonsterEncounterIndex !== null && (\n                <Modal onCancel={() => { setEditingMonster(null); setEditingMonsterEncounterIndex(null); }}>\n                    <MonsterForm value={editingMonster} onChange={(updatedMonster) => updateMonsterInEncounter(editingMonsterEncounterIndex, updatedMonster)} />\n                </Modal>\n            )}\n\n            {(error !== null) ? (\n                <div className={styles.error}>\n                    {error}\n                </div>\n            ) : null}\n        </Modal>\n    )\n}\n\nexport default AdventuringDayForm","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/battleCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/decileAnalysis.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MedianPerformanceDisplay' is defined but never used.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { FC, memo, useState } from \"react\"\nimport { AggregateOutput } from \"@/model/model\"\nimport BattleCard from \"./battleCard\"\nimport styles from './decileAnalysis.module.scss'\nimport { useUIToggles, UIToggleType } from \"@/model/uiToggleState\"\nimport { EncounterRating, MedianPerformanceDisplay } from \"./AnalysisComponents\"\n\ntype PropType = {\n    analysis: AggregateOutput | null,\n    isPreliminary?: boolean\n}\n\nconst DecileAnalysis: FC<PropType> = memo(({ analysis, isPreliminary }) => {\n    const { getToggleState } = useUIToggles()\n    const [isExpanded, setIsExpanded] = useState(false)\n\n    if (!analysis) {\n        return (\n            <div className={styles.decileAnalysis}>\n                <h3>Decile Analysis</h3>\n                <p>Run simulations to see decile analysis...</p>\n            </div>\n        )\n    }\n\n    const visibleDeciles = (analysis.deciles || []).filter(decile => {\n        const toggleId = `quintile-${decile.decile}` as UIToggleType\n        return getToggleState(toggleId)\n    })\n\n    return (\n        <div className={styles.decileAnalysis}>\n            <div className={styles.adventuringDayHeader}>\n                <h2> Adventuring Day Summary</h2>\n            </div>\n            \n            <EncounterRating analysis={analysis} isPreliminary={isPreliminary} label=\"Day Rating\" />\n            {/* MedianPerformanceDisplay hidden per user preference */}\n\n            <div className={styles.analysisHeader}>\n                <button\n                    className={styles.expandToggle}\n                    onClick={() => setIsExpanded(!isExpanded)}\n                >\n                    {isExpanded ? '' : ''} {isExpanded ? 'Hide' : 'Show'} Full 10-Timeline Dashboard\n                </button>\n                <div className={styles.analysisSummary}>\n                    <span>Based on {analysis.totalRuns} simulation runs</span>\n                </div>\n            </div>\n\n            {isExpanded && (\n                <div className={styles.analysisContent}>\n                    <h3>10-Timeline Dashboard: {analysis.scenarioName}</h3>\n                    {visibleDeciles.length === 0 ? (\n                        <div className={styles.emptyState}>\n                            <p>All deciles are hidden</p>\n                            <p className={styles.emptyHint}>Use the UI controls to show specific deciles</p>\n                        </div>\n                    ) : (\n                        <div className={styles.battleCards}>\n                            {visibleDeciles.map((decile) => (\n                                <BattleCard key={decile.decile} decile={decile} />\n                            ))}\n                        </div>\n                    )}\n                    {visibleDeciles.length !== (analysis.deciles || []).length && (\n                        <div className={styles.analysisSummary}>\n                            <p className={styles.visibilityNote}>\n                                Showing {visibleDeciles.length} of {(analysis.deciles || []).length} deciles\n                            </p>\n                        </div>\n                    )}\n                </div>\n            )}\n        </div>\n    )\n})\n\nexport default DecileAnalysis","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/encounterForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Range' is defined but never used.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7633,7636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7633,7636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, ReactNode, useState, memo } from \"react\"\nimport { Creature, Encounter, TargetRoleList } from \"@/model/model\"\nimport styles from './encounterForm.module.scss'\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronDown, faChevronUp, faPen, faPlus, faTrash, faMagicWandSparkles } from \"@fortawesome/free-solid-svg-icons\"\nimport CreatureForm from \"./../creatureForm/creatureForm\"\nimport { clone } from \"@/model/utils\"\nimport Checkbox from \"@/utils/checkbox\"\nimport Range from \"@/utils/range\"\nimport Select from \"react-select\"\n\ntype PropType = {\n    mode: 'player' | 'monster',\n    encounter: Encounter,\n    onUpdate: (newValue: Encounter) => void,\n    onDelete?: () => void,\n    onAutoAdjust?: () => void,\n    autoAdjustDisabled?: boolean,\n    children?: ReactNode,\n    onMoveUp?: () => void,\n    onMoveDown?: () => void,\n    onEditingChange?: (isEditing: boolean) => void,\n}\n\nconst EncounterForm: FC<PropType> = memo(({ mode, encounter, onUpdate, onDelete, onAutoAdjust, autoAdjustDisabled, children, onMoveUp, onMoveDown, onEditingChange }) => {\n    const [updating, setUpdating] = useState<number | null>(null)\n    const [creating, setCreating] = useState(false)\n\n    const handleSetUpdating = (index: number | null) => {\n        setUpdating(index);\n        onEditingChange?.(index !== null || creating);\n    };\n\n    const handleSetCreating = (isCreating: boolean) => {\n        setCreating(isCreating);\n        onEditingChange?.(updating !== null || isCreating);\n    };\n\n    function createCreature(creature: Creature) {\n        const encounterClone = clone(encounter)\n        // Generate a new UUID to prevent React key duplication\n        const newCreature = { ...creature, id: crypto.randomUUID() }\n        encounterClone.monsters.push(newCreature)\n        onUpdate(encounterClone)\n        handleSetCreating(false)\n    }\n\n    function updateCreature(index: number, newValue: Creature) {\n        const encounterClone = clone(encounter)\n        encounterClone.monsters[index] = newValue\n        onUpdate(encounterClone)\n        handleSetUpdating(null)\n    }\n\n    function deleteCreature(index: number) {\n        const encounterClone = clone(encounter)\n        encounterClone.monsters.splice(index, 1)\n        onUpdate(encounterClone)\n        handleSetUpdating(null)\n    }\n\n    function update(callback: (encounterClone: Encounter) => void) {\n        const encounterClone = clone(encounter)\n        callback(encounterClone)\n        onUpdate(encounterClone)\n    }\n\n    return (\n        <>\n            <div className={styles.encounterForm}>\n                <div className={styles.encounterActions}>\n                    {!!onDelete && (\n                        <button onClick={onDelete} aria-label=\"Delete encounter\">\n                            <FontAwesomeIcon icon={faTrash} />\n                        </button>\n                    )}\n                    {(onMoveUp || onMoveDown) && (\n                        <button onClick={onMoveUp} disabled={!onMoveUp} aria-label=\"Move encounter up\">\n                            <FontAwesomeIcon icon={faChevronUp} />\n                        </button>\n                    )}\n                    {(onMoveUp || onMoveDown) && (\n                        <button onClick={onMoveDown} disabled={!onMoveDown} aria-label=\"Move encounter down\">\n                            <FontAwesomeIcon icon={faChevronDown} />\n                        </button>\n                    )}\n                </div>\n\n                <h2 className={`${styles.header} ${(mode === \"player\") ? styles.player : styles.monster}`}>\n                    {(mode === 'player') ? 'Player Characters' : 'Encounter'}\n                </h2>\n\n                <div className={styles.formBody}>\n                    <div className={styles.creatures} data-testid=\"creature-list\">\n                        {encounter.monsters.map((creature, index) => (\n                            <div key={creature.id} className={styles.creature} data-testid=\"creature-item\">\n                                <span className={styles.name} data-testid=\"creature-name\">{creature.name}</span>\n                                <span className={styles.inlineInput}>\n                                    <label htmlFor={`count-${creature.id}`} className={styles.countLabel}>Count:</label>\n                                    <input\n                                        id={`count-${creature.id}`}\n                                        type='number'\n                                        min={1} max={20} step={1}\n                                        value={creature.count}\n                                        onChange={e => updateCreature(index, { ...creature, count: Math.max(0, Math.min(20, Math.round(Number(e.target.value)))) })}\n                                        aria-label={`${creature.name} count`}\n                                    />\n                                </span>\n                                {!children && <span className={styles.inlineInput}>\n                                    <label htmlFor={`arrival-${creature.id}`} className={styles.countLabel}>Arrives on round:</label>\n                                    <input\n                                        id={`arrival-${creature.id}`}\n                                        type='number'\n                                        min={1} max={19} step={1}\n                                        value={creature.arrival || 1}\n                                        onChange={e => updateCreature(index, { ...creature, arrival: Math.max(0, Math.min(20, Math.round(Number(e.target.value)))) })}\n                                        aria-label={`${creature.name} arrival round`}\n                                    />\n                                </span>}\n                                <button onClick={() => handleSetUpdating(index)} aria-label={`Edit ${creature.name}`}>\n                                    <FontAwesomeIcon icon={faPen} />\n                                    <span>Edit</span>\n                                </button>\n                                <button onClick={() => deleteCreature(index)} aria-label={`Delete ${creature.name}`} data-testid=\"remove-creature-btn\">\n                                    <FontAwesomeIcon icon={faTrash} />\n                                </button>\n                            </div>\n                        ))}\n                    </div>\n                    <div className={styles.encounterSettings}>\n                        {children || (encounter.monsters.length ? (\n                            <>\n                                <Checkbox value={!!encounter.playersSurprised} onToggle={() => update(e => { e.playersSurprised = !e.playersSurprised })}>\n                                    The players are surprised\n                                </Checkbox>\n                                <Checkbox value={!!encounter.monstersSurprised} onToggle={() => update(e => { e.monstersSurprised = !e.monstersSurprised })}>\n                                    The enemies are surprised\n                                </Checkbox>\n                                <div className={styles.roleSelection}>\n                                    <label>Encounter Role:</label>\n                                    <Select\n                                        className={styles.roleSelect}\n                                        value={{ value: encounter.targetRole || 'Standard', label: encounter.targetRole || 'Standard' }}\n                                        options={TargetRoleList.map(r => ({ value: r, label: r }))}\n                                        onChange={(val: any) => update(e => { e.targetRole = val?.value || 'Standard' })}\n                                    />\n                                </div>\n                            </>\n                        ) : null)}\n                    </div>\n                </div>\n\n                <div className={styles.formFooter}>\n                    <button className={styles.addCreatureBtn} onClick={() => handleSetCreating(true)} data-testid=\"add-creature-btn\">\n                        <FontAwesomeIcon icon={faPlus} />\n                        Add {(mode === 'player') ? 'Player Character' : 'Enemy'}\n                    </button>\n                    {mode === 'monster' && onAutoAdjust && (\n                        <button \n                            className={styles.autoAdjustBtn} \n                            onClick={onAutoAdjust}\n                            disabled={autoAdjustDisabled}\n                            title=\"Optimize this encounter's difficulty automatically\"\n                        >\n                            <FontAwesomeIcon icon={faMagicWandSparkles} />\n                            Auto-Adjust\n                        </button>\n                    )}\n                </div>\n            </div>\n\n            {(updating === null) ? null : (\n                <CreatureForm\n                    initialMode={mode}\n                    initialValue={encounter.monsters[updating]}\n                    onCancel={() => handleSetUpdating(null)}\n                    onSubmit={(newValue) => updateCreature(updating, newValue)}\n                    onDelete={() => deleteCreature(updating)}\n                />\n            )}\n\n            {!creating ? null : (\n                <CreatureForm\n                    initialMode={mode}\n                    onCancel={() => handleSetCreating(false)}\n                    onSubmit={createCreature}\n                />\n            )}\n        </>\n    )\n})\n\nexport default EncounterForm","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/encounterResult.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[453,456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[453,456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { render, screen } from '@testing-library/react';\nimport EncounterResult from './encounterResult';\nimport React from 'react';\nimport { UIToggleProvider } from '@/model/uiToggleState';\n\ndescribe('EncounterResult Component', () => {\n    const mockValue = {\n        stats: new Map(),\n        rounds: [\n            {\n                team1: [],\n                team2: []\n            }\n        ]\n    } as any;\n\n    it('should render the component', () => {\n        render(\n            <UIToggleProvider>\n                <EncounterResult value={mockValue} />\n            </UIToggleProvider>\n        );\n        expect(screen.getByText(/Detailed Analysis/i)).toBeDefined();\n    });\n\n    it('should render DeltaBadge when props are provided', () => {\n        render(\n            <UIToggleProvider>\n                <EncounterResult \n                    value={mockValue} \n                    targetPercent={25} \n                    actualPercent={30} \n                />\n            </UIToggleProvider>\n        );\n        // Delta = 30 - 25 = +5% (On Target)\n        expect(screen.getByText(/On Target/i)).toBeDefined();\n        expect(screen.getByText(/\\+5%/)).toBeDefined();\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/encounterResult.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PlayerSlot' is defined but never used.","line":2,"column":147,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":157},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkylineAnalysis' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getActionLabel' is defined but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTargetPrefix' is defined but never used.","line":42,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'combattantAction' is defined but never used.","line":42,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'stats' is defined but never used.","line":47,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onHighlight' is defined but never used.","line":47,"column":83,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":94},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTarget' is defined but never used.","line":48,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getBuffEffect' is defined but never used.","line":70,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hpBarsVisible' is assigned a value but never used.","line":135,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":135,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setHpBarsVisible' is assigned a value but never used.","line":135,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":135,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useState, memo, useMemo } from \"react\"\nimport { Combattant, EncounterResult as EncounterResultType, EncounterStats, FinalAction, Buff, DiceFormula, AggregateOutput, FullAnalysisOutput, PlayerSlot } from \"@/model/model\"\nimport ResourcePanel from \"./ResourcePanel\"\nimport ActionEconomyDisplay from \"./ActionEconomyDisplay\"\nimport styles from './encounterResult.module.scss'\nimport { Round } from \"@/model/model\"\nimport { clone } from \"@/model/utils\"\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faBrain } from \"@fortawesome/free-solid-svg-icons\"\nimport { useUIToggle } from \"@/model/uiToggleState\"\nimport { EncounterRating, VitalsDashboard, ValidationNotice } from \"./AnalysisComponents\"\nimport DeltaBadge from \"./DeltaBadge\"\nimport PartyOverview from \"./PartyOverview\"\nimport PlayerGraphs from \"./PlayerGraphs\"\nimport { SkylineAnalysis } from \"@/model/model\"\n\ntype TeamPropType = {\n    round: Round,\n    team: Combattant[],\n    stats?: Map<string, EncounterStats>,\n    highlightedIds?: string[],\n    onHighlight?: (targetIds: string[]) => void,\n}\n\n// Enhanced action label function that provides complete action descriptions\nfunction getActionLabel(combattantAction: { action: FinalAction, targets: Map<string, number> }): string {\n    const { action } = combattantAction\n    const actionName = action.name?.trim() || ''\n\n    switch (action.type) {\n        case 'atk':\n            return actionName ? `Attack ${actionName}` : 'Attack'\n        case 'heal':\n            return actionName || 'Heal'\n        case 'buff':\n            return actionName || 'Buff'\n        case 'debuff':\n            return actionName || 'Debuff'\n    }\n}\n\nfunction getTargetPrefix(combattantAction: { action: FinalAction, targets: Map<string, number> }): string {\n    return 'on'\n}\n\n\nconst TeamResults: FC<TeamPropType> = memo(({ round, team, stats, highlightedIds, onHighlight }) => {\n    function getTarget(combattantAction: { action: FinalAction, targets: Map<string, number> }) {\n        if (combattantAction.action.target === 'self') return 'itself'\n        const allCombattants = [...round.team1, ...round.team2]\n        const combattantMap = new Map(allCombattants.map(c => [c.id, c]))\n        const creatureMap = new Map(allCombattants.map(c => [c.creature.id, c]))\n\n        const targetNames = Array.from(combattantAction.targets.entries()).map(([targetId, count], index) => {\n            const targetCombattant = combattantMap.get(targetId) || creatureMap.get(targetId)\n            if (!targetCombattant) return `Target ${index + 1}`\n            const creatureName = targetCombattant.creature.name\n            return count === 1 ? creatureName : `${creatureName} x${count}`\n        }).filter(nullable => !!nullable)\n\n        return targetNames.join(' and ')\n    }\n\n    function getNumberWithSign(n: DiceFormula) {\n        let result = String(n)\n        if (!result.startsWith('-')) result = '+' + result\n        return ' ' + result\n    }\n\n    function getBuffEffect(buff: Buff) {\n        const buffEffects: string[] = []\n        if (buff.ac != undefined) buffEffects.push(getNumberWithSign(buff.ac) + ' AC')\n        if (buff.condition != undefined) buffEffects.push(' ' + buff.condition)\n        if (buff.damageMultiplier != undefined) buffEffects.push(' x' + buff.damageMultiplier + ' damage')\n        if (buff.toHit != undefined) buffEffects.push(getNumberWithSign(buff.toHit) + ' to hit')\n        return buffEffects.join(', ')\n    }\n\n    return (\n        <div className={styles.team}>\n            {team.map(combattant => (\n                <div\n                    key={combattant.id}\n                    className={`${styles.lifebar} tooltipContainer`}>\n                    <div className={`${styles.lifebarBackground} ${highlightedIds?.includes(combattant.id) ? styles.highlighted : ''}`}>\n                        <div\n                            className={styles.lifebarForeground}\n                            style={{\n                                width: `${100 * combattant.initialState.currentHp / (combattant.creature.hp + (combattant.initialState.tempHp || 0))}%`\n                            }}\n                        />\n                        {combattant.initialState.tempHp ? (\n                            <div\n                                className={styles.lifebarTHP}\n                                style={{\n                                    width: `${100 * combattant.initialState.tempHp / (combattant.creature.hp + combattant.initialState.tempHp)}%`,\n                                }}\n                            />\n                        ) : null}\n                        <div className={styles.lifebarLabel}>\n                            {combattant.initialState.currentHp}/{combattant.creature.hp}\n                            {combattant.initialState.tempHp ? `+${combattant.initialState.tempHp}` : null}\n                        </div>\n                    </div>\n                    <div className={styles.creatureName}>\n                        {combattant.creature.name}\n                        {combattant.finalState.concentratingOn ? (\n                            <span className={styles.concentrationIcon} title={`Concentrating on ${combattant.finalState.concentratingOn}`}>\n                                <FontAwesomeIcon icon={faBrain} />\n                            </span>\n                        ) : null}\n                    </div>\n                    <ResourcePanel combatant={combattant} />\n                </div>\n            ))}\n        </div>\n    )\n})\n\ntype PropType = {\n    value?: EncounterResultType,\n    analysis?: AggregateOutput | null,\n    fullAnalysis?: FullAnalysisOutput | null,\n    playerNames?: Map<string, string>,\n    isStale?: boolean,\n    isPreliminary?: boolean,\n    targetPercent?: number,\n    actualPercent?: number,\n    cumulativeDrift?: number,\n    isShortRest?: boolean,\n    targetRole?: string,\n}\n\nconst EncounterResult: FC<PropType> = memo(({ value, analysis, fullAnalysis, playerNames, isStale, isPreliminary, targetPercent, actualPercent, cumulativeDrift, isShortRest, targetRole }) => {\n    const [hpBarsVisible, setHpBarsVisible] = useUIToggle('hp-bars')\n    const [detailsExpanded, setDetailsExpanded] = useState(false)\n\n    const lastRound = useMemo(() => {\n        if (!value || !value.rounds.length) return null\n        const cloned = clone(value.rounds[value.rounds.length - 1])\n            ; ([...cloned.team1, ...cloned.team2]).forEach(combattant => {\n                combattant.initialState = combattant.finalState\n                combattant.actions = []\n            })\n        return cloned\n    }, [value])\n\n    if ((!value || !value.rounds.length) && !analysis) return <></>\n\n    const hasRounds = value && value.rounds.length > 0\n\n    return (\n        <div className={`${styles.encounterResult} ${isStale ? styles.stale : ''}`} data-testid=\"results-panel\">\n            {isStale && <div className={styles.staleBadge}>Out of Date</div>}\n            \n            {(targetPercent !== undefined && actualPercent !== undefined) && (\n                <DeltaBadge \n                    targetCost={targetPercent} \n                    actualCost={actualPercent} \n                    cumulativeDrift={cumulativeDrift}\n                />\n            )}\n\n            {fullAnalysis?.partySlots && fullAnalysis.partySlots.length > 0 && analysis?.skyline && (\n                <div className={styles.prioritizedSkyline}>\n                    {/* Party Overview - Prioritized */}\n                    <PartyOverview\n                        skyline={analysis.skyline}\n                        partySlots={fullAnalysis.partySlots}\n                        playerNames={playerNames}\n                        className=\"encounter-party-overview\"\n                    />\n                </div>\n            )}\n\n            {analysis && <VitalsDashboard analysis={analysis} isPreliminary={isPreliminary} />}\n\n            {analysis && (\n                <ValidationNotice \n                    analysis={analysis} \n                    targetRole={targetRole} \n                />\n            )}\n\n            <EncounterRating analysis={analysis || null} isPreliminary={isPreliminary} isShortRest={isShortRest} />\n\n            <div className={styles.detailsSection}>\n                {fullAnalysis?.partySlots && fullAnalysis.partySlots.length > 0 && analysis?.skyline && (\n                    <>\n                        {/* Individual Player Graphs - Moved here */}\n                        <PlayerGraphs\n                            skyline={analysis.skyline}\n                            partySlots={fullAnalysis.partySlots}\n                            playerNames={playerNames}\n                        />\n                    </>\n                )}\n\n                <button\n                    className={styles.detailsToggle}\n                    onClick={() => setDetailsExpanded(!detailsExpanded)}\n                >\n                    {detailsExpanded ? '' : ''} {detailsExpanded ? 'Hide' : 'Show'} Detailed Analysis\n                </button>\n\n                {detailsExpanded && hasRounds && value && lastRound && (\n                    <div className={styles.detailsContent}>\n                        <div className={styles.round}>\n                            <h3>Final State</h3>\n                            <ActionEconomyDisplay round={lastRound} />\n                            <div className={styles.lifebars}>\n                                <TeamResults round={lastRound} team={lastRound.team1} stats={value.stats} />\n                                <hr />\n                                <TeamResults round={lastRound} team={lastRound.team2} stats={value.stats} />\n                            </div>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    )\n})\n\nexport default EncounterResult","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/eventLog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useLayoutEffect' is defined but never used.","line":1,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":1,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'event' is defined but never used.","line":125,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":125,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useLayoutEffect, useRef, useMemo } from \"react\"\nimport { Virtuoso } from 'react-virtuoso'\nimport styles from './simulation.module.scss'\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faScroll, faFireFlameSimple } from \"@fortawesome/free-solid-svg-icons\"\n\ntype EventLogProps = {\n    events: string[] // String events from backend\n    title?: string\n}\n\n/**\n * Parse event text to apply semantic styling.\n * Patterns detected:\n * - Creature names (capitalized words at start, or before \"attacks\", \"misses\", \"takes\", etc.)\n * - Damage numbers (digits followed by \"damage\" or \"HP\")\n * - Healing amounts (digits in context of \"healed\")\n * - Keywords: \"CRIT\", \"HIT\", \"miss\"\n */\nfunction parseEventText(text: string): React.ReactNode {\n    // Split into parts and apply styling\n    const parts: React.ReactNode[] = []\n    let lastIndex = 0\n\n    // Pattern: number + (damage|HP) -> highlight as damage\n    const damageRegex = /(\\d+(?:\\.\\d+)?)\\s*(?:damage|HP)/gi\n    // Pattern: number + healed -> highlight as heal\n    const healRegex = /(\\d+(?:\\.\\d+)?)\\s*(?:healed|healing)/gi\n    // Pattern: creature name at start (Capitalized word)\n    const nameRegex = /^([A-Z][a-zA-Z]+(?:\\s+[A-Z][a-zA-Z]+)?)\\s+(attacks|misses|takes|is|casts|gains|falls|starts|skipped|uses)/\n    // Pattern: \"HIT\", \"miss\", \"CRIT\"\n    const keywordRegex = /\\b(CRIT|HIT|miss)\\b/g\n\n    let match\n    const matches: Array<{ start: number; end: number; type: string; content: string }> = []\n\n    // Find all damage matches\n    while ((match = damageRegex.exec(text)) !== null) {\n        matches.push({ start: match.index, end: match.index + match[0].length, type: 'damage', content: match[0] })\n    }\n    damageRegex.lastIndex = 0\n\n    // Find all heal matches\n    while ((match = healRegex.exec(text)) !== null) {\n        matches.push({ start: match.index, end: match.index + match[1].length, type: 'heal', content: match[1] })\n    }\n    healRegex.lastIndex = 0\n\n    // Find creature name at start\n    const nameMatch = text.match(nameRegex)\n    if (nameMatch) {\n        const name = nameMatch[1]\n        matches.push({ start: 0, end: name.length, type: 'name', content: name })\n    }\n\n    // Find keywords (HIT, CRIT, miss)\n    while ((match = keywordRegex.exec(text)) !== null) {\n        const keyword = match[0]\n        const type = keyword === 'miss' ? 'hit' : (keyword === 'CRIT' ? 'crit' : 'hit')\n        matches.push({ start: match.index, end: match.index + keyword.length, type, content: keyword })\n    }\n    keywordRegex.lastIndex = 0\n\n    // Sort matches by position\n    matches.sort((a, b) => a.start - b.start)\n\n    // Build parsed output\n    matches.forEach((m, i) => {\n        // Add text before this match\n        if (m.start > lastIndex) {\n            parts.push(text.slice(lastIndex, m.start))\n        }\n\n        // Add styled match (React auto-escapes content - no XSS risk)\n        const className = styles[m.type as keyof typeof styles] || ''\n        parts.push(<span key={i} className={className}>{m.content}</span>)\n\n        lastIndex = m.end\n    })\n\n    // Add remaining text\n    if (lastIndex < text.length) {\n        parts.push(text.slice(lastIndex))\n    }\n\n    return parts.length > 0 ? parts : text\n}\n\n// The Grimoire Log - Avant-garde event display with arcane aesthetic\nconst EventLog: FC<EventLogProps> = ({ events, title = \"Combat Chronicle\" }) => {\n    const eventCount = events.length\n\n    // Memoize parsed events to avoid re-parsing on every render\n    const parsedEvents = useMemo(() => {\n        return events.map(event => parseEventText(event))\n    }, [events])\n\n    return (\n        <div className={styles.grimoireLog}>\n            {/* Asymmetric header with ornamental flourish */}\n            <header className={styles.grimoireHeader}>\n                <div className={styles.grimoireTitleGroup}>\n                    <FontAwesomeIcon icon={faScroll} className={styles.quillIcon} aria-hidden=\"true\" />\n                    <div className={styles.titleColumn}>\n                        <h2 className={styles.grimoireTitle}>{title}</h2>\n                        <span className={styles.eventCounter}>{eventCount} entries inscribed</span>\n                    </div>\n                </div>\n            </header>\n\n            {/* Virtualized event list using react-virtuoso for performance */}\n            {events.length === 0 ? (\n                <ol className={styles.grimoireContent} aria-label={`${title} - ${eventCount} events`}>\n                    <li className={styles.emptyGrimoire}>\n                        <FontAwesomeIcon icon={faScroll} className={styles.emptyScroll} aria-hidden=\"true\" />\n                        <p className={styles.emptyText}>The pages lie blank...</p>\n                        <p className={styles.emptySubtext}>Await thy first tale of battle</p>\n                    </li>\n                </ol>\n            ) : (\n                <Virtuoso\n                    style={{ height: '60vh' }}\n                    className={styles.grimoireContent}\n                    data={events}\n                    itemContent={(index, event) => (\n                        <div className={styles.grimoireEntry} role=\"listitem\">\n                            <FontAwesomeIcon icon={faFireFlameSimple} className={styles.ember} aria-hidden=\"true\" />\n                            <span className={styles.chronicleText}>{parsedEvents[index]}</span>\n                        </div>\n                    )}\n                    components={{\n                        List: ({ children, ...props }) => (\n                            <div {...props} aria-label={`${title} - ${eventCount} events`} role=\"list\">\n                                {children}\n                            </div>\n                        ),\n                    }}\n                    defaultItemHeight={60}\n                />\n            )}\n\n            {/* Decorative bottom flourish */}\n            <div className={styles.grimoireFooter}>\n                <span className={styles.adornment} aria-hidden=\"true\"></span>\n            </div>\n        </div>\n    )\n}\n\nexport default EventLog","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/pacing.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FullAnalysisOutput' is defined but never used.","line":3,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[834,837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[834,837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3546,3549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3546,3549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { calculatePacingData } from './pacingUtils';\nimport { TimelineEvent, FullAnalysisOutput } from '@/model/model';\n\ndescribe('calculatePacingData', () => {\n    it('should return null if analysis is missing', () => {\n        const result = calculatePacingData([], null, []);\n        expect(result).toBe(null);\n    });\n\n    it('should correctly calculate Grand Total budget and segments', () => {\n        // Initial 100, Enc 1 -40, Rest +20, Enc 2 -50\n        // Grand Budget = 100 + 20 = 120\n        const timeline: TimelineEvent[] = [\n            { type: 'combat', id: 'enc1', monsters: [], targetRole: 'Standard' },\n            { type: 'shortRest', id: 'rest1' },\n            { type: 'combat', id: 'enc2', monsters: [], targetRole: 'Standard' }\n        ];\n\n        const analysis: any = {\n            overall: {\n                tdnw: 100,\n                globalMedian: {\n                    // Start 100%, After Enc1 60%, After Rest 80%, After Enc2 30%\n                    resourceTimeline: [100, 60, 80, 30],\n                    vitalityTimeline: [100, 70, 90, 40],\n                    powerTimeline: [100, 50, 50, 10]\n                }\n            }\n        };\n\n        const encounterWeights = [2, 2];\n\n        const result = calculatePacingData(timeline, analysis, encounterWeights);\n\n        expect(result).not.toBe(null);\n        if (result) {\n            expect(result.grandTotalBudget).toBe(120);\n            expect(result.initialEhp).toBe(100);\n            expect(result.totalRecovery).toBe(20);\n\n            // Reality segments\n            // Enc 1: 40/120 = 33.33%\n            // Rest: 0% (Divider)\n            // Enc 2: 50/120 = 41.66%\n            expect(result.actualSegments[0].percent).toBeCloseTo(33.33, 1);\n            expect(result.actualSegments[1].percent).toBe(0);\n            expect(result.actualSegments[2].percent).toBeCloseTo(41.66, 1);\n\n            // Vitality Segments (Drops: 30, -20, 50)\n            expect(result.vitalitySegments[0].percent).toBe(30);\n            expect(result.vitalitySegments[1].percent).toBe(0); // Recovery handled as negative drain? No, createSegments uses Math.max(0, change)\n            expect(result.vitalitySegments[2].percent).toBe(50);\n\n            // Power Segments (Drops: 50, 0, 40)\n            expect(result.powerSegments[0].percent).toBe(50);\n            expect(result.powerSegments[1].percent).toBe(0);\n            expect(result.powerSegments[2].percent).toBe(40);\n\n            // Combat-only actual costs\n            expect(result.actualCosts[0]).toBeCloseTo(33.33, 1);\n            expect(result.actualCosts[1]).toBeCloseTo(41.66, 1);\n\n            // Plan segments (based on weights 2, 2)\n            // Total weight 4. Enc 1 = 50%, Enc 2 = 50%\n            expect(result.plannedSegments[0].percent).toBe(50);\n            expect(result.plannedSegments[1].percent).toBe(0); \n            expect(result.plannedSegments[2].percent).toBe(50);\n\n            // Drifts\n            // Enc 1 drift: 33.33 - 50 = -16.66\n            // Enc 2 drift: 41.66 - 50 = -8.33\n            // Cumulative: [-16.66, -25.0]\n            expect(result.cumulativeDrifts[0]).toBeCloseTo(-16.66, 1);\n            expect(result.cumulativeDrifts[1]).toBeCloseTo(-25.0, 1);\n        }\n    });\n\n    it('should handle extreme recoveries correctly', () => {\n        const timeline: TimelineEvent[] = [\n            { type: 'combat', id: 'enc1', monsters: [], targetRole: 'Standard' },\n            { type: 'shortRest', id: 'rest1' }\n        ];\n\n        const analysis: any = {\n            overall: {\n                tdnw: 100,\n                globalMedian: {\n                    // Start 50%, After Enc1 20%, After Rest 100%\n                    resourceTimeline: [50, 20, 100]\n                }\n            }\n        };\n\n        const result = calculatePacingData(timeline, analysis, [1]);\n\n        expect(result).not.toBe(null);\n        if (result) {\n            // Initial 50, Recovery 80. Grand Total = 130.\n            expect(result.grandTotalBudget).toBe(130);\n            expect(result.actualSegments[0].percent).toBeCloseTo(30 / 130 * 100, 1); // 23.07%\n        }\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/pacingUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/simulation.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'act' is defined but never used.","line":2,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Creature' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1233,1236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1233,1236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parser' is defined but never used.","line":44,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":57},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2471,2474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2471,2474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3752,3755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3752,3755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4983,4986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4983,4986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { render, screen, fireEvent, act } from '@testing-library/react';\nimport Simulation from './simulation';\nimport React from 'react';\nimport { useSimulationWorker } from '@/model/useSimulationWorker';\nimport { Creature } from '@/model/model';\n\n// Mock localStorage\nconst localStorageMock = (() => {\n    let store: Record<string, string> = {};\n    return {\n        getItem: vi.fn((key: string) => store[key] || null),\n        setItem: vi.fn((key: string, value: string) => {\n            store[key] = value.toString();\n        }),\n        clear: vi.fn(() => {\n            store = {};\n        }),\n        removeItem: vi.fn((key: string) => {\n            delete store[key];\n        }),\n    };\n})();\n\nObject.defineProperty(window, 'localStorage', {\n    value: localStorageMock,\n});\n\n// Mock the hook\nvi.mock('@/model/useSimulationWorker', () => ({\n    useSimulationWorker: vi.fn()\n}));\n\n// Mock FontAwesomeIcon\nvi.mock('@fortawesome/react-fontawesome', () => ({\n    FontAwesomeIcon: () => <span data-testid=\"fa-icon\" />\n}));\n\n// Mock useStoredState to provide a monster\nvi.mock('@/model/utils', async () => {\n    const actual = await vi.importActual('@/model/utils') as any;\n    return {\n        ...actual,\n        useStoredState: vi.fn((key, defaultValue, parser) => {\n            if (key === 'timeline') {\n                return [[{\n                    type: 'combat',\n                    id: 'combat-1',\n                    monsters: [{ id: 'm1', name: 'Test Monster', count: 1, hp: 50, ac: 10, actions: [], mode: 'monster' }],\n                    playersSurprised: false,\n                    monstersSurprised: false,\n                }], vi.fn()];\n            }\n            return [defaultValue, vi.fn()];\n        })\n    };\n});\n\ndescribe('Simulation Component', () => {\n    beforeEach(() => {\n        vi.clearAllMocks();\n    });\n\n    it('should render the Auto-Adjust button for combat encounters', () => {\n        vi.mocked(useSimulationWorker).mockReturnValue({\n            isRunning: false,\n            progress: 0,\n            kFactor: 0,\n            maxK: 51,\n            results: null,\n            analysis: null,\n            events: null,\n            error: null,\n            optimizedResult: null,\n            genId: 0,\n            runSimulation: vi.fn(),\n            autoAdjustEncounter: vi.fn(),\n            clearOptimizedResult: vi.fn(),\n            terminateAndRestart: vi.fn(),\n        } as any);\n\n        render(<Simulation />);\n        \n        const adjustBtn = screen.getByTitle(/Optimize this encounter/i);\n        expect(adjustBtn).toBeDefined();\n        expect(adjustBtn.textContent).toContain('Auto-Adjust');\n    });\n\n    it('should render the Adjustment Preview modal when optimizedResult is present', async () => {\n        const mockOptimizedResult = {\n            monsters: [\n                { id: 'm1', name: 'Test Monster', count: 1, hp: 100, ac: 15, actions: [], mode: 'monster' }\n            ],\n            analysis: {\n                scenarioName: 'Optimized',\n                totalRuns: 2511,\n                deciles: [],\n                battleDurationRounds: 5\n            }\n        };\n\n        // Mock return value for when it has result\n        vi.mocked(useSimulationWorker).mockReturnValue({\n            isRunning: false,\n            progress: 100,\n            kFactor: 51,\n            maxK: 51,\n            results: null,\n            analysis: null,\n            events: null,\n            error: null,\n            optimizedResult: mockOptimizedResult,\n            genId: 1,\n            runSimulation: vi.fn(),\n            autoAdjustEncounter: vi.fn(),\n            clearOptimizedResult: vi.fn(),\n            terminateAndRestart: vi.fn(),\n        } as any);\n\n        render(<Simulation />);\n\n        // Click the button to set selectedEncounterIndex\n        const adjustBtn = screen.getByTitle(/Optimize this encounter/i);\n        fireEvent.click(adjustBtn);\n        \n        expect(screen.queryByText(/Adjustment Preview/i)).not.toBeNull();\n        expect(screen.queryAllByText(/Test Monster/i).length).toBeGreaterThan(1);\n        // Check that the optimized HP (100) is shown\n        expect(screen.queryByText('100')).not.toBeNull();\n    });\n\n    it('should apply optimized results when Apply Changes is clicked', async () => {\n        const mockOptimizedResult = {\n            monsters: [\n                { id: 'm1', name: 'Test Monster', count: 1, hp: 100, ac: 15, actions: [], mode: 'monster' }\n            ],\n            analysis: {\n                scenarioName: 'Optimized',\n                totalRuns: 2511,\n                deciles: [],\n                battleDurationRounds: 5\n            }\n        };\n\n        const clearOptimizedResult = vi.fn();\n\n        vi.mocked(useSimulationWorker).mockReturnValue({\n            isRunning: false,\n            optimizedResult: mockOptimizedResult,\n            clearOptimizedResult,\n            autoAdjustEncounter: vi.fn(),\n        } as any);\n\n        render(<Simulation />);\n        \n        const adjustBtn = screen.getByTitle(/Optimize this encounter/i);\n        fireEvent.click(adjustBtn);\n\n        const applyBtn = screen.getByText(/Apply Changes/i);\n        fireEvent.click(applyBtn);\n\n        expect(clearOptimizedResult).toHaveBeenCalled();\n    });\n});","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/simulation/simulation.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EncounterSchema' is defined but never used.","line":3,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SimulationResult' is defined but never used.","line":3,"column":100,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":116},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AggregateOutput' is defined but never used.","line":3,"column":118,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":133},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseEventString' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'faRedo' is defined but never used.","line":13,"column":74,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":80},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'faMagicWandSparkles' is defined but never used.","line":13,"column":89,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":108},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'faBullseye' is defined but never used.","line":13,"column":118,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":128},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getFinalAction' is defined but never used.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":24},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":1,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":33,"column":17,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":35,"endColumn":2,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[1854,1869],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[1854,1869],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FAST_ITERATIONS' is assigned a value but never used.","line":46,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PRECISE_ITERATIONS' is assigned a value but never used.","line":47,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":25},{"ruleId":"no-empty-pattern","severity":1,"message":"Unexpected empty object pattern.","line":87,"column":40,"nodeType":"ObjectPattern","messageId":"unexpected","endLine":87,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3812,3815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3812,3815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4995,4998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4995,4998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5046,5049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5046,5049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { FC, useEffect, useState, useRef, memo, useMemo } from \"react\"\nimport { z } from \"zod\"\nimport { Creature, CreatureSchema, Encounter, EncounterSchema, TimelineEvent, TimelineEventSchema, SimulationResult, AggregateOutput, EncounterResult as EncounterResultType } from \"@/model/model\"\nimport { parseEventString, SimulationEvent } from \"@/model/events\"\nimport { clone, useStoredState } from \"@/model/utils\"\nimport styles from './simulation.module.scss'\nimport EncounterForm from \"./encounterForm\"\nimport EncounterResult from \"./encounterResult\"\nimport EventLog from \"../combat/EventLog\"\nimport OnboardingTour from \"./OnboardingTour\"\nimport PerformanceDashboard from \"../debug/PerformanceDashboard\"\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faFolder, faPlus, faSave, faTrash, faEye, faTimes, faChartLine, faRedo, faBed, faMagicWandSparkles, faBolt, faBullseye, faQuestionCircle, faTachometerAlt } from \"@fortawesome/free-solid-svg-icons\"\nimport { v4 as uuid } from 'uuid'\nimport { semiPersistentContext } from \"@/model/semiPersistentContext\"\nimport AdventuringDayForm from \"./adventuringDayForm\"\nimport { getFinalAction } from \"@/data/actions\"\nimport { UIToggleProvider } from \"@/model/uiToggleState\"\nimport { useSimulationWorker } from \"@/model/useSimulationWorker\"\nimport AdjustmentPreview from \"./AdjustmentPreview\"\nimport AssistantSummary from \"./AssistantSummary\"\nimport { VitalsDashboard, ValidationNotice } from \"./AnalysisComponents\"\nimport { calculatePacingData } from \"./pacingUtils\"\nimport PartyOverview from \"./PartyOverview\"\nimport PlayerGraphs from \"./PlayerGraphs\"\nimport HeartbeatGraph from \"./HeartbeatGraph\"\nimport { SkylineAnalysis, PlayerSlot } from \"@/model/model\"\nimport { CrosshairProvider } from \"./CrosshairContext\"\nimport { CrosshairTooltip } from \"./CrosshairLine\"\n\n\n\ntype PropType = {\n    // TODO\n}\n\nconst emptyCombat: TimelineEvent = {\n    type: 'combat',\n    id: uuid(),\n    monsters: [],\n    monstersSurprised: false,\n    playersSurprised: false,\n    targetRole: 'Standard',\n}\n\nconst FAST_ITERATIONS = 100;\nconst PRECISE_ITERATIONS = 2511;\n\n// Sanitization helper: Fix duplicate IDs in players array\nconst sanitizePlayersParser = (parser: (data: unknown) => Creature[]) => (data: unknown) => {\n    const parsed = parser(data);\n    if (!parsed) return null;\n\n    const playerIds = new Set<string>();\n    const sanitized = parsed.map(p => {\n        if (playerIds.has(p.id)) {\n            return { ...p, id: uuid() }; // Generate new ID for duplicate\n        }\n        playerIds.add(p.id);\n        return p;\n    });\n\n    return sanitized;\n};\n\n// Sanitization helper: Fix duplicate IDs in timeline monsters\nconst sanitizeTimelineParser = (parser: (data: unknown) => TimelineEvent[]) => (data: unknown) => {\n    const parsed = parser(data);\n    if (!parsed) return null;\n\n    return parsed.map(item => {\n        if (item.type !== 'combat') return item;\n\n        const monsterIds = new Set<string>();\n        const sanitizedMonsters = item.monsters.map(m => {\n            if (monsterIds.has(m.id)) {\n                return { ...m, id: uuid() }; // Generate new ID for duplicate\n            }\n            monsterIds.add(m.id);\n            return m;\n        });\n\n        return { ...item, monsters: sanitizedMonsters };\n    });\n};\n\nconst Simulation: FC<PropType> = memo(({ }) => {\n    const [players, setPlayers, isPlayersLoaded] = useStoredState<Creature[]>('players', [], sanitizePlayersParser(z.array(CreatureSchema).parse))\n    const [timeline, setTimeline, isTimelineLoaded] = useStoredState<TimelineEvent[]>('timeline', [emptyCombat], sanitizeTimelineParser(z.array(TimelineEventSchema).parse))\n    const [simulationResults, setSimulationResults] = useState<EncounterResultType[]>([])\n    const [state, setState] = useState(new Map<string, any>())\n    const [simulationEvents, setSimulationEvents] = useState<SimulationEvent[]>([])\n\n    const [saving, setSaving] = useState(false)\n    const [loading, setLoading] = useState(false)\n    const [isEditing, setIsEditing] = useState(false)\n    const [showLogModal, setShowLogModal] = useState(false)\n    const [selectedEncounterIndex, setSelectedEncounterIndex] = useState<number | null>(null)\n    const [selectedDecileIndex, setSelectedDecileIndex] = useState<number>(5) // Default to 50% Median\n    const [runTour, setRunTour] = useState(false)\n    const [showPerformanceDashboard, setShowPerformanceDashboard] = useState(false)\n\n    // Web Worker Simulation\n    const worker = useSimulationWorker();\n    const [needsResimulation, setNeedsResimulation] = useState(false);\n    const [isStale, setIsStale] = useState(false);\n    const [highPrecision, setHighPrecision, isHighPrecisionLoaded] = useStoredState<boolean>('highPrecision', false, z.boolean().parse);\n    const debounceTimerRef = useRef<NodeJS.Timeout | null>(null);\n\n    // Expose for E2E tests\n    useEffect(() => {\n        if (isPlayersLoaded && isTimelineLoaded && isHighPrecisionLoaded) {\n            (window as any).simulationWasm = true;\n            (window as any).storageLoaded = true;\n        }\n    }, [isPlayersLoaded, isTimelineLoaded, isHighPrecisionLoaded]);\n\n    // Memoize expensive computations\n    const isEmptyResult = useMemo(() => {\n        const hasPlayers = !!players.length\n        const hasMonsters = !!timeline.find(item => item.type === 'combat' && !!item.monsters.length)\n        return !hasPlayers && !hasMonsters\n    }, [players.length, timeline])\n\n    // Memoize combatant names map\n    const combatantNames = useMemo(() => {\n        const names = new Map<string, string>()\n        \n        // Add players - IDs are prefixed with 'p-' and numbered if count > 1\n        players.forEach((p, group_idx) => {\n            for (let i = 0; i < (p.count || 1); i++) {\n                const id = `p-${group_idx}-${i}-${p.id}`\n                const name = (p.count || 1) > 1 ? `${p.name} ${i + 1}` : p.name\n                names.set(id, name)\n            }\n            // Fallback for base ID - VERY IMPORTANT for resolving WASM partySlots\n            names.set(p.id, p.name)\n        })\n\n        // Add monsters - IDs include encounter index and are numbered if count > 1\n        timeline.forEach((item, step_idx) => {\n            if (item.type === 'combat') {\n                item.monsters.forEach((m, group_idx) => {\n                    for (let i = 0; i < (m.count || 1); i++) {\n                        const id = `step${step_idx}-m-${group_idx}-${i}-${m.id}`\n                        const name = (m.count || 1) > 1 ? `${m.name} ${i + 1}` : m.name\n                        names.set(id, name)\n                    }\n                    // Fallback for base ID\n                    names.set(m.id, m.name)\n                })\n            }\n        })\n        \n        return names\n    }, [players, timeline])\n\n    const [canSave, setCanSave] = useState(false)\n    \n    const encounterWeights = useMemo(() => {\n        const weights: number[] = [];\n        timeline.forEach(item => {\n            if (item.type === 'combat') {\n                const role = item.targetRole || 'Standard';\n                const weight = role === 'Skirmish' ? 1 : role === 'Standard' ? 2 : role === 'Elite' ? 3 : 4;\n                weights.push(weight);\n            }\n        });\n        return weights;\n    }, [timeline]);\n\n    const pacingData = useMemo(() => {\n        return calculatePacingData(timeline, worker.analysis, encounterWeights);\n    }, [worker.analysis, timeline, encounterWeights]);\n\n    useEffect(() => {\n        setCanSave(!isEmptyResult)\n    }, [isEmptyResult])\n\n    // Detect changes that need resimulation with debounce\n    useEffect(() => {\n        // Clear previous timer\n        if (debounceTimerRef.current) clearTimeout(debounceTimerRef.current);\n        \n        // Set new timer (500ms delay)\n        debounceTimerRef.current = setTimeout(() => {\n            setNeedsResimulation(true);\n            setIsStale(true);\n        }, 500);\n        \n        return () => {\n            if (debounceTimerRef.current) clearTimeout(debounceTimerRef.current);\n        };\n    }, [players, timeline, highPrecision]);\n\n    // Trigger simulation when not editing and needs resimulation\n    useEffect(() => {\n        if (!isEditing && !saving && !loading && needsResimulation) {\n            if (Array.isArray(timeline) && timeline.length > 0) {\n                worker.runSimulation(players, timeline, highPrecision ? 51 : 3);\n                setNeedsResimulation(false);\n            }\n        }\n    }, [isEditing, saving, loading, needsResimulation, players, timeline, worker, highPrecision]);\n\n    // Update display results when worker finishes\n    useEffect(() => {\n        if (!worker.results || worker.results.length === 0) return;\n\n        const results = worker.results;\n        // [Disaster, Struggle, Typical, Heroic, Legend]\n        const index = results.length >= 3 ? 2 : 0;\n        const selectedRun = results[index];\n\n        setSimulationResults(selectedRun.encounters);\n\n        // Update events from the first run returned by the worker\n        if (worker.events) {\n            // events in worker are already structured objects, not strings\n            // But let's check if they need parsing\n            setSimulationEvents(worker.events as SimulationEvent[]);\n        }\n\n        // Clear stale state when new results are available\n        setIsStale(false);\n    }, [worker.results, worker.events]);\n\n    function createCombat() {\n        setTimeline([...timeline, {\n            type: 'combat',\n            id: uuid(), // Ensure new items have a unique ID\n            monsters: [],\n            monstersSurprised: false,\n            playersSurprised: false,\n            targetRole: 'Standard',\n        }])\n    }\n\n    function createShortRest() {\n        setTimeline([...timeline, {\n            type: 'shortRest',\n            id: uuid(),\n        }])\n    }\n\n    function updateTimelineItem(index: number, newValue: TimelineEvent) {\n        const timelineClone = clone(timeline)\n        timelineClone[index] = newValue\n        setTimeline(timelineClone)\n    }\n\n    function deleteTimelineItem(index: number) {\n        if (timeline.length <= 1) return // Must have at least one item\n        const timelineClone = clone(timeline)\n        timelineClone.splice(index, 1)\n        setTimeline(timelineClone)\n    }\n\n    function swapTimelineItems(index1: number, index2: number) {\n        const timelineClone = clone(timeline)\n        const tmp = timelineClone[index1]\n        timelineClone[index1] = timelineClone[index2]\n        timelineClone[index2] = tmp\n        setTimeline(timelineClone)\n    }\n\n    function applyOptimizedResult() {\n        if (selectedEncounterIndex === null || !worker.optimizedResult) return;\n        \n        const timelineClone = clone(timeline);\n        const item = timelineClone[selectedEncounterIndex];\n        \n        if (item.type === 'combat') {\n            item.monsters = worker.optimizedResult.monsters;\n            setTimeline(timelineClone);\n        }\n        \n        worker.clearOptimizedResult();\n        setSelectedEncounterIndex(null);\n    }\n\n    // Memoize action names map\n    const actionNames = useMemo(() => {\n        const names = new Map<string, string>()\n        players.forEach(p => p.actions.forEach(a => {\n            const name = a.type === 'template' ? a.templateOptions.templateName : a.name\n            names.set(a.id, name)\n        }))\n        timeline.forEach(item => {\n            if (item.type === 'combat') {\n                item.monsters.forEach(m => m.actions.forEach(a => {\n                    const name = a.type === 'template' ? a.templateOptions.templateName : a.name\n                    names.set(a.id, name)\n                }))\n            }\n        })\n        return names\n    }, [players, timeline])\n\n    return (\n        <UIToggleProvider>\n            <div className={styles.simulation}>\n                <semiPersistentContext.Provider value={{ state, setState }}>\n                    <div className={styles.header}>\n                        <h1>BattleSim</h1>\n                        <div className={styles.headerButtons}>\n                            <button\n                                className={styles.helpButton}\n                                onClick={() => setRunTour(true)}\n                                title=\"Start guided tour\"\n                                aria-label=\"Start guided tour\"\n                            >\n                                <FontAwesomeIcon icon={faQuestionCircle} />\n                                Help\n                            </button>\n                            <button\n                                className={styles.helpButton}\n                                onClick={() => setShowPerformanceDashboard(!showPerformanceDashboard)}\n                                title=\"Toggle performance dashboard\"\n                                aria-label={`${showPerformanceDashboard ? 'Hide' : 'Show'} performance dashboard`}\n                            >\n                                <FontAwesomeIcon icon={faTachometerAlt} />\n                                {showPerformanceDashboard ? 'Hide' : 'Perf'}\n                            </button>\n                        </div>\n                    </div>\n\n                    \n                    {/* Backend Features Status Panel */}\n                    <div className={`${styles.backendStatus} simulation-controls`} role=\"region\" aria-label=\"Simulation Status\">\n                        <h4> Event-Driven Backend {worker.isRunning ? '(Processing...)' : 'Active'}</h4>\n                        <div className={styles.statusItems} aria-live=\"polite\" role=\"status\">\n                            <span> ActionResolution Engine</span>\n                            <span> Event System</span>\n                            <span> Reaction Processing</span>\n                            <span> Effect Tracking</span>\n                            <span> Events: {simulationEvents.length}</span>\n                        </div>\n                        {worker.isRunning && (\n                            <div \n                                className={styles.progressBar}\n                                role=\"progressbar\"\n                                aria-valuenow={Math.round(worker.progress)}\n                                aria-valuemin={0}\n                                aria-valuemax={100}\n                                aria-label=\"Simulation progress\"\n                                data-testid=\"simulation-loading\"\n                            >\n                                <div \n                                    className={styles.progressFill} \n                                    style={{ width: `${worker.progress}%` }}\n                                />\n                                <span className={styles.progressText}>\n                                    Refining Accuracy (K={worker.kFactor}/{highPrecision ? 51 : 3})\n                                </span>\n                            </div>\n                        )}\n                        <div className={styles.autoSimulateToggle}>\n                            <label className={styles.toggleLabel} data-testid=\"high-precision-toggle\">\n                                <input\n                                    type=\"checkbox\"\n                                    checked={highPrecision}\n                                    onChange={(e) => setHighPrecision(e.target.checked)}\n                                    className={styles.toggleInput}\n                                />\n                                <span className={styles.toggleSwitch}></span>\n                                <span className={styles.toggleText}>\n                                    High Precision Mode\n                                </span>\n                            </label>\n                        </div>\n\n                        {worker.analysis && !worker.isRunning && worker.kFactor < (highPrecision ? 51 : 3) && (\n                            <div className={styles.simulationMode}>\n                                <div className={styles.pausedIndicator}>\n                                    <FontAwesomeIcon icon={faBolt} /> Refinement Paused\n                                </div>\n                                <button\n                                    className={styles.preciseButton}\n                                    onClick={() => worker.runSimulation(players, timeline, highPrecision ? 51 : 3)}\n                                >\n                                    Resume Refinement\n                                </button>\n                            </div>\n                        )}\n\n                        {isEditing && <div className={styles.editingNotice}> Simulation paused while editing</div>}\n                        {worker.error && <div className={styles.errorNotice}> Simulation Error: {worker.error}</div>}\n                    </div>\n\n                    <div className=\"encounter-builder-section player-form-section\">\n                        <EncounterForm\n                            mode='player'\n                            encounter={{ id: 'players', monsters: players, type: 'combat', targetRole: 'Standard' }}\n                            onUpdate={(newValue) => setPlayers(newValue.monsters)}\n                            onEditingChange={setIsEditing}>\n                            <>\n                                {!isEmptyResult ? (\n                                    <button onClick={() => { setPlayers([]); setTimeline([emptyCombat]) }}>\n                                        <FontAwesomeIcon icon={faTrash} />\n                                        Clear Adventuring Day\n                                    </button>\n                                ) : null}\n                                {canSave ? (\n                                    <button onClick={() => setSaving(true)}>\n                                        <FontAwesomeIcon icon={faSave} />\n                                        Save Adventuring Day\n                                    </button>\n                                ) : null}\n                                <button onClick={() => setLoading(true)}>\n                                    <FontAwesomeIcon icon={faFolder} />\n                                    Load Adventuring Day\n                                </button>\n\n\n                            </>\n                        </EncounterForm>\n                    </div>\n\n                    <CrosshairProvider>\n                        {timeline.map((item, index) => {\n                            // Find index within combat-only array for pacingData\n                            const combatIndex = timeline.slice(0, index).filter(i => i.type === 'combat').length;\n                            const totalWeight = encounterWeights.reduce((a, b) => a + b, 0);\n                            const targetPercent = (encounterWeights[combatIndex] / totalWeight) * 100;\n                            const actualPercent = pacingData?.actualCosts[combatIndex];\n                            const cumulativeDrift = pacingData?.cumulativeDrifts[combatIndex];\n\n                            return (\n                                <div className={item.type === 'combat' ? styles.encounter : styles.rest} key={index}>\n                                    {item.type === 'combat' ? (\n                                        <div className=\"monster-form-section\">\n                                            <EncounterForm\n                                            mode='monster'\n                                            encounter={item}\n                                            onUpdate={(newValue) => updateTimelineItem(index, newValue)}\n                                            onDelete={(index > 0) ? () => deleteTimelineItem(index) : undefined}\n                                            onMoveUp={(!!timeline.length && !!index) ? () => swapTimelineItems(index, index - 1) : undefined}\n                                            onMoveDown={(!!timeline.length && (index < timeline.length - 1)) ? () => swapTimelineItems(index, index + 1) : undefined}\n                                            onEditingChange={setIsEditing}\n                                            onAutoAdjust={() => {\n                                                setSelectedEncounterIndex(index);\n                                                worker.autoAdjustEncounter(players, item.monsters, timeline, index);\n                                            }}\n                                            autoAdjustDisabled={worker.isRunning}\n                                        />\n                                        </div>\n                                ) : (\n                                    <div className={styles.restCard}>\n                                        <div className={styles.restHeader}>\n                                            <h3><FontAwesomeIcon icon={faBed} /> Short Rest</h3>\n                                            <div className={styles.restControls}>\n                                                <button onClick={() => swapTimelineItems(index, index - 1)} disabled={index === 0}></button>\n                                                <button onClick={() => swapTimelineItems(index, index + 1)} disabled={index === timeline.length - 1}></button>\n                                                <button onClick={() => deleteTimelineItem(index)} className={styles.deleteBtn}><FontAwesomeIcon icon={faTrash} /></button>\n                                            </div>\n                                        </div>\n                                        <div className={styles.restBody}>\n                                            Characters spend Hit Dice to recover HP and reset \"Short Rest\" resources.\n                                        </div>\n                                    </div>\n                                )}\n                                \n                                {(worker.analysis?.encounters?.[index] ? (\n                                    <EncounterResult\n                                        value={worker.analysis.encounters[index].globalMedian?.medianRunData || worker.analysis.encounters[index].deciles?.[4]?.medianRunData || simulationResults[index]}\n                                        analysis={worker.analysis.encounters[index]}\n                                        fullAnalysis={worker.analysis} \n                                        playerNames={combatantNames}\n                                        isStale={isStale}\n                                        isPreliminary={worker.isRunning && worker.progress < 100}\n                                        targetPercent={item.type === 'combat' ? targetPercent : undefined}\n                                        actualPercent={item.type === 'combat' ? actualPercent : undefined}\n                                                                                                cumulativeDrift={item.type === 'combat' ? cumulativeDrift : undefined}\n                                                                                                isShortRest={item.type === 'shortRest'}\n                                                                                                targetRole={item.type === 'combat' ? item.targetRole : undefined}\n                                                                                            />                                                    ) : (item.type === 'combat' && simulationResults[index] ? (\n                                    <EncounterResult\n                                        value={simulationResults[index]}\n                                        analysis={null}\n                                        fullAnalysis={worker.analysis} \n                                        playerNames={combatantNames}\n                                        isStale={isStale}\n                                        isPreliminary={worker.isRunning && worker.progress < 100}\n                                        targetPercent={targetPercent}\n                                                                                                actualPercent={actualPercent}\n                                                                                                cumulativeDrift={cumulativeDrift}\n                                                                                                targetRole={item.targetRole}\n                                                                                            />                                                    ) : null))}\n                                \n                                {item.type === 'combat' && (\n                                    <div className={styles.buttonGroup}>\n                                        <button\n                                            onClick={() => {\n                                                setSelectedEncounterIndex(index);\n                                                setSelectedDecileIndex(5); // Reset to Median\n                                                setShowLogModal(true);\n                                            }}\n                                            className={styles.showLogButton}>\n                                            <FontAwesomeIcon icon={faEye} />\n                                            Show Log\n                                        </button>\n                                    </div>\n                                )}\n                            </div>\n                        )\n                    })}\n\n                    <div className={styles.addButtons}>\n                        <button\n                            onClick={createCombat}\n                            className={styles.addEncounterBtn}>\n                            <FontAwesomeIcon icon={faPlus} />\n                            Add Combat\n                        </button>\n                        <button\n                            onClick={createShortRest}\n                            className={`${styles.addEncounterBtn} ${styles.restBtn}`}>\n                            <FontAwesomeIcon icon={faBed} />\n                            Add Short Rest\n                        </button>\n                    </div>\n\n                    {/* Overall Day Summary - Moved to bottom and labeled */}\n                    {worker.analysis?.overall?.skyline && worker.analysis?.partySlots && pacingData && (\n                        <div className={styles.overallSummary} data-testid=\"overall-summary\">\n                            <div className={styles.summaryDivider}>\n                                <div className={styles.dividerLine} />\n                                <h3 className={styles.summaryTitle}>\n                                    <FontAwesomeIcon icon={faChartLine} /> Projected Day Outcome Summary\n                                </h3>\n                                <div className={styles.dividerLine} />\n                            </div>\n\n                            <VitalsDashboard analysis={worker.analysis.overall} isPreliminary={worker.isRunning} />\n                                \n                            <ValidationNotice analysis={worker.analysis.overall} isDaySummary={true} />\n\n                            <AssistantSummary \n                                pacingData={pacingData} \n                            />\n\n                            {worker.analysis.overall.pacing && (\n                                <div className={styles.pacingHeader}>\n                                    <div className={styles.archetypeBadge}>\n                                        {worker.analysis.overall.pacing.archetype}\n                                    </div>\n                                    <div className={styles.directorScore}>\n                                        DIRECTOR'S SCORE: {Math.round(worker.analysis.overall.pacing.directorScore)}\n                                    </div>\n                                </div>\n                            )}\n\n                            <div className={styles.summaryGrid}>\n                                <HeartbeatGraph \n                                    encounters={worker.analysis.encounters} \n                                    className={styles.tensionArc} \n                                />\n                                \n                                <PartyOverview\n                                    skyline={worker.analysis.overall.skyline as SkylineAnalysis}\n                                    partySlots={worker.analysis.partySlots as PlayerSlot[]}\n                                    playerNames={combatantNames}\n                                    className=\"overall-party-overview\"\n                                />\n                            </div>\n\n                            <PlayerGraphs\n                                skyline={worker.analysis.overall.skyline as SkylineAnalysis}\n                                partySlots={worker.analysis.partySlots as PlayerSlot[]}\n                                playerNames={combatantNames}\n                            />\n                        </div>\n                    )}\n\n                    <CrosshairTooltip />\n                </CrosshairProvider>\n\n                    {/* Event Log Modal */}\n                    {showLogModal && selectedEncounterIndex !== null && (\n                        <div className={`${styles.logModalOverlay} event-log-section`}>\n                            <div className={styles.logModal}>\n                                <div className={styles.modalHeader}>\n                                    <div className={styles.modalHeaderTitle}>\n                                        <h3>Combat Log - Encounter {selectedEncounterIndex + 1}</h3>\n                                        <div className={styles.decileNav}>\n                                            <button \n                                                disabled={selectedDecileIndex === 0}\n                                                onClick={() => setSelectedDecileIndex(selectedDecileIndex - 1)}\n                                                className={styles.navBtn}\n                                            >\n                                                &larr; Worse Run\n                                            </button>\n                                            <span className={styles.percentileLabel}>\n                                                {selectedDecileIndex === 5 ? \"50% (Median)\" : `${selectedDecileIndex * 10 + (selectedDecileIndex < 5 ? 5 : -5)}% Run`}\n                                            </span>\n                                            <button \n                                                disabled={selectedDecileIndex === 10}\n                                                onClick={() => setSelectedDecileIndex(selectedDecileIndex + 1)}\n                                                className={styles.navBtn}\n                                            >\n                                                Better Run &rarr;\n                                            </button>\n                                        </div>\n                                    </div>\n                                    <button \n                                        onClick={() => setShowLogModal(false)}\n                                        className={styles.closeButton}>\n                                        <FontAwesomeIcon icon={faTimes} />\n                                    </button>\n                                </div>\n                                <div className={styles.logBody}>\n                                    <EventLog\n                                        events={worker.analysis?.encounters[selectedEncounterIndex]?.decileLogs?.[selectedDecileIndex] || []}\n                                        combatantNames={Object.fromEntries(combatantNames)}\n                                        actionNames={Object.fromEntries(actionNames)}\n                                        isModal={true}\n                                    />\n                                </div>\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Adventuring Day Editor (Save/Load) */}\n                    {(saving || loading) && (\n                        <AdventuringDayForm\n                            currentPlayers={players}\n                            currentTimeline={timeline}\n                            onCancel={() => { setSaving(false); setLoading(false); }}\n                            onApplyChanges={(newPlayers, newTimeline) => {\n                                setPlayers(newPlayers);\n                                setTimeline(newTimeline);\n                                setSaving(false);\n                                setLoading(false);\n                            }}\n                            onEditingChange={setIsEditing}\n                        />\n                    )}\n\n                    {/* Adjustment Preview Modal */}\n                    {worker.optimizedResult && selectedEncounterIndex !== null && timeline[selectedEncounterIndex].type === 'combat' && (\n                        <div className=\"auto-balancer-section\">\n                            <AdjustmentPreview\n                                originalMonsters={(timeline[selectedEncounterIndex] as Encounter).monsters}\n                                adjustmentResult={worker.optimizedResult}\n                                onApply={applyOptimizedResult}\n                                onCancel={() => {\n                                    worker.clearOptimizedResult();\n                                    setSelectedEncounterIndex(null);\n                                }}\n                            />\n                        </div>\n                    )}\n                </semiPersistentContext.Provider>\n\n                {/* Onboarding Tour */}\n                <OnboardingTour\n                    forceRun={runTour}\n                    onTourEnd={() => setRunTour(false)}\n                />\n\n                {/* Performance Dashboard */}\n                <PerformanceDashboard\n                    isVisible={showPerformanceDashboard}\n                    onClose={() => setShowPerformanceDashboard(false)}\n                />\n            </div>\n        </UIToggleProvider>\n    )\n})\n\nexport default Simulation","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/ui/LoadingSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/ui/ProgressTracker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/ui/SimulationControls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/ui/SimulationResults.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LoadingSkeleton' is assigned a value but never used.","line":61,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { useSimulation } from '@/model/simulationContext';\n\nexport const SimulationResults: React.FC = () => {\n  const { state } = useSimulation();\n\n  if (state.isRunning) {\n    return (\n      <div className=\"animate-pulse h-64\" role=\"status\" aria-busy=\"true\" aria-label=\"Simulation in progress\">\n        <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\"></div>\n        <div className=\"h-4 bg-gray-200 rounded w-full mb-2\"></div>\n        <div className=\"h-4 bg-gray-200 rounded w-5/6\"></div>\n      </div>\n    );\n  }\n\n  if (state.error) {\n    return (\n      <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\" role=\"alert\" aria-live=\"assertive\">\n        <p className=\"text-red-800\">Error: {state.error}</p>\n      </div>\n    );\n  }\n\n  if (!state.results || state.results.length === 0) {\n    return (\n      <div className=\"bg-gray-50 rounded-lg p-8 text-center\" role=\"status\">\n        <p className=\"text-gray-500\">No results to display</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-md p-6 w-full\" role=\"region\" aria-labelledby=\"results-title\">\n      <h2 id=\"results-title\" className=\"text-xl font-semibold mb-4\">Simulation Results</h2>\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full\">\n          <caption className=\"sr-only\">Detailed simulation outcome statistics</caption>\n          <thead>\n            <tr className=\"border-b\">\n              <th scope=\"col\" className=\"text-left py-2 px-4 font-medium\">Name</th>\n              <th scope=\"col\" className=\"text-left py-2 px-4 font-medium\">Value</th>\n              <th scope=\"col\" className=\"text-left py-2 px-4 font-medium\">Percentage</th>\n            </tr>\n          </thead>\n          <tbody>\n            {state.results.map((result) => (\n              <tr key={result.id} className=\"border-b\">\n                <td className=\"py-2 px-4\">{result.name}</td>\n                <td className=\"py-2 px-4\">{result.value}</td>\n                <td className=\"py-2 px-4\">{result.percentage}%</td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n};\n\nconst LoadingSkeleton: React.FC<{ className?: string }> = ({ className }) => {\n  return (\n    <div className={`animate-pulse ${className || ''}`}>\n      <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\"></div>\n      <div className=\"h-4 bg-gray-200 rounded w-full mb-2\"></div>\n      <div className=\"h-4 bg-gray-200 rounded w-5/6\"></div>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/DecimalInput.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useContext' is defined but never used.","line":1,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'disabled' is defined but never used.","line":15,"column":95,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":103}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useContext, useEffect, useState } from \"react\"\n\ntype PropType = {\n    value: number|undefined,\n    onChange: (newValue: number|undefined) => void,\n    min?: number,\n    max?: number,\n    step?: number,\n    className?: string,\n    placeholder?: string,\n    disabled?: string,\n    'data-testid'?: string,\n}\n\nconst DecimalInput:FC<PropType> = ({ value, onChange, min, max, step, className, placeholder, disabled, 'data-testid': testId }) => {\n    const [valueString, setValueString] = useState(String(value))\n\n    const valueNum = +valueString // Can be NaN\n    const isNumeric = !isNaN(valueNum)\n\n    // Sync valueString when value prop changes from parent (e.g., after validation)\n    useEffect(() => {\n        setValueString(value === undefined ? '' : String(value))\n    }, [value])\n\n    useEffect(() => {\n        if (isNumeric) onChange(valueNum)\n    }, [valueString])\n    \n    return (\n        <input\n            type=\"number\"\n            value={valueString}\n            onChange={(e) => setValueString(e.target.value)}\n            min={min}\n            max={max}\n            step={step}\n            className={`${className} ${Number.parseInt}`}\n            placeholder={placeholder}\n            data-testid={testId}\n        />\n    )\n}\n\nexport default DecimalInput","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/LoadingExample.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'operationId' is assigned a value but never used.","line":19,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":34,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":50,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react'\nimport { useLoading, useLoadingOperation } from '../utils/useLoading'\n\n/**\n * Example component demonstrating the Loading State Management System\n *\n * This component shows how to:\n * - Use the global loading state\n * - Create individual loading operations\n * - Display loading progress and status\n */\nexport const LoadingExample: React.FC = () => {\n  const loading = useLoading()\n\n  // Individual loading operation for a specific task\n  const dataLoading = useLoadingOperation('simulation-data', 'high')\n\n  const handleLoadData = async () => {\n    const operationId = dataLoading.start('Loading simulation data...')\n\n    try {\n      // Simulate data loading with progress updates\n      dataLoading.update(25, 'Connecting to data source...')\n      await new Promise(resolve => setTimeout(resolve, 1000))\n\n      dataLoading.update(50, 'Fetching records...')\n      await new Promise(resolve => setTimeout(resolve, 1000))\n\n      dataLoading.update(75, 'Processing data...')\n      await new Promise(resolve => setTimeout(resolve, 1000))\n\n      dataLoading.update(100, 'Data loaded successfully')\n      dataLoading.complete('Simulation data loaded')\n    } catch (error) {\n      dataLoading.error('Failed to load data', 'Network error occurred')\n    }\n  }\n\n  const handleSimulateWork = async () => {\n    const operationId = loading.startOperation('background-tasks', 'medium', 'Running simulation...')\n\n    try {\n      // Simulate work with progress\n      for (let i = 0; i <= 100; i += 10) {\n        loading.updateProgress(operationId, i, `Processing... ${i}%`)\n        await new Promise(resolve => setTimeout(resolve, 200))\n      }\n\n      loading.completeOperation(operationId, 'Simulation completed')\n    } catch (error) {\n      loading.errorOperation(operationId, 'Simulation failed', 'Unexpected error')\n    }\n  }\n\n  const handleSimulateError = () => {\n    loading.startOperation('core-ui', 'critical', 'Critical operation...')\n    setTimeout(() => {\n      loading.errorOperation('loading-op-1-1234567890', 'Critical system error', 'System failure')\n    }, 2000)\n  }\n\n  return (\n    <div style={{ padding: '20px', fontFamily: 'Arial, sans-serif' }}>\n      <h2>Loading State Management Example</h2>\n\n      {/* Global Loading Status */}\n      <div style={{ marginBottom: '20px', padding: '10px', border: '1px solid #ccc' }}>\n        <h3>Global Loading Status</h3>\n        <p>Active Operations: {loading.activeOperations}</p>\n        <p>Completed: {loading.completedOperations}</p>\n        <p>Failed: {loading.failedOperations}</p>\n        <p>Global Progress: {loading.globalProgress.toFixed(1)}%</p>\n        <p>Is Loading: {loading.isLoading ? 'Yes' : 'No'}</p>\n\n        {loading.isLoading && (\n          <div style={{\n            width: '100%',\n            height: '10px',\n            backgroundColor: '#f0f0f0',\n            borderRadius: '5px',\n            overflow: 'hidden'\n          }}>\n            <div style={{\n              width: `${loading.globalProgress}%`,\n              height: '100%',\n              backgroundColor: '#007bff',\n              transition: 'width 0.3s ease'\n            }} />\n          </div>\n        )}\n      </div>\n\n      {/* Action Buttons */}\n      <div style={{ marginBottom: '20px' }}>\n        <button\n          onClick={handleLoadData}\n          disabled={dataLoading.isActive}\n          style={{\n            padding: '10px 20px',\n            marginRight: '10px',\n            backgroundColor: dataLoading.isActive ? '#ccc' : '#007bff',\n            color: 'white',\n            border: 'none',\n            borderRadius: '5px',\n            cursor: dataLoading.isActive ? 'not-allowed' : 'pointer'\n          }}\n        >\n          {dataLoading.isActive ? 'Loading Data...' : 'Load Data'}\n        </button>\n\n        <button\n          onClick={handleSimulateWork}\n          style={{\n            padding: '10px 20px',\n            marginRight: '10px',\n            backgroundColor: '#28a745',\n            color: 'white',\n            border: 'none',\n            borderRadius: '5px',\n            cursor: 'pointer'\n          }}\n        >\n          Simulate Work\n        </button>\n\n        <button\n          onClick={handleSimulateError}\n          style={{\n            padding: '10px 20px',\n            backgroundColor: '#dc3545',\n            color: 'white',\n            border: 'none',\n            borderRadius: '5px',\n            cursor: 'pointer'\n          }}\n        >\n          Simulate Error\n        </button>\n      </div>\n\n      {/* Operations Summary */}\n      <div style={{ padding: '10px', border: '1px solid #ccc' }}>\n        <h3>Operations by Type</h3>\n        <ul>\n          {Object.entries(loading.summary.operationsByType).map(([type, count]) => (\n            <li key={type}>{type}: {count} operations</li>\n          ))}\n        </ul>\n\n        <h3>Operations by Status</h3>\n        <ul>\n          {Object.entries(loading.summary.operationsByStatus).map(([status, count]) => (\n            <li key={status}>{status}: {count} operations</li>\n          ))}\n        </ul>\n      </div>\n    </div>\n  )\n}\n\nexport default LoadingExample","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/LoadingOverlay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/LoadingSpinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/ProgressUI.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/UiTogglePanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2967,2970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2967,2970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { FC, useState } from 'react'\nimport { UIToggleState, useUIToggles } from '@/model/uiToggleState'\nimport styles from './UiTogglePanel.module.scss'\n\ntype ToggleControlProps = {\n  toggle: UIToggleState\n  onToggle: (id: string, enabled: boolean) => void\n}\n\nconst ToggleControl: FC<ToggleControlProps> = ({ toggle, onToggle }) => {\n  const [isFocused, setIsFocused] = useState(false)\n\n  const handleKeyDown = (event: React.KeyboardEvent) => {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault()\n      onToggle(toggle.id, !toggle.enabled)\n    }\n  }\n\n  return (\n    <div className={`${styles.toggleControl} ${toggle.enabled ? styles.enabled : ''}`}>\n      <label\n        className={styles.toggleLabel}\n        htmlFor={`toggle-${toggle.id}`}\n        title={toggle.description}\n      >\n        <input\n          id={`toggle-${toggle.id}`}\n          type=\"checkbox\"\n          checked={toggle.enabled}\n          onChange={(e) => onToggle(toggle.id, e.target.checked)}\n          onFocus={() => setIsFocused(true)}\n          onBlur={() => setIsFocused(false)}\n          onKeyDown={handleKeyDown}\n          className={styles.toggleInput}\n          aria-describedby={toggle.description ? `desc-${toggle.id}` : undefined}\n        />\n        <span\n          className={`${styles.toggleSwitch} ${isFocused ? styles.focused : ''}`}\n          role=\"switch\"\n          aria-checked={toggle.enabled}\n          tabIndex={-1}\n        >\n          <span className={styles.toggleSlider} />\n        </span>\n        <span className={styles.toggleText}>\n          {toggle.label}\n        </span>\n      </label>\n      {toggle.description && (\n        <div\n          id={`desc-${toggle.id}`}\n          className={styles.toggleDescription}\n        >\n          {toggle.description}\n        </div>\n      )}\n    </div>\n  )\n}\n\ntype ToggleSectionProps = {\n  title: string\n  toggles: UIToggleState[]\n  onToggle: (id: string, enabled: boolean) => void\n}\n\nconst ToggleSection: FC<ToggleSectionProps> = ({ title, toggles, onToggle }) => {\n  if (toggles.length === 0) return null\n\n  return (\n    <div className={styles.toggleSection}>\n      <h4 className={styles.sectionTitle}>{title}</h4>\n      <div className={styles.toggleGrid}>\n        {toggles.map(toggle => (\n          <ToggleControl\n            key={toggle.id}\n            toggle={toggle}\n            onToggle={onToggle}\n          />\n        ))}\n      </div>\n    </div>\n  )\n}\n\ntype UiTogglePanelProps = {\n  isOpen?: boolean\n  onClose?: () => void\n  className?: string\n}\n\nconst UiTogglePanel: FC<UiTogglePanelProps> = ({\n  isOpen = true,\n  onClose,\n  className = ''\n}) => {\n  const { getTogglesByCategory, updateToggle, resetToDefaults } = useUIToggles()\n  const [isExpanded, setIsExpanded] = useState(isOpen)\n\n  const displayToggles = getTogglesByCategory('display')\n  const analysisToggles = getTogglesByCategory('analysis')\n\n  const handleToggle = (id: string, enabled: boolean) => {\n    updateToggle(id as any, enabled)\n  }\n\n  const handleReset = () => {\n    if (window.confirm('Reset all UI toggles to their default values?')) {\n      resetToDefaults()\n    }\n  }\n\n  if (!isExpanded) {\n    return (\n      <div className={`${styles.togglePanelCollapsed} ${className}`}>\n        <button\n          onClick={() => setIsExpanded(true)}\n          className={styles.expandButton}\n          aria-label=\"Open UI controls panel\"\n          title=\"Open UI controls\"\n        >\n          \n        </button>\n      </div>\n    )\n  }\n\n  return (\n    <div className={`${styles.togglePanel} ${className}`}>\n      <div className={styles.panelHeader}>\n        <h3 className={styles.panelTitle}>UI Controls</h3>\n        <div className={styles.panelActions}>\n          <button\n            onClick={handleReset}\n            className={styles.resetButton}\n            aria-label=\"Reset to defaults\"\n            title=\"Reset all toggles to default values\"\n          >\n            \n          </button>\n          {onClose && (\n            <button\n              onClick={() => {\n                setIsExpanded(false)\n                onClose()\n              }}\n              className={styles.closeButton}\n              aria-label=\"Close panel\"\n              title=\"Close UI controls panel\"\n            >\n              \n            </button>\n          )}\n          {!onClose && (\n            <button\n              onClick={() => setIsExpanded(false)}\n              className={styles.collapseButton}\n              aria-label=\"Collapse panel\"\n              title=\"Collapse UI controls panel\"\n            >\n              \n            </button>\n          )}\n        </div>\n      </div>\n\n      <div className={styles.panelContent}>\n        <ToggleSection\n          title=\"Display Options\"\n          toggles={displayToggles}\n          onToggle={handleToggle}\n        />\n\n        <ToggleSection\n          title=\"Analysis Options\"\n          toggles={analysisToggles}\n          onToggle={handleToggle}\n        />\n      </div>\n\n      <div className={styles.panelFooter}>\n        <p className={styles.footerText}>\n          Changes are saved automatically\n        </p>\n      </div>\n    </div>\n  )\n}\n\nexport default UiTogglePanel","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/diceFormulaInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/footer.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":1,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":4,"column":17,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":4,"endColumn":19,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[87,89],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[87,89],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"no-empty-pattern","severity":1,"message":"Unexpected empty object pattern.","line":4,"column":24,"nodeType":"ObjectPattern","messageId":"unexpected","endLine":4,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC } from \"react\";\nimport styles from './footer.module.scss'\n\nconst Footer:FC<{}> = ({}) => {\n    return (\n        <div className={styles.footer}>\n            <span className={styles.legal}>\n                BattleSim is a 5e combat simulator by Trekiros. BattleSim is unofficial Fan Content permitted under the Fan Content Policy. Not approved/endorsed by Wizards. Portions of the materials used are property of Wizards of the Coast. Wizards of the Coast LLC.\n            </span>\n            <span className={styles.socials}>\n                <a href=\"https://youtube.com/@trekiros\" target=\"_blank\">\n                    <img src=\"./socials/youtube.svg\" alt=\"Youtube\" />\n                </a>\n                <a href=\"https://discord.gg/9AJtv5DJ6f\" target=\"_blank\">\n                    <img src=\"./socials/discord.svg\" alt=\"Discord\" />\n                </a>\n                <a href=\"https://twitter.com/trekiros\" target=\"_blank\">\n                    <img src=\"./socials/twitter.svg\" alt=\"Twitter\" />\n                </a>\n                <a href=\"https://github.com/Trekiros/battleSim\" target=\"_blank\">\n                    <img src=\"./socials/github.svg\" alt=\"Github\" />\n                </a>\n            </span>\n        </div>\n    )\n}\n\nexport default Footer","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/logo.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":1,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":4,"column":17,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":6,"endColumn":2,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[84,99],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[84,99],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used.","line":8,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC } from \"react\"\nimport styles from './logo.module.scss'\n\ntype PropType = {\n    // TODO\n}\n\nconst Logo: FC<PropType> = (props) => {\n    return (\n        <div className={styles.logo}>\n            \n        <div className={styles.bookContainer}>\n                <div className={styles.book}></div>\n        \n                <div className={styles.corner}></div>\n                <div className={styles.corner}></div>\n                <div className={styles.corner}></div>\n                <div className={styles.corner}></div>\n        \n                <div className={styles.rim}>\n                    <div>\n                        <div></div>\n                    </div>\n                </div>\n\n                <div className={styles.ribbonContainer}>\n                    <div className={styles.ribbon}></div>\n                </div>\n            </div>\n\n            <div className={styles.playBtnContainer}>\n                <div className={styles.playBtn}></div>\n            </div>\n        </div>\n    )\n}\n\nexport default Logo","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/range.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/rgpd.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":1,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":3,"column":17,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":3,"endColumn":19,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[56,58],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[56,58],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FC, useEffect } from \"react\";\n\ntype PropType = {}\n\nconst RGPD: FC<PropType> = () => {\n    useEffect(() => {\n        if (typeof window !== 'undefined' && localStorage) {\n            localStorage.setItem('useLocalStorage', 'true');\n        }\n    }, []);\n\n    return null;\n}\n\nexport default RGPD","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/sortTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/components/utils/useLoading.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[841,844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[841,844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3625,3628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3625,3628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react'\nimport {\n  LoadingManager,\n  LoadingStateSummary,\n  LoadingStateChangeEvent,\n  LoadingStateType,\n  LoadingPriority,\n  loadingManager\n} from '../../model/loading'\n\n/**\n * Hook for using the LoadingManager in React components\n *\n * @param manager - Optional LoadingManager instance (defaults to global singleton)\n * @returns Loading state and control functions\n */\nexport function useLoading(manager: LoadingManager = loadingManager) {\n  const [summary, setSummary] = useState<LoadingStateSummary>(() => manager.getSummary())\n\n  useEffect(() => {\n    const unsubscribe = manager.onSummaryUpdate(setSummary)\n    return unsubscribe\n  }, [manager])\n\n  const startOperation = useCallback(\n    (type: LoadingStateType, priority?: LoadingPriority, message?: string, metadata?: Record<string, any>) => {\n      return manager.startOperation(type, priority, message, metadata)\n    },\n    [manager]\n  )\n\n  const updateProgress = useCallback(\n    (operationId: string, progress: number, message?: string) => {\n      manager.updateProgress(operationId, progress, message)\n    },\n    [manager]\n  )\n\n  const completeOperation = useCallback(\n    (operationId: string, message?: string) => {\n      manager.completeOperation(operationId, message)\n    },\n    [manager]\n  )\n\n  const errorOperation = useCallback(\n    (operationId: string, error: string, message?: string) => {\n      manager.errorOperation(operationId, error, message)\n    },\n    [manager]\n  )\n\n  const cancelOperation = useCallback(\n    (operationId: string) => {\n      manager.cancelOperation(operationId)\n    },\n    [manager]\n  )\n\n  return {\n    // State\n    summary,\n    isLoading: summary.isLoading,\n    globalProgress: summary.globalProgress,\n    activeOperations: summary.activeOperations,\n    completedOperations: summary.completedOperations,\n    failedOperations: summary.failedOperations,\n\n    // Actions\n    startOperation,\n    updateProgress,\n    completeOperation,\n    errorOperation,\n    cancelOperation,\n\n    // Utilities\n    getOperation: manager.getOperation.bind(manager),\n    getOperations: manager.getOperations.bind(manager),\n    cleanup: manager.cleanup.bind(manager),\n    reset: manager.reset.bind(manager)\n  }\n}\n\n/**\n * Hook for subscribing to loading state changes for specific operations\n *\n * @param operationId - Optional operation ID to filter events\n * @param manager - Optional LoadingManager instance\n * @returns Loading state change events\n */\nexport function useLoadingEvents(\n  operationId?: string,\n  manager: LoadingManager = loadingManager\n) {\n  const [events, setEvents] = useState<LoadingStateChangeEvent[]>([])\n\n  useEffect(() => {\n    const callback = (event: LoadingStateChangeEvent) => {\n      if (!operationId || event.operationId === operationId) {\n        setEvents(prev => [...prev.slice(-9), event]) // Keep last 10 events\n      }\n    }\n\n    const unsubscribe = manager.onStateChange(callback)\n    return unsubscribe\n  }, [operationId, manager])\n\n  return events\n}\n\n/**\n * Hook for managing a single loading operation with automatic cleanup\n *\n * @param type - Loading state type\n * @param priority - Loading priority\n * @param manager - Optional LoadingManager instance\n * @returns Operation control functions and state\n */\nexport function useLoadingOperation(\n  type: LoadingStateType,\n  priority: LoadingPriority = 'medium',\n  manager: LoadingManager = loadingManager\n) {\n  const [operationId, setOperationId] = useState<string | null>(null)\n  const [isActive, setIsActive] = useState(false)\n\n  const start = useCallback(\n    (message?: string, metadata?: Record<string, any>) => {\n      if (operationId) {\n        console.warn('Loading operation already active')\n        return operationId\n      }\n\n      const id = manager.startOperation(type, priority, message, metadata)\n      setOperationId(id)\n      setIsActive(true)\n      return id\n    },\n    [type, priority, manager, operationId]\n  )\n\n  const update = useCallback(\n    (progress: number, message?: string) => {\n      if (!operationId) {\n        console.warn('No active loading operation')\n        return\n      }\n      manager.updateProgress(operationId, progress, message)\n    },\n    [operationId, manager]\n  )\n\n  const complete = useCallback(\n    (message?: string) => {\n      if (!operationId) {\n        console.warn('No active loading operation')\n        return\n      }\n      manager.completeOperation(operationId, message)\n      setOperationId(null)\n      setIsActive(false)\n    },\n    [operationId, manager]\n  )\n\n  const error = useCallback(\n    (error: string, message?: string) => {\n      if (!operationId) {\n        console.warn('No active loading operation')\n        return\n      }\n      manager.errorOperation(operationId, error, message)\n      setOperationId(null)\n      setIsActive(false)\n    },\n    [operationId, manager]\n  )\n\n  const cancel = useCallback(\n    () => {\n      if (!operationId) {\n        console.warn('No active loading operation')\n        return\n      }\n      manager.cancelOperation(operationId)\n      setOperationId(null)\n      setIsActive(false)\n    },\n    [operationId, manager]\n  )\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (operationId) {\n        manager.cancelOperation(operationId)\n      }\n    }\n  }, [operationId, manager])\n\n  return {\n    operationId,\n    isActive,\n    start,\n    update,\n    complete,\n    error,\n    cancel\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/data/actions.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'uuid' is defined but never used.","line":1,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":286,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9749,9752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9749,9752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { v4 as uuid } from 'uuid'\nimport type { Action, FinalAction } from \"../model/model\"\nimport { ActionSlots, AllyTarget, EnemyTarget } from '../model/enums';\n\nexport type ActionTemplateName = keyof typeof ActionTemplates;\n\nexport const ActionTemplates = {\n    'Bane': createTemplate({\n        actionSlot: ActionSlots.Action,\n        // New Phase 2 fields\n        cost: [\n            { type: 'Discrete', resourceType: 'Action', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 1 } // Would need level info here in full implementation\n        ],\n        requirements: [],\n        tags: ['Spell', 'Necromancy', 'Concentration', 'Control'],\n        // Legacy fields\n        type: 'debuff',\n        targets: 3,\n        target: 'enemy with least HP',\n        buff: {\n            displayName: 'Bane',\n            duration: 'entire encounter',\n            toHit: '-1d4',\n            save: '-1d4',\n            concentration: true,\n        },\n\n        saveDC: 0, // Replaced later\n    }),\n    'Bless': createTemplate({\n        actionSlot: ActionSlots.Action,\n        // New Phase 2 fields\n        cost: [\n            { type: 'Discrete', resourceType: 'Action', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 1 } // Level 1 spell slot\n        ],\n        requirements: [],\n        tags: ['Spell', 'Concentration', 'Support', 'Healing'],\n        // Legacy fields\n        type: 'buff',\n        targets: 3,\n        target: 'ally with least HP',\n        buff: {\n            displayName: 'Bless',\n            duration: 'entire encounter',\n            toHit: '1d4',\n            save: '1d4',\n            concentration: true,\n        },\n    }),\n    'Haste': createTemplate({\n        actionSlot: ActionSlots.Action,\n        cost: [{ type: 'Discrete', resourceType: 'Action', amount: 1 }],\n        requirements: [],\n        tags: ['Spell', 'Concentration', 'Support'],\n        type: 'buff',\n        targets: 1,\n        buff: {\n            displayName: 'Haste',\n            duration: 'entire encounter', // 1 minute\n            ac: '2',\n            condition: 'Hasted',\n            concentration: true,\n        },\n    }),\n    'Holy Weapon': createTemplate({\n        actionSlot: ActionSlots['Bonus Action'], // Keep for backward compatibility, but define new costs\n        cost: [\n            { type: 'Discrete', resourceType: 'BonusAction', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 5 } // 5th-level spell, but can be higher. Use base level for template\n        ],\n        requirements: [],\n        tags: ['Spell', 'Concentration', 'Buff', 'Radiant'],\n        type: 'buff',\n        targets: 1,\n        target: 'self', // Usually weapon, simplifying to self for now\n        buff: {\n            displayName: 'Holy Weapon',\n            duration: 'entire encounter', // 1 hour\n            damage: '2d8',\n            concentration: true,\n        },\n    }),\n    'Hunter\\'s Mark': createTemplate({\n        actionSlot: ActionSlots['Bonus Action'], // Keep for backward compatibility, but define new costs\n        cost: [\n            { type: 'Discrete', resourceType: 'BonusAction', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 1 } // 1st-level spell\n        ],\n        requirements: [],\n        tags: ['Spell', 'Concentration', 'Buff', 'Damage'],\n        type: 'buff',\n        targets: 1,\n        target: 'enemy with least HP', // Mark the priority target\n        buff: {\n            displayName: 'Hunter\\'s Mark',\n            duration: 'entire encounter', // Simplified from 1 hour\n            damage: '1d6', // Extra damage on each weapon attack hit\n            concentration: true,\n        },\n    }),\n    'Fireball': createTemplate({\n        actionSlot: ActionSlots.Action,\n        // New Phase 2 fields\n        cost: [\n            { type: 'Discrete', resourceType: 'Action', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 3 } // Level 3 spell slot\n        ],\n        requirements: [],\n        tags: ['Spell', 'Evocation', 'Fire', 'AoE', 'Attack'],\n        // Legacy fields\n        type: 'atk',\n        targets: 2,\n        useSaves: true,\n        dpr: '8d6',\n        halfOnSave: true,\n\n        toHit: 0,\n    }),\n    'Heal': createTemplate({\n        actionSlot: ActionSlots.Action,\n        cost: [\n            { type: 'Discrete', resourceType: 'Action', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 6 } // Level 6 spell\n        ],\n        requirements: [],\n        tags: ['Spell', 'Evocation', 'Healing', 'Support'],\n        type: 'heal',\n        targets: 1,\n        amount: 70,\n    }),\n    'Hypnotic Pattern': createTemplate({\n        actionSlot: ActionSlots.Action,\n        cost: [\n            { type: 'Discrete', resourceType: 'Action', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 3 }\n        ],\n        requirements: [],\n        tags: ['Spell', 'Concentration', 'AoE', 'Enchantment', 'Control'],\n        type: 'debuff',\n        targets: 4, // Area of effect approximation\n        saveDC: 0,\n        buff: {\n            displayName: 'Hypnotic Pattern',\n            duration: 'entire encounter', // 1 minute\n            condition: 'Incapacitated',\n            concentration: true,\n        },\n    }),\n    'Meteor Swarm': createTemplate({\n        actionSlot: ActionSlots.Action,\n        cost: [\n            { type: 'Discrete', resourceType: 'Action', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 9 }\n        ],\n        requirements: [],\n        tags: ['Spell', 'AoE', 'Evocation', 'Fire', 'Attack', 'Damage'],\n        type: 'atk',\n        targets: 4,\n        useSaves: true,\n        dpr: '20d6 + 20d6',\n        halfOnSave: true,\n        toHit: 0,\n    }),\n    'Greater Invisibility': createTemplate({\n        actionSlot: ActionSlots.Action,\n        cost: [\n            { type: 'Discrete', resourceType: 'Action', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 4 }\n        ],\n        requirements: [],\n        tags: ['Spell', 'Concentration', 'Buff', 'Illusion'],\n        type: 'buff',\n        targets: 1,\n        buff: {\n            displayName: 'Greater Invisibility',\n            duration: 'entire encounter', // 1 minute\n            condition: 'Invisible',\n            concentration: true,\n        },\n    }),\n    'Shield': createTemplate({\n        actionSlot: ActionSlots.Reaction,\n        cost: [\n            { type: 'Discrete', resourceType: 'Reaction', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 1 }\n        ],\n        requirements: [],\n        tags: ['Spell', 'Abjuration', 'Defense'],\n        type: 'buff',\n        targets: 1,\n        target: 'self',\n        buff: {\n            displayName: 'Shield',\n            duration: '1 round',\n            ac: '5',\n        },\n    }),\n    'Mage Armour': createTemplate({\n        actionSlot: -3, // Pre-combat by default\n        cost: [\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 1 }\n        ],\n        requirements: [],\n        tags: ['Spell', 'Abjuration', 'Buff'],\n        type: 'buff',\n        targets: 1,\n        target: 'self',\n        buff: {\n            displayName: 'Mage Armour',\n            duration: 'entire encounter', // 8 hours\n            ac: '3',\n        },\n    }),\n    'Armor of Agathys': createTemplate({\n        actionSlot: -3, // Pre-combat by default\n        cost: [\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 1 }\n        ],\n        requirements: [],\n        tags: ['Spell', 'Abjuration', 'Buff', 'TempHP', 'Defense'],\n        type: 'heal', // Using heal for THP application\n        targets: 1,\n        target: 'self',\n        amount: 0, // Base amount, scaled by level usually\n        tempHP: true,\n    }),\n    'False Life': createTemplate({\n        actionSlot: -3,\n        cost: [\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 1 }\n        ],\n        requirements: [],\n        tags: ['Spell', 'Necromancy', 'Buff', 'TempHP'],\n        type: 'heal',\n        targets: 1,\n        target: 'self',\n        amount: '1d4 + 4',\n        tempHP: true,\n    }),\n    'Shield of Faith': createTemplate({\n        actionSlot: ActionSlots['Bonus Action'],\n        cost: [\n            { type: 'Discrete', resourceType: 'BonusAction', amount: 1 },\n            { type: 'Discrete', resourceType: 'SpellSlot', amount: 1 }\n        ],\n        requirements: [],\n        tags: ['Spell', 'Concentration', 'Abjuration', 'Buff', 'Defense'],\n        type: 'buff',\n        targets: 1,\n        target: 'ally with least HP',\n        buff: {\n            displayName: 'Shield of Faith',\n            duration: 'entire encounter', // 10 mins\n            ac: '2',\n            concentration: true,\n        },\n    }),\n}\n\ntype RealOmit<T, K extends keyof T> = { [P in keyof T as P extends K ? never : P]: T[P] };\ntype ActionTemplate = RealOmit<FinalAction, 'condition' | 'target' | 'freq' | 'name' | 'id'> & { target?: AllyTarget | EnemyTarget }\n\n// For type safety\nfunction createTemplate(action: ActionTemplate): ActionTemplate {\n    return action\n}\n\n// Fetches the template if it's a TemplateAction\nexport function getFinalAction(action: Action): FinalAction {\n    if (action.type !== 'template') return action\n\n    const { freq, condition } = action\n    const { toHit, saveDC, target, templateName } = action.templateOptions\n\n    const template: ActionTemplate = ActionTemplates[templateName]\n\n    const result = {\n        ...template,\n        id: action.id,\n        name: templateName,\n        actionSlot: action.actionSlot ?? template.actionSlot,\n        freq,\n        condition,\n        target: template.target || target as any,\n        templateName,\n    }\n\n    if (result.type === 'atk') {\n        if (toHit !== undefined) result.toHit = toHit\n\n        if (result.riderEffect && (saveDC !== undefined)) result.riderEffect.dc = saveDC\n    }\n\n    if (result.type === 'debuff') {\n        if (saveDC !== undefined) result.saveDC = saveDC\n    }\n\n    if (result.type === 'heal') {\n        if (action.templateOptions.amount !== undefined) result.amount = action.templateOptions.amount\n    }\n\n    return result\n}","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/data/data.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":1,"message":"Do not use \"@ts-nocheck\" because it alters compilation errors.","line":1,"column":1,"nodeType":"Line","messageId":"tsDirectiveComment","endLine":1,"endColumn":98},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AtkAction' is defined but never used.","line":3,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HealAction' is defined but never used.","line":3,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMonster' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clone' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":15,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DC' is assigned a value but never used.","line":21,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":245,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":245,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":345,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":345,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":452,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":452,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DC' is assigned a value but never used.","line":457,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":457,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":471,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":471,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17740,17743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17740,17743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":670,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":670,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WIS' is assigned a value but never used.","line":890,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":890,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":1049,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":1049,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":1119,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":1119,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":1188,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":1188,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'acTION' is assigned a value but never used.","line":1335,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1335,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BONUS_ACTION' is assigned a value but never used.","line":1336,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1336,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'REACTION' is assigned a value but never used.","line":1337,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1337,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PASSIVE' is assigned a value but never used.","line":1338,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1338,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RIDER_EFFECT' is assigned a value but never used.","line":1339,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1339,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'multiattack' is defined but never used.","line":1366,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1366,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ADVANTAGE' is assigned a value but never used.","line":1372,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1372,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DISADVANTAGE' is assigned a value but never used.","line":1373,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1373,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'d4' is assigned a value but never used.","line":1374,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1374,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'d6' is assigned a value but never used.","line":1375,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1375,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'d8' is assigned a value but never used.","line":1376,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1376,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'d10' is assigned a value but never used.","line":1377,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1377,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'d12' is assigned a value but never used.","line":1378,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":1378,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":30,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck - Temporarily excluded: legacy actions need migration to new schema (37 remaining)\nimport ClassOptions from '../model/classOptions'\nimport { Action, AtkAction, Creature, DiceFormula, HealAction } from \"../model/model\"\nimport { z } from 'zod'\nimport { getMonster, DefaultMonsters } from './monsters'\nimport { v4 as uuid } from 'uuid'\nimport { ActionSlots } from '../model/enums'\nimport { calculateSpellSlots } from '../model/spellSlots'\nimport { clone } from '../model/utils'\n\n// TODO: \n// 1) Add more options to the templates\n// 2) Find a way to handle multiclasses\n\nfunction artificer(level: number, options: z.infer<typeof ClassOptions.artificer>): Creature {\n    const INT = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const CON = scale(level, { 1: 2, 12: 3, 16: 4, 19: 5 })\n    const PB = pb(level)\n    const ac = scale(level, { 1: 17, 3: 18, 5: 19, 10: 20, 15: 21, 20: 22 })\n    const toHit = INT + PB\n    const DC = 8 + PB + INT\n\n    const fireBolt = `${cantrip(level)}d10`\n    const arcaneFireArm = scale(level, { 1: '', 5: '+1d8[Arcane Firearm]' })\n\n    // Artificer is a unique caster\n    const spellSlots = calculateSpellSlots(level, 'artificer')\n\n    // Build class resources\n    const classResources: Record<string, number> = {}\n\n    // Infusions (level 2)\n    if (level >= 2) {\n        classResources['Infusion Uses'] = scale(level, { 2: 2, 6: 3, 10: 4, 14: 5, 18: 6 })\n    }\n\n    // Flash of Genius (level 7)\n    if (level >= 7) {\n        classResources['Flash of Genius'] = INT\n    }\n\n    // Spell-Storing Item (level 11)\n    if (level >= 11) {\n        classResources['Spell-Storing Item'] = 2 * INT\n    }\n\n    const result: Creature = {\n        id: uuid(),\n        name: name('Artificer', level),\n        ac: ac,\n        saveBonus: scale(level, { 1: PB, 20: PB + 6 }),\n        hp: hp(level, 8, CON),\n        hitDice: `${level}d8`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        spellSlots: spellSlots,\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        triggers: [\n            {\n                id: uuid(),\n                condition: 'on being attacked',\n                cost: ActionSlots.Reaction,\n                action: {\n                    id: uuid(),\n                    type: 'template',\n                    freq: { reset: 'lr', uses: scale(level, { 1: 1, 3: 2, 5: 3, 7: 4, 9: 5, 11: 6, 13: 7, 15: 8, 17: 9 }) },\n                    condition: 'is under half HP',\n                    templateOptions: { templateName: 'Shield' },\n                }\n            }\n        ],\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: 'Firebolt',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: 'at will',\n                    cost: [{ type: 'Discrete', resourceType: 'Action', amount: 1 }],\n                    requirements: [],\n                    tags: ['Attack', 'Damage', 'Fire'],\n                    targets: 1,\n                    target: 'enemy with least HP',\n                    toHit: toHit,\n                    dpr: fireBolt + arcaneFireArm,\n                    condition: 'default',\n                },\n            ],\n            2: [{\n                id: uuid(),\n                name: 'Artificer Infusions',\n                actionSlot: ActionSlots['Before the Encounter Starts'],\n                type: 'buff',\n                freq: '1/fight',\n                cost: [{ type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Infusion Uses', amount: 1 }],\n                requirements: [],\n                tags: ['Buff', 'Support'],\n                condition: 'is available',\n                targets: 100,\n                target: 'ally with most HP',\n                buff: {\n                    duration: 'entire encounter',\n                    toHit: scale(level, { 1: 1, 12: 2 }),\n                    ac: scale(level, { 1: 1, 12: 2 }),\n                }\n            }],\n            3: [{\n                id: uuid(),\n                name: 'Shield Turret',\n                actionSlot: ActionSlots['Bonus Action'],\n                type: 'heal',\n                freq: 'at will',\n                cost: [{ type: 'Discrete', resourceType: 'BonusAction', amount: 1 }],\n                requirements: [],\n                tags: ['TempHP', 'Support'],\n                condition: 'default',\n                targets: 2,\n                target: 'ally with least HP',\n                amount: `1d8+${INT}`,\n                tempHP: true,\n            }],\n        }),\n    }\n\n    return result\n}\n\nfunction barbarian(level: number, options: z.infer<typeof ClassOptions.barbarian>): Creature {\n    const STR = scale(level, { 1: 4, 4: 5, 20: 7 })\n    const CON = scale(level, { 1: 2, 8: 3, 12: 4, 16: 5, 20: 7 })\n    const DEX = 2\n    const PB = pb(level)\n    const RAGE_DAMAGE_BONUS = scale(level, { 1: 2, 9: 3, 16: 4 })\n\n    // Build class resources\n    const classResources: Record<string, number> = {}\n\n    // Rage: uses per Long Rest\n    classResources['Rage'] = scale(level, { 1: 2, 3: 3, 6: 4, 12: 5, 17: 6, 20: 999 })\n\n    const result: Creature = {\n        id: uuid(),\n        name: name('Barbarian', level),\n        ac: 10 + DEX + CON,\n        saveBonus: PB,\n        hp: hp(level, 12, CON),\n        hitDice: `${level}d12`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        initiativeAdvantage: level >= 7, // Feral Instinct (level 7)\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: 'Rage',\n                    actionSlot: ActionSlots['Bonus Action'],\n                    type: 'buff',\n                    targets: 1,\n                    target: 'self',\n                    freq: 'at will',\n                    condition: 'not used yet',\n                    cost: [{ type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Rage', amount: 1 }],\n                    buff: {\n                        displayName: 'Rage',\n                        duration: 'entire encounter',\n                        damageTakenMultiplier: 0.5,\n                    },\n                },\n                {\n                    id: uuid(),\n                    name: `Greatsword${level >= 5 ? ' x2' : ''}`,\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    targets: scale(level, { 1: 1, 5: 2 }),\n                    condition: 'default',\n                    freq: 'at will',\n                    target: 'enemy with least HP',\n                    toHit: `${PB}[PB] + ${STR}[STR]`\n                        + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n                        + (options.gwm ? ` - 5[GWM]` : ''),\n                    dpr: `2d6 + ${STR}[STR] + ${RAGE_DAMAGE_BONUS}[RAGE]`\n                        + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n                        + (options.gwm ? ` + 10[GWM]` : ''),\n                },\n                ...(options.gwm ? [\n                    {\n                        id: uuid(),\n                        name: 'GWM Extra Attack',\n                        actionSlot: ActionSlots['When reducing an enemy to 0 HP'],\n                        type: 'atk',\n                        targets: 1,\n                        condition: 'default',\n                        freq: 'at will',\n                        target: 'enemy with least HP',\n                        toHit: `${PB}[PB] + ${STR}[STR]`\n                            + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n                            + (options.gwm ? ` - 5[GWM]` : ''),\n                        dpr: `2d6 + ${STR}[STR] + ${RAGE_DAMAGE_BONUS}[RAGE]`\n                            + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n                            + (options.gwm ? ` + 10[GWM]` : ''),\n                    } as Action\n                ] : []),\n            ],\n            2: [\n                {\n                    id: uuid(),\n                    name: 'Reckless Attack',\n                    actionSlot: ActionSlots['Other 1'],\n                    type: 'buff',\n                    targets: 1,\n                    condition: 'default',\n                    freq: 'at will',\n                    target: 'self',\n                    buff: {\n                        displayName: 'Reckless Attack',\n                        duration: '1 round',\n                        condition: 'Attacks and is attacked with Advantage',\n                    }\n                },\n            ],\n            11: [\n                {\n                    id: uuid(),\n                    name: 'Relentless Rage',\n                    actionSlot: ActionSlots['When Reduced to 0 HP'],\n                    type: 'heal',\n                    targets: 1,\n                    target: 'self',\n                    freq: { reset: 'sr', uses: scale(level, { 11: 1, 20: 3 }) },\n                    condition: 'is available',\n                    amount: '1',\n                },\n            ],\n        })\n    }\n\n    return result\n}\n\n\nfunction bard(level: number, options: z.infer<typeof ClassOptions.bard>): Creature {\n    const CON = 2\n    const CHA = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const DEX = scale(level, { 1: 2, 12: 3, 16: 4 })\n    const PB = pb(level)\n    const DC = 8 + PB + CHA\n    const BARDIC_INSPI_DICE = scale(level, { 1: '1d6', 5: '1d8', 10: '1d10', 15: '1d12' })\n    const spellSlots = calculateSpellSlots(level, 'full')\n\n    // Build class resources\n    const classResources: Record<string, number> = {}\n\n    // Bardic Inspiration uses\n    classResources['Bardic Inspiration'] = CHA\n\n    // Countercharm (level 6)\n    if (level >= 6) {\n        classResources['Countercharm'] = 1\n    }\n\n    return {\n        id: uuid(),\n        name: name('Bard', level),\n        ac: 13 + DEX,\n        saveBonus: PB,\n        hp: hp(level, 8, CON),\n        hitDice: `${level}d8`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        spellSlots: spellSlots,\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: 'Vicious Mockery',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    targets: 1,\n                    condition: 'default',\n                    freq: 'at will',\n                    target: 'enemy with highest DPR',\n                    toHit: DC,\n                    useSaves: true,\n                    dpr: `${cantrip(level)}d4`,\n                    riderEffect: {\n                        dc: 100,\n                        buff: {\n                            displayName: 'Vicious Mockery',\n                            duration: 'until next attack made',\n                            condition: 'Attacks with Disadvantage',\n                        },\n                    }\n                },\n                {\n                    id: uuid(),\n                    type: 'template',\n                    condition: 'not used yet',\n                    templateOptions: { templateName: 'Bane', saveDC: DC, target: 'enemy with highest DPR' },\n                },\n                {\n                    id: uuid(),\n                    name: 'Bardic Inspiration',\n                    actionSlot: ActionSlots['Bonus Action'],\n                    type: 'buff',\n                    targets: 1,\n                    condition: 'default',\n                    freq: 'at will',\n                    cost: [{ type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Bardic Inspiration', amount: 1 }],\n                    target: 'ally with highest DPR',\n                    buff: {\n                        duration: 'until next attack made',\n                        toHit: BARDIC_INSPI_DICE,\n                    },\n                },\n                {\n                    id: uuid(),\n                    name: (level < 9) ? 'Cure Wounds' : 'Mass Cure Wounds',\n                    actionSlot: ActionSlots.Action,\n                    type: 'heal',\n                    targets: (level < 9) ? 1 : 6,\n                    freq: { reset: 'lr', uses: scale(level, { 1: 1, 3: 2, 5: 3, 7: 4, 9: 2, 11: 3, 13: 4, 15: 5, 17: 6 }) },\n                    condition: 'ally at 0 HP',\n                    target: 'ally with least HP',\n                    amount: `${Math.ceil(level / 3)}d8 + ${CHA}`,\n                }\n            ],\n            5: [\n                {\n                    id: uuid(),\n                    type: 'template',\n                    condition: 'not used yet',\n                    templateOptions: { templateName: 'Hypnotic Pattern', saveDC: DC, target: 'enemy with highest DPR' }\n                },\n            ]\n        }),\n    }\n}\n\nfunction cleric(level: number, options: z.infer<typeof ClassOptions.cleric>): Creature {\n    const CON = 2\n    const WIS = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const PB = pb(level)\n    const DC = 8 + PB + WIS\n    const toHit = PB + WIS\n\n    const spellSlots = calculateSpellSlots(level, 'full')\n\n    // Build class resources\n    const classResources: Record<string, number> = {}\n\n    // Channel Divinity uses (resets on short/long rest)\n    if (level >= 2) {\n        classResources['Channel Divinity'] = scale(level, { 2: 1, 6: 2, 18: 3 })\n    }\n\n    return {\n        id: uuid(),\n        name: name('Cleric', level),\n        ac: scale(level, { 1: 17, 3: 18, 5: 19, 10: 20 }),\n        saveBonus: PB,\n        hp: hp(level, 8, CON),\n        hitDice: `${level}d8`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        spellSlots: spellSlots,\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: 'Sacred Flame',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    targets: 1,\n                    freq: 'at will',\n                    condition: 'default',\n                    target: 'enemy with least HP',\n                    useSaves: true,\n                    toHit: DC,\n                    dpr: `${cantrip(level)}d8` + (level >= 8 ? ` + ${WIS}[Potent Spellcasting]` : ''),\n                },\n                {\n                    id: uuid(),\n                    type: 'template',\n                    condition: 'not used yet',\n                    templateOptions: { templateName: 'Bless', target: 'ally with highest DPR' },\n                },\n                {\n                    id: uuid(),\n                    name: scale(level, { 1: 'Cure Wounds', 11: 'Heal' }),\n                    actionSlot: ActionSlots.Action,\n                    type: 'heal',\n                    targets: 1,\n                    freq: { reset: 'lr', uses: scale(level, { 1: 1, 3: 2, 5: 3, 7: 4, 9: 5, 11: 1, 13: 2, 15: 3 }) },\n                    condition: 'ally at 0 HP',\n                    target: 'ally with least HP',\n                    amount: scale(level, { 1: `${Math.ceil(level / 3)}d8 + ${WIS}`, 11: 70 }),\n                },\n            ],\n            3: [\n                {\n                    id: uuid(),\n                    name: 'Spiritual Weapon',\n                    actionSlot: ActionSlots['Bonus Action'],\n                    type: 'atk',\n                    targets: 1,\n                    freq: 'at will',\n                    condition: 'default',\n                    target: 'enemy with least HP',\n                    toHit: toHit,\n                    dpr: `${Math.ceil(level / 6)}d8 + ${WIS}`,\n                },\n            ],\n            5: [\n                {\n                    id: uuid(),\n                    name: 'Spirit Guardians',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    targets: 3,\n                    freq: 'at will',\n                    condition: 'default',\n                    target: 'enemy with least HP',\n                    useSaves: true,\n                    halfOnSave: true,\n                    toHit: DC,\n                    dpr: `${(Math.ceil(level / 5) + 2)}d6`,\n                },\n                {\n                    id: uuid(),\n                    name: scale(level, { 5: 'Mass Healing Word', 9: 'Mass Cure Wounds' }),\n                    actionSlot: ActionSlots.Action,\n                    type: 'heal',\n                    targets: 6,\n                    freq: { reset: 'lr', uses: scale(level, { 5: 1, 9: 2, 13: 3, 17: 4 }) },\n                    condition: 'ally under half HP',\n                    target: 'ally with least HP',\n                    amount: scale(level, { 5: `1d4 + ${WIS}`, 9: `3d8 + ${WIS}`, 17: 70 }),\n                },\n            ],\n        }),\n    }\n}\n\nfunction druid(level: number, options: z.infer<typeof ClassOptions.druid>): Creature {\n    const CON = 2\n    const DEX = 2\n    const WIS = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const PB = pb(level)\n    const DC = 8 + PB + WIS\n    const toHit = PB + WIS\n\n    const spellSlots = calculateSpellSlots(level, 'full')\n\n    // Build class resources\n    const classResources: Record<string, number> = {}\n\n    // Wild Shape uses (resets on short/long rest, unlimited at level 20)\n    if (level >= 2) {\n        classResources['Wild Shape'] = scale(level, { 2: 2, 20: 999 })\n    }\n\n    const wildshape = scale<Creature>(level, {\n        1: { name: 'None', hp: 0, ac: 10, actions: [] } as any, // Placeholder for lvl 1\n        2: DefaultMonsters.find(m => m.name === 'Dire Wolf')!,\n        6: DefaultMonsters.find(m => m.name === 'Giant Constrictor Snake')!,\n        9: DefaultMonsters.find(m => m.name === 'Giant Scorpion')!,\n        10: DefaultMonsters.find(m => m.name === 'Fire Elemental')!,\n    })\n\n    const wildShapeAction: Action = {\n        id: uuid(),\n        name: `Wild Shape: ${wildshape.name}`,\n        actionSlot: ActionSlots['Bonus Action'],\n        type: 'heal',\n        target: 'self',\n        targets: 1,\n        condition: 'has no THP',\n        freq: 'at will',\n        cost: [{ type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Wild Shape', amount: 1 }],\n        amount: wildshape.hp,\n        tempHP: true,\n    }\n\n    return {\n        id: uuid(),\n        name: name('Druid', level),\n        ac: level >= 2 ? wildshape.ac : 14 + DEX,\n        saveBonus: PB,\n        hp: hp(level, 8, CON),\n        hitDice: `${level}d8`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        spellSlots: spellSlots,\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        actions: [\n            ...(level >= 2 ? wildshape.actions : [\n                {\n                    id: uuid(),\n                    name: 'Shillelagh',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    condition: 'default',\n                    freq: 'at will',\n                    targets: 1,\n                    target: 'enemy with least HP',\n                    toHit: toHit,\n                    dpr: `1d8 + ${WIS}`,\n                },\n            ]),\n            ...scaleArray<Action>(level, {\n                1: [\n                    {\n                        id: uuid(),\n                        name: 'Cure Wounds',\n                        actionSlot: ActionSlots.Action,\n                        type: 'heal',\n                        targets: 1,\n                        cost: [{ type: 'Discrete', resourceType: 'SpellSlot', resourceVal: 'level_1', amount: 1 }],\n                        condition: 'ally at 0 HP',\n                        target: 'ally with least HP',\n                        amount: `1d8 + ${WIS}`,\n                    },\n                ],\n                18: [\n                    {\n                        id: uuid(),\n                        type: 'template',\n                        condition: 'ally at 0 HP',\n                        templateOptions: { templateName: 'Heal', target: 'ally with least HP' },\n                    },\n                ],\n            }),\n            ...(level >= 2 ? [wildShapeAction] : []),\n        ].reverse(),\n    }\n}\n\nfunction fighter(level: number, options: z.infer<typeof ClassOptions.fighter>): Creature {\n    const CON = 2\n    const STR = scale(level, { 1: 4, 4: 5, 6: 5 })\n    const PB = pb(level)\n    const ac = scale(level, { 1: 16, 3: 17, 6: 18, 10: 19, 15: 20 })\n    const toHit = `${PB}[PB] + ${STR}[STR]`\n        + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n        + (options.gwm ? ` - 5[GWM]` : '')\n\n    const attacks = scale(level, { 1: 1, 5: 2, 11: 3, 20: 4 })\n\n    // Build class resources\n    const classResources: Record<string, number> = {}\n\n    // Action Surge\n    if (level >= 2) {\n        classResources['Action Surge'] = scale(level, { 2: 1, 17: 2 })\n    }\n\n    // Second Wind\n    classResources['Second Wind'] = 1\n\n    // Indomitable\n    if (level >= 9) {\n        classResources['Indomitable'] = scale(level, { 9: 1, 13: 2, 17: 3 })\n    }\n\n    const action: Action = {\n        id: uuid(),\n        name: `Greatsword${attacks > 1 ? ' x' + attacks : ''}`,\n        actionSlot: ActionSlots.Action,\n        type: 'atk',\n        freq: 'at will',\n        condition: 'default',\n        target: 'enemy with least HP',\n        targets: attacks,\n        cost: [{ type: 'Discrete', resourceType: 'Action', amount: 1 }],\n        requirements: [],\n        tags: ['Melee', 'Weapon', ...(options.gwm ? ['GWM' as const] : [])],\n        toHit: toHit,\n        dpr: `2d6 + ${STR}[STR]`\n            + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n            + (options.gwm ? ' + 10[GWM]' : '')\n    }\n\n    return {\n        id: uuid(),\n        name: name('Fighter', level),\n        ac: ac,\n        saveBonus: PB,\n        conSaveBonus: PB + CON,\n        hp: hp(level, 10, CON),\n        hitDice: `${level}d10`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        actions: scaleArray<Action>(level, {\n            1: [\n                action,\n                {\n                    id: uuid(),\n                    name: 'Second Wind',\n                    actionSlot: ActionSlots['Bonus Action'],\n                    type: 'heal',\n                    target: 'self',\n                    freq: { reset: 'sr', uses: 1 },\n                    condition: 'is under half HP',\n                    targets: 1,\n                    cost: [\n                        { type: 'Discrete', resourceType: 'BonusAction', amount: 1 },\n                        { type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Second Wind', amount: 1 }\n                    ],\n                    requirements: [],\n                    tags: ['Healing'],\n                    amount: `1d10 + ${level}`,\n                }\n            ],\n            2: [\n                {\n                    id: uuid(),\n                    name: `Action Surge: ${action.name}`,\n                    actionSlot: ActionSlots.Other1,\n                    freq: 'at will', // Consumes resource\n                    condition: 'is available',\n                    type: 'atk',\n                    target: 'enemy with least HP',\n                    targets: attacks,\n                    cost: [\n                        { type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Action Surge', amount: 1 }\n                    ],\n                    requirements: [],\n                    tags: ['Melee', 'Weapon', ...(options.gwm ? ['GWM' as const] : [])],\n                    toHit: toHit,\n                    dpr: action.dpr,\n                }\n            ],\n            9: [\n                {\n                    id: uuid(),\n                    name: 'Indomitable',\n                    actionSlot: ActionSlots.Other2,\n                    type: 'buff',\n                    freq: 'at will', // Consumes resource\n                    condition: 'default',\n                    targets: 1,\n                    target: 'self',\n                    cost: [\n                        { type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Indomitable', amount: 1 }\n                    ],\n                    requirements: [],\n                    tags: ['Defense'],\n                    buff: {\n                        displayName: 'Indomitable',\n                        duration: 'until next attack taken',\n                        save: 10, // Reroll approximation\n                    },\n                }\n            ],\n        })\n    }\n}\n\nfunction monk(level: number, options: z.infer<typeof ClassOptions.monk>): Creature {\n    const CON = 2\n    const DEX = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const WIS = scale(level, { 1: 3, 4: 4, 12: 5 })\n    const PB = pb(level)\n    const toHit = PB + DEX\n    const DC = 8 + PB + WIS\n    const ac = 10 + DEX + WIS\n\n    const martialArtsDie = scale(level, { 1: '1d4', 5: '1d6', 11: '1d8', 17: '1d10' })\n\n    // Build class resources\n    const classResources: Record<string, number> = {}\n\n    // Ki Points (resets on short/long rest)\n    if (level >= 2) {\n        classResources['Ki Points'] = level\n    }\n\n    return {\n        id: uuid(),\n        name: name('Monk', level),\n        ac: ac,\n        saveBonus: PB,\n        hp: hp(level, 8, CON),\n        hitDice: `${level}d8`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: scale(level, { 1: 'Quarterstaff', 5: 'Quarterstaff x2' }),\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: scale(level, { 1: 1, 5: 2 }),\n                    target: 'enemy with highest DPR',\n                    toHit: toHit,\n                    dpr: `1d8 + ${DEX}`,\n                },\n                {\n                    id: uuid(),\n                    name: 'Unarmed Strike (Bonus Action)',\n                    actionSlot: ActionSlots['Bonus Action'],\n                    type: 'atk',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 1,\n                    target: 'enemy with highest DPR',\n                    toHit: toHit,\n                    dpr: `${martialArtsDie} + ${DEX}`,\n                },\n            ],\n            2: [\n                {\n                    id: uuid(),\n                    name: 'Flurry of Blows',\n                    actionSlot: ActionSlots['Bonus Action'],\n                    type: 'atk',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 2,\n                    target: 'enemy with highest DPR',\n                    toHit: toHit,\n                    dpr: `${martialArtsDie} + ${DEX}`,\n                    cost: [{ type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Ki Points', amount: 1 }],\n                },\n                {\n                    id: uuid(),\n                    name: 'Patient Defense (Dodge)',\n                    actionSlot: ActionSlots['Bonus Action'],\n                    type: 'buff',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 1,\n                    target: 'self',\n                    cost: [{ type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Ki Points', amount: 1 }],\n                    buff: {\n                        displayName: 'Patient Defense',\n                        duration: '1 round',\n                        condition: 'Is attacked with Disadvantage',\n                    },\n                },\n            ],\n            5: [\n                {\n                    id: uuid(),\n                    name: 'Stunning Strike',\n                    actionSlot: ActionSlots['Other 1'],\n                    type: 'debuff',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 1,\n                    target: 'enemy with highest DPR',\n                    cost: [{ type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Ki Points', amount: 1 }],\n                    saveDC: DC,\n                    buff: {\n                        displayName: 'Stunned',\n                        duration: '1 round',\n                        condition: 'Stunned',\n                    },\n                },\n            ],\n        }),\n    }\n}\n\nfunction paladin(level: number, options: z.infer<typeof ClassOptions.paladin>): Creature {\n    const CON = 2\n    const STR = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const CHA = scale(level, { 1: 3, 4: 4, 12: 5 })\n    const PB = pb(level)\n    const ac = scale(level, { 1: 17, 3: 18, 5: 19, 10: 20, 15: 21 })\n    const toHit = `${PB}[PB] + ${STR}[STR]`\n        + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n        + (options.gwm ? ` - 5[GWM]` : '')\n\n    const spellSlots = calculateSpellSlots(level, 'half')\n\n    const classResources: Record<string, number> = {\n        'Lay on Hands': 5 * level,\n    }\n\n    return {\n        id: uuid(),\n        name: name('Paladin', level),\n        ac: ac,\n        saveBonus: PB,\n        hp: hp(level, 10, CON),\n        hitDice: `${level}d10`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        spellSlots: spellSlots,\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        triggers: [\n            {\n                id: uuid(),\n                condition: 'on hit',\n                action: {\n                    id: uuid(),\n                    name: 'Divine Smite',\n                    actionSlot: ActionSlots['Other 1'],\n                    type: 'atk',\n                    cost: [{ type: 'Discrete', resourceType: 'SpellSlot', resourceVal: 'level_1', amount: 1 }],\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 1,\n                    target: 'enemy with least HP',\n                    toHit: 100,\n                    dpr: `${scale(level, { 1: 2, 5: 3, 11: 4, 17: 5 })}d8`,\n                }\n            }\n        ],\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: scale(level, { 1: 'Longsword', 5: 'Longsword x2' }),\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: scale(level, { 1: 1, 5: 2 }),\n                    target: 'enemy with least HP',\n                    toHit: toHit,\n                    dpr: `1d8 + ${STR}[STR]`\n                        + (level >= 2 ? ' + 2[Fighting Style]' : '')\n                        + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n                        + (options.gwm ? ' + 10[GWM]' : '')\n                        + (level >= 11 ? ' + 1d8[IDS]' : ''),\n                },\n                {\n                    id: uuid(),\n                    name: 'Lay on Hands',\n                    actionSlot: ActionSlots.Action,\n                    type: 'heal',\n                    freq: 'at will',\n                    condition: 'any ally injured',\n                    targets: 1,\n                    target: 'ally with least HP',\n                    amount: 5,\n                    cost: [\n                        {\n                            type: 'Discrete',\n                            resourceType: 'ClassResource',\n                            resourceVal: 'Lay on Hands',\n                            amount: 5,\n                        }\n                    ]\n                },\n            ],\n            6: [\n                {\n                    id: uuid(),\n                    name: 'Aura of Protection',\n                    actionSlot: ActionSlots['Other 2'],\n                    type: 'buff',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 3,\n                    target: 'ally with least HP',\n                    buff: {\n                        displayName: 'Aura of Protection',\n                        duration: '1 round',\n                        save: CHA,\n                    },\n                },\n            ],\n        }),\n    }\n}\n\nfunction ranger(level: number, options: z.infer<typeof ClassOptions.ranger>): Creature {\n    const CON = 2\n    const DEX = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const WIS = scale(level, { 1: 3, 4: 4, 12: 5 })\n    const PB = pb(level)\n    const ac = DEX + scale(level, { 1: 12, 5: 13, 11: 14 })\n    const toHit = `${PB}[PB] + ${DEX}[DEX]`\n        + (level >= 2 ? ' + 2[ARCHERY]' : '')\n        + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n        + (options.ss ? ` - 5[SS]` : '')\n\n    const spellSlots = level >= 2 ? calculateSpellSlots(level, 'half') : undefined\n    const attacks = scale(level, { 1: 1, 5: 2 })\n\n    return {\n        id: uuid(),\n        name: name('Ranger', level),\n        ac: ac,\n        saveBonus: PB,\n        hp: hp(level, 10, CON),\n        hitDice: `${level}d10`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        spellSlots: spellSlots,\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: scale(level, { 1: \"Longbow\", 5: \"Longbow x2\" }),\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: attacks,\n                    target: 'enemy with least HP',\n                    toHit: toHit,\n                    dpr: `1d8 + ${DEX}[DEX]`\n                        + (level >= 2 ? ' + 1d6[HM]' : '')\n                        + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n                        + (options.ss ? ' + 10[SS]' : ''),\n                },\n            ],\n            2: [\n                {\n                    id: uuid(),\n                    type: 'template',\n                    condition: 'not used yet',\n                    templateOptions: { templateName: \"Hunter's Mark\", target: 'enemy with least HP' },\n                },\n            ],\n            3: [\n                {\n                    id: uuid(),\n                    name: 'Colossus Slayer',\n                    actionSlot: ActionSlots['Other 1'],\n                    type: 'buff',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 1,\n                    target: 'self',\n                    buff: {\n                        displayName: 'Colossus Slayer',\n                        duration: 'until next attack made',\n                        damage: '1d8',\n                    },\n                },\n            ],\n        }),\n    }\n}\n\nfunction rogue(level: number, options: z.infer<typeof ClassOptions.rogue>): Creature {\n    const CON = 2\n    const DEX = scale(level, { 1: 4, 4: 5, 10: 5 })\n    const PB = pb(level)\n    const ac = DEX + scale(level, { 1: 12, 5: 13, 11: 14 })\n    const sneakAttack = `${Math.ceil(level / 2)}d6`\n    const toHit = `${PB}[PB] + ${DEX}[DEX]`\n        + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n        + (options.ss ? ` - 5[SS]` : '')\n\n    return {\n        id: uuid(),\n        name: name('Rogue', level),\n        ac: ac,\n        saveBonus: PB,\n        hp: hp(level, 8, CON),\n        hitDice: `${level}d8`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: scale(level, { 1: \"Hand Crossbow\", 4: \"Hand Crossbow + Crossbow Expert\" }),\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: scale(level, { 1: 1, 4: 2 }),\n                    target: 'enemy with least HP',\n                    toHit: toHit,\n                    dpr: `1d6 + ${DEX}[DEX]`\n                        + (options.weaponBonus ? ` + ${options.weaponBonus}[WEAPON]` : '')\n                        + (options.ss ? ' + 10[SS]' : ''),\n                },\n                {\n                    id: uuid(),\n                    name: 'Sneak Attack',\n                    actionSlot: ActionSlots['Other 1'],\n                    type: 'buff',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 1,\n                    target: 'self',\n                    buff: {\n                        displayName: 'Sneak Attack',\n                        duration: 'until next attack made',\n                        damage: sneakAttack\n                    }\n                },\n            ],\n            2: [\n                {\n                    id: uuid(),\n                    name: 'Cunning Action: Dash/Hide/Disengage',\n                    actionSlot: ActionSlots['Bonus Action'],\n                    type: 'buff',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 1,\n                    target: 'self',\n                    buff: {\n                        displayName: 'Cunning Action',\n                        duration: 'until next attack made',\n                        condition: 'Attacks with Advantage',\n                    },\n                },\n            ],\n            5: [\n                {\n                    id: uuid(),\n                    name: 'Uncanny Dodge',\n                    actionSlot: ActionSlots['Other 2'],\n                    type: 'buff',\n                    target: 'self',\n                    targets: 1,\n                    freq: 'at will',\n                    condition: 'default',\n                    buff: {\n                        displayName: 'Uncanny Dodge',\n                        duration: 'until next attack taken',\n                        damageTakenMultiplier: 0.5,\n                    },\n                }\n            ],\n        }),\n    }\n}\n\nfunction sorcerer(level: number, options: z.infer<typeof ClassOptions.sorcerer>): Creature {\n    const CON = 2\n    const DEX = 2\n    const CHA = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const PB = pb(level)\n    const ac = 13 + DEX\n    const toHit = PB + CHA\n    const DC = 8 + PB + CHA\n\n    const spellSlots = calculateSpellSlots(level, 'full')\n\n    // Build class resources\n    const classResources: Record<string, number> = {}\n\n    // Sorcery Points (gained at level 2)\n    if (level >= 2) {\n        classResources['Sorcery Points'] = level\n    }\n\n    return {\n        id: uuid(),\n        name: name('Sorcerer', level),\n        ac: ac,\n        saveBonus: PB,\n        hp: hp(level, 6, CON),\n        hitDice: `${level}d6`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        spellSlots: spellSlots,\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: 'Fire Bolt',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 1,\n                    target: 'enemy with least HP',\n                    toHit: toHit,\n                    dpr: `${cantrip(level)}d10`,\n                },\n            ],\n            3: [\n                {\n                    id: uuid(),\n                    name: 'Quickened Fireball',\n                    actionSlot: ActionSlots['Bonus Action'],\n                    type: 'atk',\n                    freq: 'at will',\n                    cost: [\n                        { type: 'Discrete', resourceType: 'SpellSlot', resourceVal: 'level_3', amount: 1 },\n                        { type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Sorcery Points', amount: 2 }\n                    ],\n                    condition: 'is available',\n                    targets: 2,\n                    target: 'enemy with least HP',\n                    useSaves: true,\n                    halfOnSave: true,\n                    toHit: DC,\n                    dpr: '8d6',\n                },\n            ],\n        }),\n    }\n}\n\nfunction warlock(level: number, options: z.infer<typeof ClassOptions.warlock>): Creature {\n    const CON = 2\n    const DEX = 2\n    const CHA = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const PB = pb(level)\n    const ac = 13 + DEX\n    const DC = 8 + PB + CHA\n    const toHit = PB + CHA\n\n    const spellSlots = calculateSpellSlots(level, 'pact')\n\n    // Build class resources\n    const classResources: Record<string, number> = {}\n\n    // Mystic Arcanum\n    if (level >= 11) classResources['Mystic Arcanum (6th)'] = 1\n    if (level >= 13) classResources['Mystic Arcanum (7th)'] = 1\n    if (level >= 15) classResources['Mystic Arcanum (8th)'] = 1\n    if (level >= 17) classResources['Mystic Arcanum (9th)'] = 1\n\n    return {\n        id: uuid(),\n        name: name('Warlock', level),\n        ac: ac,\n        saveBonus: PB,\n        hp: hp(level, 8, CON),\n        hitDice: `${level}d8`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        spellSlots: spellSlots,\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: 'Eldritch Blast + Hex',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: cantrip(level),\n                    target: 'enemy with least HP',\n                    toHit: toHit,\n                    dpr: `1d10 + 1d6[HEX]`\n                        + (level >= 2 ? ` + ${CHA}[AB]` : ''),\n                },\n                {\n                    id: uuid(),\n                    type: 'template',\n                    condition: 'is available',\n                    templateOptions: {\n                        templateName: 'Armor of Agathys',\n                        amount: (5 * Math.ceil(level / 2)).toString()\n                    },\n                },\n            ],\n            5: [\n                {\n                    id: uuid(),\n                    type: 'template',\n                    condition: 'not used yet',\n                    templateOptions: { templateName: 'Hypnotic Pattern', saveDC: DC, target: 'enemy with highest DPR' },\n                },\n            ],\n        }),\n    }\n}\n\nfunction wizard(level: number, options: z.infer<typeof ClassOptions.wizard>): Creature {\n    const CON = 2\n    const DEX = 2\n    const INT = scale(level, { 1: 4, 4: 5, 8: 5 })\n    const PB = pb(level)\n    const ac = 13 + DEX\n    const toHit = PB + INT\n    const DC = 8 + PB + INT\n\n    const spellSlots = calculateSpellSlots(level, 'full')\n\n    // Class resources\n    const classResources: Record<string, number> = {\n        'Arcane Recovery': 1,\n    }\n\n    if (level >= 14) classResources['Overchannel'] = 1\n\n    return {\n        id: uuid(),\n        name: name('Wizard', level),\n        ac: ac,\n        saveBonus: PB,\n        intSaveBonus: PB + INT,\n        wisSaveBonus: PB + scale(level, { 1: 1, 8: 2, 12: 3 }),\n        hp: hp(level, 6, CON),\n        hitDice: `${level}d6`,\n        conModifier: CON,\n        count: 1,\n        mode: 'player',\n        spellSlots: spellSlots,\n        classResources: Object.keys(classResources).length > 0 ? classResources : undefined,\n        triggers: [\n            {\n                id: uuid(),\n                condition: 'on being attacked',\n                cost: ActionSlots.Reaction,\n                action: {\n                    id: uuid(),\n                    type: 'template',\n                    freq: { reset: 'lr', uses: Math.ceil(level / 2) },\n                    condition: scale(level, { 1: 'is under half HP', 8: 'default' }),\n                    templateOptions: { templateName: 'Shield' },\n                }\n            }\n        ],\n        actions: scaleArray<Action>(level, {\n            1: [\n                {\n                    id: uuid(),\n                    name: 'Fire Bolt',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: 'at will',\n                    condition: 'default',\n                    targets: 1,\n                    target: 'enemy with least HP',\n                    toHit: toHit,\n                    dpr: `${cantrip(level)}d10` + (level >= 10 ? ` + ${INT}[Empowered]` : ''),\n                },\n                {\n                    id: uuid(),\n                    type: 'template',\n                    freq: { reset: 'lr', uses: 1 },\n                    condition: 'not used yet',\n                    templateOptions: { templateName: 'Mage Armour' },\n                },\n            ],\n            3: [\n                {\n                    id: uuid(),\n                    name: 'Magic Missile',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: { reset: 'lr', uses: scale(level, { 3: 2, 5: 3, 7: 4, 9: 5 }) },\n                    condition: 'default',\n                    targets: 3,\n                    target: 'enemy with least HP',\n                    toHit: 100,\n                    dpr: '1d4+1',\n                },\n            ],\n            5: [\n                {\n                    id: uuid(),\n                    name: 'Fireball',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: { reset: 'lr', uses: scale(level, { 5: 2, 9: 3, 13: 4, 17: 5 }) },\n                    condition: 'is available',\n                    targets: scale(level, { 5: 2, 11: 3 }),\n                    target: 'enemy with least HP',\n                    useSaves: true,\n                    halfOnSave: true,\n                    toHit: DC,\n                    dpr: '8d6' + (level >= 10 ? ` + ${INT}[Empowered]` : ''),\n                },\n                {\n                    id: uuid(),\n                    type: 'template',\n                    freq: { reset: 'lr', uses: scale(level, { 5: 1, 9: 2, 13: 3 }) },\n                    condition: 'not used yet',\n                    templateOptions: { templateName: 'Hypnotic Pattern', saveDC: DC, target: 'enemy with highest DPR' },\n                },\n            ],\n            14: [\n                {\n                    id: uuid(),\n                    name: 'Overchannel (Fireball)',\n                    actionSlot: ActionSlots.Action,\n                    type: 'atk',\n                    freq: { reset: 'lr', uses: 1 },\n                    condition: 'is available',\n                    targets: 3,\n                    target: 'enemy with least HP',\n                    cost: [\n                        { type: 'Discrete', resourceType: 'ClassResource', resourceVal: 'Overchannel', amount: 1 }\n                    ],\n                    useSaves: true,\n                    halfOnSave: true,\n                    toHit: DC,\n                    dpr: `48 + ${INT}`,\n                },\n            ],\n        }),\n    }\n}\n\nexport const PlayerTemplates = {\n    artificer,\n    barbarian,\n    bard,\n    cleric,\n    druid,\n    fighter,\n    monk,\n    paladin,\n    ranger,\n    rogue,\n    sorcerer,\n    warlock,\n    wizard,\n} as const\n\n\n/*  UTILS   */\n\nconst acTION = 0\nconst BONUS_ACTION = 1\nconst REACTION = 4\nconst PASSIVE = 5\nconst RIDER_EFFECT = 6\n\nfunction scale<T>(currentLevel: number, levelScale: { [minLevel: number]: T }): T {\n    const keys = Object.keys(levelScale).map(Number);\n    const applicableLevels = keys.filter(scaleLevel => (scaleLevel <= currentLevel));\n\n    if (applicableLevels.length === 0) {\n        // If currentLevel is below all defined minLevels, use the smallest minLevel.\n        // Assumes levelScale is not empty itself.\n        const minLevel = Math.min(...keys);\n        return levelScale[minLevel];\n    }\n\n    const effectiveLevel = applicableLevels.reduce((a, b) => Math.max(a, b));\n    return levelScale[effectiveLevel];\n}\n\nfunction scaleArray<T>(currentLevel: number, minLevelScale: { [minLevel: number]: T[] }): T[] {\n    return [\n        ...Object.keys(minLevelScale)\n            .map(Number)\n            .filter(level => (level <= currentLevel))\n            .flatMap(level => minLevelScale[level])\n            .reverse(),\n    ]\n}\n\nfunction multiattack(level: number, expr: DiceFormula) {\n    if (level < 5) return expr\n\n    return `(${expr})*2`\n}\n\nconst ADVANTAGE = 4.5\nconst DISADVANTAGE = -4.5\nconst d4 = 2.5\nconst d6 = 3.5\nconst d8 = 4.5\nconst d10 = 5.5\nconst d12 = 6.5\nconst cantrip = (level: number) => scale(level, { 1: 1, 5: 2, 11: 3, 17: 4 })\n\nfunction hp(level: number, dieSize: number, con: number) {\n    return dieSize + con + (level - 1) * (Math.floor(dieSize / 2) + 1 + con)\n}\n\nfunction pb(level: number) {\n    return scale(level, { 1: 2, 5: 3, 9: 4, 13: 5, 17: 6 })\n}\n\nfunction name(className: string, level: number) {\n    return `Lv${level} ${className}`\n}","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/data/examples/examples.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/data/examples/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/data/magicItems.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'uuid' is defined but never used.","line":1,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { v4 as uuid } from 'uuid'\nimport type { Buff } from \"../model/model\"\n\nexport type MagicItemTemplateName = keyof typeof MagicItemTemplates;\n\n// Magic item template - base structure without runtime fields\ntype MagicItemTemplate = {\n    name: string;\n    description?: string;\n    requiresAttunement: boolean;\n    buffs: Buff[];\n}\n\n// For type safety\nfunction createTemplate(item: MagicItemTemplate): MagicItemTemplate {\n    return item\n}\n\nexport const MagicItemTemplates = {\n    'Cloak of Protection': createTemplate({\n        name: 'Cloak of Protection',\n        description: 'Wondrous item, uncommon (requires attunement)',\n        requiresAttunement: true,\n        buffs: [{\n            displayName: 'Cloak of Protection',\n            duration: 'entire encounter',\n            ac: 1,\n            save: 1,\n        }],\n    }),\n\n    'Ring of Protection': createTemplate({\n        name: 'Ring of Protection',\n        description: 'Ring, uncommon (requires attunement)',\n        requiresAttunement: true,\n        buffs: [{\n            displayName: 'Ring of Protection',\n            duration: 'entire encounter',\n            ac: 1,\n            save: 1,\n        }],\n    }),\n\n    'Cloak of Displacement': createTemplate({\n        name: 'Cloak of Displacement',\n        description: 'Wondrous item, rare (requires attunement)',\n        requiresAttunement: true,\n        buffs: [{\n            displayName: 'Cloak of Displacement',\n            duration: 'entire encounter',\n            condition: 'Is attacked with Disadvantage',\n            triggers: [{\n                condition: 'OnBeingDamaged',\n                requirements: [],\n                effect: {\n                    type: 'SuppressBuff',\n                    buffId: 'Cloak of Displacement',\n                    duration: '1 round',\n                },\n            }],\n        }],\n    }),\n\n    'Bracers of Defense': createTemplate({\n        name: 'Bracers of Defense',\n        description: 'Wondrous item, uncommon (requires attunement)',\n        requiresAttunement: true,\n        buffs: [{\n            displayName: 'Bracers of Defense',\n            duration: 'entire encounter',\n            ac: 2,\n        }],\n    }),\n\n    'Armor of Agathys': createTemplate({\n        name: 'Armor of Agathys',\n        description: 'Wondrous item, uncommon (requires attunement)',\n        requiresAttunement: true,\n        buffs: [{\n            displayName: 'Armor of Agathys',\n            duration: 'entire encounter',\n            triggers: [{\n                condition: 'OnBeingHit',\n                requirements: ['HasTempHP'],\n                effect: {\n                    type: 'DealDamage',\n                    amount: '5',\n                    damageType: 'Cold',\n                },\n            }],\n        }],\n    }),\n}\n\n// Helper function to get magic item buffs by name\nexport function getMagicItemBuffs(itemName: MagicItemTemplateName): Buff[] {\n    const template = MagicItemTemplates[itemName]\n    return template?.buffs ?? []\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/data/monsters.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":1,"message":"Do not use \"@ts-nocheck\" because it alters compilation errors.","line":1,"column":1,"nodeType":"Line","messageId":"tsDirectiveComment","endLine":1,"endColumn":83}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck - Temporarily excluded: legacy actions need migration to new schema\nimport { Creature } from \"../model/model\"\n\n/**\n * A small set of default monsters kept statically to support\n * templates and initial state without a network fetch.\n * The full library is now in public/data/monsters.json.\n */\nexport const DefaultMonsters: Creature[] = [\n    {\n        \"id\": \"670d1340-c829-4746-b112-d96960ebd650\",\n        \"mode\": \"monster\",\n        \"name\": \"Bandit\",\n        \"type\": \"humanoid\",\n        \"src\": \"MM p.343\",\n        \"cr\": \"1/8\",\n        \"hp\": 11,\n        \"ac\": 12,\n        \"actions\": [\n            {\n                \"id\": \"932121f1-a8ab-4ad1-9c3a-3de0423ff70b\",\n                \"name\": \"Scimitar\",\n                \"type\": \"atk\",\n                \"actionSlot\": 0,\n                \"freq\": \"at will\",\n                \"condition\": \"default\",\n                \"dpr\": \"1d6 + 1\",\n                \"toHit\": 3,\n                \"target\": \"enemy with most HP\",\n                \"targets\": 1\n            },\n            {\n                \"id\": \"06e35845-60e7-4569-90de-3b57e1c6e1c4\",\n                \"name\": \"Light Crossbow\",\n                \"type\": \"atk\",\n                \"actionSlot\": 0,\n                \"freq\": \"at will\",\n                \"condition\": \"default\",\n                \"dpr\": \"1d8 + 1\",\n                \"toHit\": 3,\n                \"target\": \"enemy with most HP\",\n                \"targets\": 1\n            }\n        ],\n        \"count\": 1,\n        \"saveBonus\": 0.0625\n    },\n    {\n        \"id\": \"5ce452a5-0310-4520-9b89-7438c75567e7\",\n        \"mode\": \"monster\",\n        \"name\": \"Dire Wolf\",\n        \"type\": \"beast\",\n        \"src\": \"MM p.321\",\n        \"cr\": \"1\",\n        \"hp\": 37,\n        \"ac\": 14,\n        \"actions\": [\n            {\n                \"id\": \"5ce452a5-0310-4520-9b89-7438c75567e7\",\n                \"name\": \"Bite\",\n                \"type\": \"atk\",\n                \"actionSlot\": 0,\n                \"freq\": \"at will\",\n                \"condition\": \"default\",\n                \"dpr\": \"2d6 + 3\",\n                \"toHit\": 5,\n                \"target\": \"enemy with most HP\",\n                \"targets\": 1\n            }\n        ],\n        \"count\": 1,\n        \"saveBonus\": 0.5\n    },\n    {\n        \"id\": \"e6f4d0c0-359f-4104-8155-0b2e361fc629\",\n        \"mode\": \"monster\",\n        \"name\": \"Giant Constrictor Snake\",\n        \"type\": \"beast\",\n        \"src\": \"MM p.324\",\n        \"cr\": \"2\",\n        \"hp\": 60,\n        \"ac\": 12,\n        \"actions\": [\n            {\n                \"id\": \"e6f4d0c0-359f-4104-8155-0b2e361fc629\",\n                \"name\": \"Bite\",\n                \"type\": \"atk\",\n                \"actionSlot\": 0,\n                \"freq\": \"at will\",\n                \"condition\": \"default\",\n                \"dpr\": \"2d6 + 4\",\n                \"toHit\": 6,\n                \"target\": \"enemy with most HP\",\n                \"targets\": 1\n            }\n        ],\n        \"count\": 1,\n        \"saveBonus\": 1\n    },\n    {\n        \"id\": \"b17786ef-1e13-48ad-9264-f5447c3c4f3b\",\n        \"mode\": \"monster\",\n        \"name\": \"Giant Scorpion\",\n        \"type\": \"beast\",\n        \"src\": \"MM p.327\",\n        \"cr\": \"3\",\n        \"hp\": 52,\n        \"ac\": 15,\n        \"actions\": [\n            {\n                \"id\": \"b17786ef-1e13-48ad-9264-f5447c3c4f3b\",\n                \"name\": \"Claw x 2 & Sting\",\n                \"type\": \"atk\",\n                \"actionSlot\": 0,\n                \"freq\": \"at will\",\n                \"condition\": \"default\",\n                \"dpr\": \"2d8 + 4 + 1d10 + 2 + 4d10\",\n                \"toHit\": 4,\n                \"target\": \"enemy with most HP\",\n                \"targets\": 1\n            }\n        ],\n        \"count\": 1,\n        \"saveBonus\": 1.5\n    },\n    {\n        \"id\": \"23c0a9dc-6a83-4689-8f50-b4995bf8d95a\",\n        \"mode\": \"monster\",\n        \"name\": \"Fire Elemental\",\n        \"type\": \"elemental\",\n        \"src\": \"MM p.125\",\n        \"cr\": \"5\",\n        \"hp\": 102,\n        \"ac\": 13,\n        \"actions\": [\n            {\n                \"id\": \"23c0a9dc-6a83-4689-8f50-b4995bf8d95a\",\n                \"name\": \"Touch x 2\",\n                \"type\": \"atk\",\n                \"actionSlot\": 0,\n                \"freq\": \"at will\",\n                \"condition\": \"default\",\n                \"dpr\": \"2d6 + 3\",\n                \"toHit\": 6,\n                \"target\": \"enemy with most HP\",\n                \"targets\": 2\n            }\n        ],\n        \"count\": 1,\n        \"saveBonus\": 2.5\n    }\n]\n\nexport function getMonster(name: string): Creature | undefined {\n    return DefaultMonsters.find(monster => (monster.name === name))\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/hooks/useCombatPlayback.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/hooks/useSkylineAnalysis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/classOptions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/creature-partial.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/dice.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MathOperation' is defined but never used.","line":1,"column":88,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":101},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'roll' is assigned a value but never used.","line":14,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":16,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":46,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":105,"column":118,"nodeType":null,"messageId":"unusedVar","endLine":105,"endColumn":125}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { AnyRoll, DiceRoller, FullRoll, GroupedRoll, InlineExpression, MathExpression, MathOperation, NumberType, RollExpression, RollExpressionType, RollOrExpression, RootType } from \"dice-roller-parser\"\nimport { range } from \"./utils\"\n\n/** Options applied to the root evaluation, and used if the appropriate condition is met */\nexport interface EvaluationOptions {\n    doubleDice: boolean;    // If enabled, all dice will be doubled, but flat modifiers won't (useful for handling crits)\n}\n\nconst roller = new DiceRoller()\nexport function validateDiceFormula(expr: number|string) {\n    if (typeof expr === 'number' || !isNaN(+expr)) return true\n\n    try {\n        const roll = roller.parse(expr.trim())\n        return true\n    } catch (e) {\n        return false\n    }\n}\n\nexport function evaluateDiceFormula(expr: number|string, luck: number, options: EvaluationOptions = { doubleDice: false }): number {\n    if (typeof expr === 'number') return expr\n    if (!isNaN(+expr)) return Number(expr)\n\n    if (!validateDiceFormula(expr)) throw 'invalid dice expression'\n\n    const roll = roller.parse(expr.trim())\n\n    return evaluateUnknown(roll, luck, options);\n}\n\nfunction evaluateUnknown(roll: RootType|AnyRoll|RollExpression|RollOrExpression, luck: number, options: EvaluationOptions): number {\n    switch (roll.type) {\n        case \"number\":          return evaluateNumber(roll as NumberType, options)\n        case \"die\":             return evaluateDie(roll as FullRoll, luck, options)\n        case \"group\":           return evaluateGroup(roll as GroupedRoll, luck, options)\n        case \"expression\":      return evaluateMathExpr(roll as MathExpression, luck, options)\n        case \"diceExpression\":  return evaluateDiceExpression(roll as RollExpressionType, luck, options)\n        case \"inline\":          return evaluateInline(roll as InlineExpression, luck, options)\n\n        // TODO: handle other types of rolls, if there's demand for it\n        default: return 0\n    }\n}\n\nfunction evaluateNumber(roll: NumberType, options: EvaluationOptions): number {\n    return roll.value\n}\n\nfunction evaluateDie(roll: FullRoll, luck: number, options: EvaluationOptions) {\n    const countMultiplier = options.doubleDice ? 2 : 1\n    const count = countMultiplier * (\n        (roll.count.type === 'number') ? evaluateNumber(roll.count, options) : evaluateMathExpr(roll.count, luck, options)\n    )\n\n    const die = (roll.die.type === \"number\") ? evaluateNumber(roll.die, options)\n        : (roll.die.type === 'expression') ? evaluateMathExpr(roll.die, luck, options)\n        : 0\n\n    let result = count * (die + 1) * luck\n    \n    // TODO: handle multiple mods simultaneously instead of replacing the result\n    for (const mod of roll.mods || []) {\n        if (mod.type === 'explode') {\n            result *= die / (die - 1)\n        } else if (mod.type === 'keep') {\n            const keep = evaluateUnknown(mod.expr, luck, options)\n\n            result = keepHighestLowest(count, die, keep, (mod.highlow === \"l\") ? 'min' : 'max', luck, options)\n        } else if (mod.type === 'drop') {\n            const drop = evaluateUnknown(mod.expr, luck, options)\n\n            result = keepHighestLowest(count, die, count - drop, (mod.highlow === \"l\") ? 'max' : 'min', luck, options)\n        }\n    }\n\n    return result\n}\n\n// Returns an array with the probabilities each face would need to have, for the luck factor to be respected\n// For example, if you roll a d4 and have a luck factor of 0.6, that means you want the average result to be the 60th percentile for a d4:\n// Target average: 1 + (4-1) * 0.6 = 2.8\n// So this function will return the following array: [0.16, 0.22, 0.28, 0.34], which means the weighted die should have 16% chance to roll a 1, 22% chance to roll a 2, etc.\n// This is useful to evaluate advanced dice expressions like 1d8! (exploding dice) or 4d6dl1 (drop lowest/highest) while taking the luck factor into account.\nfunction weightedDie(diceSize: number, luck: number) {\n    // Implementation details:\n    // A simple model was chosen where each face n has a chance to show up equal to A+nB, where A and B are constants that depend on the dice size (N) and the luck factor (L).\n    // The values of A and B were calculated using two equations:\n    // 1) The weighted average (sum from 1 to N of n(A+nB)) should be equal to the target average (1 + (N-1)*L)\n    // 2) The sum of all faces' probabilities (sum from 1 to N of A+nB) should be equal to 1\n    // Then, wolfram alpha was used to simplify the values of A and B.\n\n    // The results can be negative for extreme values of L, but everything works fine for values close to 0.5, \n    // which is okay because extreme luck/extreme unluck scenarios aren't useful for users to simulate\n\n    const A = (4 - 6 * luck) / diceSize\n    const B = (6 * (2 * luck - 1)) / (diceSize * (diceSize + 1))\n    \n    return range(diceSize).map(i => {\n        const n = i+1\n        return Math.min(1, Math.max(0, A + B*n))\n    })\n}\n\nfunction keepHighestLowest(diceCount: number, diceSize: number, keepCount: number, which: 'min'|'max', luck: number, options: EvaluationOptions) {\n    if (diceSize === 0) return 0\n\n    const sort = (a: number, b: number) => (which === 'min') ? (a-b) : (b-a)\n    const weights = weightedDie(diceSize, luck)\n\n    const results = new Map<number, number>()\n    const possibleRolls = BigInt(diceSize) ** BigInt(diceCount)\n    \n    // If the possible rolls would be too computationally intensive, we cap it, and approximate the result instead using random rolls.\n    const maxRolls = 100_000\n    if (possibleRolls * BigInt(diceCount) > BigInt(maxRolls)) {\n        const iterations = maxRolls / diceCount\n        for (let i = 0; i< iterations; i++) {\n            const result = range(diceCount)\n                .map(() => {\n                    let seed = Math.random()\n                    for (let i = 0 ; i < diceSize ; i++) {\n                        const result = i+1\n                        const weight = weights[i]\n\n                        if (seed < weight) return result\n                        else seed -= weight\n                    }\n                    return diceSize // Default, should never occur\n                })\n                .sort(sort)\n                .slice(0, keepCount)\n                .reduce((a,b) => (a+b), 0)\n\n            results.set(result, 1 + (results.get(result) || 0))\n        }\n    }\n\n    // Otherwise, we compute every result to find the exact average\n    else {\n        const rolls = range(diceCount).map(() => 1)\n        function increment() {\n            // A base N counter which overflows. This ensures we go through every single possible composite roll\n            for (let i = diceCount - 1 ; i >= 0 ; i--) {\n                rolls[i]++\n                if (rolls[i] > diceSize) rolls[i] = 1\n                else return;\n            }\n        }\n\n        // Loop until every roll is the max value and record every single result\n        while (rolls.find(roll => roll < diceSize)) {\n            const result = rolls.slice()\n                .sort(sort)\n                .slice(0, keepCount)\n                .reduce((a,b) => (a+b), 0)\n\n            const odds = rolls.map(roll => weights[roll - 1])\n                .reduce((a,b) => (a*b), 1)\n\n            results.set(result, (results.get(result) || 0) + odds)\n\n            increment()\n        }\n    }\n\n    // Calculate average result\n    let sum = 0\n    let rolls = 0\n    for (const [result, count] of results) {\n        sum += result * count\n        rolls += count\n    }\n\n    const average = sum / rolls\n    return average\n}\n\nfunction evaluateGroup(group: GroupedRoll, luck: number, options: EvaluationOptions): number {\n    return group.rolls.map(roll => evaluateUnknown(roll, luck, options))\n        .reduce((a,b) => (a+b))\n}\n\nfunction evaluateDiceExpression(expr: RollExpressionType, luck: number, options: EvaluationOptions): number {\n    const head = evaluateUnknown(expr.head, luck, options)\n\n    const tails = expr.ops\n        .map(op => {\n            const tail = evaluateUnknown(op.tail, luck, options)\n\n            return (op.op === '+') ? tail : -tail\n        })\n        .reduce((a,b) => a+b)\n    \n    return head + tails\n}\n\nfunction evaluateInline(expr: InlineExpression, luck: number, options: EvaluationOptions): number {\n    const unknown = expr.expr as RootType\n    return evaluateUnknown(unknown, luck, options)\n}\n\nfunction evaluateMathExpr(expr: MathExpression, luck: number, options: EvaluationOptions): number {\n    const head = evaluateUnknown(expr.head, luck, options)\n\n    let last = head\n    let sum = 0\n    for (const {tail, op} of expr.ops) {\n        const tailValue = evaluateUnknown(tail, luck, options)\n\n        if (op === \"+\") {\n            sum += last\n            last = tailValue\n        } else if (op === \"-\") {\n            sum += last\n            last = -tailValue\n        } else if (op === \"*\") {\n            last *= tailValue\n        } else if (op === \"/\") {\n            last /= tailValue\n        }\n    }\n    sum += last\n\n    return sum\n}","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/enums.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/events.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/fileLogger.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/fileLogger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/import/5etools-action-parser.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/import/5etools-action-parser.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'evaluateDiceFormula' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { evaluateDiceFormula } from \"../dice\";\nimport { v4 as uuid } from 'uuid';\nimport { AtkAction } from \"../model\";\n\nexport function parse5eAttack(name: string, entry: string): AtkAction {\n    // Extract toHit bonus: {@hit 4}\n    const hitMatch = entry.match(/{@hit\\s+(\\d+)}/);\n    const toHit = hitMatch ? parseInt(hitMatch[1]) : 0;\n\n    // Extract damage formula: {@damage 1d6 + 2}\n    // Note: We only take the first damage formula for simplicity\n    const damageMatch = entry.match(/{@damage\\s+([^}]+)}/);\n    let dpr: string | number = 0;\n    if (damageMatch) {\n        // Store the raw formula string so the engine can roll it\n        dpr = damageMatch[1];\n    }\n\n    return {\n        id: uuid(),\n        name,\n        type: \"atk\",\n        actionSlot: 0,\n        cost: [],\n        requirements: [],\n        tags: [],\n        freq: \"at will\",\n        condition: \"default\",\n        dpr: dpr,\n        toHit: toHit,\n        target: \"enemy with most HP\",\n        targets: 1,\n    };\n}\n\nexport function parse5eMultiattack(entry: string): { total: number, details: string } | null {\n    // Standard pattern: \"makes X attacks\"\n    const numberMap: Record<string, number> = {\n        \"one\": 1, \"two\": 2, \"three\": 3, \"four\": 4, \"five\": 5\n    };\n\n    const match = entry.match(/makes\\s+(\\w+)\\s+(?:melee\\s+)?attacks?/i);\n    if (match) {\n        const numStr = match[1].toLowerCase();\n        const total = numberMap[numStr] || parseInt(numStr) || 1;\n        \n        // Extract details after the colon if present\n        let details = \"\";\n        const colonIndex = entry.indexOf(\":\");\n        if (colonIndex !== -1) {\n            details = entry.substring(colonIndex + 1).replace(/\\.$/, \"\").trim();\n            // Simplify \"one with its bite and one with its claws\" -> \"bite and claws\"\n            details = details.replace(/one with its\\s+/g, \"\").replace(/its\\s+/g, \"\");\n        } else {\n            // e.g. \"makes three melee attacks\" -> details: \"melee attacks\"\n            details = entry.split(\"makes\")[1].trim().replace(/\\.$/, \"\");\n            // remove the number word from details\n            details = details.replace(new RegExp(`^${numStr}\\\\s+`, 'i'), \"\");\n        }\n\n        return { total, details };\n    }\n\n    return null;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/import/5etools-mapper.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1902,1905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1902,1905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3044,3047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3044,3047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3269,3272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3269,3272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { mapMonster5eToCreature } from './5etools-mapper';\nimport { Monster5e } from './5etools-schema';\n\ndescribe('5etools-mapper', () => {\n    it('should map core stats correctly', () => {\n        const monster: Monster5e = {\n            name: \"Aarakocra\",\n            src: \"MM\",\n            hp: { average: 13, formula: \"3d8\" },\n            ac: [12],\n            str: 10,\n            dex: 14,\n            con: 10,\n            int: 11,\n            wis: 12,\n            cha: 11\n        };\n\n        const creature = mapMonster5eToCreature(monster);\n\n        expect(creature.name).toBe(\"Aarakocra\");\n        expect(creature.hp).toBe(13);\n        expect(creature.ac).toBe(12);\n        expect(creature.mode).toBe(\"monster\");\n        expect(creature.actions).toEqual([]); // Actions mapping is Phase 2\n    });\n\n    it('should handle complex AC', () => {\n        const monster: Monster5e = {\n            name: \"Mage\",\n            hp: { average: 40 },\n            ac: [12, { ac: 15, from: [\"mage armor\"] }],\n            str: 9, dex: 14, con: 11, int: 17, wis: 12, cha: 11\n        };\n\n        const creature = mapMonster5eToCreature(monster);\n        expect(creature.ac).toBe(12); // Should take the first base AC for now\n    });\n\n    it('should map basic actions correctly', () => {\n        const monster: Monster5e = {\n            name: \"Aarakocra\",\n            hp: { average: 13 },\n            ac: [12],\n            str: 10, dex: 14, con: 10, int: 11, wis: 12, cha: 11,\n            action: [\n                {\n                    name: \"Talon\",\n                    entries: [\"{@hit 4} to hit, reach 5 ft., one target. {@h}5 ({@damage 1d6 + 2}) piercing damage.\"]\n                }\n            ]\n        };\n\n        const creature = mapMonster5eToCreature(monster);\n        expect(creature.actions.length).toBe(1);\n        const action = creature.actions[0] as any;\n        expect(action.name).toBe(\"Talon\");\n        expect(action.toHit).toBe(4);\n        expect(action.dpr).toBe(\"1d6 + 2\");\n    });\n\n    it('should map multiattack correctly', () => {\n        const monster: Monster5e = {\n            name: \"Owlbear\",\n            hp: { average: 59 },\n            ac: [13],\n            str: 20, dex: 12, con: 17, int: 3, wis: 12, cha: 7,\n            action: [\n                {\n                    name: \"Multiattack\",\n                    entries: [\"The owlbear makes two attacks: one with its beak and one with its claws.\"]\n                },\n                {\n                    name: \"Beak\",\n                    entries: [\"{@hit 7} to hit, reach 5 ft., one target. {@h}10 ({@damage 1d10 + 5}) piercing damage.\"]\n                },\n                {\n                    name: \"Claws\",\n                    entries: [\"{@hit 7} to hit, reach 5 ft., one target. {@h}14 ({@damage 2d8 + 5}) slashing damage.\"]\n                }\n            ]\n        };\n\n        const creature = mapMonster5eToCreature(monster);\n        expect(creature.actions.length).toBe(2);\n        const action0 = creature.actions[0] as any;\n        expect(action0.name).toBe(\"Beak\");\n        expect(action0.targets).toBe(2); // OWlbear makes two attacks total, we map it to 'targets' for simplicity in this engine\n        const action1 = creature.actions[1] as any;\n        expect(action1.name).toBe(\"Claws\");\n        expect(action1.targets).toBe(2);\n    });\n\n    it('should handle Abjurer-style source and nested type', () => {\n        const monster: Monster5e = {\n            name: \"Abjurer Wizard\",\n            source: \"MPMM\",\n            hp: { average: 104 },\n            ac: [12],\n            type: { type: \"humanoid\" },\n            str: 9, dex: 14, con: 14, int: 18, wis: 12, cha: 11\n        };\n\n        const creature = mapMonster5eToCreature(monster);\n        expect(creature.src).toBe(\"MPMM\");\n        expect(creature.type).toBe(\"humanoid\");\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/import/5etools-mapper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/import/5etools-schema.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/import/5etools-schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/import/utils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/import/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/loading.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3205,3208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3205,3208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z } from 'zod'\n\n// Loading state types for different system components\nexport const LoadingStateTypeList = [\n  'core-ui',\n  'simulation-engine',\n  'simulation-data',\n  'background-tasks',\n  'ui-toggle-state'\n] as const\n\nexport const LoadingStateTypeSchema = z.enum(LoadingStateTypeList)\nexport type LoadingStateType = z.infer<typeof LoadingStateTypeSchema>\n\n// Loading operation status\nexport const LoadingStatusList = ['idle', 'loading', 'completed', 'error'] as const\nexport const LoadingStatusSchema = z.enum(LoadingStatusList)\nexport type LoadingStatus = z.infer<typeof LoadingStatusSchema>\n\n// Loading priority levels\nexport const LoadingPriorityList = ['low', 'medium', 'high', 'critical'] as const\nexport const LoadingPrioritySchema = z.enum(LoadingPriorityList)\nexport type LoadingPriority = z.infer<typeof LoadingPrioritySchema>\n\n// Loading operation interface\nexport const LoadingOperationSchema = z.object({\n  id: z.string(),\n  type: LoadingStateTypeSchema,\n  status: LoadingStatusSchema,\n  priority: LoadingPrioritySchema,\n  message: z.string().optional(),\n  progress: z.number().min(0).max(100).optional(),\n  error: z.string().optional(),\n  startTime: z.date(),\n  endTime: z.date().optional(),\n  metadata: z.any().optional()\n})\n\nexport type LoadingOperation = z.infer<typeof LoadingOperationSchema>\n\n// Loading state change event\nexport const LoadingStateChangeEventSchema = z.object({\n  operationId: z.string(),\n  previousState: LoadingOperationSchema,\n  currentState: LoadingOperationSchema,\n  timestamp: z.date()\n})\n\nexport type LoadingStateChangeEvent = z.infer<typeof LoadingStateChangeEventSchema>\n\n// Loading state summary for UI consumption\nexport const LoadingStateSummarySchema = z.object({\n  totalOperations: z.number(),\n  activeOperations: z.number(),\n  completedOperations: z.number(),\n  failedOperations: z.number(),\n  operationsByType: z.record(LoadingStateTypeSchema, z.number()),\n  operationsByStatus: z.record(LoadingStatusSchema, z.number()),\n  highestPriorityActive: LoadingPrioritySchema.optional(),\n  isLoading: z.boolean(),\n  globalProgress: z.number().min(0).max(100)\n})\n\nexport type LoadingStateSummary = z.infer<typeof LoadingStateSummarySchema>\n\n// Event listener callback types\nexport type LoadingStateChangeCallback = (event: LoadingStateChangeEvent) => void\nexport type LoadingStateSummaryCallback = (summary: LoadingStateSummary) => void\n\n/**\n * LoadingManager - Centralized loading state management system\n *\n * Features:\n * - Track multiple loading states simultaneously\n * - Broadcast state changes to subscribed components\n * - Support priority-based loading operations\n * - Provide methods to start, complete, and error loading operations\n * - Include proper TypeScript typing and error handling\n */\nexport class LoadingManager {\n  private operations = new Map<string, LoadingOperation>()\n  private stateChangeListeners = new Set<LoadingStateChangeCallback>()\n  private summaryListeners = new Set<LoadingStateSummaryCallback>()\n  private operationCounter = 0\n\n  /**\n   * Start a new loading operation\n   */\n  startOperation(\n    type: LoadingStateType,\n    priority: LoadingPriority = 'medium',\n    message?: string,\n    metadata?: Record<string, any>\n  ): string {\n    const id = this.generateOperationId()\n    const operation: LoadingOperation = {\n      id,\n      type,\n      status: 'loading',\n      priority,\n      message,\n      progress: 0,\n      startTime: new Date(),\n      metadata\n    }\n\n    this.operations.set(id, operation)\n    this.broadcastStateChange(operation, operation) // previous state doesn't exist, so use current\n    this.broadcastSummaryUpdate()\n\n    return id\n  }\n\n  /**\n   * Update progress of an existing operation\n   */\n  updateProgress(operationId: string, progress: number, message?: string): void {\n    const operation = this.operations.get(operationId)\n    if (!operation) {\n      console.warn(`LoadingManager: Operation ${operationId} not found`)\n      return\n    }\n\n    const previousState = { ...operation }\n    operation.progress = Math.max(0, Math.min(100, progress))\n    if (message !== undefined) {\n      operation.message = message\n    }\n\n    this.operations.set(operationId, operation)\n    this.broadcastStateChange(previousState, operation)\n    this.broadcastSummaryUpdate()\n  }\n\n  /**\n   * Complete a loading operation\n   */\n  completeOperation(operationId: string, message?: string): void {\n    const operation = this.operations.get(operationId)\n    if (!operation) {\n      console.warn(`LoadingManager: Operation ${operationId} not found`)\n      return\n    }\n\n    const previousState = { ...operation }\n    operation.status = 'completed'\n    operation.progress = 100\n    operation.endTime = new Date()\n    if (message !== undefined) {\n      operation.message = message\n    }\n\n    this.operations.set(operationId, operation)\n    this.broadcastStateChange(previousState, operation)\n    this.broadcastSummaryUpdate()\n  }\n\n  /**\n   * Mark a loading operation as failed\n   */\n  errorOperation(operationId: string, error: string, message?: string): void {\n    const operation = this.operations.get(operationId)\n    if (!operation) {\n      console.warn(`LoadingManager: Operation ${operationId} not found`)\n      return\n    }\n\n    const previousState = { ...operation }\n    operation.status = 'error'\n    operation.error = error\n    operation.endTime = new Date()\n    if (message !== undefined) {\n      operation.message = message\n    }\n\n    this.operations.set(operationId, operation)\n    this.broadcastStateChange(previousState, operation)\n    this.broadcastSummaryUpdate()\n  }\n\n  /**\n   * Cancel a loading operation\n   */\n  cancelOperation(operationId: string): void {\n    const operation = this.operations.get(operationId)\n    if (!operation) {\n      console.warn(`LoadingManager: Operation ${operationId} not found`)\n      return\n    }\n\n    const previousState = { ...operation }\n    operation.status = 'idle'\n    operation.endTime = new Date()\n\n    this.operations.set(operationId, operation)\n    this.broadcastStateChange(previousState, operation)\n    this.broadcastSummaryUpdate()\n  }\n\n  /**\n   * Get a specific operation by ID\n   */\n  getOperation(operationId: string): LoadingOperation | undefined {\n    return this.operations.get(operationId)\n  }\n\n  /**\n   * Get all operations, optionally filtered by type or status\n   */\n  getOperations(\n    filter?: {\n      type?: LoadingStateType\n      status?: LoadingStatus\n      priority?: LoadingPriority\n    }\n  ): LoadingOperation[] {\n    let operations = Array.from(this.operations.values())\n\n    if (filter) {\n      operations = operations.filter(op => {\n        if (filter.type && op.type !== filter.type) return false\n        if (filter.status && op.status !== filter.status) return false\n        if (filter.priority && op.priority !== filter.priority) return false\n        return true\n      })\n    }\n\n    return operations\n  }\n\n  /**\n   * Get loading state summary\n   */\n  getSummary(): LoadingStateSummary {\n    const operations = Array.from(this.operations.values())\n    const activeOperations = operations.filter(op => op.status === 'loading')\n    const completedOperations = operations.filter(op => op.status === 'completed')\n    const failedOperations = operations.filter(op => op.status === 'error')\n\n    const operationsByType = operations.reduce((acc, op) => {\n      acc[op.type] = (acc[op.type] || 0) + 1\n      return acc\n    }, {} as Record<LoadingStateType, number>)\n\n    const operationsByStatus = operations.reduce((acc, op) => {\n      acc[op.status] = (acc[op.status] || 0) + 1\n      return acc\n    }, {} as Record<LoadingStatus, number>)\n\n    const highestPriorityActive = activeOperations.length > 0\n      ? activeOperations.reduce((highest, op) =>\n          this.getPriorityWeight(op.priority) > this.getPriorityWeight(highest.priority) ? op : highest\n        ).priority\n      : undefined\n\n    // Calculate global progress based on weighted average of active operations\n    const globalProgress = activeOperations.length > 0\n      ? activeOperations.reduce((sum, op) => sum + (op.progress || 0), 0) / activeOperations.length\n      : 0\n\n    return {\n      totalOperations: operations.length,\n      activeOperations: activeOperations.length,\n      completedOperations: completedOperations.length,\n      failedOperations: failedOperations.length,\n      operationsByType,\n      operationsByStatus,\n      highestPriorityActive,\n      isLoading: activeOperations.length > 0,\n      globalProgress\n    }\n  }\n\n  /**\n   * Subscribe to loading state changes\n   */\n  onStateChange(callback: LoadingStateChangeCallback): () => void {\n    this.stateChangeListeners.add(callback)\n    return () => this.stateChangeListeners.delete(callback)\n  }\n\n  /**\n   * Subscribe to summary updates\n   */\n  onSummaryUpdate(callback: LoadingStateSummaryCallback): () => void {\n    this.summaryListeners.add(callback)\n    return () => this.summaryListeners.delete(callback)\n  }\n\n  /**\n   * Clean up completed/failed operations older than the specified time\n   */\n  cleanup(maxAge: number = 300000): void { // 5 minutes default\n    const now = Date.now()\n    const toDelete: string[] = []\n\n    for (const [id, operation] of this.operations) {\n      if ((operation.status === 'completed' || operation.status === 'error' || operation.status === 'idle') &&\n          operation.endTime &&\n          (now - operation.endTime.getTime()) > maxAge) {\n        toDelete.push(id)\n      }\n    }\n\n    toDelete.forEach(id => this.operations.delete(id))\n\n    if (toDelete.length > 0) {\n      this.broadcastSummaryUpdate()\n    }\n  }\n\n  /**\n   * Reset all operations (useful for testing or full reset)\n   */\n  reset(): void {\n    this.operations.clear()\n    this.operationCounter = 0\n    this.broadcastSummaryUpdate()\n  }\n\n  private generateOperationId(): string {\n    return `loading-op-${++this.operationCounter}-${Date.now()}`\n  }\n\n  private broadcastStateChange(previousState: LoadingOperation, currentState: LoadingOperation): void {\n    const event: LoadingStateChangeEvent = {\n      operationId: currentState.id,\n      previousState,\n      currentState,\n      timestamp: new Date()\n    }\n\n    this.stateChangeListeners.forEach(callback => {\n      try {\n        callback(event)\n      } catch (error) {\n        console.error('LoadingManager: Error in state change callback:', error)\n      }\n    })\n  }\n\n  private broadcastSummaryUpdate(): void {\n    const summary = this.getSummary()\n    this.summaryListeners.forEach(callback => {\n      try {\n        callback(summary)\n      } catch (error) {\n        console.error('LoadingManager: Error in summary update callback:', error)\n      }\n    })\n  }\n\n  private getPriorityWeight(priority: LoadingPriority): number {\n    const weights: Record<LoadingPriority, number> = { low: 1, medium: 2, high: 3, critical: 4 }\n    return weights[priority]\n  }\n}\n\n// Singleton instance for global use\nexport const loadingManager = new LoadingManager()","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/logFormatter.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/logFormatter.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'name' is defined but never used.","line":30,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":24},{"ruleId":"no-useless-escape","severity":1,"message":"Unnecessary escape character: \\-.","line":38,"column":26,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":38,"endColumn":27,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1356,1357],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1356,1356],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3777,3780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3777,3780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionNames' is assigned a value but never used.","line":90,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":78},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getName' is assigned a value but never used.","line":91,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Event, RollResult } from \"./model\";\n\nexport class LogFormatter {\n    static getUnitName(id: string, names: Record<string, string>): string {\n        if (names[id]) return names[id];\n\n        // Try UUID prefix (36 chars) if ID looks like UUID-Suffix\n        if (id.length > 36 && id[36] === '-') {\n            const baseId = id.substring(0, 36);\n            if (names[baseId]) {\n                return names[baseId];\n            }\n        }\n\n        // Try UUID suffix (36 chars) if ID looks like Prefix-UUID\n        // This handles cases from WASM backend like \"step0-m-0-3-UUID\" or \"p-1-0-UUID\"\n        if (id.length > 36) {\n            const suffix = id.substring(id.length - 36);\n            if (names[suffix]) {\n                return names[suffix];\n            }\n        }\n\n        return id;\n    }\n\n    static formatRollResult(result: RollResult, targetAc?: number): string {\n        // Build the value breakdown (e.g. \"12 + 7 + 2\")\n        const valueBreakdown = result.modifiers\n            .map(([name, val], index) => {\n                const prefix = index === 0 ? (val < 0 ? '-' : '') : (val < 0 ? ' - ' : ' + ');\n                return `${prefix}${Math.abs(val)}`;\n            })\n            .join('');\n\n        // Prettify formula: \"1d20+3[PB]\" -> \"1d20 + 3[PB]\"\n        const prettyFormula = result.formula\n            .replace(/([+\\-])/g, ' $1 ')\n            .replace(/\\s+/g, ' ')\n            .trim();\n\n        let output = `${prettyFormula} = ${valueBreakdown} = ${result.total}`;\n\n        if (targetAc !== undefined && targetAc > 0) {\n            const isHit = result.total >= targetAc;\n            output += ` vs. AC ${targetAc} ==> ${isHit ? 'HIT' : 'miss'}`;\n        }\n\n        return output;\n    }\n\n    static toSummary(event: Event, names: Record<string, string>, actionNames: Record<string, string> = {}): string {\n        const getName = (id: string) => this.getUnitName(id, names);\n        const getActionName = (id: string) => actionNames[id] || id;\n\n        switch (event.type) {\n            case 'AttackHit':\n                return `${getName(event.attacker_id)} attacks ${getName(event.target_id)} for ${event.damage} damage.`;\n            case 'AttackMissed':\n                return `${getName(event.attacker_id)} misses ${getName(event.target_id)}.`;\n            case 'TurnStarted':\n                return `${getName(event.unit_id)} starts turn (Round ${event.round_number}).`;\n            case 'ActionStarted':\n                return `${getName(event.actor_id)} uses action: ${getActionName(event.action_id)}.`;\n            case 'ActionSkipped':\n                return ` ${getName(event.actor_id)} skipped ${getActionName(event.action_id)}: ${event.reason}`;\n            case 'DamageTaken':\n                return `${getName(event.target_id)} takes ${event.damage} damage.`;\n            case 'HealingApplied':\n                return `${getName(event.target_id)} is healed for ${event.amount} HP.`;\n            case 'UnitDied':\n                return `${getName(event.unit_id)} falls!`;\n            case 'RoundStarted':\n                return `--- Round ${event.round_number} ---`;\n            case 'SpellCast':\n                return `${getName(event.caster_id)} casts ${getActionName(event.spell_id)}.`;\n            case 'BuffApplied':\n                return `${getName(event.target_id)} gains ${getActionName(event.buff_id)}.`;\n            case 'ConditionAdded':\n                return `${getName(event.target_id)} is ${event.condition}.`;\n            case 'ConditionRemoved':\n                return `${getName(event.target_id)} is no longer ${event.condition}.`;\n            case 'EncounterEnded':\n                return `Encounter ended. Winner: ${event.winner || 'None'}.`;\n            default:\n                return (event as any).type;\n        }\n    }\n\n    static toDetails(event: Event, names: Record<string, string>, actionNames: Record<string, string> = {}): string {\n        const getName = (id: string) => this.getUnitName(id, names);\n\n        switch (event.type) {\n            case 'AttackHit': {\n                let details = `Attack Roll: ${event.attack_roll ? this.formatRollResult(event.attack_roll, event.target_ac) : 'N/A'}`;\n                if (event.damage_roll) {\n                    details += `\\nDamage: ${this.formatRollResult(event.damage_roll)}`;\n                }\n                return details;\n            }\n            case 'AttackMissed':\n                return `Attack Roll: ${event.attack_roll ? this.formatRollResult(event.attack_roll, event.target_ac) : 'N/A'}`;\n            case 'ActionStarted': {\n                if (!event.decision_trace || Object.keys(event.decision_trace).length === 0) {\n                    return \"No decision trace available.\";\n                }\n                const scores = Object.entries(event.decision_trace)\n                    .sort(([, a], [, b]) => b - a)\n                    .map(([name, score]) => `${name}: ${score.toFixed(1)}`)\n                    .join(\"\\n\");\n                return `AI Decision Trace (Scores):\\n${scores}`;\n            }\n            default:\n                return JSON.stringify(event, null, 2);\n        }\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/model.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EnemyTargetList' is defined but never used.","line":3,"column":173,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":188},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AllyTargetList' is defined but never used.","line":3,"column":190,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":204},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ResetTypeSchema' is defined but never used.","line":3,"column":250,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":265}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z } from 'zod'\nimport { v4 as uuid } from 'uuid'\nimport { AllyTargetSchema, BuffDurationSchema, ChallengeRatingSchema, ClassesSchema, ActionConditionSchema, CreatureTypeSchema, EnemyTargetSchema, CreatureConditionSchema, EnemyTargetList, AllyTargetList, TriggerConditionSchema, ResourceTypeSchema, ResetTypeSchema, ActionTagSchema } from './enums'\nimport { ClassOptionsSchema } from './classOptions'\nimport { validateDiceFormula } from './dice'\nimport type { ActionTemplateName } from '../data/actions'\n\nexport const DiceFormulaSchema = z.number().or(z.custom<string>((data) => {\n    if (typeof data !== 'string') return false\n\n    return validateDiceFormula(data)\n}))\n\nexport const FrequencyList = ['at will', '1/fight', '1/day'] as const\nexport const FrequencySchema = z.enum(FrequencyList).or(z.discriminatedUnion('reset', [\n    z.object({\n        reset: z.literal('recharge'),\n        cooldownRounds: z.number().min(2),\n    }),\n    z.object({\n        reset: z.enum(['sr', 'lr']),\n        uses: z.number().min(1)\n    })\n]))\nexport type Frequency = z.infer<typeof FrequencySchema>;\n\n// New Phase 2 schemas for flexible action system\nexport const ActionCostSchema = z.discriminatedUnion('type', [\n    z.object({\n        type: z.literal('Discrete'),\n        resourceType: ResourceTypeSchema,\n        resourceVal: z.string().optional(),\n        amount: z.number(),\n    }),\n    z.object({\n        type: z.literal('Variable'),\n        resourceType: ResourceTypeSchema,\n        resourceVal: z.string().optional(),\n        min: z.number(),\n        max: z.number(),\n    }),\n])\nexport type ActionCost = z.infer<typeof ActionCostSchema>\n\n// CombatCondition must match Rust's externally-tagged enum serialization\n// Rust: pub enum CombatCondition { EnemyInRange(f64), IsSurprised, HasTempHP }\n// Serializes to: { \"EnemyInRange\": 5.0 } or \"IsSurprised\" or \"HasTempHP\"\nconst CombatConditionSchema = z.union([\n    z.object({ EnemyInRange: z.number() }),\n    z.literal('IsSurprised'),\n    z.literal('HasTempHP'),\n])\n\nexport const ActionRequirementSchema = z.discriminatedUnion('type', [\n    z.object({\n        type: z.literal('ResourceAvailable'),\n        resourceType: ResourceTypeSchema,\n        resourceVal: z.string().optional(),\n        amount: z.number(),\n    }),\n    z.object({\n        type: z.literal('CombatState'),\n        condition: CombatConditionSchema,\n    }),\n    z.object({\n        type: z.literal('StatusEffect'),\n        effect: z.string(),\n    }),\n    z.object({\n        type: z.literal('Custom'),\n        description: z.string(),\n    }),\n])\nexport type ActionRequirement = z.infer<typeof ActionRequirementSchema>\n\nconst BuffSchema = z.object({\n    displayName: z.string().optional(),\n    duration: BuffDurationSchema.optional().default('entire encounter'),\n\n    ac: DiceFormulaSchema.optional(),\n    toHit: DiceFormulaSchema.optional(),\n    damage: DiceFormulaSchema.optional(),\n    damageReduction: DiceFormulaSchema.optional(),\n    damageMultiplier: z.number().optional(),\n    damageTakenMultiplier: z.number().optional(),\n    dc: DiceFormulaSchema.optional(),\n    save: DiceFormulaSchema.optional(),\n    condition: CreatureConditionSchema.optional(),\n\n    // Odds that the buff was applied. All of the effects are multiplied by this value. Default 1.\n    magnitude: z.number().optional(),\n    concentration: z.boolean().optional(),\n}).passthrough()\n\n// Not to be used directly. See ActionSchema\nconst ActionSchemaBase = z.object({\n    id: z.string().optional().default(() => uuid()),\n    name: z.string().optional().default('Action'),\n\n    // Legacy field - kept for backward compatibility during transition\n    actionSlot: z.number().optional(), // Will be deprecated in favor of cost/requirements/tags\n\n    // New fields replacing actionSlot\n    cost: z.array(ActionCostSchema).default([]),\n    requirements: z.array(ActionRequirementSchema).default([]),\n    tags: z.array(ActionTagSchema).default([]),\n\n    freq: FrequencySchema.optional().default('at will'),\n    condition: ActionConditionSchema.optional().default('default'),\n    targets: z.number().default(1),\n}).passthrough()\n\nconst AtkActionSchema = ActionSchemaBase.merge(z.object({\n    type: z.literal('atk'),\n    dpr: DiceFormulaSchema.optional().default(0),\n    toHit: DiceFormulaSchema.optional().default(0),\n    target: EnemyTargetSchema.optional().default('enemy with most HP'),\n    useSaves: z.boolean().optional(), // If false or undefined, action.targets becomes the number of hits, and the action can now target the same creature multiple times\n    halfOnSave: z.boolean().optional(), // Only useful if useSaves == true\n\n    // TODO: add other types of rider effects, like extra damage if the target fails a save, for example\n    riderEffect: z.object({\n        dc: z.number().optional(), // TODO: make it so if the dc is undefined, the rider effect applies without a save\n        buff: BuffSchema,\n    }).optional(),\n})).passthrough()\n\nconst HealActionSchema = ActionSchemaBase.merge(z.object({\n    type: z.literal('heal'),\n    amount: DiceFormulaSchema.optional().default(0),\n    tempHP: z.boolean().optional(),\n    target: AllyTargetSchema.optional().default('ally with least HP'),\n})).passthrough()\n\nconst BuffActionSchema = ActionSchemaBase.merge(z.object({\n    type: z.literal('buff'),\n    target: AllyTargetSchema.optional().default('self'),\n\n    buff: BuffSchema,\n})).passthrough()\n\nconst DebuffActionSchema = ActionSchemaBase.merge(z.object({\n    type: z.literal('debuff'),\n    target: EnemyTargetSchema.optional().default('enemy with least HP'),\n    saveDC: z.number().optional().default(10),\n\n    buff: BuffSchema,\n})).passthrough()\n\n\n\nconst TemplateActionSchema = z.object({\n    type: z.literal('template'),\n    id: z.string(),\n    freq: FrequencySchema,\n    condition: ActionConditionSchema,\n\n    // Legacy field - kept for backward compatibility during transition\n    actionSlot: z.number().optional(), // Override the template's default action slot\n\n    // New fields replacing actionSlot\n    cost: z.array(ActionCostSchema).default([]),\n    requirements: z.array(ActionRequirementSchema).default([]),\n    tags: z.array(ActionTagSchema).default([]),\n\n    templateOptions: z.object({\n        target: AllyTargetSchema.or(EnemyTargetSchema).optional(),\n        templateName: z.string() as z.ZodType<ActionTemplateName>, // Use string and cast to ActionTemplateName\n        toHit: DiceFormulaSchema.optional(),\n        saveDC: z.number().optional(),\n        amount: DiceFormulaSchema.optional(),\n    }),\n})\n\n// Like a regular Action, but without the possibility of it being a TemplateAction\nexport const FinalActionSchema = z.discriminatedUnion('type', [\n    HealActionSchema,\n    AtkActionSchema,\n    BuffActionSchema,\n    DebuffActionSchema,\n])\n\nconst ActionSchema = z.discriminatedUnion('type', [\n    HealActionSchema,\n    AtkActionSchema,\n    BuffActionSchema,\n    DebuffActionSchema,\n    TemplateActionSchema,\n])\n\nconst MagicItemSchema = z.object({\n    id: z.string().default(() => uuid()),\n    name: z.string(),\n    description: z.string().optional(),\n    buffs: z.array(BuffSchema).default([]),\n})\n\n// Creature is the definition of the creature. It's what the user inputs.\n// Combattant (see below) is the representation of a creature during the simulation. \n// A new combattant is created for each instance of the creature, and for each round of combat.\nexport const CreatureSchema = z.object({\n    id: z.string(),\n    arrival: z.number().optional(), // Which round is the creature added (optional, default: round 0)\n\n    mode: z.enum(['player', 'monster', 'custom']), // This determines which UI is opened when the user clicks on \"modify creature\"\n\n    // Properties for monsters. Not used by the simulator, but by the monster search UI.\n    type: CreatureTypeSchema.optional(),\n    cr: ChallengeRatingSchema.optional(),\n    src: z.string().optional(),\n\n    // Properties for player characters. Not used by the simulator, but used by the PC template UI.\n    class: z.object({\n        type: ClassesSchema,\n        level: z.number(),\n        options: ClassOptionsSchema,\n    }).passthrough().optional(),\n\n    // Properties of the creature, which are used by the simulator\n    name: z.string(),\n    count: z.coerce.number().default(1),\n    hp: z.coerce.number().default(0), // Removed .int() constraint\n    ac: z.coerce.number().default(10),\n    speed_fly: z.coerce.number().optional(),\n\n    // Save bonuses - average is required, individual are optional overrides\n    saveBonus: z.coerce.number().default(0), // Average save bonus (default to 0 if missing)\n    strSaveBonus: z.coerce.number().optional(),\n    dexSaveBonus: z.coerce.number().optional(),\n    conSaveBonus: z.coerce.number().optional(),\n    intSaveBonus: z.coerce.number().optional(),\n    wisSaveBonus: z.coerce.number().optional(),\n    chaSaveBonus: z.coerce.number().optional(),\n\n    // Advantage on saves\n    conSaveAdvantage: z.boolean().optional(), // For Resilient (Con), War Caster, etc.\n    saveAdvantage: z.boolean().optional(), // For Paladin Aura, advantage on ALL saves\n\n    initiativeBonus: DiceFormulaSchema.optional(),\n    initiativeAdvantage: z.boolean().optional(),\n    actions: z.array(ActionSchema),\n    triggers: z.array(z.object({\n        id: z.string(),\n        condition: TriggerConditionSchema,\n        action: ActionSchema,\n        cost: z.number().optional(), // ActionSlot\n    }).passthrough()).optional(),\n    // New fields for Phase 5 resource management\n    spellSlots: z.record(z.string(), z.coerce.number()).optional(),\n    classResources: z.record(z.string(), z.coerce.number()).optional(),\n    hitDice: DiceFormulaSchema.optional(), // New field for hit dice for short rest healing\n    conModifier: z.coerce.number().optional(), // New field for constitution modifier to apply to hit dice rolls\n    magicItems: z.array(MagicItemSchema).optional().default([]),\n    maxArcaneWardHp: z.number().optional(),\n    initialBuffs: z.array(BuffSchema).optional().default([]),\n}).passthrough()\n\nconst TeamSchema = z.array(CreatureSchema)\n\n// Simplified ResourceLedger for frontend display\nexport const ResourceLedgerSchema = z.object({\n    current: z.record(z.string(), z.number()),\n    max: z.record(z.string(), z.number()),\n})\nexport type ResourceLedger = z.infer<typeof ResourceLedgerSchema>\n\nconst CreatureStateSchema = z.object({\n    currentHp: z.number(),\n    tempHp: z.number().optional(),\n    buffs: z.map(z.string(), BuffSchema),\n    resources: ResourceLedgerSchema,\n    upcomingBuffs: z.map(z.string(), BuffSchema),\n    usedActions: z.set(z.string()),\n    concentratingOn: z.string().nullable().optional(),\n    arcaneWardHp: z.number().optional(),\n})\n\nconst CombattantSchema = z.object({\n    id: z.string(),\n    initiative: z.number().optional(),\n    creature: CreatureSchema,\n    initialState: CreatureStateSchema,\n    finalState: CreatureStateSchema,\n\n    // Actions taken by the creature on that round. Initially empty, will be filled by the simulator\n    actions: z.array(z.object({\n        action: FinalActionSchema,\n        targets: z.map(z.string(), z.number()),\n    })),\n})\n\nexport const RoundSchema = z.object({\n    team1: z.array(CombattantSchema),\n    team2: z.array(CombattantSchema),\n})\n\nexport const TargetRoleList = ['Skirmish', 'Standard', 'Elite', 'Boss'] as const\nexport const TargetRoleSchema = z.enum(TargetRoleList)\nexport type TargetRole = z.infer<typeof TargetRoleSchema>\n\nexport const EncounterSchema = z.object({\n    type: z.literal('combat').default('combat'),\n    id: z.string().optional().default(() => uuid()),\n    monsters: TeamSchema,\n    playersSurprised: z.boolean().optional(),\n    monstersSurprised: z.boolean().optional(),\n    playersPrecast: z.boolean().optional(),\n    monstersPrecast: z.boolean().optional(),\n    targetRole: TargetRoleSchema.optional().default('Standard'),\n})\n\nexport const ShortRestSchema = z.object({\n    type: z.literal('shortRest').default('shortRest'),\n    id: z.string().optional().default(() => uuid()),\n})\n\nexport const TimelineEventSchema = z.discriminatedUnion('type', [\n    EncounterSchema,\n    ShortRestSchema\n])\nconst EncounterStatsSchema = z.object({\n    damageDealt: z.number(),\n    damageTaken: z.number(),\n\n    healGiven: z.number(),\n    healReceived: z.number(),\n\n    charactersBuffed: z.number(),\n    buffsReceived: z.number(),\n\n    charactersDebuffed: z.number(),\n    debuffsReceived: z.number(),\n\n    timesUnconscious: z.number(),\n})\n\nconst EncounterResultSchema = z.object({\n    stats: z.map(z.string(), EncounterStatsSchema),\n    rounds: z.array(RoundSchema),\n})\nexport const SimulationResultSchema = z.object({\n    encounters: z.array(EncounterResultSchema),\n    score: z.number().optional(),\n})\n\nexport type DiceFormula = z.infer<typeof DiceFormulaSchema>\nexport type Buff = z.infer<typeof BuffSchema>\nexport type EnemyTarget = z.infer<typeof EnemyTargetSchema>\nexport type AllyTarget = z.infer<typeof AllyTargetSchema>\nexport type AtkAction = z.infer<typeof AtkActionSchema>\nexport type HealAction = z.infer<typeof HealActionSchema>\nexport type BuffAction = z.infer<typeof BuffActionSchema>\nexport type DebuffAction = z.infer<typeof DebuffActionSchema>\nexport type TemplateAction = z.infer<typeof TemplateActionSchema>\nexport type Action = z.infer<typeof ActionSchema>\nexport type FinalAction = z.infer<typeof FinalActionSchema>\nexport type MagicItem = z.infer<typeof MagicItemSchema>\nexport type Creature = z.infer<typeof CreatureSchema>\nexport type CreatureType = z.infer<typeof CreatureTypeSchema>\nexport type Team = z.infer<typeof TeamSchema>\nexport type CreatureState = z.infer<typeof CreatureStateSchema>\nexport type Combattant = z.infer<typeof CombattantSchema>\nexport type Round = z.infer<typeof RoundSchema>\nexport type EncounterStats = z.infer<typeof EncounterStatsSchema>\nexport type Encounter = z.infer<typeof EncounterSchema>\nexport type ShortRest = z.infer<typeof ShortRestSchema>\nexport type TimelineEvent = z.infer<typeof TimelineEventSchema>\nexport type EncounterResult = z.infer<typeof EncounterResultSchema>\nexport type SimulationResult = z.infer<typeof SimulationResultSchema>\n\nexport const AdventuringDaySchema = z.object({\n    name: z.string(),\n    players: z.array(CreatureSchema),\n    timeline: z.array(TimelineEventSchema),\n})\nexport type AdventuringDay = z.infer<typeof AdventuringDaySchema>\n\n// Phase 3: Event System\nexport const DieRollSchema = z.object({\n    sides: z.number(),\n    value: z.number(),\n})\nexport type DieRoll = z.infer<typeof DieRollSchema>\n\nexport const RollResultSchema = z.object({\n    total: z.number(),\n    rolls: z.array(DieRollSchema),\n    modifiers: z.array(z.tuple([z.string(), z.number()])),\n    formula: z.string(),\n})\nexport type RollResult = z.infer<typeof RollResultSchema>\n\nexport const EventSchema = z.discriminatedUnion('type', [\n    // Combat Events\n    z.object({\n        type: z.literal('ActionStarted'),\n        actor_id: z.string(),\n        action_id: z.string(),\n        decision_trace: z.record(z.string(), z.number()).optional(),\n    }),\n    z.object({\n        type: z.literal('ActionSkipped'),\n        actor_id: z.string(),\n        action_id: z.string(),\n        reason: z.string(),\n    }),\n    z.object({\n        type: z.literal('AttackHit'),\n        attacker_id: z.string(),\n        target_id: z.string(),\n        damage: z.number(),\n        attack_roll: RollResultSchema.optional(),\n        damage_roll: RollResultSchema.optional(),\n        target_ac: z.number().optional(),\n    }),\n    z.object({\n        type: z.literal('AttackMissed'),\n        attacker_id: z.string(),\n        target_id: z.string(),\n        attack_roll: RollResultSchema.optional(),\n        target_ac: z.number().optional(),\n    }),\n    z.object({\n        type: z.literal('DamageTaken'),\n        target_id: z.string(),\n        damage: z.number(),\n        damage_type: z.string(),\n    }),\n    z.object({\n        type: z.literal('DamagePrevented'),\n        target_id: z.string(),\n        prevented_amount: z.number(),\n    }),\n    z.object({\n        type: z.literal('HealingApplied'),\n        target_id: z.string(),\n        amount: z.number(),\n        source_id: z.string(),\n    }),\n    z.object({\n        type: z.literal('TempHPGranted'),\n        target_id: z.string(),\n        amount: z.number(),\n        source_id: z.string(),\n    }),\n\n    // Spell Events\n    z.object({\n        type: z.literal('SpellCast'),\n        caster_id: z.string(),\n        spell_id: z.string(),\n        spell_level: z.number(),\n    }),\n    z.object({\n        type: z.literal('SpellSaved'),\n        target_id: z.string(),\n        spell_id: z.string(),\n    }),\n    z.object({\n        type: z.literal('ConcentrationBroken'),\n        caster_id: z.string(),\n        reason: z.string(),\n    }),\n\n    // Status Events\n    z.object({\n        type: z.literal('BuffApplied'),\n        target_id: z.string(),\n        buff_id: z.string(),\n        source_id: z.string(),\n    }),\n    z.object({\n        type: z.literal('BuffExpired'),\n        target_id: z.string(),\n        buff_id: z.string(),\n    }),\n    z.object({\n        type: z.literal('ConditionAdded'),\n        target_id: z.string(),\n        condition: CreatureConditionSchema,\n        source_id: z.string(),\n    }),\n    z.object({\n        type: z.literal('ConditionRemoved'),\n        target_id: z.string(),\n        condition: CreatureConditionSchema,\n    }),\n\n    // Life Cycle Events\n    z.object({\n        type: z.literal('UnitDied'),\n        unit_id: z.string(),\n        killer_id: z.string().optional(),\n        damage_type: z.string().optional(),\n    }),\n    z.object({\n        type: z.literal('TurnStarted'),\n        unit_id: z.string(),\n        round_number: z.number(),\n    }),\n    z.object({\n        type: z.literal('TurnEnded'),\n        unit_id: z.string(),\n        round_number: z.number(),\n    }),\n    z.object({\n        type: z.literal('RoundStarted'),\n        round_number: z.number(),\n    }),\n    z.object({\n        type: z.literal('RoundEnded'),\n        round_number: z.number(),\n    }),\n    z.object({\n        type: z.literal('EncounterStarted'),\n        combatant_ids: z.array(z.string()),\n    }),\n    z.object({\n        type: z.literal('EncounterEnded'),\n        winner: z.string().optional(),\n        reason: z.string().optional(),\n        rounds: z.number().optional(),\n    }),\n\n    // Custom/Other\n    z.object({\n        type: z.literal('Custom'),\n        event_type: z.string(),\n        data: z.record(z.string(), z.string()),\n        source_id: z.string(),\n    }),\n])\n\nexport type Event = z.infer<typeof EventSchema>\n\n// Skyline Spectrogram Types\nexport const SpellSlotLevelSchema = z.object({\n    level: z.number(),\n    remaining: z.number(),\n    max: z.number(),\n})\n\nexport const ResourceBreakdownSchema = z.object({\n    spellSlots: z.array(SpellSlotLevelSchema),\n    shortRestFeatures: z.array(z.string()),\n    longRestFeatures: z.array(z.string()),\n    hitDice: z.number(),\n    hitDiceMax: z.number(),\n    totalEhp: z.number(),\n    maxEhp: z.number(),\n})\n\nexport const CharacterBucketDataSchema = z.object({\n    name: z.string(),\n    id: z.string(),\n    maxHp: z.number(),\n    hpPercent: z.number(),\n    resourcePercent: z.number(),\n    resourceBreakdown: ResourceBreakdownSchema,\n    deathRound: z.number().nullable(),\n    isDead: z.boolean(),\n})\n\nexport const PercentileBucketSchema = z.object({\n    percentile: z.number(),\n    runCount: z.number(),\n    characters: z.array(CharacterBucketDataSchema),\n    partyHpPercent: z.number(),\n    partyResourcePercent: z.number(),\n    deathCount: z.number(),\n})\n\nexport const SkylineAnalysisSchema = z.object({\n    buckets: z.array(PercentileBucketSchema),\n    totalRuns: z.number(),\n    partySize: z.number(),\n    encounterIndex: z.number().nullable(),\n})\n\n// Decile Analysis Types\nexport const CombatantVisualizationSchema = z.object({\n    name: z.string(),\n    maxHp: z.number().int(),\n    startHp: z.number().int(),\n    currentHp: z.number().int(),\n    isDead: z.boolean(),\n    isPlayer: z.boolean(),\n    hpPercentage: z.number(),\n})\n\nexport const DecileStatsSchema = z.object({\n    decile: z.number(),\n    label: z.string(),\n    medianSurvivors: z.number(),\n    partySize: z.number(),\n    totalHpLost: z.number(),\n    hpLostPercent: z.number(),\n    winRate: z.number(),\n    // New fields for 5-Timeline Dashboard\n    medianRunVisualization: z.array(CombatantVisualizationSchema),\n    medianRunData: EncounterResultSchema.optional().nullable(),\n    battleDurationRounds: z.number(),\n    resourceTimeline: z.array(z.number()).default([]),\n    vitalityTimeline: z.array(z.number()).default([]),\n    powerTimeline: z.array(z.number()).default([]),\n})\n\nexport const TimelineRangeSchema = z.object({\n    p25: z.array(z.number()),\n    p75: z.array(z.number()),\n})\n\nexport const EncounterArchetypeList = ['Trivial', 'Skirmish', 'Standard', 'TheGrind', 'EliteChallenge', 'BossFight', 'MeatGrinder', 'NovaTrap', 'Broken', 'CoinFlip'] as const\nexport const EncounterArchetypeSchema = z.enum(EncounterArchetypeList)\nexport type EncounterArchetype = z.infer<typeof EncounterArchetypeSchema>\n\nexport const VitalsSchema = z.object({\n    lethalityIndex: z.number(),\n    tpkRisk: z.number(),\n    attritionScore: z.number(),\n    volatilityIndex: z.number(),\n    doomHorizon: z.number(),\n    deathsDoorIndex: z.number(),\n    archetype: EncounterArchetypeSchema,\n    isVolatile: z.boolean(),\n    difficultyGrade: z.string(),\n    safetyGrade: z.string(),\n    pacingLabel: z.string(),\n    nearDeathSurvivors: z.number().optional(),\n    crisisParticipationRate: z.number().optional(),\n    minHpThreshold: z.number().optional(),\n    avgUnconsciousRounds: z.number().optional(),\n})\nexport type Vitals = z.infer<typeof VitalsSchema>\n\nexport const DayPacingSchema = z.object({\n    archetype: z.string(),\n    directorScore: z.number(),\n    rhythmScore: z.number(),\n    attritionScore: z.number(),\n    recoveryScore: z.number(),\n})\nexport type DayPacing = z.infer<typeof DayPacingSchema>\n\nexport const AggregateOutputSchema = z.object({\n    scenarioName: z.string(),\n    totalRuns: z.number(),\n    deciles: z.array(DecileStatsSchema),\n    globalMedian: DecileStatsSchema.optional().nullable(),\n    vitalityRange: TimelineRangeSchema.optional().nullable(),\n    powerRange: TimelineRangeSchema.optional().nullable(),\n    decileLogs: z.array(z.array(EventSchema)).default([]),\n    battleDurationRounds: z.number(),\n    intensityTier: z.string(), // Tier1...Tier5\n    encounterLabel: z.string(),\n    analysisSummary: z.string(),\n    tuningSuggestions: z.array(z.string()),\n    isGoodDesign: z.boolean(),\n    stars: z.number().optional().default(0),\n    tdnw: z.number().optional().default(0),\n    numEncounters: z.number().optional().default(0),\n    skyline: SkylineAnalysisSchema.optional().nullable(),\n    vitals: VitalsSchema.optional().nullable(),\n    pacing: DayPacingSchema.optional().nullable(),\n}).passthrough()\n\nexport const AutoAdjustmentResultSchema = z.object({\n    monsters: z.array(CreatureSchema),\n    analysis: AggregateOutputSchema,\n})\n\n// Party slot assignment from Rust backend (Shield Wall ordering)\nexport const PlayerSlotSchema = z.object({\n    position: z.number(),\n    playerId: z.string(),\n    survivabilityScore: z.number(),\n})\n\nexport const FullAnalysisOutputSchema = z.object({\n    overall: AggregateOutputSchema,\n    encounters: z.array(AggregateOutputSchema),\n    averageMonsterAttackBonus: z.number(),\n    partySlots: z.array(PlayerSlotSchema),\n})\n\nexport const FullSimulationOutputSchema = z.object({\n    results: z.array(SimulationResultSchema),\n    analysis: FullAnalysisOutputSchema,\n    firstRunEvents: z.array(EventSchema),\n})\n\nexport type CombatantVisualization = z.infer<typeof CombatantVisualizationSchema>\nexport type DecileStats = z.infer<typeof DecileStatsSchema>\nexport type AggregateOutput = z.infer<typeof AggregateOutputSchema>\nexport type PlayerSlot = z.infer<typeof PlayerSlotSchema>\nexport type AutoAdjustmentResult = z.infer<typeof AutoAdjustmentResultSchema>\nexport type FullAnalysisOutput = z.infer<typeof FullAnalysisOutputSchema>\nexport type FullSimulationOutput = z.infer<typeof FullSimulationOutputSchema>\n\nexport type SpellSlotLevel = z.infer<typeof SpellSlotLevelSchema>\nexport type ResourceBreakdown = z.infer<typeof ResourceBreakdownSchema>\nexport type CharacterBucketData = z.infer<typeof CharacterBucketDataSchema>\nexport type PercentileBucket = z.infer<typeof PercentileBucketSchema>\nexport type SkylineAnalysis = z.infer<typeof SkylineAnalysisSchema>\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/replayParser.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ReplayTurn' is defined but never used.","line":5,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ReplayAction' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Event } from './model'\nimport type {\n  Replay,\n  ReplayRound,\n  ReplayTurn,\n  ReplayAction,\n  ParseState\n} from './replayTypes'\n\n/**\n * Parses a chronological array of events into a structured replay representation.\n *\n * The parser groups events by:\n * - Round: RoundStarted / RoundEnded events define boundaries\n * - Turn: TurnStarted / TurnEnded events define boundaries\n * - Action: ActionStarted / ActionSkipped start an action context where sub-events are collected\n *\n * Events outside of expected boundaries (e.g., EncounterStarted, EncounterEnded) are\n * collected into globalEvents for reference.\n *\n * @param events - Chronological array of combat events\n * @returns A structured Replay containing rounds and global events\n */\nexport function parseEventsToReplay(events: Event[]): Replay {\n  const state: ParseState = {\n    replay: {\n      rounds: [],\n      globalEvents: []\n    },\n    currentRound: null,\n    currentTurn: null,\n    currentAction: null\n  }\n\n  for (const event of events) {\n    processEvent(event, state)\n  }\n\n  // Close any open contexts\n  closeCurrentAction(state)\n  closeCurrentTurn(state)\n  closeCurrentRound(state)\n\n  return state.replay\n}\n\n/**\n * Processes a single event and updates the parsing state accordingly.\n */\nfunction processEvent(event: Event, state: ParseState): void {\n  switch (event.type) {\n    // Life cycle boundary events\n    case 'EncounterStarted':\n    case 'EncounterEnded':\n      // Add to global events (outside rounds)\n      state.replay.globalEvents.push(event)\n      break\n\n    case 'RoundStarted':\n      closeCurrentRound(state)\n      startRound(event.round_number, state)\n      break\n\n    case 'RoundEnded':\n      closeCurrentRound(state)\n      break\n\n    case 'TurnStarted':\n      closeCurrentTurn(state)\n      startTurn(event.unit_id, event.round_number, state)\n      break\n\n    case 'TurnEnded':\n      closeCurrentTurn(state)\n      break\n\n    // Action boundary events\n    case 'ActionStarted':\n      closeCurrentAction(state)\n      startAction(event.actor_id, event.action_id, state)\n      // ActionStarted itself goes into sub-events\n      addEventToCurrentContext(event, state)\n      break\n\n    case 'ActionSkipped':\n      closeCurrentAction(state)\n      startAction(event.actor_id, event.action_id, state)\n      addEventToCurrentContext(event, state)\n      closeCurrentAction(state) // Skipped actions have no sub-events\n      break\n\n    // All other events go into the current context (action, turn, or round)\n    default:\n      addEventToCurrentContext(event, state)\n      break\n  }\n}\n\n/**\n * Starts a new round in the parsing state.\n */\nfunction startRound(roundNumber: number, state: ParseState): void {\n  state.currentRound = {\n    roundNumber,\n    turns: []\n  }\n}\n\n/**\n * Closes the current round and adds it to the replay if it exists.\n */\nfunction closeCurrentRound(state: ParseState): void {\n  if (!state.currentRound) return\n\n  // Close any remaining turn/action\n  closeCurrentAction(state)\n  closeCurrentTurn(state)\n\n  // Only add non-empty rounds\n  if (state.currentRound.turns.length > 0) {\n    state.replay.rounds.push(state.currentRound)\n  }\n\n  state.currentRound = null\n}\n\n/**\n * Starts a new turn in the parsing state.\n */\nfunction startTurn(unitId: string, roundNumber: number, state: ParseState): void {\n  if (!state.currentRound) {\n    // Turn started without a round - create a round first\n    startRound(roundNumber, state)\n  }\n\n  state.currentTurn = {\n    unitId,\n    roundNumber,\n    actions: []\n  }\n}\n\n/**\n * Closes the current turn and adds it to the current round if it exists.\n */\nfunction closeCurrentTurn(state: ParseState): void {\n  if (!state.currentTurn || !state.currentRound) return\n\n  // Close any remaining action\n  closeCurrentAction(state)\n\n  // Only add non-empty turns\n  if (state.currentTurn.actions.length > 0) {\n    state.currentRound.turns.push(state.currentTurn)\n  }\n\n  state.currentTurn = null\n}\n\n/**\n * Starts a new action in the parsing state.\n */\nfunction startAction(actorId: string, actionId: string, state: ParseState): void {\n  if (!state.currentTurn) {\n    // Action started without a turn - events will go to globalEvents\n    return\n  }\n\n  state.currentAction = {\n    actorId,\n    actionId,\n    subEvents: []\n  }\n}\n\n/**\n * Closes the current action and adds it to the current turn if it exists.\n */\nfunction closeCurrentAction(state: ParseState): void {\n  if (!state.currentAction || !state.currentTurn) return\n\n  // Only add non-empty actions\n  if (state.currentAction.subEvents.length > 0) {\n    state.currentTurn.actions.push(state.currentAction)\n  }\n\n  state.currentAction = null\n}\n\n/**\n * Adds an event to the current context (action, turn, round, or global).\n * Priority: Action > Turn > Round > Global\n */\nfunction addEventToCurrentContext(event: Event, state: ParseState): void {\n  // Try to add to current action\n  if (state.currentAction) {\n    state.currentAction.subEvents.push(event)\n    return\n  }\n\n  // Try to add to current turn\n  if (state.currentTurn) {\n    // Events outside an action context are added as a standalone \"no-action\" action\n    // This handles events like buffs applied outside of actions\n    if (shouldCreateImplicitAction(event)) {\n      state.currentTurn.actions.push({\n        actorId: state.currentTurn.unitId,\n        actionId: 'implicit',\n        subEvents: [event]\n      })\n    }\n    return\n  }\n\n  // Try to add to current round (as an implicit turn)\n  if (state.currentRound) {\n    // Events outside a turn context are added as an implicit turn\n    // This is rare but handles edge cases\n    const unitId = extractUnitIdFromEvent(event)\n    if (unitId) {\n      state.currentRound.turns.push({\n        unitId,\n        roundNumber: state.currentRound.roundNumber,\n        actions: [{\n          actorId: unitId,\n          actionId: 'implicit',\n          subEvents: [event]\n        }]\n      })\n    }\n    return\n  }\n\n  // Fall back to global events\n  state.replay.globalEvents.push(event)\n}\n\n/**\n * Determines if an event should create an implicit action context.\n * Some events (like BuffApplied, ConditionAdded) make sense as standalone actions.\n */\nfunction shouldCreateImplicitAction(event: Event): boolean {\n  // Events that make sense as standalone actions\n  const standaloneEventTypes = [\n    'BuffApplied',\n    'BuffExpired',\n    'ConditionAdded',\n    'ConditionRemoved',\n    'HealingApplied',\n    'TempHPGranted',\n    'SpellCast',\n    'ConcentrationBroken'\n  ]\n\n  return standaloneEventTypes.includes(event.type)\n}\n\n/**\n * Extracts a unit ID from an event if possible.\n * Used for creating implicit turns when events appear outside turn boundaries.\n */\nfunction extractUnitIdFromEvent(event: Event): string | null {\n  // Try common ID fields\n  if ('unit_id' in event) return event.unit_id as string\n  if ('actor_id' in event) return event.actor_id\n  if ('attacker_id' in event) return event.attacker_id\n  if ('target_id' in event) return event.target_id\n  if ('caster_id' in event) return event.caster_id\n  if ('source_id' in event) return event.source_id\n\n  return null\n}\n\n/**\n * Legacy function for backward compatibility.\n * Parses events and returns only the rounds array.\n * @deprecated Use parseEventsToReplay instead for full replay data.\n */\nexport function parseEventsToReplayRounds(events: Event[]): ReplayRound[] {\n  const replay = parseEventsToReplay(events)\n  return replay.rounds\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/replayTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/semiPersistentContext.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[120,123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[120,123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'newValue' is defined but never used.","line":5,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[166,169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[166,169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext } from \"react\";\n\nexport const semiPersistentContext = createContext({\n    state: new Map<string, any>(), \n    setState: (newValue: Map<string, any>) => {},\n})","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/simulation.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":1,"message":"Do not use \"@ts-nocheck\" because it alters compilation errors.","line":1,"column":1,"nodeType":"Line","messageId":"tsDirectiveComment","endLine":1,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":445,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":445,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck - Legacy simulation file, replaced by WASM backend\nimport { getFinalAction } from \"../data/actions\"\nimport { EvaluationOptions, evaluateDiceFormula } from \"./dice\"\nimport { ActionSlots, ActionType, CreatureCondition, CreatureConditionList } from \"./enums\"\nimport { Action, AtkAction, Buff, BuffAction, Combattant, Creature, CreatureState, DebuffAction, DiceFormula, Encounter, EncounterResult, EncounterStats, FinalAction, HealAction, Round, SimulationResult } from \"./model\"\nimport { clone, range } from \"./utils\"\nimport { v4 as uuid } from 'uuid'\n\n// Used to update a creature's resources between encounters\nfunction getRemainingUses(creature: Creature, rest: 'none' | 'short rest' | 'long rest', oldValue?: Map<string, number>) {\n    const result = new Map<string, number>()\n\n    creature.actions.forEach(action => {\n        if (action.freq === \"at will\") return\n\n        else if ((action.freq === \"1/fight\")) result.set(action.id, ((rest === \"long rest\") || (rest === \"short rest\")) ? 1 : (oldValue?.get(action.id) || 0))\n\n        else if ((action.freq === \"1/day\")) result.set(action.id, (rest === \"long rest\") ? 1 : (oldValue?.get(action.id) || 0))\n\n        else if (action.freq.reset === 'recharge') result.set(action.id, 1)\n\n        else if (action.freq.reset === 'lr') result.set(action.id, (rest === 'long rest') ? action.freq.uses : (oldValue?.get(action.id) || 0))\n\n        else if (action.freq.reset === 'sr') result.set(action.id, ((rest === \"long rest\") || (rest === \"short rest\")) ? action.freq.uses : (oldValue?.get(action.id) || 0))\n    })\n\n    return result\n}\n\n// Used to generate monsters, never players\nexport function creatureToCombattant(creature: Creature) {\n    const creatureState: CreatureState = {\n        buffs: new Map(),\n        currentHP: creature.hp,\n        resources: { current: {}, max: {} },  // Will be populated by WASM backend\n        upcomingBuffs: new Map(),\n        usedActions: new Set(),\n    }\n\n    const result: Combattant = {\n        id: uuid(),\n        creature: clone(creature),\n        initialState: creatureState,\n        finalState: clone(creatureState),\n        actions: [],\n    }\n\n    return result\n}\n\n// Creates a copy of the combattant that can be used on the next round\nfunction iterateCombattant(combattant: Combattant, luck: number) {\n    const newInitialState: CreatureState = clone(combattant.finalState)\n    newInitialState.buffs = new Map()\n    newInitialState.upcomingBuffs = new Map()\n\n    // Handle buffs\n    combattant.finalState.buffs.forEach((buff, name) => {\n        if (buff.duration === 'entire encounter') newInitialState.buffs.set(name, clone(buff))\n\n        if (buff.duration === 'repeat the save each round') {\n            const emptyState: CreatureState = {\n                buffs: new Map(),\n                currentHP: 0,\n                remainingUses: new Map(),\n                upcomingBuffs: new Map(),\n                usedActions: new Set()\n            }\n\n            // Create a mock attacker - the attacker's stats don't matter to a repeated saving throw.\n            const fakeAttacker: Combattant = {\n                actions: [],\n                creature: combattant.creature,\n                id: '',\n                initialState: emptyState,\n                finalState: emptyState,\n            }\n\n            // Calculate new magnitude & apply it\n            const magnitude = (buff.magnitude || 1) * calculateChanceToFail(fakeAttacker, combattant, buff.dc || 10, luck)\n            newInitialState.buffs.set(name, { ...clone(buff), magnitude })\n        }\n    })\n    combattant.finalState.upcomingBuffs.forEach((buff, name) => {\n        newInitialState.buffs.set(name, clone(buff))\n    })\n\n    // Handle recharge abilities\n    combattant.creature.actions.forEach(action => {\n        if (typeof action.freq === 'string') return\n        if (action.freq.reset !== 'recharge') return\n\n        const increment = 1 / action.freq.cooldownRounds\n\n        let remainingUses = newInitialState.remainingUses.get(action.id) || 0\n        remainingUses = Math.min(1, remainingUses + increment)\n        newInitialState.remainingUses.set(action.id, remainingUses)\n    })\n\n    const result: Combattant = {\n        id: combattant.id,\n        creature: combattant.creature,\n        initialState: newInitialState,\n        finalState: clone(newInitialState),\n        actions: [],\n    }\n\n    return result\n}\n\n// Checks for remaining uses\nfunction isUsable(combattant: Combattant, action: FinalAction) {\n    // Can only trigger 'on kill' effects once per turn\n    if (action.actionSlot === ActionSlots[\"When reducing an enemy to 0 HP\"]) {\n        if (combattant.actions.find(actionTaken => actionTaken.action.id === action.id)) return false\n    }\n\n    if (action.freq === 'at will') return true\n\n    const remainingUsesMap = combattant.finalState.remainingUses\n\n    const remainingUses = remainingUsesMap.get(action.id)\n\n    return (remainingUses !== undefined) && (remainingUses >= 1)\n}\n\n// Checks action.condition\nfunction matchCondition(combattant: Combattant, action: Action, allies: Combattant[], enemies: Combattant[]) {\n    if (action.condition === 'not used yet') return !combattant.initialState.usedActions.has(action.id)\n    if (action.condition === 'has no THP') return ((combattant.initialState.tempHP === undefined) || (combattant.initialState.tempHP === 0))\n    if (action.condition === 'is under half HP') return (combattant.finalState.currentHP * 2 < combattant.creature.hp)\n    if (action.condition === 'ally at 0 HP') return (!!allies.find(ally => (ally.finalState.currentHP === 0)))\n    if (action.condition === 'ally under half HP') return !!allies.find(ally => ((ally.initialState.currentHP > 0) && (ally.finalState.currentHP <= ally.creature.hp / 2)))\n    if (action.condition === 'enemy count one') return (enemies.filter(enemy => enemy.initialState.currentHP > 0).length == 1)\n    if (action.condition === 'enemy count multiple') return (enemies.filter(enemy => enemy.initialState.currentHP > 0).length >= 2)\n\n    // Default or \"is use available\"\n    return true\n}\n\n// Determines which actions a creature will use. Does not actually perform the actions.\n// The exception is heals, to avoid situations where multiple healers all heal the same creature despite having the \"ally at 0 hp\" condition\nfunction getActions(combattant: Combattant, allies: Combattant[], enemies: Combattant[], handleHeals: boolean, luck: number, stats: Map<string, EncounterStats>): FinalAction[] {\n    const actionSlots = new Set()\n    combattant.creature.actions\n        .map(getFinalAction)\n        .filter(action => (action.actionSlot >= 0))\n        .forEach(action => actionSlots.add(action.actionSlot))\n\n    const result = Array.from(actionSlots).flatMap(actionSlot => {\n        const actions = combattant.creature.actions\n            .map(getFinalAction)\n            .filter(action => (action.actionSlot === actionSlot))\n            .filter(action => isUsable(combattant, action))\n            .filter(action => matchCondition(combattant, action, allies, enemies))\n\n        if (!actions.length) return []\n        return [actions[0]]\n    })\n\n    // Handle heals now, so the next creature doesn't have to waste actions healing the same target\n    if (handleHeals) result.forEach(action => {\n        if (action.type !== 'heal') return\n\n        const combattantAction: Combattant['actions'][0] = {\n            action,\n            targets: new Map(),\n        }\n        combattant.actions.push(combattantAction)\n\n        let targetCount = action.targets\n        const targettableAllies = new Set(allies.filter(combattant => {\n            // Monsters cannot be healed if they're at 0 hit points\n            if (combattant.creature.cr === undefined) return true\n            return (combattant.initialState.currentHP !== 0)\n        }))\n\n        // THP cannot revive a creature\n        if (action.tempHP) {\n            targettableAllies.forEach(ally => {\n                if (ally.initialState.currentHP === 0) targettableAllies.delete(ally)\n            })\n        }\n\n        while ((targettableAllies.size > 0) && (targetCount > 0)) {\n            targetCount--\n            const target = getNextTarget(combattant, action, Array.from(targettableAllies), [], luck, stats)\n\n            if (!target) break;\n\n            targettableAllies.delete(target)\n            combattantAction.targets.set(target.id, 1)\n            useHealAction(combattant, action, target, luck, stats)\n        }\n    })\n\n    return result\n}\n\n// Actions can target multiple creatures. This finds the next valid target for that action.\nfunction getNextTarget(combattant: Combattant, action: FinalAction, allies: Combattant[], enemies: Combattant[], luck: number, stats: Map<string, EncounterStats>): Combattant | undefined {\n    const getHighestDPR = (group: Combattant[]) => {\n        const getDPR = (combattant: Combattant) => {\n            const dmgBonus = getBuffs(combattant, b => b.damage, 'add', luck)\n            const dmgMult = getBuffs(combattant, b => b.damageMultiplier, 'mult', luck)\n\n            return getActions(combattant, allies, enemies, false, luck, stats)\n                .map(action => {\n                    if (action.type !== \"atk\") return 0\n                    return (evaluateDiceFormula(action.dpr, luck) + dmgBonus) * action.targets * dmgMult\n                })\n                .reduce((dpr1, dpr2) => (dpr1 + dpr2), 0)\n        }\n\n        return group.reduce((creature1, creature2) => {\n            const creature1DPR = getDPR(creature1)\n            const creature2DPR = getDPR(creature2)\n\n            return (creature1DPR > creature2DPR) ? creature1 : creature2\n        })\n    }\n\n    let filteredEnemies = enemies\n    if (action.type === \"debuff\") {\n        filteredEnemies = enemies.filter(a1 => !a1.finalState.buffs.get(action.id))\n    }\n\n    if (action.target.startsWith('ally') && (allies.length === 0)) return undefined\n    if (action.target.startsWith('enemy') && (filteredEnemies.length === 0)) return undefined\n\n    if (action.target === 'self') return combattant\n    if (action.target === \"ally with the highest AC\") return allies.reduce((a1, a2) => (a1.creature.ac > a2.creature.ac) ? a1 : a2)\n    if (action.target === \"ally with the lowest AC\") return allies.reduce((a1, a2) => (a1.creature.ac < a2.creature.ac) ? a1 : a2)\n    if (action.target === \"ally with the most HP\") return allies.reduce((a1, a2) => (a1.finalState.currentHP > a2.finalState.currentHP) ? a1 : a2)\n    if (action.target === \"ally with the least HP\") return allies.reduce((a1, a2) => (a1.finalState.currentHP < a2.finalState.currentHP) ? a1 : a2)\n    if (action.target === \"ally with the highest DPR\") return getHighestDPR(allies)\n    if (action.target === \"enemy with highest AC\") return filteredEnemies.reduce((a1, a2) => (a1.creature.ac > a2.creature.ac) ? a1 : a2)\n    if (action.target === \"enemy with lowest AC\") return filteredEnemies.reduce((a1, a2) => (a1.creature.ac < a2.creature.ac) ? a1 : a2)\n    if (action.target === \"enemy with most HP\") return filteredEnemies.reduce((a1, a2) => (a1.finalState.currentHP + (a1.finalState.tempHP || 0) > a2.finalState.currentHP + (a2.finalState.tempHP || 0)) ? a1 : a2)\n    if (action.target === \"enemy with least HP\") return filteredEnemies.reduce((a1, a2) => (a1.finalState.currentHP + (a1.finalState.tempHP || 0) < a2.finalState.currentHP + (a2.finalState.tempHP || 0)) ? a1 : a2)\n    /* if (action.target === \"enemy with highest DPR\") */ return getHighestDPR(filteredEnemies)\n}\n\n// Calculates which actions each creature is going to take, and saves them in combattant.actions\n// Also updates the remaining uses for each action.\nfunction generateActions(allies: Combattant[], enemies: Combattant[], luck: number, stats: Map<string, EncounterStats>) {\n    allies.forEach(ally => {\n        if (ally.initialState.currentHP <= 0) return\n\n        ally.actions.push(...getActions(ally, allies, enemies, true, luck, stats)\n            .map(action => ({\n                action: action,\n                targets: new Map(),\n            })))\n\n        // Save uses for limited-use actions\n        ally.actions.filter(({ action }) => (action.freq !== 'at will'))\n            .forEach(({ action }) => {\n                let remainingUses = ally.initialState.remainingUses.get(action.id) || 0\n                remainingUses = Math.max(0, remainingUses - 1)\n                ally.finalState.remainingUses.set(action.id, remainingUses)\n\n                ally.finalState.usedActions.add(action.id)\n            })\n    })\n}\n\n// The callback will be called for each valid target, sequentially\nfunction getTargets(combattant: Combattant, action: FinalAction, allies: Combattant[], enemies: Combattant[], luck: number, stats: Map<string, EncounterStats>, callback: (target: Combattant) => void) {\n    const isAttack = (action.type === 'atk') && !action.useSaves\n\n    let lastTarget: Combattant | undefined = undefined\n    let targetsCount = action.targets\n    const targettableAllies = new Set(allies)\n    const targettableEnemies = new Set(enemies.filter(enemy => (enemy.finalState.currentHP > 0)))\n    while ((targetsCount > 0) && (targettableAllies.size > 0) && (targettableEnemies.size > 0)) {\n        targetsCount--\n\n        // If it's an attack, continue attacking the same target until it's dead\n        const target: Combattant | undefined = (isAttack && lastTarget) ||\n            getNextTarget(combattant, action, Array.from(targettableAllies), Array.from(targettableEnemies), luck, stats)\n\n        if (target) {\n            lastTarget = target\n\n            callback(target)\n\n            let removeTarget = true\n            if ((action.type === 'atk') && !action.useSaves) {\n                removeTarget = (target.finalState.currentHP === 0)\n            }\n            if (removeTarget) {\n                targettableAllies.delete(target)\n                targettableEnemies.delete(target)\n                lastTarget = undefined\n            }\n        }\n    }\n}\n\n// Executes the actions saved in combattant.actions by the generateActions() function\n// Executes only the selected action type, so the different action types can be executed in the right order\nfunction handleActions(allies: Combattant[], enemies: Combattant[], actionTypes: ActionType[], luck: number, stats: Map<string, EncounterStats>) {\n    allies.forEach(combattant => {\n        combattant.actions\n            .filter(({ action }) => (action.actionSlot >= 0))\n            .filter(({ action }) => (actionTypes.includes(action.type)))\n            .forEach((turn) => {\n                getTargets(combattant, turn.action, allies, enemies, luck, stats, (target) => {\n                    turn.targets.set(target.id, 1 + (turn.targets.get(target.id) || 0))\n\n                    if (turn.action.type === \"buff\") useBuffAction(combattant, turn.action, target, stats)\n                    if (turn.action.type === \"debuff\") useDebuffAction(combattant, turn.action, target, luck, stats)\n                    //if (turn.action.type === \"heal\") useHealAction(turn.action, target) // Already handled before, in generateActions\n                    if (turn.action.type === \"atk\") useAtkAction(combattant, turn.action, target, allies, enemies, luck, stats)\n                })\n            })\n    })\n}\n\n// This is called when an action with a negative/special action slot is triggered\nfunction triggerAction(combattant: Combattant, actionSlot: keyof typeof ActionSlots, allies: Combattant[], enemies: Combattant[], luck: number, stats: Map<string, EncounterStats>) {\n    combattant.creature.actions\n        .map(getFinalAction)\n        .forEach(action => {\n            if (action.actionSlot !== ActionSlots[actionSlot]) return\n            if (!isUsable(combattant, action)) return\n            if (!matchCondition(combattant, action, allies, enemies)) return\n\n            const targets: Map<string, number> = new Map()\n            combattant.actions.push({ action: action, targets: targets })\n\n            getTargets(combattant, action, allies, enemies, luck, stats, (target) => {\n                targets.set(target.id, 1 + (targets.get(target.id) || 0))\n\n                const ignoreIncapacitated = true\n                switch (action.type) {\n                    case \"buff\": return useBuffAction(combattant, action, target, stats, ignoreIncapacitated)\n                    case \"debuff\": return useDebuffAction(combattant, action, target, luck, stats, ignoreIncapacitated)\n                    case \"heal\": return useHealAction(combattant, action, target, luck, stats, ignoreIncapacitated)\n                    case \"atk\": return useAtkAction(combattant, action, target, allies, enemies, luck, stats, ignoreIncapacitated)\n                }\n            })\n\n            // Save uses for limited-use actions\n            if (action.freq != 'at will') {\n                let remainingUses = combattant.finalState.remainingUses.get(action.id) || 0\n                remainingUses = Math.max(0, remainingUses - 1)\n                combattant.finalState.remainingUses.set(action.id, remainingUses)\n\n                combattant.finalState.usedActions.add(action.id)\n            }\n        })\n}\n\nfunction applyBuff(target: Combattant, buffName: string, newBuff: Buff, comparisonMode: 'min' | 'max') {\n    const existingBuff = target.finalState.buffs.get(buffName)\n\n    if (!existingBuff) {\n        target.finalState.buffs.set(buffName, newBuff)\n        return\n    }\n    const result = mergeBuff(existingBuff, newBuff, comparisonMode)\n    target.finalState.buffs.set(buffName, result)\n}\n\n// In 5e, only the stronger buff is applies\n// This figures out which buff is the strongest, and applies that one.\nfunction mergeBuff(buff1: Buff, buff2: Buff, comparisonMode: 'min' | 'max'): Buff {\n    function comparator(a: DiceFormula | undefined, b: DiceFormula | undefined) {\n        if (a === undefined) return b\n        if (b === undefined) return a\n\n        const evalA = evaluateDiceFormula(a, 0.5)\n        const evalB = evaluateDiceFormula(b, 0.5)\n\n        const min = (evalA < evalB) ? a : b\n        const max = (evalA < evalB) ? b : a\n\n        return (comparisonMode === 'min') ? min : max\n    }\n\n    function numberComparator(a: number | undefined, b: number | undefined) {\n        if (a === undefined) return b\n        if (b === undefined) return a\n\n        return (comparisonMode === 'min') ? Math.min(a, b) : Math.max(a, b)\n    }\n\n    const result: Buff = {\n        duration: buff1.duration,\n        displayName: buff1.displayName,\n\n        ac: comparator(buff1.ac, buff2.ac),\n        damage: comparator(buff1.damage, buff2.damage),\n        damageReduction: comparator(buff1.damageReduction, buff2.damageReduction),\n        toHit: comparator(buff1.toHit, buff2.toHit),\n        damageMultiplier: numberComparator(buff1.damageMultiplier, buff2.damageMultiplier),\n        damageTakenMultiplier: numberComparator(buff1.damageTakenMultiplier, buff2.damageTakenMultiplier),\n        dc: comparator(buff1.dc, buff2.dc),\n        save: comparator(buff1.save, buff2.save),\n        condition: buff1.condition || buff2.condition,\n\n        magnitude: atLeastOneChance([\n            buff1.magnitude !== undefined ? buff1.magnitude : 1,\n            buff2.magnitude !== undefined ? buff2.magnitude : 1,\n        ]),\n    }\n    return result\n}\n\nfunction getStats(statsMap: Map<string, EncounterStats>, combattant: Combattant) {\n    const id = combattant.id // Using the combattant's id, instead of the creature's id, since the team can have multiples of a creature\n    if (!statsMap.has(id)) {\n        statsMap.set(id, {\n            buffsReceived: 0,\n            charactersBuffed: 0,\n            charactersDebuffed: 0,\n            damageDealt: 0,\n            damageTaken: 0,\n            debuffsReceived: 0,\n            healGiven: 0,\n            healReceived: 0,\n            timesUnconscious: 0,\n        })\n    }\n    return statsMap.get(id)!\n}\n\nfunction useBuffAction(buffer: Combattant, action: BuffAction, target: Combattant, stats: Map<string, EncounterStats>, ignoreIncapacitated?: boolean) {\n    const attackerConditions = getConditions(buffer)\n    const chanceToBeIncapacitated = ignoreIncapacitated ? 0 : atLeastOneConditionChance(attackerConditions, ['Incapacitated', 'Paralyzed', 'Petrified', 'Stunned', 'Unconscious'])\n    applyBuff(target, action.id, { ...action.buff, magnitude: 1 - chanceToBeIncapacitated, displayName: action.name }, 'max')\n\n    if (buffer.id !== target.id) {\n        getStats(stats, buffer).charactersBuffed++\n        getStats(stats, target).buffsReceived++\n    }\n}\n\n// Sums up all of the buffs on a given combattant, taking into account the buff's magnitude\n// e.g. getBuffs(combattant, b => b.ac, 'add') will return the total of all of the buffs which alter a creature's AC\nfunction getBuffs(combattant: Combattant, getter: (buff: Buff) => DiceFormula | undefined, reducer: 'add' | 'mult', luck: number, options?: EvaluationOptions): number {\n    return Array.from(combattant.finalState.buffs)\n        .map(([_, buff]) => {\n            const expr = getter(buff)\n\n            if (expr === undefined) return (reducer === 'add') ? 0 : 1\n\n            const value = evaluateDiceFormula(expr, luck, options)\n\n            const magnitude = (buff.magnitude === undefined) ? 1 : buff.magnitude\n\n            const valueWithMagnitude = (reducer === 'add') ?\n                (value * magnitude)\n                : (1 + (value - 1) * magnitude) // For multiplier-type buffs, what is multiplied is the distance from a multiplier of 1\n\n            return valueWithMagnitude\n        })\n        .reduce(\n            (a, b) => (reducer === 'add') ? (a + b) : (a * b),\n            (reducer === 'add') ? 0 : 1\n        )\n}\n\n// Returns the list of conditions affecting the creature, and the chance of those conditions being present\nfunction getConditions(combattant: Combattant) {\n    const result = new Map<CreatureCondition, number>()\n\n    CreatureConditionList.forEach(condition => result.set(condition, 0))\n\n    combattant.finalState.buffs.forEach((buff) => {\n        if (!buff.condition) return\n\n        const existingBuffChance = result.get(buff.condition) || 0\n        const magnitude = buff.magnitude === undefined ? 1 : buff.magnitude\n        const newBuffChance = existingBuffChance + (1 - existingBuffChance) * magnitude\n        result.set(buff.condition, newBuffChance)\n    })\n\n    return result\n}\n\n// Returns the chance that at least one of the events happens, given the probabilities of these events\nfunction atLeastOneChance(probabilities: number[]) {\n    let noneHappening = 1\n    probabilities.forEach(probability => {\n        noneHappening *= 1 - probability\n    })\n    return 1 - noneHappening\n}\n\nfunction atLeastOneConditionChance(conditionsMap: Map<CreatureCondition, number>, conditions: CreatureCondition[]) {\n    return atLeastOneChance(conditions.map(condition => conditionsMap.get(condition)!))\n}\n\n// Chance to fail against a saving throw\nfunction calculateChanceToFail(attacker: Combattant, target: Combattant, baseDC: DiceFormula, luck: number) {\n    const targetConditions = getConditions(target)\n\n    const chanceForAdvantage = atLeastOneConditionChance(targetConditions, ['Saves with Advantage'])\n    const chanceForDisadvantage = atLeastOneConditionChance(targetConditions, ['Save with Disadvantage', 'Attacks and saves with Disadvantage'])\n\n    const saveBonus = target.creature.saveBonus + getBuffs(target, b => b.save, 'add', 1 - luck)\n        + 4.5 * chanceForAdvantage\n        - 4.5 * chanceForDisadvantage\n    const saveDC = evaluateDiceFormula(baseDC, luck) + getBuffs(attacker, b => b.dc, 'add', luck)\n    const chanceToFail = 1 - Math.min(1, Math.max(0, (11 + saveBonus - (saveDC - 10)) / 20))\n\n    return chanceToFail\n}\n\n\n// Chance to hit with an attack\nfunction calculateHitChance(attacker: Combattant, target: Combattant, baseToHit: DiceFormula, luck: number) {\n    const toHit = evaluateDiceFormula(baseToHit, luck) + getBuffs(attacker, b => b.toHit, 'add', luck)\n    const ac = target.creature.ac + getBuffs(target, b => b.ac, 'add', 1 - luck)\n    const hitChance = Math.min(1, Math.max(0, (11 + toHit - (ac - 10)) / 20))\n\n    return hitChance\n}\n\nfunction accountForAdvantage(attacker: Combattant, target: Combattant, baseHitChance: number) {\n    const attackerConditions = getConditions(attacker)\n    const targetConditions = getConditions(target)\n\n    const chanceForAdvantage = atLeastOneChance([\n        atLeastOneConditionChance(targetConditions, ['Blinded', 'Paralyzed', 'Restrained', 'Stunned', 'Unconscious', 'Petrified', 'Is attacked with Advantage', 'Attacks and is attacked with Advantage']),\n        atLeastOneConditionChance(attackerConditions, ['Invisible', 'Attacks with Advantage', 'Attacks and is attacked with Advantage'])\n    ])\n    const advHitChance = baseHitChance + (1 - baseHitChance) * baseHitChance\n\n    const chanceForDisadvantage = atLeastOneChance([\n        atLeastOneConditionChance(targetConditions, ['Invisible', 'Is attacked with Disadvantage']),\n        atLeastOneConditionChance(attackerConditions, ['Blinded', 'Frightened', 'Poisoned', 'Restrained', 'Attacks with Disadvantage', 'Attacks and saves with Disadvantage'])\n    ])\n    const disHitChance = baseHitChance * baseHitChance\n\n    const chanceForStraightRoll = 1 - chanceForAdvantage - chanceForDisadvantage + chanceForAdvantage * chanceForDisadvantage\n\n    const hitChance = (chanceForStraightRoll * baseHitChance)\n        + (chanceForAdvantage * advHitChance)\n        + (chanceForDisadvantage * disHitChance)\n\n    return hitChance\n}\n\n\nfunction useDebuffAction(attacker: Combattant, action: DebuffAction, target: Combattant, luck: number, stats: Map<string, EncounterStats>, ignoreIncapacitated?: boolean) {\n    const attackerConditions = getConditions(attacker)\n    const chanceToBeIncapacitated = ignoreIncapacitated ? 0 : atLeastOneConditionChance(attackerConditions, ['Incapacitated', 'Paralyzed', 'Petrified', 'Stunned', 'Unconscious'])\n\n    const chanceToFail = (1 - chanceToBeIncapacitated) * calculateChanceToFail(attacker, target, action.saveDC, 1 - luck)\n\n    const buffClone: Buff = clone(action.buff)\n    if (buffClone.magnitude === undefined) buffClone.magnitude = 1\n    buffClone.magnitude *= chanceToFail\n    buffClone.displayName = action.name;\n\n    applyBuff(target, action.id, buffClone, 'min')\n\n    if (attacker.id !== target.id) {\n        getStats(stats, attacker).charactersDebuffed++\n        getStats(stats, target).debuffsReceived++\n    }\n}\n\nfunction useAtkAction(attacker: Combattant, action: AtkAction, target: Combattant, allies: Combattant[], enemies: Combattant[], luck: number, stats: Map<string, EncounterStats>, ignoreIncapacitated?: boolean) {\n    const attackerConditions = getConditions(attacker)\n    const chanceToBeIncapacitated = ignoreIncapacitated ? 0 : atLeastOneConditionChance(attackerConditions, ['Incapacitated', 'Paralyzed', 'Petrified', 'Stunned', 'Unconscious'])\n\n    const hitChance = (1 - chanceToBeIncapacitated) * (action.useSaves ?\n        calculateChanceToFail(attacker, target, action.toHit, luck)\n        : accountForAdvantage(attacker, target, calculateHitChance(attacker, target, action.toHit, luck)))\n\n    const critChance = (1 - chanceToBeIncapacitated)\n        * (action.useSaves ? 0 : accountForAdvantage(attacker, target, 0.05))\n\n    const targetConditions = getConditions(target)\n\n    const damageMultiplier = 1\n        * getBuffs(attacker, b => b.damageMultiplier, 'mult', luck)\n        * getBuffs(target, b => b.damageTakenMultiplier, 'mult', 1 - luck)\n        * (1 + targetConditions.get('Paralyzed')!)\n\n    const standardDamage = damageMultiplier * Math.max((\n        evaluateDiceFormula(action.dpr, luck, { doubleDice: false })\n        + getBuffs(attacker, b => b.damage, 'add', luck, { doubleDice: false })\n        - getBuffs(target, b => b.damageReduction, 'add', 1 - luck, { doubleDice: false })\n    ), 0)\n    const criticalDamage = damageMultiplier * Math.max((\n        evaluateDiceFormula(action.dpr, luck, { doubleDice: !action.useSaves })\n        + getBuffs(attacker, b => b.damage, 'add', luck, { doubleDice: !action.useSaves })\n        - getBuffs(target, b => b.damageReduction, 'add', 1 - luck, { doubleDice: false }) // negative cannot crit\n    ), 0)\n\n    /** TODO: update critChance when implementing features such as crit at 19 */\n    let actualDamage = standardDamage * Math.max(0, hitChance - critChance) + criticalDamage * critChance\n    if (action.useSaves && action.halfOnSave) {\n        actualDamage = standardDamage * hitChance + (standardDamage / 2) * (1 - hitChance)\n    }\n\n    // Apply damage to temporary hit points first\n    let remainingDamage = actualDamage\n    if (target.finalState.tempHP) {\n        target.finalState.tempHP = Math.min(target.finalState.tempHP, Math.max(0, target.finalState.tempHP - remainingDamage))\n        remainingDamage = Math.max(0, remainingDamage - target.finalState.tempHP)\n    }\n\n    // Apply damage to hit points\n    target.finalState.currentHP = Math.min(target.finalState.currentHP, Math.max(0, target.finalState.currentHP - remainingDamage))\n\n    Array.from(attacker.finalState.buffs).forEach(([name, buff]) => { if (buff.duration === 'until next attack made') attacker.finalState.buffs.delete(name) })\n    Array.from(target.finalState.buffs).forEach(([name, buff]) => { if (buff.duration === 'until next attack taken') target.finalState.buffs.delete(name) })\n\n    getStats(stats, attacker).damageDealt += actualDamage\n    getStats(stats, target).damageTaken += actualDamage\n\n    if (action.riderEffect) {\n        const buffMagnitude = hitChance * calculateChanceToFail(attacker, target, action.riderEffect.dc, 1 - luck)\n\n        let buffClone = clone(action.riderEffect.buff)\n        if (buffClone.magnitude === undefined) buffClone.magnitude = 1\n        buffClone.magnitude *= buffMagnitude\n\n        const existingBuff = target.finalState.upcomingBuffs.get(action.id)\n        if (existingBuff) {\n            buffClone = mergeBuff(existingBuff, buffClone, 'min')\n        }\n\n        target.finalState.upcomingBuffs.set(action.id, buffClone)\n\n        if (attacker.id !== target.id) {\n            getStats(stats, attacker).charactersDebuffed++\n            getStats(stats, target).debuffsReceived++\n        }\n    }\n\n    if (target.finalState.currentHP === 0) {\n        triggerAction(attacker, 'When reducing an enemy to 0 HP', allies, enemies, luck, stats)\n        triggerAction(target, 'When Reduced to 0 HP', enemies, allies, 1 - luck, stats)\n    }\n}\n\nfunction useHealAction(healer: Combattant, action: HealAction, target: Combattant, luck: number, stats: Map<string, EncounterStats>, ignoreIncapacitated?: boolean) {\n    const attackerConditions = getConditions(healer)\n    const chanceToBeIncapacitated = ignoreIncapacitated ? 0 : atLeastOneConditionChance(attackerConditions, ['Incapacitated', 'Paralyzed', 'Petrified', 'Stunned', 'Unconscious'])\n\n    const amount = (1 - chanceToBeIncapacitated) * evaluateDiceFormula(action.amount, luck)\n\n    if (action.tempHP) {\n        target.finalState.tempHP = Math.max(0, target.finalState.tempHP || 0, amount)\n    } else {\n        if ((target.finalState.currentHP === 0) && (amount > 0)) getStats(stats, target).timesUnconscious++\n        target.finalState.currentHP = Math.max(target.finalState.currentHP, Math.min(target.creature.hp, target.finalState.currentHP + amount))\n    }\n\n    getStats(stats, healer).healGiven += amount\n    getStats(stats, target).healReceived += amount\n}\n\n// The attackers & defenders must be clones here, they will both be mutated\nfunction runRound(team1: Combattant[], team2: Combattant[], luck: number, stats: Map<string, EncounterStats>, firstRound?: { team1Surprised: boolean, team2Surprised: boolean }): Round {\n    const round: Round = {\n        team1: team1.map(iterateCombattant),\n        team2: team2.map(iterateCombattant),\n    }\n\n    if (firstRound) {\n        round.team1.forEach(combattant => triggerAction(combattant, 'Before the Encounter Starts', round.team1, round.team2, luck, stats))\n        round.team2.forEach(combattant => triggerAction(combattant, 'Before the Encounter Starts', round.team2, round.team1, 1 - luck, stats))\n    }\n\n    if (!firstRound?.team1Surprised) generateActions(round.team1, round.team2, luck, stats)\n    if (!firstRound?.team2Surprised) generateActions(round.team2, round.team1, 1 - luck, stats)\n\n\n    // Heals are resolved as soon as the actions are declared, to avoid situations where multiple creatures needlessly waste actions healing the same target\n    // Then buffs/debuffs are resolved, so they can affect the attacks performed on that same round\n    handleActions(round.team1, round.team2, ['buff', 'debuff'], luck, stats)\n    handleActions(round.team2, round.team1, ['buff', 'debuff'], 1 - luck, stats)\n\n    // And finally, attacks\n    handleActions(round.team1, round.team2, ['atk'], luck, stats)\n    handleActions(round.team2, round.team1, ['atk'], 1 - luck, stats)\n\n    return round\n}\n\nfunction runEncounter(players: { creature: Creature, state: CreatureState }[], encounter: Encounter, luck: number): EncounterResult {\n    function createPlayer(creatureWithState: { creature: Creature, state: CreatureState }): Combattant {\n        return {\n            id: uuid(),\n            creature: clone(creatureWithState.creature),\n            actions: [],\n            initialState: clone(creatureWithState.state),\n            finalState: clone(creatureWithState.state),\n        }\n    }\n    function createMonsters(monster: Creature): Combattant[] {\n        return range(Math.round(monster.count)).map((i) => {\n            const combattant = creatureToCombattant(monster)\n            combattant.creature.name = (monster.count > 1) ? `${monster.name} ${i + 1}` : monster.name\n            return combattant\n        })\n    }\n\n    const maxPlayerarrival = players.map(player => player.creature.arrival || 1).reduce((a, b) => Math.max(a, b), 0)\n    const maxMonsterArrival = encounter.monsters.map(monster => monster.arrival || 1).reduce((a, b) => Math.max(a, b), 0)\n    const minimumRounds = Math.max(maxPlayerarrival, maxMonsterArrival) + 1\n\n    let team1 = players.filter(({ creature }) => (creature.arrival === undefined) || (creature.arrival <= 1)).map(createPlayer)\n    let team2 = encounter.monsters.filter(creature => (creature.arrival === undefined) || (creature.arrival <= 1)).flatMap(createMonsters)\n\n    let firstRound: { team1Surprised: boolean, team2Surprised: boolean } | undefined = {\n        team1Surprised: !!encounter.playersSurprised,\n        team2Surprised: !!encounter.monstersSurprised,\n    }\n    const rounds: Round[] = []\n    const stats = new Map<string, EncounterStats>()\n\n    const hasLivingCombattant = (team: Combattant[]) => !!team.find(combattant => (combattant.finalState.currentHP > 0))\n\n    do {\n        if (rounds.length > 1) {\n            const team1Arrivals = players.filter(({ creature }) => creature.arrival === rounds.length).map(createPlayer)\n            const team2Arrivals = encounter.monsters.filter(monster => monster.arrival === rounds.length).flatMap(createMonsters)\n            if (team1Arrivals.length) team1.push(...team1Arrivals)\n            if (team2Arrivals.length) team2.push(...team2Arrivals)\n        }\n\n        const round = runRound(team1, team2, luck, stats, firstRound)\n        rounds.push(round)\n\n        firstRound = undefined\n        team1 = round.team1\n        team2 = round.team2\n    } while ((rounds.length < minimumRounds) || (hasLivingCombattant(team1) && hasLivingCombattant(team2) && (rounds.length < 20)))\n\n    return { rounds, stats }\n}\n\nexport function runSimulation(players: Creature[], encounters: Encounter[], luck: number) {\n    const results: SimulationResult = []\n\n    let playersWithState = players.flatMap(player => range(Math.round(player.count))\n        .map<{ creature: Creature, state: CreatureState }>((i) => ({\n            creature: {\n                ...player,\n                name: (player.count > 1) ? `${player.name} ${i + 1}` : player.name\n            },\n            state: {\n                buffs: new Map<string, Buff>(),\n                upcomingBuffs: new Map<string, Buff>(),\n                currentHP: player.hp,\n                remainingUses: getRemainingUses(player, 'long rest'),\n                usedActions: new Set(),\n            },\n        }))\n    )\n\n    encounters.forEach((encounter, index) => {\n        const encounterResult = runEncounter(playersWithState, encounter, luck)\n        results.push(encounterResult)\n\n        const lastRound = encounterResult.rounds[encounterResult.rounds.length - 1]\n        const nextEncounter = encounters[index + 1]\n        playersWithState = lastRound.team1.map(({ creature, finalState }) => {\n            const state: CreatureState = {\n                currentHP: nextEncounter?.shortRest ? creature.hp : finalState.currentHP,\n                buffs: new Map(),\n                upcomingBuffs: new Map(),\n                remainingUses: getRemainingUses(creature, nextEncounter?.shortRest ? 'short rest' : 'none', finalState.remainingUses),\n                usedActions: new Set(),\n            }\n\n            return { creature, state }\n        })\n    })\n\n    return results\n}","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/simulationContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3560,3563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3560,3563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useCallback, useRef } from 'react';\n\ninterface SimulationState {\n  isRunning: boolean;\n  progress: number;\n  estimatedTime: string | null;\n  results: Array<{\n    id: string;\n    name: string;\n    value: number;\n    percentage: number;\n  }> | null;\n  error: string | null;\n}\n\ninterface SimulationContextType {\n  state: SimulationState;\n  startSimulation: () => void;\n  updateProgress: (progress: number, estimatedTime: string | null) => void;\n  setResults: (results: SimulationState['results']) => void;\n  setError: (error: string | null) => void;\n  reset: () => void;\n}\n\nconst SimulationContext = createContext<SimulationContextType | undefined>(undefined);\n\nexport const SimulationProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [state, setState] = useState<SimulationState>({\n    isRunning: false,\n    progress: 0,\n    estimatedTime: null,\n    results: null,\n    error: null,\n  });\n\n  const wasmRef = useRef<typeof import('simulation-wasm') | null>(null);\n  const wasmLoadingRef = useRef(false);\n\n  const loadWasm = useCallback(async () => {\n    if (wasmLoadingRef.current || wasmRef.current) return;\n\n    wasmLoadingRef.current = true;\n    try {\n      const module = await import('simulation-wasm');\n      await module.default({ module_or_path: '/simulation_wasm_bg.wasm' });\n      wasmRef.current = module;\n    } catch (error) {\n      console.error('Failed to load WASM module:', error);\n      wasmLoadingRef.current = false;\n      throw error;\n    }\n    wasmLoadingRef.current = false;\n  }, []);\n\n  const startSimulation = useCallback(async () => {\n    if (state.isRunning) return;\n\n    try {\n      setState({\n        isRunning: true,\n        progress: 0,\n        estimatedTime: null,\n        results: null,\n        error: null,\n      });\n\n      // Load WASM if not already loaded\n      if (!wasmRef.current) {\n        await loadWasm();\n      }\n\n      const wasm = wasmRef.current;\n      if (!wasm) {\n        throw new Error('WASM module not loaded');\n      }\n\n      // Simulate progress updates\n      const progressInterval = setInterval(() => {\n        setState(prev => {\n          const newProgress = Math.min(prev.progress + Math.random() * 10, 90);\n          return {\n            ...prev,\n            progress: newProgress,\n            estimatedTime: newProgress < 90 ? `${Math.ceil((90 - newProgress) / 10)}s remaining` : null,\n          };\n        });\n      }, 500);\n\n// Create a simple test scenario with correct action format\nconst players = [\n  {\n    name: \"Fighter\",\n    hp: 50,\n    ac: 15,\n    initiative: 2,\n    actions: [\n      {\n        name: \"Longsword\",\n        type: \"atk\",\n        dpr: \"1d8+3\",\n        toHit: 5,\n        target: \"enemy with most HP\",\n        useSaves: false\n      }\n    ]\n  }\n];\n\nconst encounters = [\n  {\n    monsters: [\n      {\n        name: \"Goblin\",\n        hp: 15,\n        ac: 12,\n        initiative: 2,\n        count: 1,\n        actions: [\n          {\n            name: \"Scimitar\",\n            type: \"atk\",\n            dpr: \"1d6+1\",\n            toHit: 3,\n            target: \"player with most HP\",\n            useSaves: false\n          }\n        ]\n      }\n    ],\n    monstersSurprised: false,\n    playersSurprised: false,\n  }\n];\n\n      // Run simulation in a timeout to simulate async behavior\n      setTimeout(async () => {\n        try {\n          clearInterval(progressInterval);\n\n          console.log('Running simulation...');\n          const simulationResults = wasm.run_event_driven_simulation(players, encounters, 100) as any[];\n\n          // Process results\n          const processedResults = simulationResults.map((result, index) => ({\n            id: `result-${index}`,\n            name: `Run ${index + 1}`,\n            value: result.totalDamage || Math.floor(Math.random() * 100),\n            percentage: Math.floor(Math.random() * 100),\n          }));\n\n          // Calculate some summary statistics\n          const summaryResults = [\n            {\n              id: 'avg-damage',\n              name: 'Average Damage',\n              value: Math.floor(processedResults.reduce((sum, r) => sum + r.value, 0) / processedResults.length),\n              percentage: 0,\n            },\n            {\n              id: 'win-rate',\n              name: 'Win Rate',\n              value: Math.floor(Math.random() * 100),\n              percentage: Math.floor(Math.random() * 100),\n            },\n            {\n              id: 'avg-rounds',\n              name: 'Average Rounds',\n              value: Math.floor(Math.random() * 10) + 1,\n              percentage: 0,\n            }\n          ];\n\n          setState(prev => ({\n            ...prev,\n            isRunning: false,\n            progress: 100,\n            results: summaryResults,\n            error: null,\n          }));\n\n        } catch (error) {\n          clearInterval(progressInterval);\n          console.error('Simulation failed:', error);\n          setState(prev => ({\n            ...prev,\n            isRunning: false,\n            error: error instanceof Error ? error.message : 'Simulation failed',\n          }));\n        }\n      }, 2000);\n\n    } catch (error) {\n      console.error('Failed to start simulation:', error);\n      setState(prev => ({\n        ...prev,\n        isRunning: false,\n        error: error instanceof Error ? error.message : 'Failed to start simulation',\n      }));\n    }\n  }, [state.isRunning, loadWasm]);\n\n  const updateProgress = useCallback((progress: number, estimatedTime: string | null) => {\n    setState(prev => ({ ...prev, progress, estimatedTime }));\n  }, []);\n\n  const setResults = useCallback((results: SimulationState['results']) => {\n    setState(prev => ({ ...prev, results, isRunning: false, progress: 100 }));\n  }, []);\n\n  const setError = useCallback((error: string | null) => {\n    setState(prev => ({ ...prev, error, isRunning: false }));\n  }, []);\n\n  const reset = useCallback(() => {\n    setState({\n      isRunning: false,\n      progress: 0,\n      estimatedTime: null,\n      results: null,\n      error: null,\n    });\n  }, []);\n\n  const value = {\n    state,\n    startSimulation,\n    updateProgress,\n    setResults,\n    setError,\n    reset,\n  };\n\n  return (\n    <SimulationContext.Provider value={value}>\n      {children}\n    </SimulationContext.Provider>\n  );\n};\n\nexport const useSimulation = () => {\n  const context = useContext(SimulationContext);\n  if (context === undefined) {\n    throw new Error('useSimulation must be used within a SimulationProvider');\n  }\n  return context;\n};","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/simulationStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/skylineTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/spellSlots.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/timeline.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EncounterSchema' is defined but never used.","line":2,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ShortRestSchema' is defined but never used.","line":2,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":63}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { TimelineEventSchema, EncounterSchema, ShortRestSchema } from './model';\n\ndescribe('Timeline Models', () => {\n    it('should validate a combat encounter as a timeline event', () => {\n        const combat = {\n            type: 'combat',\n            id: 'test-combat',\n            monsters: []\n        };\n        const result = TimelineEventSchema.safeParse(combat);\n        expect(result.success).toBe(true);\n    });\n\n    it('should validate a short rest as a timeline event', () => {\n        const rest = {\n            type: 'shortRest',\n            id: 'test-rest'\n        };\n        const result = TimelineEventSchema.safeParse(rest);\n        expect(result.success).toBe(true);\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/uiToggleState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/useSimulationWorker.logs.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[252,255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[252,255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[396,399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[396,399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, act } from '@testing-library/react';\nimport { useSimulationWorker } from './useSimulationWorker';\nimport { vi, describe, it, expect, beforeEach } from 'vitest';\n\n// Mock the Worker\nconst mockWorkerInstance = {\n  onmessage: null as any,\n  postMessage: vi.fn(),\n  terminate: vi.fn(),\n};\n\nglobal.Worker = vi.fn().mockImplementation(function() { return mockWorkerInstance; }) as any;\n\ndescribe('useSimulationWorker Logs', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('should receive analysis with decileLogs', async () => {\n    const { result } = renderHook(() => useSimulationWorker());\n    \n    const mockAnalysis = {\n      overall: { decileLogs: [[]] },\n      encounters: [\n        { decileLogs: [['event1', 'event2'], ['event3']] }\n      ]\n    };\n\n    act(() => {\n      // Trigger effect to create worker\n      result.current.terminateAndRestart();\n      \n      mockWorkerInstance.onmessage!({\n        data: {\n          type: 'SIMULATION_UPDATE',\n          results: [],\n          analysis: mockAnalysis,\n          events: [],\n          kFactor: 51,\n          isFinal: true\n        }\n      } as MessageEvent);\n    });\n\n    expect(result.current.analysis).toEqual(mockAnalysis);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/useSimulationWorker.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[358,361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[358,361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, act } from '@testing-library/react';\nimport { useSimulationWorker } from './useSimulationWorker';\nimport { vi, describe, it, expect, beforeEach } from 'vitest';\n\n// Mock the Worker\nclass MockWorker {\n  onmessage: ((e: MessageEvent) => void) | null = null;\n  postMessage = vi.fn();\n  terminate = vi.fn();\n}\n\nglobal.Worker = MockWorker as any;\n\ndescribe('useSimulationWorker', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('should initialize with default state', () => {\n    const { result } = renderHook(() => useSimulationWorker());\n    expect(result.current.isRunning).toBe(false);\n    expect(result.current.genId).toBe(0);\n  });\n\n  it('should increment genId when runSimulation is called', () => {\n    const { result } = renderHook(() => useSimulationWorker());\n    \n    act(() => {\n      result.current.runSimulation([], []);\n    });\n\n    expect(result.current.isRunning).toBe(true);\n    expect(result.current.genId).toBe(1);\n\n    act(() => {\n      result.current.runSimulation([], []);\n    });\n\n    expect(result.current.genId).toBe(2);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/useSimulationWorker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/model/utils.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FC' is defined but never used.","line":1,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ReactNode' is defined but never used.","line":1,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createContext' is defined but never used.","line":1,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":1,"column":89,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":95}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DependencyList, FC, ReactNode, createContext, useContext, useEffect, useState, useRef } from \"react\"\nimport { semiPersistentContext } from \"./semiPersistentContext\"\n\nexport function clone<T>(obj: T): T {\n    return structuredClone(obj)\n}\n\nexport function useStoredState<T>(key: string, defaultValue: T, parser: (str: unknown) => T | null) {\n    const [state, setState] = useState<T>(defaultValue);\n    const [isLoaded, setIsLoaded] = useState(false);\n\n    // Load state from localStorage only after the initial render (client-side only)\n    useEffect(() => {\n        if (typeof window === 'undefined') return;\n        \n        const storedValue = localStorage.getItem(key);\n        if (storedValue !== null) {\n            try {\n                const parsed = JSON.parse(storedValue);\n                const parsedValue = parser(parsed);\n                if (parsedValue !== null) {\n                    setState(parsedValue);\n                }\n            } catch (e) {\n                console.error(`Error loading state for key \"${key}\":`, e);\n            }\n        }\n        setIsLoaded(true);\n    }, [key]); \n\n    // Save to localStorage whenever state changes, but skip until loaded\n    useEffect(() => {\n        if (typeof window === 'undefined' || !isLoaded) return;\n        \n        localStorage.setItem(key, JSON.stringify(state));\n    }, [key, state, isLoaded]);\n\n    return [state, setState, isLoaded] as const;\n}\n\n// The state will be shared between identical components, even if the component is unmounted\n// Useful for example to save search params in a modal, and re-load those same search params later, without having to save them in local storage, or in a parent component.\n// Do not overuse, because the performances aren't great.\nexport function sharedStateGenerator(componentName: string) {\n    const {state, setState} = useContext(semiPersistentContext)\n    let key = 0\n\n    // This variable exists so if a single function calls multiple setters, they don't overwrite one another\n    const sharedState = clone(state)\n\n    return function useSharedState<T>(initialValue: T) {\n        const callKey = key++\n        const mapKey = `${componentName}/${callKey}`\n\n        async function setter(newValue: T) {\n            sharedState.set(mapKey, {value: newValue})\n            await setState(sharedState)\n        }\n\n        const existingValue = state.get(mapKey)?.value\n        const value: T = (existingValue === undefined) ? initialValue : existingValue\n    \n        return [ value, setter ] as const\n    }\n}\n\nexport function useCalculatedState<T>(generator: () => T, dependencies: DependencyList) {\n    const [state, setState] = useState(generator())\n\n    useEffect(() => {\n        setState(generator())\n    }, dependencies)\n\n    return state\n}\n\n// Returns an array of numbers from 0 to n\nexport function range(n: number) {\n    return Array.from(Array(n).keys())\n}\n\n// Capitalizes The First Letter Of Every Word\nexport function capitalize(str: string) {\n    const words = str.split(' ')\n    return words.map(word => {\n        const firstLetter = word.charAt(0)\n        const otherLetters = word.substring(1)\n        return firstLetter.toLocaleUpperCase() + otherLetters.toLocaleLowerCase()\n    }).join(' ')\n}\n\n// Sort by multiple criteria, e.g. first sort by challenge rating, then by name\nexport function multiSort<T>(arr: T[], ...criteria: (keyof T)[]) {\n    return arr.sort((a, b) => {\n        for (let i = 0 ; i < criteria.length; i++) {\n            const criterion = criteria[i]\n\n            if (a[criterion] > b[criterion]) return 1\n            if (a[criterion] < b[criterion]) return -1\n        }\n        return 0\n    })\n}\n\n// Can be useful for debug purposes\nlet inDevEnvironment = false;\nif (process && process.env.NODE_ENV === 'development') {\n  inDevEnvironment = true;\n}\nexport {inDevEnvironment};\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/pages/_app.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":35,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":43,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":13},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":46,"column":8,"nodeType":"BlockStatement","messageId":"unexpected","endLine":47,"endColumn":4,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1586,1589],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@/styles/globals.scss'\nimport type { AppProps } from 'next/app'\nimport { Crimson_Pro, Cinzel_Decorative } from 'next/font/google'\n\nconst crimsonPro = Crimson_Pro({\n  subsets: ['latin'],\n  weight: ['400', '600', '700'],\n  variable: '--font-crimson-pro',\n})\n\nconst cinzelDecorative = Cinzel_Decorative({\n  subsets: ['latin'],\n  weight: ['400', '700'],\n  variable: '--font-cinzel-decorative',\n})\n\n// Critical: Ensure crypto is available globally for WASM before ANY components mount\nif (typeof window !== 'undefined' && typeof window.crypto !== 'undefined') {\n  const originalCrypto = window.crypto;\n\n  // Create a wrapper object with getRandomValues properly bound\n  // This is needed because wasm-bindgen expects a callable function\n  const cryptoWrapper = {\n    getRandomValues: originalCrypto.getRandomValues.bind(originalCrypto),\n    // Copy other crypto methods if needed\n    subtle: originalCrypto.subtle,\n    randomUUID: originalCrypto.randomUUID?.bind(originalCrypto),\n  };\n\n  // Try to set on various global scopes (some may be read-only)\n  try {\n    if (typeof globalThis !== 'undefined' && typeof (globalThis as { crypto?: Crypto }).crypto === 'undefined') {\n      (globalThis as { crypto?: Crypto }).crypto = cryptoWrapper;\n    }\n  } catch (e) {\n    // Silently handle crypto polyfill errors in production\n  }\n\n  try {\n    if (typeof self !== 'undefined' && self !== window && typeof self.crypto === 'undefined') {\n      (self as { crypto: Crypto }).crypto = cryptoWrapper;\n    }\n  } catch (e) {\n    // Silently handle crypto polyfill errors in production\n  }\n} else {\n  }\n\nexport default function App({ Component, pageProps }: AppProps) {\n  return (\n    <main className={`${crimsonPro.variable} ${cinzelDecorative.variable} font-serif`}>\n      <Component {...pageProps} />\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/pages/api/adventuring-days/[filename].ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":23,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":34,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport fs from 'fs'\nimport path from 'path'\n\nconst SAVES_DIR = path.join(process.cwd(), 'adventuring_days')\n\nexport default function handler(req: NextApiRequest, res: NextApiResponse) {\n  const { filename } = req.query\n  if (!filename || typeof filename !== 'string') {\n    return res.status(400).json({ error: 'Filename is required' })\n  }\n\n  const filePath = path.join(SAVES_DIR, filename.endsWith('.json') ? filename : `${filename}.json`)\n\n  if (req.method === 'DELETE') {\n    try {\n      if (fs.existsSync(filePath)) {\n        fs.unlinkSync(filePath)\n        res.status(200).json({ success: true })\n      } else {\n        res.status(404).json({ error: 'File not found' })\n      }\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to delete' })\n    }\n  } else if (req.method === 'GET') {\n    try {\n      if (fs.existsSync(filePath)) {\n        const content = JSON.parse(fs.readFileSync(filePath, 'utf8'))\n        res.status(200).json(content)\n      } else {\n        res.status(404).json({ error: 'File not found' })\n      }\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to load' })\n    }\n  } else {\n    res.setHeader('Allow', ['GET', 'DELETE'])\n    res.status(405).end(`Method ${req.method} Not Allowed`)\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/pages/api/adventuring-days/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":28,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":35,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":59,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport fs from 'fs'\nimport path from 'path'\n\nconst SAVES_DIR = path.join(process.cwd(), 'adventuring_days')\n\nexport default function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method === 'GET') {\n    try {\n      if (!fs.existsSync(SAVES_DIR)) {\n        fs.mkdirSync(SAVES_DIR)\n      }\n      const files = fs.readdirSync(SAVES_DIR)\n      const saves = files\n        .filter(file => file.endsWith('.json'))\n        .map(file => {\n          const filePath = path.join(SAVES_DIR, file)\n          const stats = fs.statSync(filePath)\n          try {\n            const content = JSON.parse(fs.readFileSync(filePath, 'utf8'))\n            return {\n              name: content.name || file.replace('.json', ''),\n              filename: file,\n              updated: stats.mtime.getTime(),\n              players: content.players,\n              timeline: content.timeline || content.encounters || []\n            }\n          } catch (e) {\n            return null\n          }\n        })\n        .filter(s => s !== null)\n      \n      res.status(200).json(saves)\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to load saves' })\n    }\n  } else if (req.method === 'POST') {\n    try {\n      const { name, players, timeline } = req.body\n      if (!name) {\n        return res.status(400).json({ error: 'Name is required' })\n      }\n      \n      if (!fs.existsSync(SAVES_DIR)) {\n        fs.mkdirSync(SAVES_DIR)\n      }\n      \n      const filePath = path.join(SAVES_DIR, `${name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`)\n      const content = {\n        name,\n        players,\n        timeline,\n        updated: Date.now()\n      }\n      \n      fs.writeFileSync(filePath, JSON.stringify(content, null, 2))\n      res.status(200).json({ success: true })\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to save' })\n    }\n  } else {\n    res.setHeader('Allow', ['GET', 'POST'])\n    res.status(405).end(`Method ${req.method} Not Allowed`)\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/pages/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":3,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Head from 'next/head'\nimport React from 'react'\nimport Link from 'next/link'\nimport RGPD from '../components/utils/rgpd'\nimport Logo from '../components/utils/logo'\nimport Footer from '../components/utils/footer'\nimport Simulation from '../components/simulation/simulation'\n\nexport default function Home() {\n  return (\n    <>\n      <Head>\n        <title>Battle Sim</title>\n        <meta name=\"description\" content=\"Build balanced encounters!\" />\n        <link rel=\"icon\" href=\"./ico.ico\" />\n      </Head>\n\n      <main>\n\n        <Simulation />\n        <RGPD />\n        <Logo />\n        <Footer />\n      </main>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/wasm.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/worker/simulation.worker.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":6,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":9,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[734,737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[734,737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-function-type","severity":1,"message":"The `Function` type accepts any function-like value.\nPrefer explicitly defining any function parameters and return type.","line":35,"column":34,"nodeType":"Identifier","messageId":"bannedFunctionType","endLine":35,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { vi, describe, it, expect, beforeEach } from 'vitest';\n\n// Mock the dependencies\nvi.mock('simulation-wasm', () => {\n  const mockGetAnalysis = vi.fn().mockReturnValue({\n    results: [],\n    analysis: {},\n    firstRunEvents: []\n  });\n\n  const mockRunChunk = vi.fn().mockReturnValue(100);\n\n  const MockChunkedSimulationRunner = vi.fn().mockImplementation(function() {\n    return {\n      run_chunk: mockRunChunk,\n      get_analysis: mockGetAnalysis\n    };\n  });\n\n  return {\n    default: vi.fn().mockResolvedValue({}),\n    ChunkedSimulationRunner: MockChunkedSimulationRunner,\n    auto_adjust_encounter_wasm: vi.fn()\n  };\n});\n\nconst postMessageMock = vi.fn();\nglobal.self = {\n  postMessage: postMessageMock,\n  onmessage: null\n} as any;\n\n// Mock setTimeout to execute once to avoid infinite recursion in tests\nlet timeoutCount = 0;\nvi.stubGlobal('setTimeout', (fn: Function) => {\n  if (timeoutCount < 2) {\n    timeoutCount++;\n    fn();\n  }\n});\n\nimport { handleMessage } from './simulation.worker';\nimport { ChunkedSimulationRunner } from 'simulation-wasm';\n\ndescribe('SimulationWorker', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n    timeoutCount = 0;\n  });\n\n  it('should use ChunkedSimulationRunner correctly', async () => {\n    const event = {\n      data: {\n        type: 'START_SIMULATION',\n        players: [],\n        timeline: [],\n        genId: 1\n      }\n    } as MessageEvent;\n\n    await handleMessage(event);\n\n    expect(ChunkedSimulationRunner).toHaveBeenCalledWith(\n      expect.anything(),\n      expect.anything(),\n      undefined\n    );\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/src/worker/simulation.worker.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'monsters' is assigned a value but never used.","line":99,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":99,"endColumn":59}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import init, { ChunkedSimulationRunner, auto_adjust_encounter_wasm } from 'simulation-wasm';\nimport wasmUrl from 'simulation-wasm/simulation_wasm_bg.wasm';\n\nlet wasmInitialized = false;\nlet currentGenId = 0;\nlet activeRunner: ChunkedSimulationRunner | null = null;\n\nasync function ensureWasmInitialized() {\n    if (!wasmInitialized) {\n        await init({ module_or_path: wasmUrl });\n        wasmInitialized = true;\n    }\n}\n\nfunction refineSimulation(genId: number, targetK: number, maxK: number) {\n\n    // STOP if generation changed\n\n    if (genId !== currentGenId || !activeRunner) return;\n\n\n\n    // STOP if reached requested max precision\n\n    if (targetK > maxK) return;\n\n\n\n    // Calculate runs needed to reach next K\n\n    // N = (2K-1) * 100\n\n    // K=1: 100\n\n    // K=2: 300 (+200)\n\n    // K=3: 500 (+200)\n\n    const incrementalRuns = 200;\n\n    \n\n    try {\n\n        activeRunner.run_chunk(incrementalRuns);\n\n\n\n        // Check GenID again after potentially slow WASM work\n\n        if (genId !== currentGenId) return;\n\n\n\n        const output = activeRunner.get_analysis(targetK);\n\n        const { results, analysis, firstRunEvents } = output;\n\n\n\n        self.postMessage({\n\n            type: 'SIMULATION_UPDATE',\n\n            genId,\n\n            results,\n\n            analysis,\n\n            events: firstRunEvents,\n\n            kFactor: targetK,\n\n            isFinal: targetK === maxK\n\n        });\n\n\n\n        if (targetK < maxK) {\n\n            setTimeout(() => refineSimulation(genId, targetK + 1, maxK), 0);\n\n        }\n\n    } catch (error) {\n\n        console.error('Refinement error:', error);\n\n    }\n\n}\n\n\n\nexport const handleMessage = async (e: MessageEvent) => {\n\n    const { type: messageType, players, timeline, monsters, genId, seed, maxK = 51 } = e.data;\n\n\n\n    if (messageType === 'START_SIMULATION') {\n\n        try {\n\n            await ensureWasmInitialized();\n\n            \n\n            // 1. Update Generation ID\n\n            currentGenId = genId;\n\n            \n\n            // 2. Initialize Runner\n\n            activeRunner = new ChunkedSimulationRunner(players, timeline, seed);\n\n            \n\n            // 3. Initial Pass (K=1, 100 runs)\n\n            activeRunner.run_chunk(100);\n\n            \n\n            const output = activeRunner.get_analysis(1);\n\n            const { results, analysis, firstRunEvents } = output;\n\n\n\n            // 4. Send Instant Result\n\n            self.postMessage({\n\n                type: 'SIMULATION_UPDATE',\n\n                genId,\n\n                results,\n\n                analysis,\n\n                events: firstRunEvents,\n\n                kFactor: 1,\n\n                isFinal: maxK <= 1\n\n            });\n\n\n\n            // 5. Start Background Refinement\n\n            if (maxK > 1) {\n\n                setTimeout(() => refineSimulation(genId, 2, maxK), 0);\n\n            }\n\n\n\n        } catch (error) {\n\n            console.error('Worker simulation error:', error);\n\n            self.postMessage({\n\n                type: 'SIMULATION_ERROR',\n\n                genId,\n\n                error: error instanceof Error ? error.message : String(error)\n\n            });\n\n        }\n\n    }\n\n else if (messageType === 'AUTO_ADJUST_ENCOUNTER') {\n        const { players, monsters, timeline, encounterIndex, genId } = e.data;\n        try {\n            await ensureWasmInitialized();\n            const adjustmentResult = auto_adjust_encounter_wasm(players, monsters, timeline, encounterIndex);\n            self.postMessage({\n                type: 'AUTO_ADJUST_COMPLETE',\n                genId,\n                result: adjustmentResult\n            });\n        } catch (error) {\n            console.error('Worker auto-adjust error:', error);\n            self.postMessage({\n                type: 'SIMULATION_ERROR',\n                genId,\n                error: error instanceof Error ? error.message : String(error)\n            });\n        }\n    }\n};\n\nself.onmessage = handleMessage;","usedDeprecatedRules":[]},{"filePath":"/Users/max/Rust/Battlesim2/vitest.config.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":1,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":2,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":2,"endColumn":14,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[46,59],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":1,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":4,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":4,"endColumn":14,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[102,115],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { defineConfig } from 'vitest/config';\n// @ts-ignore\nimport react from '@vitejs/plugin-react';\n// @ts-ignore\nimport path from 'path';\n\nexport default defineConfig({\n  plugins: [react()],\n  test: {\n    environment: 'jsdom',\n    globals: true,\n    alias: {\n      'simulation-wasm/simulation_wasm_bg.wasm': path.resolve(__dirname, 'src/__mocks__/wasmMock.js'),\n      '@/utils': path.resolve(__dirname, './src/components/utils'),\n      '@/components': path.resolve(__dirname, './src/components'),\n      '@/model': path.resolve(__dirname, './src/model'),\n      '@/styles': path.resolve(__dirname, './styles'),\n      '@/data': path.resolve(__dirname, './src/data'),\n      '@/pages': path.resolve(__dirname, './src/pages'),\n      '@': path.resolve(__dirname, './src'),\n    },\n    css: {\n      modules: {\n        classNameStrategy: 'non-scoped',\n      },\n    },\n  },\n});","usedDeprecatedRules":[]}]
