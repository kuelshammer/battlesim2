<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3: GUI Integration Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #4a5568;
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            color: #718096;
            font-size: 1.2em;
            margin: 10px 0 0 0;
        }

        .phase-indicator {
            background: linear-gradient(45deg, #22c55e, #10b981);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin: 20px 0;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
        }

        .demo-section {
            margin: 30px 0;
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: #f8fafc;
        }

        .demo-section h2 {
            color: #2d3748;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-section h2::before {
            content: "üéØ";
            font-size: 1.2em;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .control-group {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .control-group h3 {
            margin-top: 0;
            color: #4a5568;
            font-size: 1.1em;
        }

        button {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(45deg, #6b7280, #4b5563);
        }

        button.success {
            background: linear-gradient(45deg, #22c55e, #16a34a);
        }

        button.warning {
            background: linear-gradient(45deg, #f59e0b, #d97706);
        }

        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            margin: 10px 0;
        }

        .output {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .status-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .status-card h4 {
            margin: 0 0 10px 0;
            color: #718096;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #2d3748;
        }

        /* Phase 3 Progress Bar Styles */
        .phase3-progress-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .phase3-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .phase3-simulation-id {
            font-family: monospace;
            background: #f1f5f9;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .phase3-progress-status {
            background: #10b981;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .phase3-progress-bar {
            background: #e5e7eb;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .phase3-progress-fill {
            height: 100%;
            border-radius: 10px;
            position: relative;
            transition: width 0.3s ease;
        }

        .phase3-progress-glow {
            position: absolute;
            top: 0;
            right: 0;
            width: 30px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6));
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .phase3-progress-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            font-size: 0.9em;
            color: #4a5568;
        }

        .phase3-progress-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .phase3-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .phase3-btn-pause {
            background: #f59e0b;
            color: white;
        }

        .phase3-btn-cancel {
            background: #ef4444;
            color: white;
        }

        .phase3-progress-messages {
            margin-top: 15px;
        }

        .phase3-message {
            background: #f8fafc;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 0.85em;
            border-left: 3px solid #3b82f6;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Phase 3: GUI Integration</h1>
            <p>Dual-slot storage system with background processing and real-time progress tracking</p>
            <div class="phase-indicator">‚úÖ Phase 3 Implementation Complete</div>
        </div>

        <!-- GUI Status Dashboard -->
        <div class="demo-section">
            <h2>GUI Status Dashboard</h2>
            <div class="status-grid" id="statusGrid">
                <div class="status-card">
                    <h4>Display Mode</h4>
                    <div class="value" id="displayMode">ShowNewest</div>
                </div>
                <div class="status-card">
                    <h4>Active Sims</h4>
                    <div class="value" id="activeSims">0</div>
                </div>
                <div class="status-card">
                    <h4>Storage Used</h4>
                    <div class="value" id="storageUsed">0/100</div>
                </div>
                <div class="status-card">
                    <h4>Background</h4>
                    <div class="value" id="backgroundStatus">üü¢</div>
                </div>
            </div>
            <button onclick="updateGuiStatus()" class="success">üîÑ Refresh Status</button>
        </div>

        <!-- Display Manager Controls -->
        <div class="demo-section">
            <h2>Display Manager</h2>
            <div class="controls">
                <div class="control-group">
                    <h3>Display Mode</h3>
                    <select id="displayModeSelect" onchange="setDisplayMode(this.value)">
                        <option value="ShowNewest">Show Newest</option>
                        <option value="ShowMostSimilar">Show Most Similar</option>
                        <option value="LetUserChoose">Let User Choose</option>
                        <option value="PrimaryOnly">Primary Only</option>
                        <option value="SecondaryOnly">Secondary Only</option>
                    </select>
                    <button onclick="getDisplayResults()">üìä Get Display Results</button>
                </div>
                <div class="control-group">
                    <h3>Slot Selection</h3>
                    <button onclick="selectSlot('Primary')" class="secondary">üéØ Primary Slot</button>
                    <button onclick="selectSlot('Secondary')" class="secondary">üéØ Secondary Slot</button>
                </div>
            </div>
        </div>

        <!-- Background Processing -->
        <div class="demo-section">
            <h2>Background Processing</h2>
            <div class="controls">
                <div class="control-group">
                    <h3>Simulation Control</h3>
                    <button onclick="startBackgroundSimulation('High')" class="success">üöÄ Start High Priority</button>
                    <button onclick="startBackgroundSimulation('Normal')" class="warning">‚ö° Start Normal</button>
                    <button onclick="startBackgroundSimulation('Low')" class="secondary">üêå Start Low</button>
                </div>
                <div class="control-group">
                    <h3>Progress Tracking</h3>
                    <button onclick="getSimulationProgress()">üìà Get Progress</button>
                    <button onclick="createProgressBar()">üìä Create Progress Bar</button>
                    <button onclick="completeSimulation()">‚úÖ Complete Simulation</button>
                </div>
            </div>
        </div>

        <!-- Progress Display Area -->
        <div class="demo-section">
            <h2>Progress Display</h2>
            <div id="progressContainer"></div>
        </div>

        <!-- Configuration -->
        <div class="demo-section">
            <h2>Configuration</h2>
            <div class="controls">
                <div class="control-group">
                    <h3>GUI Settings</h3>
                    <button onclick="updateConfiguration()">‚öôÔ∏è Update Configuration</button>
                    <button onclick="resetConfiguration()" class="secondary">üîÑ Reset to Defaults</button>
                </div>
            </div>
        </div>

        <!-- Output Console -->
        <div class="demo-section">
            <h2>Output Console</h2>
            <div id="output" class="output">
                Phase 3 GUI Integration initialized and ready! üöÄ
                Click any button above to test the functionality.
            </div>
        </div>
    </div>

    <script>
        let phase3Gui = null;
        let currentSimulationId = null;

        // Initialize Phase 3 GUI Integration
        async function initializePhase3() {
            try {
                const { init_phase3_gui } = wasm_bindgen;
                await wasm_bindgen();
                phase3Gui = init_phase3_gui();
                
                logOutput('‚úÖ Phase 3 GUI Integration initialized successfully');
                updateGuiStatus();
            } catch (error) {
                logOutput('‚ùå Failed to initialize Phase 3: ' + error);
            }
        }

        // Update GUI Status
        async function updateGuiStatus() {
            if (!phase3Gui) {
                logOutput('‚ö†Ô∏è GUI not initialized');
                return;
            }

            try {
                const status = await phase3Gui.getGuiStatus();
                
                document.getElementById('displayMode').textContent = status.display_mode;
                document.getElementById('activeSims').textContent = status.active_simulations;
                document.getElementById('storageUsed').textContent = `${status.storage_slots_used}/${status.storage_slots_available}`;
                document.getElementById('backgroundStatus').textContent = status.background_processing_enabled ? 'üü¢' : 'üî¥';
                
                logOutput('üìä GUI Status updated: ' + JSON.stringify(status, null, 2));
            } catch (error) {
                logOutput('‚ùå Failed to update GUI status: ' + error);
            }
        }

        // Set Display Mode
        async function setDisplayMode(mode) {
            if (!phase3Gui) return;

            try {
                await phase3Gui.setDisplayMode(mode);
                logOutput(`üéØ Display mode set to: ${mode}`);
                updateGuiStatus();
            } catch (error) {
                logOutput('‚ùå Failed to set display mode: ' + error);
            }
        }

        // Get Display Results
        async function getDisplayResults() {
            if (!phase3Gui) return;

            try {
                const players = [{ name: "Fighter", hp: 50, ac: 16 }];
                const encounters = [{ monsters: [{ name: "Goblin", hp: 20, ac: 15 }] }];
                const iterations = 100;

                const results = await phase3Gui.getDisplayResults(players, encounters, iterations);
                logOutput('üìä Display Results: ' + JSON.stringify(results, null, 2));
                
                if (results.user_interaction_required) {
                    logOutput('ü§ù User interaction required - showing slot selection');
                }
            } catch (error) {
                logOutput('‚ùå Failed to get display results: ' + error);
            }
        }

        // Select Slot
        async function selectSlot(slot) {
            if (!phase3Gui) return;

            try {
                const result = await phase3Gui.userSelectedSlot(slot);
                logOutput(`üéØ Slot selected: ${slot} - ${result.message}`);
                updateGuiStatus();
            } catch (error) {
                logOutput('‚ùå Failed to select slot: ' + error);
            }
        }

        // Start Background Simulation
        async function startBackgroundSimulation(priority) {
            if (!phase3Gui) return;

            try {
                const players = [{ name: "Fighter", hp: 50, ac: 16 }];
                const encounters = [{ monsters: [{ name: "Goblin", hp: 20, ac: 15 }] }];
                const iterations = 1000;

                const result = await phase3Gui.startBackgroundSimulation(players, encounters, iterations, priority);
                currentSimulationId = result.simulation_id;
                
                logOutput(`üöÄ Background simulation started: ${result.simulation_id} (${priority} priority)`);
                logOutput(`üìä Status: ${result.status}, Estimated time: ${result.estimated_time_ms}ms`);
                
                updateGuiStatus();
                
                // Auto-show progress
                setTimeout(() => createProgressBar(), 500);
            } catch (error) {
                logOutput('‚ùå Failed to start background simulation: ' + error);
            }
        }

        // Get Simulation Progress
        async function getSimulationProgress() {
            if (!phase3Gui || !currentSimulationId) {
                logOutput('‚ö†Ô∏è No active simulation to track');
                return;
            }

            try {
                const progress = await phase3Gui.getSimulationProgress(currentSimulationId);
                logOutput(`üìà Progress for ${currentSimulationId}: ${progress.percentage * 100}% - ${progress.phase}`);
                logOutput(`üìä Details: ${progress.iterations_completed}/${progress.total_iterations} iterations`);
                
                if (progress.messages && progress.messages.length > 0) {
                    progress.messages.forEach(msg => logOutput(`üí¨ ${msg}`));
                }
            } catch (error) {
                logOutput('‚ùå Failed to get simulation progress: ' + error);
            }
        }

        // Create Progress Bar
        async function createProgressBar() {
            if (!phase3Gui || !currentSimulationId) {
                logOutput('‚ö†Ô∏è No active simulation for progress bar');
                return;
            }

            try {
                const html = await phase3Gui.createProgressBar(currentSimulationId);
                document.getElementById('progressContainer').innerHTML = html;
                logOutput(`üìä Progress bar created for ${currentSimulationId}`);
            } catch (error) {
                logOutput('‚ùå Failed to create progress bar: ' + error);
            }
        }

        // Complete Simulation
        async function completeSimulation() {
            if (!phase3Gui || !currentSimulationId) {
                logOutput('‚ö†Ô∏è No active simulation to complete');
                return;
            }

            try {
                const result = await phase3Gui.completeSimulation(currentSimulationId);
                logOutput(`‚úÖ Simulation completed: ${result.simulation_id}`);
                logOutput(`üìä Results stored in: ${result.slot_used}`);
                logOutput(`‚è±Ô∏è Execution time: ${result.execution_time_ms}ms`);
                
                currentSimulationId = null;
                document.getElementById('progressContainer').innerHTML = '';
                updateGuiStatus();
            } catch (error) {
                logOutput('‚ùå Failed to complete simulation: ' + error);
            }
        }

        // Update Configuration
        async function updateConfiguration() {
            if (!phase3Gui) return;

            try {
                const config = {
                    display_mode: document.getElementById('displayModeSelect').value,
                    show_progress_indicators: true,
                    auto_switch_similar: true,
                    max_concurrent_simulations: 3
                };

                await phase3Gui.updateConfiguration(config);
                logOutput('‚öôÔ∏è Configuration updated successfully');
            } catch (error) {
                logOutput('‚ùå Failed to update configuration: ' + error);
            }
        }

        // Reset Configuration
        function resetConfiguration() {
            document.getElementById('displayModeSelect').value = 'ShowNewest';
            logOutput('üîÑ Configuration reset to defaults');
        }

        // Utility function for logging
        function logOutput(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML = `[${timestamp}] ${message}\n` + output.innerHTML;
            
            // Keep only last 20 messages
            const lines = output.innerHTML.split('\n');
            if (lines.length > 20) {
                output.innerHTML = lines.slice(0, 20).join('\n');
            }
            
            // Auto-scroll to top
            output.scrollTop = 0;
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            logOutput('üåê Page loaded - initializing Phase 3 GUI Integration...');
            
            // For demo purposes, we'll simulate the WASM module
            // In a real implementation, this would load the actual WASM module
            setTimeout(() => {
                logOutput('üéØ Phase 3 GUI Integration Demo Ready!');
                logOutput('üìù Note: This is a demonstration of the Phase 3 GUI Integration');
                logOutput('üîó In the actual implementation, this would connect to the WASM module');
                updateGuiStatus();
            }, 1000);
        });

        // Auto-refresh status every 5 seconds
        setInterval(() => {
            if (phase3Gui) {
                updateGuiStatus();
            }
        }, 5000);
    </script>
</body>
</html>