{"id":"Battlesim2-06t","title":"Extract WASM bindings to dedicated wasm_api.rs module","description":"lib.rs has 1000+ lines mixing module exports with WASM bindings. Extract all #[wasm_bindgen] functions to src/wasm_api.rs for better separation of concerns and maintainability.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T10:31:01.113225+01:00","updated_at":"2025-12-30T11:14:59.220386+01:00","closed_at":"2025-12-30T11:14:59.220386+01:00","close_reason":"Closed"}
{"id":"Battlesim2-0wp","title":"Interactive User Onboarding","description":"## Overview\nBuild interactive onboarding flow for first-time users: guided tour, tooltips, contextual help panels, and loadable example encounters.\n\n## Why This Matters\n- Reduce time-to-value: New users understand app within 2 minutes\n- Lower support burden: Common \"how do I...\" questions answered inline\n- Showcase features: Tour reveals hidden capabilities (auto-balancer, deciles)\n- Professional polish: Good onboarding signals quality product\n\n## Implementation Plan\n\n### Phase 1: Example Encounters\nCreate `src/data/examples/` with pre-built scenarios\n\nInclude 3 examples:\n1. Goblin Ambush (Level 1, simple)\n2. Orc Raid (Level 3, mixed melee/ranged)\n3. Dragon Encounter (Level 10, complex AOE, legendary actions)\n\n### Phase 2: Tour Framework\nUse react-joyride or build custom tour with 4-6 steps covering encounter builder, simulation controls, decile chart, event log\n\n### Phase 3: Persistent State\nTrack if user has seen tour in localStorage\n\n### Phase 4: Empty State Helpers\nAdd helpful messages when state is empty with actionable \"Load Example\" buttons\n\n### Phase 5: Contextual Tooltips\nUse @radix-ui/react-tooltip for contextual help\n\n## Success Criteria\n- 3 example encounters loadable from UI\n- 4-step tour runs automatically on first visit\n- Tour is dismissible and re-runnable from help menu\n- Empty states show actionable next steps\n- Tour persists state (does not show again once dismissed)\n- Mobile-responsive (tour adapts to small screens)\n\n## Notes\n- Keep tour short (4-6 steps max)\n- Consider \"quick start\" button that loads example and runs sim immediately\n- A/B test tour completion rate if possible","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T19:48:39.398225+01:00","updated_at":"2025-12-28T10:26:39.642429+01:00","closed_at":"2025-12-28T10:26:39.642429+01:00","close_reason":"Closed"}
{"id":"Battlesim2-121","title":"Add React.memo optimizations to expensive components","description":"EventLog and SimulationResults lack React.memo. Add memoization to prevent unnecessary re-renders when props haven't changed. Critical for large simulation results.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-30T10:31:32.710461+01:00","updated_at":"2025-12-30T13:11:51.703321+01:00","closed_at":"2025-12-30T13:11:51.703321+01:00","close_reason":"Closed"}
{"id":"Battlesim2-191","title":"Expose AI Decision Trace in Logs","description":"Include the AI's internal scoring matrix in ActionStarted events to make decision logic transparent.","design":"# Implementation Plan\n\n## Proposed Changes\n\n### [Backend] simulation-wasm\n\n#### [MODIFY] execution.rs\n- Update `select_actions_for_combatant` to return both selected actions and a `HashMap\u003cString, f64\u003e` \"decision trace\" containing scores of all evaluated actions.\n- Update `execute_combatant_turn` to handle the trace.\n- Update `execute_action_with_reactions` to accept an optional `decision_trace`.\n- Pass the trace to `Event::ActionStarted`.\n\n#### [MODIFY] events.rs\n- Update `Event::format_for_log` to display the `decision_trace` in the CLI output.\n\n### [Frontend] TypeScript / React\n\n#### [MODIFY] model.ts\n- Update `EventSchema` for `ActionStarted` to include `decision_trace: Record\u003cstring, number\u003e`.\n\n#### [MODIFY] logFormatter.ts\n- Update `LogFormatter.toDetails` to handle `ActionStarted` events and format the `decision_trace`.\n\n#### [MODIFY] EventLog.tsx\n- Ensure `ActionStarted` events are marked as `hasDetails` if a `decision_trace` is present.\n\n## Verification Plan\n- **Automated**: Run `cargo test` and add a test case for trace population.\n- **Manual**: Verify CLI output and UI breakdown.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T07:13:08.066028+01:00","updated_at":"2025-12-27T10:32:13.991742+01:00","closed_at":"2025-12-27T10:32:13.991742+01:00","close_reason":"Closed","labels":["backend","frontend"]}
{"id":"Battlesim2-1h0","title":"Project Migration: Conductor to Beads","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-26T18:29:39.868231+01:00","updated_at":"2025-12-26T23:45:14.414414+01:00","closed_at":"2025-12-26T23:45:14.414414+01:00","close_reason":"All sub-tasks (cleanup, frontend polish, and backend diagnostics) are complete. Project is now fully powered by Beads.","labels":["tech-debt"]}
{"id":"Battlesim2-1rv","title":"Implement Multi-Run Tail Auditing","description":"Extend the auditor to verify 10 random runs from the 2511-batch to ensure compliance in edge cases.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T07:13:02.883898+01:00","updated_at":"2025-12-27T07:16:30.162305+01:00","closed_at":"2025-12-27T07:16:30.162305+01:00","close_reason":"Implemented multi-run auditing with 'batch-log' command and updated scripts.","labels":["backend","quality"]}
{"id":"Battlesim2-1ub","title":"Delete deprecated Conductor tracking files","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:29:45.058632+01:00","updated_at":"2025-12-26T18:30:56.036314+01:00","closed_at":"2025-12-26T18:30:56.036314+01:00","close_reason":"Conductor tracking files removed.","labels":["tech-debt"],"dependencies":[{"issue_id":"Battlesim2-1ub","depends_on_id":"Battlesim2-1h0","type":"parent-child","created_at":"2025-12-26T18:30:40.544373+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-24v","title":"Update WASM exports to use three-tier simulation system","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T00:10:14.931055+01:00","updated_at":"2025-12-30T00:16:58.410318+01:00","closed_at":"2025-12-30T00:16:58.410318+01:00","close_reason":"Updated all WASM exports to use the new three-tier system with 1% granularity: (1) run_simulation_wasm_rolling_stats() now calls run_simulation_with_three_tier(), (2) run_batch_simulation_wasm() updated to use three-tier, (3) run_batch_simulation_with_callback() updated to use three-tier, (4) run_simulation_with_callback() updated to use select_interesting_seeds_with_tiers() for 1% granularity seed selection. All 94 tests pass."}
{"id":"Battlesim2-2bz","title":"Add snapshot tests for missing scenarios","description":"Missing snapshots for TPK, multi-encounter adventures, buff interactions, reaction chains. Add regression snapshots to prevent behavior changes in critical scenarios.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-30T10:31:43.420976+01:00","updated_at":"2025-12-30T22:32:01.342168+01:00","closed_at":"2025-12-30T22:32:01.342168+01:00","close_reason":"Closed"}
{"id":"Battlesim2-2ll","title":"Implement Rule Auditor for 5e Compliance","description":"A script to validate JSON logs against 5e Action Economy, Concentration, and Resource constraints.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T23:48:22.494485+01:00","updated_at":"2025-12-26T23:49:34.660371+01:00","closed_at":"2025-12-26T23:49:34.660371+01:00","close_reason":"Implemented Rule Auditor with checks for Action Economy, Reaction limits, and Concentration cleanup on death.","labels":["backend","quality"]}
{"id":"Battlesim2-2m0","title":"Add Puppeteer-based E2E testing for frontend","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T19:18:17.908951+01:00","updated_at":"2025-12-28T19:22:48.79826+01:00","closed_at":"2025-12-28T19:22:48.79826+01:00","close_reason":"Replaced by detailed tasks: Battlesim2-9k8, vy8, bpy, cc4, tjp"}
{"id":"Battlesim2-2wp","title":"Replace JSON cache hashing with fast hashing","description":"Cache uses slow JSON serialization for hashing. Replace with xxHash3 or similar fast hash function. Estimated 25% performance improvement for cache operations.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-30T10:31:17.230664+01:00","updated_at":"2025-12-30T12:07:20.820033+01:00","closed_at":"2025-12-30T12:07:20.820033+01:00","close_reason":"Closed"}
{"id":"Battlesim2-37b","title":"Fix ownership error in execution.rs initiative loop","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T12:35:36.226895+01:00","updated_at":"2025-12-28T12:36:08.687879+01:00","closed_at":"2025-12-28T12:36:08.687879+01:00","close_reason":"Fixed ownership error by iterating over reference"}
{"id":"Battlesim2-37p","title":"Execute complete test suite: Backend (Rust/Wasm) + Frontend (TypeScript)","description":"Run ALL tests in the project:\n- Rust/Wasm tests (cargo test)\n- TypeScript unit tests (vitest)\n- Build verification\n- Report results and any failures","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T20:29:52.675093+01:00","updated_at":"2025-12-28T20:31:35.223426+01:00","closed_at":"2025-12-28T20:31:35.223426+01:00","close_reason":"All tests passed successfully:\n✅ Rust/Wasm: 136/136 tests passed\n✅ TypeScript: 73/73 tests passed  \n✅ Production Build: Successful\n\nTotal: 209 tests passed, 0 failures"}
{"id":"Battlesim2-4dg","title":"Update frontend integration for Two-Pass","description":"Update simulation worker to use new API, decile graph rendering, and verify TPK detection still works. Depends on WASM export.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T13:37:48.424279+01:00","updated_at":"2025-12-29T14:37:31.970539+01:00","closed_at":"2025-12-29T14:37:31.970539+01:00","close_reason":"Closed"}
{"id":"Battlesim2-4q4","title":"Add Two-Pass deterministic reproducibility tests","description":"No tests verify that Two-Pass system produces deterministic results. Add tests to ensure same seed = same results across runs, and that survey pass correlates with full simulation.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-30T10:30:50.779703+01:00","updated_at":"2025-12-30T11:56:42.048579+01:00","closed_at":"2025-12-30T11:56:42.048579+01:00","close_reason":"Closed"}
{"id":"Battlesim2-526","title":"Add caching for repeated seeds","description":"If same seed appears multiple times across encounters, cache it to avoid re-simulating same seed twice. Optimization for Two-Pass system.","notes":"Implemented thread-local simulation results caching based on scenario hash and seed. Added WASM export to clear cache and integrated it into the UserInteractionManager. Verified with tests.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T13:38:13.743852+01:00","updated_at":"2025-12-29T22:15:38.235198+01:00","closed_at":"2025-12-29T22:15:38.235398+01:00"}
{"id":"Battlesim2-58o","title":"Fix flaky snapshot test (heavy_vs_consistent oscillates 80-90%)","description":"Snapshot test snapshot_heavy_vs_consistent oscillates between median_win_rate 80.0 and 90.0 across runs despite using fixed RNG seed (42). Test uses deterministic seeding but produces non-deterministic results. Need to investigate source of non-determinism (hash map iteration order, parallel test execution, or state leakage) and fix to make snapshot reliable.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-30T10:55:59.462341+01:00","updated_at":"2025-12-30T11:56:42.051248+01:00","closed_at":"2025-12-30T11:56:42.051248+01:00","close_reason":"Closed"}
{"id":"Battlesim2-5d8","title":"Remove Phase 3 prototype code from production","description":"phase3_working.rs and phase3_gui_integration.rs contain prototype/demo code polluting production. Either delete if obsolete or rename and integrate properly into core modules.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-30T10:31:01.383541+01:00","updated_at":"2025-12-30T11:06:47.745112+01:00","closed_at":"2025-12-30T11:06:47.745112+01:00","close_reason":"Closed"}
{"id":"Battlesim2-5hf","title":"Fix React key duplication in monsterForm.tsx selectMonster","description":"React key duplication error: when selecting monsters from monsterForm, the UUID is not regenerated, causing duplicate keys.\n\nRoot cause: monsterForm.tsx selectMonster() function uses clone(monster) or template.data without regenerating the UUID.\n\nFix: Add id: crypto.randomUUID() when creating the creature in selectMonster().","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T11:06:57.60127+01:00","updated_at":"2025-12-29T11:07:54.191586+01:00","closed_at":"2025-12-29T11:07:54.191586+01:00","close_reason":"Closed"}
{"id":"Battlesim2-5m4","title":"Enforce ID regeneration in LoadCreatureForm","description":"LoadCreatureForm onLoad handler passes raw creature object from localStorage without generating new ID. This causes key collisions when same saved creature is added multiple times.\n\nFix by cloning and regenerating uuid() before passing to onLoad callback.\n\nFiles: src/components/creatureForm/loadCreatureForm.tsx","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T11:55:49.229477+01:00","updated_at":"2025-12-29T12:13:44.180114+01:00","closed_at":"2025-12-29T12:13:44.180114+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-5m4","depends_on_id":"Battlesim2-b0a","type":"blocks","created_at":"2025-12-29T11:55:59.44175+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-61w","title":"Fix Rust/WASM compilation warnings","description":"Fix Rust compiler warnings in simulation-wasm:\n\n- Remove unused imports (Encounter, HashMap, IntensityTier, etc.)\n- Fix unused variables (_players, _report, mut variables that don't need mut)\n- Clean up warnings in tests/decile_test.rs and tests/reliability_tests.rs\n\nRun `cargo clippy` and `cargo test` to verify all warnings are resolved.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T10:37:38.273239+01:00","updated_at":"2025-12-27T11:04:59.357853+01:00","closed_at":"2025-12-27T11:04:59.357853+01:00","close_reason":"Closed"}
{"id":"Battlesim2-63h","title":"Implement Two-Pass decile accuracy tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:14:01.977454+01:00","updated_at":"2025-12-29T16:21:10.885748+01:00","closed_at":"2025-12-29T16:21:10.885748+01:00","close_reason":"Closed"}
{"id":"Battlesim2-6gs","title":"Implement rolling statistics aggregation","description":"Modify simulation runner to calculate stats (win rate, damage) using rolling averages instead of storing Vec\u003cSimulationResult\u003e of all 2511 runs. Changes space complexity from O(N) to O(1). Limit logs to small sample if needed.\n\nDependencies: Battlesim2-xxx","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T12:36:04.210732+01:00","updated_at":"2025-12-29T13:20:52.119567+01:00","closed_at":"2025-12-29T13:20:52.119567+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-6gs","depends_on_id":"Battlesim2-8zi","type":"blocks","created_at":"2025-12-29T12:37:04.258431+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-72w","title":"Implement 1% bucketing algorithm in select_interesting_seeds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:55:52.171003+01:00","updated_at":"2025-12-29T22:59:32.810046+01:00","closed_at":"2025-12-29T22:59:32.810046+01:00","close_reason":"Implemented select_interesting_seeds_with_tiers() function in lib.rs that: (1) Divides 10,100 runs into 100 equal buckets with median from each → Tier B, (2) Selects 11 global decile percentiles (P5, P15, ..., P95) → Tier A, (3) Selects per-encounter extremes (P0, P50, P100) → Tier C, (4) Includes all death runs as Tier B. Returns Vec\u003cSelectedSeed\u003e with tier classification and bucket labels.","dependencies":[{"issue_id":"Battlesim2-72w","depends_on_id":"Battlesim2-9he","type":"blocks","created_at":"2025-12-29T22:56:01.475949+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-7n9","title":"Implement core dice mechanics and actual RNG","description":"Replace placeholder base_roll + 10.0 logic in action_resolver.rs with actual roll_d20() + attack_bonus. Implement proper damage dice rolling and double-dice for critical hits.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T11:30:43.171489+01:00","updated_at":"2025-12-31T12:04:54.204728+01:00","closed_at":"2025-12-31T12:04:54.204728+01:00","close_reason":"Closed"}
{"id":"Battlesim2-7qx","title":"Add ActionExecutionEngine comprehensive unit tests","description":"Critical component lacks test coverage: action sequences, reactions, action economy enforcement, MAX_ROUNDS limits. Add comprehensive unit tests covering all execution paths.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T10:31:16.948293+01:00","updated_at":"2025-12-30T12:34:34.647076+01:00","closed_at":"2025-12-30T12:34:34.647076+01:00","close_reason":"Closed"}
{"id":"Battlesim2-86z","title":"Refactor Combattant struct for shared ownership","description":"Combattant::clone is allocation hotspot. Refactor to separate static data (names, base stats) from mutable state (HP, resources). Wrap static data in Rc/Arc so cloning copies pointer instead of deep cloning Vecs of abilities/items.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T12:36:42.153664+01:00","updated_at":"2025-12-29T13:11:42.68047+01:00","closed_at":"2025-12-29T13:11:42.68047+01:00","close_reason":"Successfully refactored Combattant to use Arc\u003cCreature\u003e for shared ownership.\n\n**Changes Made:**\n- Modified Combattant struct to use Arc\u003cCreature\u003e instead of owned Creature\n- Implemented custom Clone, Serialize, Deserialize for Combattant\n- Updated all 20+ files that construct Combattant instances\n\n**Memory Reduction Verified:**\n- Combattant size: 840 bytes (down from 1,264 bytes)\n- ~33% reduction per Combattant instance\n- For 2511 iterations × 5 combatants: saves ~5.3 MB\n\n**Next Task (Battlesim2-6gs):**\nImplement rolling statistics aggregation for further OOM mitigation.","dependencies":[{"issue_id":"Battlesim2-86z","depends_on_id":"Battlesim2-8zi","type":"blocks","created_at":"2025-12-29T12:37:04.105645+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-8ux","title":"Fix WASM compilation errors after cfg attributes","description":"After adding #[cfg(not(target_arch = \"wasm32\"))] to BackgroundSimulationEngine,\ntwo modules still try to import it, causing compilation failures in WASM target.\n\nErrors:\n- user_interaction.rs:2 - unresolved import BackgroundSimulationEngine\n- lib.rs:867 - unresolved import BackgroundSimulationEngine\n\nNeed to make these imports conditional as well.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T23:21:55.365178+01:00","updated_at":"2025-12-28T23:28:03.214784+01:00","closed_at":"2025-12-28T23:28:03.214784+01:00","close_reason":"Closed"}
{"id":"Battlesim2-8yr","title":"Add data sanitization to fix duplicate IDs in localStorage","description":"Gemini analysis identified that existing corrupted data in localStorage may still contain duplicate UUIDs, causing React key warnings even after the monsterForm fix.\n\nAdd a sanitization useEffect in simulation.tsx that:\n1. Detects duplicate creature IDs in players and timeline on load\n2. Regenerates UUIDs for duplicates using uuid package\n3. This fixes legacy corrupted data without requiring manual localStorage clearing","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T11:28:24.316118+01:00","updated_at":"2025-12-29T11:49:07.273768+01:00","closed_at":"2025-12-29T11:49:07.273768+01:00","close_reason":"Closed"}
{"id":"Battlesim2-8zi","title":"Analyze and reproduce WASM OOM error","description":"Create reproduction test case in simulation-wasm/tests that runs precise simulation (2511 iterations) to consistently trigger __rg_oom error. Use std::mem::size_of to quantify memory footprint of Combattant clone and estimate exhaustion point.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T12:36:41.901625+01:00","updated_at":"2025-12-29T12:54:32.410085+01:00","closed_at":"2025-12-29T12:54:32.410085+01:00","close_reason":"\nOOM reproduction tests created and executed successfully. Key findings:\n\n**Structure Sizes:**\n- Creature: 432 bytes\n- Combattant: 1,264 bytes\n- CombattantState: 1,664 bytes\n- EncounterResult: 80 bytes\n- SimulationResult: 48 bytes\n- SimulationRun: 72 bytes\n\n**Memory Usage (per iteration):**\n- Empty encounter (1 player, 0 monsters): ~1.4 KB/iteration\n- Estimated for 2511 iterations: ~3.8 MB (theoretical minimum)\n\n**Key Insights:**\n1. Tests show linear O(N) memory growth - each iteration adds ~1.4 KB\n2. Simple scenario (1 player, empty monsters) only uses ~3.8 MB for 2511 iterations\n3. Real encounters with 5+ combatants would use 5-10x more memory (~20-40 MB)\n4. Combattant::clone is the allocation hotspot - deep copies Creature, Vecs, HashMaps\n5. Browser WASM heap is typically 16-128 MB, so real scenarios would OOM\n\n**Files Created:**\n- simulation-wasm/tests/oom_reproduction_test.rs (comprehensive tests for memory analysis)\n\n**Next Steps:**\n- Battlesim2-86z (P1): Refactor Combattant to use Rc/Arc for shared Creature ownership\n- Battlesim2-6gs (P1): Implement rolling statistics aggregation (O(N)→O(1))\n"}
{"id":"Battlesim2-9bd","title":"Fix duplicate key warning in encounterForm.tsx","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-28T15:40:34.833548+01:00","updated_at":"2025-12-29T06:42:19.975937+01:00","closed_at":"2025-12-29T06:42:19.975937+01:00","close_reason":"Closed"}
{"id":"Battlesim2-9he","title":"Design LeanRunLog structure for Tier B event collection","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:55:51.649394+01:00","updated_at":"2025-12-29T22:58:12.532282+01:00","closed_at":"2025-12-29T22:58:12.532282+01:00","close_reason":"Added LeanRunLog, LeanRoundSummary, LeanDeathEvent, InterestingSeedTier enum, and SelectedSeed struct to model.rs. All structures include comprehensive documentation for Tier B (1% median) event collection with ~10-30 KB per run vs 200-500 KB for full events.","dependencies":[{"issue_id":"Battlesim2-9he","depends_on_id":"Battlesim2-clp","type":"blocks","created_at":"2025-12-29T22:56:00.986219+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-9ix","title":"Implement batching interface for WASM","description":"Expose run_simulation_batch function in WASM API. Allow JS host to call run_batch(500) multiple times instead of one call doing 2511 iterations. Allows JS GC to run and WASM memory to stabilize between batches.\n\nDependencies: Battlesim2-yyy","notes":"Implemented WASM batching interface with synchronous and callback-based exports. Added BatchSimulationRequest/Response models. Verified with unit tests.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T12:36:04.484376+01:00","updated_at":"2025-12-29T22:11:55.804277+01:00","closed_at":"2025-12-29T22:11:55.804468+01:00","dependencies":[{"issue_id":"Battlesim2-9ix","depends_on_id":"Battlesim2-6gs","type":"blocks","created_at":"2025-12-29T12:37:04.409945+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-9k8","title":"Setup E2E Infrastructure with Vitest \u0026 Puppeteer","description":"Create 'e2e' directory structure (pages, specs, fixtures)\n- Create 'vitest.e2e.config.ts' specifically for E2E\n- Add 'test:e2e' script to package.json\n- Ensure Puppeteer launches in headless mode for CI, visible for debug","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T19:22:27.77887+01:00","updated_at":"2025-12-28T19:26:44.146276+01:00","closed_at":"2025-12-28T19:26:44.146276+01:00","close_reason":"Closed"}
{"id":"Battlesim2-9l2","title":"Add stress testing for large simulation runs","description":"No tests for 100k+ iteration runs. Add stress tests to verify memory usage, performance stability, and correctness at scale.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-30T10:31:33.269964+01:00","updated_at":"2025-12-31T01:54:44.636121+01:00","closed_at":"2025-12-31T01:54:44.636121+01:00","close_reason":"Closed"}
{"id":"Battlesim2-a3j","title":"Sanitize imported and loaded Adventuring Days","description":"AdventuringDayForm loads state directly from save files (loadSavedDay) or uploaded JSON (onUpload) without checking for ID conflicts.\n\nImplement sanitization utility that regenerates all IDs (players, timeline events, monsters) and apply in loadSavedDay and onUpload before setting state.\n\nFiles: src/components/simulation/adventuringDayForm.tsx","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T11:55:49.489846+01:00","updated_at":"2025-12-29T12:15:49.339408+01:00","closed_at":"2025-12-29T12:15:49.339408+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-a3j","depends_on_id":"Battlesim2-b0a","type":"blocks","created_at":"2025-12-29T11:55:59.597452+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-ada","title":"Fix RNG cloning bug in rng::get_rng","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T16:13:33.867508+01:00","updated_at":"2025-12-29T16:16:35.70122+01:00","closed_at":"2025-12-29T16:16:35.70122+01:00","close_reason":"Closed"}
{"id":"Battlesim2-b0a","title":"Fix race condition in Simulation state sanitization","description":"The sanitization useEffect in Simulation.tsx runs only on mount ([]) and fails because useStoredState loads data asynchronously from localStorage AFTER sanitization runs. Fix by moving sanitization into the useStoredState parser callback to de-duplicate immediately upon load.\n\nFiles: src/components/simulation/simulation.tsx","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T11:55:48.972031+01:00","updated_at":"2025-12-29T11:57:41.736543+01:00","closed_at":"2025-12-29T11:57:41.736543+01:00","close_reason":"Closed"}
{"id":"Battlesim2-b1j","title":"Add LightweightRun struct to model.rs","description":"Add LightweightRun struct for Two-Pass simulation system. Fields: seed (u64), encounter_scores (Vec\u003cf64\u003e), final_score (f64), has_death (bool). Derive Debug, Clone, Serialize, Deserialize.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T13:36:51.049126+01:00","updated_at":"2025-12-29T13:41:45.347424+01:00","closed_at":"2025-12-29T13:41:45.347424+01:00","close_reason":"Closed"}
{"id":"Battlesim2-b6n","title":"Update run_simulation_with_rolling_stats for three-tier Phase 3","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:55:52.705621+01:00","updated_at":"2025-12-29T23:03:14.596518+01:00","closed_at":"2025-12-29T23:03:14.596518+01:00","close_reason":"Implemented run_simulation_with_three_tier() function in lib.rs that: (1) Runs Phase 1 lightweight survey, (2) Uses select_interesting_seeds_with_tiers() for 1% granularity, (3) In Phase 3, executes tier-aware collection: Tier A gets full events (11 decile logs), Tier B gets full events for now (TODO for lean), Tier C skips re-run (uses lightweight data). The function maintains the same SimulationSummary output format while enabling the three-tier strategy.","dependencies":[{"issue_id":"Battlesim2-b6n","depends_on_id":"Battlesim2-cph","type":"blocks","created_at":"2025-12-29T22:56:02.010856+01:00","created_by":"daemon"},{"issue_id":"Battlesim2-b6n","depends_on_id":"Battlesim2-fhd","type":"blocks","created_at":"2025-12-29T22:56:02.264409+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-bij","title":"Update WASM export for Two-Pass","description":"Update run_simulation_wasm_rolling_stats to use two-pass or create new run_simulation_wasm_two_pass function. Rebuild WASM bindings. Depends on Two-Pass runner.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T13:37:48.078369+01:00","updated_at":"2025-12-29T13:50:03.379994+01:00","closed_at":"2025-12-29T13:50:03.379994+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-bij","depends_on_id":"Battlesim2-cns","type":"blocks","created_at":"2025-12-29T13:37:48.081715+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-bpy","title":"E2E Test: Basic Combat Workflow","description":"Test Case: Add Attacker vs Defender\n- Action: Click 'Run Simulation'\n- Validation: Wait for execution to finish and verify win-rates are present\n- Verify WASM integration works in the browser context","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T19:22:28.328019+01:00","updated_at":"2025-12-28T19:26:44.149262+01:00","closed_at":"2025-12-28T19:26:44.149262+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-bpy","depends_on_id":"Battlesim2-vy8","type":"blocks","created_at":"2025-12-28T19:22:36.961368+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-cc4","title":"E2E Test: Import/Export \u0026 Persistence","description":"Test Case 1: Load a JSON scenario fixture and verify creature list\n- Test Case 2: Reload page and verify LocalStorage restored the state","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T19:22:28.602648+01:00","updated_at":"2025-12-28T19:26:44.15023+01:00","closed_at":"2025-12-28T19:26:44.15023+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-cc4","depends_on_id":"Battlesim2-vy8","type":"blocks","created_at":"2025-12-28T19:22:37.115408+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-cgr","title":"Implement Two-Pass determinism and match tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:13:54.098767+01:00","updated_at":"2025-12-29T16:21:10.888834+01:00","closed_at":"2025-12-29T16:21:10.888834+01:00","close_reason":"Closed"}
{"id":"Battlesim2-ciz","title":"Simulation Regression Snapshots","description":"## Overview\nImplement regression testing using \"known good\" simulation snapshots. CI compares new runs against stored snapshots to detect behavior changes.\n\n## Why This Matters\n- **Catch logic regressions**: Silent behavior changes break simulation accuracy\n- **D\u0026D 5e correctness**: Rules are complex—snapshots ensure we don't accidentally break mechanics\n- **Refactoring safety**: Change implementation confidently if snapshots match\n- **Living documentation**: Snapshots show exact expected behavior\n\n## Implementation Plan\n\n### Phase 1: Snapshot Storage\nCreate `simulation-wasm/tests/snapshots/` directory:\n\n```\nsnapshots/\n├── basic_melee Combat.json\n├── fireball_aoe.json\n├── healing_word.json\n├── concentration_break.json\n└── opportunity_attack.json\n```\n\nEach snapshot contains:\n```json\n{\n  \"scenario\": \"basic_melee_combat\",\n  \"seed\": 42,\n  \"timestamp\": \"2025-12-27T10:00:00Z\",\n  \"result\": {\n    \"total_rounds\": 4,\n    \"winner\": \"team1\",\n    \"final_hp\": { \"player1\": 38, \"enemy1\": 0 },\n    \"events\": [\n      { \"type\": \"AttackHit\", \"damage\": 12.0, ... },\n      ...\n    ]\n  }\n}\n```\n\n### Phase 2: Snapshot Test Runner\n\nCreate `simulation-wasm/tests/snapshot_test.rs`:\n\n```rust\n#[test]\nfn test_snapshots_match() {\n    let snapshot_files = fs::read_dir(\"tests/snapshots/\").unwrap();\n    \n    for file in snapshot_files {\n        let snapshot: Snapshot = serde_json::from_str(\u0026fs::read_to_string(file.path())?)?;\n        let scenario = load_scenario(\u0026snapshot.scenario)?;\n        \n        // Run simulation with fixed seed\n        let result = execute_scenario(scenario, snapshot.seed);\n        \n        // Compare against snapshot\n        assert_eq!(result.total_rounds, snapshot.result.total_rounds);\n        assert_eq!(result.events, snapshot.result.events);\n    }\n}\n```\n\n### Phase 3: Inline Snapshot Macro (Optional)\nUse `insta` crate for inline snapshots:\n\n```rust\n#[test]\nfn test_basic_combat() {\n    let result = execute_scenario(basic_scenario());\n    insta::assert_json_snapshot!(result);\n}\n```\n\n### Phase 4: CI Integration\n```yaml\n# .github/workflows/test.yml\n- name: Run snapshot tests\n  run: cargo test --snapshot\n  env:\n    UPDATE_SNAPSHOTS: false\n```\n\n## Success Criteria\n- ✅ 5 baseline snapshots captured (melee, AOE, healing, concentration, reaction)\n- ✅ Tests fail when simulation logic changes\n- ✅ `UPDATE_SNAPSHOTS=1` updates snapshots for verified changes\n- ✅ CI runs snapshot tests in \u003c 1 minute\n- ✅ Snapshot review required for updates (manual step)\n\n## Notes\n- Snapshots should be version-controlled (commit alongside code)\n- Use deterministic RNG (seeded) for reproducibility\n- Consider ignoring non-critical fields (timestamps, random roll order)\n- `insta` crate provides CLI: `cargo install insta` and `cargo insta review`\n- May want to snapshot ONLY final state, not full event sequence (less fragile)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T19:48:35.576986+01:00","updated_at":"2025-12-28T00:20:29.136705+01:00","closed_at":"2025-12-28T00:20:29.136705+01:00","close_reason":"Closed"}
{"id":"Battlesim2-clp","title":"Update README with 1% granularity and three-tier event design","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-29T22:55:47.054196+01:00","updated_at":"2025-12-29T22:57:19.007139+01:00","closed_at":"2025-12-29T22:57:19.007139+01:00","close_reason":"Added comprehensive Two-Pass Simulation System documentation to README.md including Phase 1/2/3 explanation, three-tier event strategy, lean events format, and performance characteristics comparison table."}
{"id":"Battlesim2-cns","title":"Implement Two-Pass simulation runner","description":"Create run_simulation_two_pass() that orchestrates: Phase1=survey, Phase2=select seeds, Phase3=re-run with full events. Returns SimulationSummary with decile-accurate samples. Replaces run_simulation_with_rolling_stats. Depends on both analysis and survey.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T13:37:40.718066+01:00","updated_at":"2025-12-29T13:46:16.884538+01:00","closed_at":"2025-12-29T13:46:16.884538+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-cns","depends_on_id":"Battlesim2-e1d","type":"blocks","created_at":"2025-12-29T13:37:40.721059+01:00","created_by":"daemon"},{"issue_id":"Battlesim2-cns","depends_on_id":"Battlesim2-d8c","type":"blocks","created_at":"2025-12-29T13:37:40.722027+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-coa","title":"Refactor lib.rs: Extract two_pass module","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T07:58:07.456441+01:00","updated_at":"2025-12-30T10:00:14.516753+01:00","closed_at":"2025-12-30T10:00:14.516753+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-coa","depends_on_id":"Battlesim2-puc","type":"blocks","created_at":"2025-12-30T07:58:07.458893+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-cph","title":"Add Tier A/B/C classification to seed selection output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:55:52.439348+01:00","updated_at":"2025-12-29T22:59:40.612036+01:00","closed_at":"2025-12-29T22:59:40.612036+01:00","close_reason":"Tier A/B/C classification already implemented in select_interesting_seeds_with_tiers() - the function returns Vec\u003cSelectedSeed\u003e where each seed has: tier (InterestingSeedTier enum), bucket_label (String for display), and seed. The classification is embedded in the selection logic: Tier A for 11 decile logs, Tier B for 100 1% medians + death runs, Tier C for per-encounter extremes.","dependencies":[{"issue_id":"Battlesim2-cph","depends_on_id":"Battlesim2-72w","type":"blocks","created_at":"2025-12-29T22:56:01.764067+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-d3w","title":"Avant-Garde Visual Refactor: The Grimoire Log","description":"Redesign the EventLog using bespoke typography and asymmetric layouts to move away from generic material UI.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-27T07:13:13.24283+01:00","updated_at":"2025-12-31T10:37:00.577467+01:00","labels":["design","frontend"]}
{"id":"Battlesim2-d63","title":"Add memory guardrails and better error messages","description":"Check simulation count at start - if high (\u003e1000), force-disable full logging. Add panic hook for user-friendly error message instead of 'unreachable' when OOM occurs.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-29T12:36:04.75106+01:00","updated_at":"2025-12-30T10:16:20.055699+01:00","closed_at":"2025-12-30T10:16:20.055699+01:00","close_reason":"Closed"}
{"id":"Battlesim2-d8c","title":"Implement decile analysis for seed selection","description":"Create select_interesting_seeds() that identifies seeds at per-encounter deciles (0,10,25,50,75,90,100%), overall best/worst, and deaths. Returns Vec\u003cu64\u003e of seeds to re-simulate. Depends on survey pass.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T13:37:35.575163+01:00","updated_at":"2025-12-29T13:44:17.101622+01:00","closed_at":"2025-12-29T13:44:17.101622+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-d8c","depends_on_id":"Battlesim2-e1d","type":"blocks","created_at":"2025-12-29T13:37:35.578011+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-dfm","title":"Fix mutex lock poison vulnerabilities","description":"90+ instances of .lock().unwrap() across user_interaction.rs, queue_manager.rs, display_manager.rs. Poisoned mutexes could deadlock. Replace with proper error handling.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-30T10:30:51.086792+01:00","updated_at":"2025-12-30T10:44:53.662892+01:00","closed_at":"2025-12-30T10:44:53.662892+01:00","close_reason":"Closed"}
{"id":"Battlesim2-dxt","title":"Improve test coverage in simulation-wasm","description":"Review and improve test coverage:\n\n1. Run cargo tarpaulin or similar tool to measure coverage\n2. Identify modules with low test coverage\n3. Add tests for uncovered code paths\n4. Focus on core modules: execution.rs, events.rs, action_resolver.rs\n5. Add edge case tests (empty inputs, boundary conditions, error paths)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-27T10:38:22.40063+01:00","updated_at":"2025-12-27T19:18:20.638759+01:00","closed_at":"2025-12-27T19:18:20.638759+01:00","close_reason":"Closed"}
{"id":"Battlesim2-e1d","title":"Implement survey pass for Phase 1","description":"Create run_survey_pass() that runs N lightweight simulations with seeded RNG. Stores all LightweightRun results (~70KB for 2511 runs). Depends on lightweight simulation.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T13:37:28.646888+01:00","updated_at":"2025-12-29T13:43:41.690843+01:00","closed_at":"2025-12-29T13:43:41.690843+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-e1d","depends_on_id":"Battlesim2-hfj","type":"blocks","created_at":"2025-12-29T13:37:28.649834+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-e2p","title":"Eliminate unwrap() panics in WASM core utilities","description":"Critical safety issue: 280+ unwrap()/expect() calls can crash WASM module. Refactor utils.rs and context.rs to return Result\u003cT, SimulationError\u003e instead of panicking. WASM panics offer no recovery and crash the entire web worker.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-30T10:30:50.102267+01:00","updated_at":"2025-12-30T11:33:20.424958+01:00","closed_at":"2025-12-30T11:33:20.424958+01:00","close_reason":"Closed"}
{"id":"Battlesim2-e64","title":"Deduplicate entity creation logic in simulation.rs","description":"~200 lines of duplicated entity creation logic across run_single_event_driven_simulation and run_single_lightweight_simulation. Extract shared helper functions for player/monster/Combattant creation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T10:31:01.65658+01:00","updated_at":"2025-12-30T11:33:20.427459+01:00","closed_at":"2025-12-30T11:33:20.427459+01:00","close_reason":"Closed"}
{"id":"Battlesim2-fhd","title":"Implement lean event collector in execution engine","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:55:51.909388+01:00","updated_at":"2025-12-29T23:01:28.320857+01:00","closed_at":"2025-12-29T23:01:28.320857+01:00","close_reason":"Implemented execute_encounter_lean() method in execution.rs that: (1) Runs same combat loop as execute_encounter(), (2) Collects aggregate statistics per round (total_damage, total_healing, deaths, survivors), (3) Tracks death events with LeanDeathEvent, (4) Returns LeanRunLog (~10-30 KB vs 200-500 KB for full events). Added imports for LeanRunLog, LeanRoundSummary, LeanDeathEvent.","dependencies":[{"issue_id":"Battlesim2-fhd","depends_on_id":"Battlesim2-9he","type":"blocks","created_at":"2025-12-29T22:56:01.231227+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-fzh","title":"Optimize LogFormatter.ts for better roll breakdown","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:29:50.242214+01:00","updated_at":"2025-12-26T22:43:25.55263+01:00","closed_at":"2025-12-26T22:43:25.55263+01:00","close_reason":"Optimized mathematical breakdown for all roll types.","labels":["frontend"],"dependencies":[{"issue_id":"Battlesim2-fzh","depends_on_id":"Battlesim2-1h0","type":"parent-child","created_at":"2025-12-26T18:30:45.705946+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-g1f","title":"Fix worker memory leak in frontend","description":"Worker is recreated every simulation run instead of being reused. This causes memory leaks and high overhead. Implement worker pool or reuse pattern in useSimulationWorker.ts.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-30T10:30:50.479349+01:00","updated_at":"2025-12-30T10:39:52.503428+01:00","closed_at":"2025-12-30T10:39:52.503428+01:00","close_reason":"Closed"}
{"id":"Battlesim2-g23","title":"Fix TypeScript strictness issues in frontend","description":"Remove 2 @ts-ignore usages and any[] type for events. Replace with proper type guards and typed interfaces. Improves type safety and catches bugs at compile time.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-30T10:31:32.439191+01:00","updated_at":"2025-12-30T13:06:05.215941+01:00","closed_at":"2025-12-30T13:06:05.215941+01:00","close_reason":"Closed"}
{"id":"Battlesim2-g4u","title":"Resolve Rust Compilation Warnings","description":"Identify and fix various compilation warnings in the simulation-wasm Rust codebase, including unused imports, unused variables, and naming convention issues.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T09:55:20.788439+01:00","updated_at":"2025-12-27T10:17:21.438017+01:00","closed_at":"2025-12-27T10:17:21.438017+01:00","close_reason":"Closed"}
{"id":"Battlesim2-hae","title":"Offload heavy simulations to Web Worker","description":"Move the main simulation loop to a Web Worker to prevent UI thread blocking during large batch runs (10,000+ iterations).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T11:30:53.534612+01:00","updated_at":"2025-12-31T11:30:53.534612+01:00"}
{"id":"Battlesim2-hfj","title":"Implement lightweight simulation function","description":"Create run_single_lightweight_simulation() that runs simulation WITHOUT event collection. Track cumulative score after each encounter and deaths. Return LightweightRun.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T13:37:02.266022+01:00","updated_at":"2025-12-29T13:43:08.556501+01:00","closed_at":"2025-12-29T13:43:08.556501+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-hfj","depends_on_id":"Battlesim2-b1j","type":"blocks","created_at":"2025-12-29T13:37:02.268274+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-hmv","title":"Fix WASM panic: Instant::now is not supported in wasm32-unknown-unknown","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T15:40:35.001725+01:00","updated_at":"2025-12-29T06:42:19.973363+01:00","closed_at":"2025-12-29T06:42:19.973363+01:00","close_reason":"Closed"}
{"id":"Battlesim2-hom","title":"Add property-based tests for simulation invariants","description":"Extend property_tests.rs with core invariants: HP conservation, initiative ordering, action cost enforcement. Uses proptest for fuzzing property validation.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-30T10:31:32.992683+01:00","updated_at":"2025-12-30T23:24:42.26653+01:00","closed_at":"2025-12-30T23:24:42.26653+01:00","close_reason":"Closed"}
{"id":"Battlesim2-hzj","title":"Reduce excessive cloning in hot paths","description":"resolution.rs has 47+ .clone() calls on actions/buffs. Use Arc/Cow or string interning to reduce allocations. Expected 20% memory reduction and performance improvement.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-30T10:31:17.799633+01:00","updated_at":"2025-12-30T12:47:53.278493+01:00","closed_at":"2025-12-30T12:47:53.278493+01:00","close_reason":"Closed"}
{"id":"Battlesim2-ipd","title":"Property-Based Testing for Simulation Invariants","description":"## Overview\nImplement property-based testing using `proptest` to validate simulation invariants across thousands of randomly generated inputs.\n\n## Why This Matters\n- **Emergent bug detection**: Finds edge cases unit tests miss\n- **Invariant verification**: Ensures fundamental rules never break (no negative HP, damage conservation, resource limits)\n- **Refactoring safety**: Change code with confidence tests catch regressions\n- **Confidence in simulation**: D\u0026D 5e rules are complex—PBT provides mathematical confidence\n\n## Implementation Plan\n\n### Phase 1: Core Invariants\nCreate `simulation-wasm/tests/properties/` directory:\n\n1. **HP Invariant** (never negative):\n   ```rust\n   proptest! {\n       #[test]\n       fn test_hp_never_negative(\n           player_hp in 1..500,\n           monster_damage in 0..100,\n           rounds in 1..20\n       ) {\n           // Run simulation, assert no HP \u003c 0\n       }\n   }\n   ```\n\n2. **Damage Conservation** (damage dealt = damage taken):\n   ```rust\n   proptest! {\n       #[test]\n           // Sum all DamageTaken events = sum all HP lost\n       }\n   }\n   ```\n\n3. **Resource Limits** (spell slots, actions bounded):\n   ```rust\n   proptest! {\n       #[test]\n           // Spell slots used ≤ spell slots available\n           // Actions per turn ≤ 1 (unless special features)\n       }\n   }\n   ```\n\n### Phase 2: Add proptest dependency\n```toml\n[dev-dependencies]\nproptest = \"1.4\"\n```\n\n### Phase 3: Fuzzing Strategy\n- Random creatures: HP 1-500, AC 5-25, attack bonus 0-15\n- Random actions: damage dice, AOE radius, save DC\n- Random configurations: 1-10 combatants, 1-50 rounds\n\n## Success Criteria\n- ✅ All 3 core invariants pass 10,000 random test cases\n- ✅ Shrinking finds minimal counterexample for any failure\n- ✅ CI runs proptest in \u003c 2 minutes\n- ✅ Failing test seeds are reproducible\n\n## Notes\n- Start with HP invariant—simplest, highest value\n- Use `prop_assert_eq!` for better failure messages\n- Consider `proptest-derive` for custom strategies (Creature generation)\n- May need to stub random dice rolls for reproducibility (use seeded RNG)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T19:48:23.461282+01:00","updated_at":"2025-12-27T21:19:40.519787+01:00","closed_at":"2025-12-27T21:19:40.519787+01:00","close_reason":"Closed"}
{"id":"Battlesim2-jrv","title":"Add ARIA labels and keyboard navigation","description":"Accessibility gaps: SimulationResults table lacks ARIA labels and keyboard navigation. Add proper semantic markup for screen reader support and keyboard-only users.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-30T10:31:43.113545+01:00","updated_at":"2025-12-31T06:56:23.524872+01:00","closed_at":"2025-12-31T06:56:23.524872+01:00","close_reason":"Closed"}
{"id":"Battlesim2-lf6","title":"Audit and cleanup legacy markdown documentation","description":"Audit root markdown files (TODO.md, ISSUES.md, DECILE_METHODOLOGY.md, etc.) and the entire conductor/ directory. Determine if they are redundant now that the project uses Beads. Purge stale files and merge relevant content into AGENTS.md or the Beads system as appropriate.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-31T10:41:41.538186+01:00","updated_at":"2025-12-31T11:37:46.579268+01:00","closed_at":"2025-12-31T11:37:46.579268+01:00","close_reason":"Closed"}
{"id":"Battlesim2-ltj","title":"Refactor lib.rs: Extract wasm_bindings and cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T07:58:16.582163+01:00","updated_at":"2025-12-30T10:04:55.103848+01:00","closed_at":"2025-12-30T10:04:55.103848+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-ltj","depends_on_id":"Battlesim2-coa","type":"blocks","created_at":"2025-12-30T07:58:16.585831+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-ncr","title":"Add validation tests for Two-Pass","description":"Test that seeded runs are deterministic, re-simulated runs match original, and decile accuracy (verify we get true medians). Depends on Two-Pass runner.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T13:37:48.253208+01:00","updated_at":"2025-12-29T16:21:10.890033+01:00","closed_at":"2025-12-29T16:21:10.890033+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-ncr","depends_on_id":"Battlesim2-cns","type":"blocks","created_at":"2025-12-29T13:37:48.253825+01:00","created_by":"daemon"},{"issue_id":"Battlesim2-ncr","depends_on_id":"Battlesim2-ada","type":"blocks","created_at":"2025-12-29T16:14:13.636821+01:00","created_by":"daemon"},{"issue_id":"Battlesim2-ncr","depends_on_id":"Battlesim2-cgr","type":"blocks","created_at":"2025-12-29T16:14:13.831278+01:00","created_by":"daemon"},{"issue_id":"Battlesim2-ncr","depends_on_id":"Battlesim2-63h","type":"blocks","created_at":"2025-12-29T16:14:14.256871+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-olz","title":"Phase 1: Unify HP Modification in Simulation Engine","description":"Locate and refactor all instances of direct HP modification (e.g., combattant.current_hp = ...) to use TurnContext::apply_damage() and TurnContext::apply_healing(). This ensures consistent event emission (DamageTaken, HealingApplied, UnitDied) and fixes the 'Source of Truth' plumbing. Affected files include resolution.rs and simulation.rs.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-31T10:35:53.354233+01:00","updated_at":"2025-12-31T13:25:07.559299+01:00","closed_at":"2025-12-31T13:25:07.559299+01:00","close_reason":"Closed"}
{"id":"Battlesim2-ond","title":"Performance Profiling Dashboard","description":"## Overview\nBuild performance profiling dashboard for real-time simulation progress, bottleneck identification, and WASM bundle size tracking.\n\n## Why This Matters\n- **Optimization visibility**: Identify slow functions before users notice lag\n- **WASM size awareness**: Larger bundles = longer load times, higher bounce\n- **Performance regression**: Detect when new code slows down simulations\n- **Debugging aid**: Profile shows exactly where time is spent\n\n## Implementation Plan\n\n### Phase 1: Rust Performance Instrumentation\n\nAdd `log` calls with timing in hot paths:\n\n```rust\n// simulation-wasm/src/execution.rs\nuse std::time::Instant;\n\npub fn execute_encounter(\u0026mut self) -\u003e EncounterResult {\n    let start = Instant::now();\n    \n    for round in 0..100 {\n        let round_start = Instant::now();\n        self.execute_round(round);\n        log::info!(\"Round {} took {:?}\", round, round_start.elapsed());\n    }\n    \n    log::info!(\"Total simulation time: {:?}\", start.elapsed());\n    result\n}\n```\n\nEnable `log` and `console_log` in WASM:\n\n```toml\n[dependencies]\nlog = \"0.4\"\nconsole_log = \"1.0\"\n```\n\n```rust\n// simulation-wasm/src/lib.rs\nfn init_logging() {\n    console_log::init_with_level(log::Level::Info).unwrap();\n}\n```\n\n### Phase 2: Performance Dashboard UI\n\nCreate `src/components/debug/PerformanceDashboard.tsx`:\n\n```typescript\ninterface PerfMetrics {\n  lastSimulationTime: number;\n  averageRoundTime: number;\n  slowestRound: number;\n  wasmSize: number;\n  memoryUsage: number;\n}\n\nconst PerformanceDashboard: FC = () =\u003e {\n  const [metrics, setMetrics] = useState\u003cPerfMetrics | null\u003e(null);\n  \n  useEffect(() =\u003e {\n    // Listen for custom performance events\n    const listener = (e: CustomEvent\u003cPerfMetrics\u003e) =\u003e {\n      setMetrics(e.detail);\n    };\n    window.addEventListener('simulationComplete', listener);\n    \n    // Fetch WASM size\n    fetch('/pkg/simulation_wasm_bg.wasm')\n      .then(r =\u003e r.blob())\n      .then(blob =\u003e setMetrics(prev =\u003e ({ ...prev, wasmSize: blob.size })));\n    \n    return () =\u003e window.removeEventListener('simulationComplete', listener);\n  }, []);\n  \n  return (\n    \u003cdiv className={styles.dashboard}\u003e\n      \u003ch4\u003ePerformance\u003c/h4\u003e\n      \u003cdiv\u003eLast sim: {metrics?.lastSimulationTime}ms\u003c/div\u003e\n      \u003cdiv\u003eAvg round: {metrics?.averageRoundTime}ms\u003c/div\u003e\n      \u003cdiv\u003eWASM: {formatBytes(metrics?.wasmSize)}\u003c/div\u003e\n      \u003cdiv\u003eMemory: {formatBytes(metrics?.memoryUsage)}\u003c/div\u003e\n      \n      {/* Bar chart of round times */}\n      \u003cdiv className={styles.roundChart}\u003e\n        {roundTimes.map((time, i) =\u003e (\n          \u003cdiv key={i} style={{ height: `${time / maxTime * 100}%` }} /\u003e\n        ))}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n};\n```\n\n### Phase 3: WASM Size Tracking\n\nAdd bundle size to dashboard:\n\n```bash\n# scripts/check-wasm-size.sh\n#!/bin/bash\nWASM_SIZE=\necho \"WASM size: \"\n\n# Alert if \u003e 1MB\nif [  -gt 1048576 ]; then\n  echo \"⚠️  WASM is \u003e 1MB, consider code splitting\"\nfi\n```\n\n### Phase 4: Flame Graph (Optional)\nUse `flamegraph` crate for Rust profiling:\n\n```bash\ncargo install flamegraph\ncargo flamegraph --bin sim_cli\n```\n\n## Success Criteria\n- ✅ Dashboard shows simulation time, round times, WASM size\n- ✅ Visual chart of per-round performance\n- ✅ WASM size alerts when \u003e 1MB\n- ✅ Performance logs appear in browser console\n- ✅ Dashboard toggles on/off (dev mode only)\n\n## Notes\n- Only enable in dev builds (use `#[cfg(debug_assertions)]`)\n- Consider using `web-sys` Performance API for browser-side timing\n- WASM size grows with dependency additions—monitor regularly\n- Round-by-round breakdown helps identify slow actions (e.g., complex AOE)\n- Could export metrics to CSV for analysis in external tools","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-27T19:48:43.771547+01:00","updated_at":"2025-12-28T11:28:07.75065+01:00","closed_at":"2025-12-28T11:28:07.75065+01:00","close_reason":"Closed"}
{"id":"Battlesim2-puc","title":"Refactor lib.rs: Extract simulation module","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T07:57:58.211643+01:00","updated_at":"2025-12-30T09:57:57.001448+01:00","closed_at":"2025-12-30T09:57:57.001448+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-puc","depends_on_id":"Battlesim2-v14","type":"blocks","created_at":"2025-12-30T07:57:58.214525+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-q7j","title":"Reduce WASM size by removing unused dependencies","description":"Current WASM is 4.5MB (9x baseline). Remove unused CLI dependencies (clap=350KB, uuid=150KB, rand_chacha=200KB) from WASM build. Use feature flags to exclude them from web target.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-30T10:31:00.848846+01:00","updated_at":"2025-12-30T11:02:09.20453+01:00","closed_at":"2025-12-30T11:02:09.20453+01:00","close_reason":"Closed"}
{"id":"Battlesim2-rat","title":"Consolidate test files into proper locations","description":"Test files in src/ (adjustment_test.rs, buff_display_test.rs, etc.) violate Rust idioms. Move API tests to tests/ directory and internal tests to modules within source files.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-30T10:31:17.512421+01:00","updated_at":"2025-12-30T13:01:19.779149+01:00","closed_at":"2025-12-30T13:01:19.779149+01:00","close_reason":"Closed"}
{"id":"Battlesim2-re1","title":"Sunset legacy Round 1 aggregation metrics","description":"The Round 1 aggregation anomaly was an artifact of the old decile averaging system. With the move to 1% bucketing and seed-based re-simulation, averaging round-by-round HP across multiple runs is obsolete and misleading. Removed the Round 1 Vitality/Power pills from the UI.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T10:36:02.750426+01:00","updated_at":"2025-12-31T11:44:37.349965+01:00","closed_at":"2025-12-31T11:44:37.349965+01:00","close_reason":"Closed"}
{"id":"Battlesim2-rem","title":"Pre-commit Quality Gate","description":"## Overview\nSet up pre-commit hooks to enforce code quality: cargo-clippy, cargo-audit, ESLint, Prettier, WASM size tracking, and test coverage thresholds.\n\n## Why This Matters\n- **Catch issues early**: Failing hooks prevent broken code from being committed\n- **Consistent style**: Prettier ensures uniform formatting across all files\n- **Security scanning**: cargo-audit catches vulnerable dependencies\n- **WASM bloat prevention**: Alert when .wasm file grows \u003e 10%\n- **Coverage awareness**: Reject commits that lower test coverage\n\n## Implementation Plan\n\n### Phase 1: Install Husky\n```bash\nnpm install -D husky\nnpm pkg set scripts.prepare=\"husky\"\nnpx husky install\n```\n\n### Phase 2: Create Hooks\n\n#### `.husky/pre-commit`\n```bash\n#!/bin/bash\nset -e\n\necho \"🔍 Running Rust checks...\"\ncd simulation-wasm\ncargo clippy -- -D warnings\ncargo audit\ncd ..\n\necho \"🔍 Running TypeScript checks...\"\nnpx eslint src/ --ext .ts,.tsx\nnpx prettier --check \"src/**/*.{ts,tsx,scss}\"\n\necho \"🔍 Checking WASM size...\"\nWASM_SIZE=stat -f%z simulation-wasm/pkg/*.wasm 2\u003e/dev/null || stat -c%s simulation-wasm/pkg/*.wasm\nBASELINE_SIZE=500000  # 500KB baseline\nif [ $WASM_SIZE -gt $((BASELINE_SIZE * 11 / 10)) ]; then\n  echo \"❌ WASM grew \u003e 10% from baseline\"\n  exit 1\nfi\n\necho \"🔍 Running tests...\"\ncd simulation-wasm\ncargo test --quiet\ncd ..\nnpx jest --passWithNoTests\n\necho \"✅ All checks passed!\"\n```\n\n### Phase 3: Configure Tools\n\n#### `.eslintrc.json` (if missing)\n```json\n{\n  \"extends\": [\"next/core-web-vitals\", \"prettier\"],\n  \"rules\": {\n    \"@typescript-eslint/no-unused-vars\": \"error\",\n    \"no-console\": [\"warn\", { \"allow\": [\"error\", \"warn\"] }]\n  }\n}\n```\n\n#### `.prettierrc`\n```json\n{\n  \"semi\": false,\n  \"singleQuote\": true,\n  \"trailingComma\": \"es5\"\n}\n```\n\n### Phase 4: Optional Commit-msg Hook\n```bash\n#!/bin/bash\n# Enforce conventional commits: feat:, fix:, docs:, etc.\nmsg=$(head -n1 $1)\nif ! echo \"$msg\" | grep -qE '^(feat|fix|docs|style|refactor|test|chore|ci)(\\(.+\\))?: '; then\n  echo \"❌ Use conventional commit format: feat:, fix:, docs:, etc.\"\n  exit 1\nfi\n```\n\n## Success Criteria\n- ✅ Committing without running cargo-clippy fails hook\n- ✅ Prettier formats code before commit (or blocks on format mismatch)\n- ✅ WASM size \u003e 10% growth blocks commit\n- ✅ cargo-audit fails on vulnerable deps\n- ✅ All hooks run in \u003c 30 seconds\n\n## Notes\n- Initially use warnings only, enforce after team adjusts\n- WASM baseline needs calibration after first build\n- Consider using `lint-staged` to only check changed files\n- Husky install should run in `postinstall` for new contributors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T19:48:30.932275+01:00","updated_at":"2025-12-27T21:03:06.082125+01:00","closed_at":"2025-12-27T21:03:06.082125+01:00","close_reason":"Closed"}
{"id":"Battlesim2-tix","title":"Refactor lib.rs: Extract utils module","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T07:57:19.537905+01:00","updated_at":"2025-12-30T09:17:33.463048+01:00","closed_at":"2025-12-30T09:17:33.463048+01:00","close_reason":"Created utils.rs module with summarize_result function. Removed unused PartialOutput struct. Updated lib.rs to use crate::utils::summarize_result(). All 94 tests pass."}
{"id":"Battlesim2-tjp","title":"Integrate E2E Tests into CI","description":"Update CI workflow (Github Actions?) to build WASM and start Next.js app\n- Run 'npm run test:e2e' against the local server\n- Handle artifacts (screenshots on failure)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T19:22:28.882899+01:00","updated_at":"2025-12-30T10:17:46.000092+01:00","closed_at":"2025-12-30T10:17:46.000092+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-tjp","depends_on_id":"Battlesim2-bpy","type":"blocks","created_at":"2025-12-28T19:22:37.268178+01:00","created_by":"daemon"},{"issue_id":"Battlesim2-tjp","depends_on_id":"Battlesim2-cc4","type":"blocks","created_at":"2025-12-28T19:22:37.450727+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-tmr","title":"Add deterministic RNG seeding for simulation tests","description":"## Overview\nAdd deterministic RNG seeding to the simulation engine to enable reliable snapshot testing, faster regression tests, and reproducible results.\n\n## Why This Matters\nThe current snapshot tests (Battlesim2-ciz) are **fundamentally broken** because they rely on non-deterministic RNG. Every run produces slightly different values, making snapshots useless for regression detection.\n\n**Current Problem:**\n- Snapshot tests fail randomly due to RNG variance\n- Regression tests need 1001×3 iterations and take 13 seconds\n- Tests are not reproducible across runs\n\n**After This Fix:**\n- Snapshot tests become deterministic and actually useful\n- Regression tests can use 100 iterations and run in \u003c1 second\n- All tests are reproducible: same seed = same results\n- CI becomes faster and more reliable\n\n## Root Cause Analysis\nThe simulation uses `rand::thread_rng()` in multiple modules:\n- `src/utilities.rs` - initiative rolls\n- `src/dice.rs` - dice rolling\n- `src/actions.rs` - attack rolls  \n- `src/action_resolver.rs` - various rolls\n- `src/resolution.rs` - saving throws\n\nAll of these need to be replaced with a seeded RNG that can be controlled from the API.\n\n## Implementation Plan\n\n### Phase 1: Add RNG Thread-Local Storage\nCreate a thread-local RNG that can be optionally seeded:\n\n```rust\n// src/rng.rs\nuse rand::prelude::*;\nuse std::cell::RefCell;\n\nthread_local! {\n    static RNG: RefCell\u003cOption\u003cStdRng\u003e\u003e = RefCell::new(None);\n}\n\npub fn seed_rng(seed: u64) {\n    RNG.with(|rng| {\n        *rng.borrow_mut() = Some(StdRng::seed_from_u64(seed));\n    });\n}\n\npub fn clear_rng() {\n    RNG.with(|rng| {\n        *rng.borrow_mut() = None;\n    });\n}\n\npub fn get_rng() -\u003e impl Rng {\n    RNG.with(|rng| {\n        match \u0026*rng.borrow() {\n            Some(seeded) =\u003e seeded.clone(),\n            None =\u003e {\n                // Fall back to thread_rng if no seed set\n                StdRng::from_entropy()\n            }\n        }\n    })\n}\n```\n\n### Phase 2: Update Simulation API\nAdd optional `seed` parameter:\n\n```rust\n// src/lib.rs\npub fn run_event_driven_simulation_rust(\n    players: Vec\u003cCreature\u003e,\n    timeline: Vec\u003cTimelineStep\u003e,\n    iterations: usize,\n    log_enabled: bool,\n    seed: Option\u003cu64\u003e,  // ← NEW\n) -\u003e Vec\u003cSimulationRun\u003e {\n    if let Some(s) = seed {\n        rng::seed_rng(s);\n    }\n    \n    let mut all_runs = Vec::new();\n    for i in 0..iterations {\n        // Reset seed for each iteration for consistency\n        if let Some(s) = seed {\n            rng::seed_rng(s + i as u64);\n        }\n        \n        let (result, events) = run_single_event_driven_simulation(\u0026players, \u0026timeline, i == 0);\n        // ...\n    }\n    \n    if seed.is_some() {\n        rng::clear_rng();\n    }\n    \n    all_runs\n}\n```\n\n### Phase 3: Replace RNG Calls\nReplace `rand::thread_rng()` with `rng::get_rng()` in:\n- `src/utilities.rs` (roll_initiative)\n- `src/dice.rs` (roll_dice)\n- `src/actions.rs` (roll_with_advantage)\n- `src/action_resolver.rs` (resolve_attack, etc.)\n- `src/resolution.rs` (saving throws)\n\n### Phase 4: Update Tests to Use Fixed Seeds\nUpdate snapshot and regression tests to use deterministic seeds:\n\n```rust\n// tests/snapshot_tests.rs\nlet runs = run_event_driven_simulation_rust(\n    players, \n    timeline, \n    101, \n    false, \n    Some(42),  // ← Fixed seed for determinism\n);\n```\n\n### Phase 5: Optimize Regression Tests\nRemove the median-of-3 workaround since tests are now deterministic:\n\n```rust\n// Before: 1001 iterations × 3 runs = 3003 simulations\nlet iterations = 1001;\nfor _run in 0..3 {\n    let runs = run_event_driven_simulation_rust(...);\n    // collect and take median\n}\n\n// After: 100 iterations × 1 run = 100 simulations (30x faster!)\nlet runs = run_event_driven_simulation_rust(\n    players, timeline, 100, false, Some(42)\n);\n```\n\n## Files to Modify\n- `src/lib.rs` - Add seed parameter to API\n- `src/rng.rs` - NEW: thread-local RNG storage\n- `src/utilities.rs` - Use seeded RNG\n- `src/dice.rs` - Use seeded RNG\n- `src/actions.rs` - Use seeded RNG\n- `src/action_resolver.rs` - Use seeded RNG\n- `src/resolution.rs` - Use seeded RNG\n- `tests/snapshot_tests.rs` - Use fixed seeds\n- `tests/regression_tests.rs` - Use fixed seeds, optimize iterations\n\n## Success Criteria\n- ✅ Snapshot tests pass consistently across multiple runs\n- ✅ Regression tests run in \u003c1 second (down from 13s)\n- ✅ All tests are reproducible (same seed produces same results)\n- ✅ Backward compatible: `None` seed uses random RNG (existing code unaffected)\n\n## Estimated Effort\n2-4 hours of focused work\n\n## Notes\n- Thread-local RNG ensures thread safety\n- Seed + iteration index ensures each run is deterministic but different\n- Clear RNG after simulation to avoid cross-contamination\n- Consider adding `--seed` CLI to sim_cli for debugging","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T00:24:40.049617+01:00","updated_at":"2025-12-28T00:44:40.89406+01:00","closed_at":"2025-12-28T00:44:40.89406+01:00","close_reason":"Closed"}
{"id":"Battlesim2-tu9","title":"Add integration scenario tests for D\u0026D 5e mechanics","description":"## Overview\nAdd integration tests using real D\u0026D 5e encounter scenarios to validate simulation logic and catch emergent bugs that unit tests miss.\n\n## Why This Matters\n- **Regression protection**: Detect when logic changes break expected behavior\n- **Emergent bugs**: Catch issues from system interactions (actions + resources + reactions)\n- **Living documentation**: Scenarios document expected D\u0026D 5e behavior\n- **Refactoring safety**: Improve code with confidence tests pass\n\n## Implementation Phases\n\n### Phase 1: Framework\n- Create `tests/scenarios/` directory structure\n- Write `integration_test.rs` test runner\n- Create `invariants.rs` with assertion helpers\n\n### Phase 2: Basic Mechanical Scenarios\n- 01_single_attack.json - Basic attack resolution\n- 02_fireball_aoe.json - AOE damage calculation\n- 03_healing_word.json - Bonus action spell\n- 04_concentration_check.json - Concentration mechanics\n- 05_multiattack.json - Multiple attacks per action\n\n### Phase 3: Complex Encounters\n- goblin_bandits.json - Multi-combatant combat\n- Resource management scenarios\n- Edge cases (temp HP, resistance, death saves)\n\n## Assertion Strategy\nAssert BEHAVIORS, not exact outcomes:\n- No negative HP or resources\n- Damage dealt = damage taken (energy conserved)\n- Action economy respected (1 action/turn max)\n- Event sequence validity\n- Concentration mechanics work correctly\n\n## Directory Structure\n```\nsimulation-wasm/tests/\n├── scenarios/\n│   ├── basic/\n│   ├── edge_cases/\n│   └── complex/\n├── integration_test.rs\n└── invariants.rs\n```\n\n## Dependencies\nShould be done AFTER:\n- Battlesim2-61w: Fix Rust warnings\n- Battlesim2-dxt: Improve test coverage\n\n## Notes\n- Scenarios use existing AdventuringDaySchema JSON format\n- User creates realistic encounters via UI, exports to JSON\n- Tests automatically validate all scenarios in directory","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T10:44:50.480731+01:00","updated_at":"2025-12-27T13:59:08.870784+01:00","closed_at":"2025-12-27T13:59:08.870784+01:00","close_reason":"Closed"}
{"id":"Battlesim2-u93","title":"Fix flaky regression test test_mechanics_heavy_vs_consistent","description":"## Overview\nThe regression test `test_mechanics_heavy_vs_consistent` in `simulation-wasm/tests/regression_tests.rs` is extremely flaky.\n\n## Problem\nThe test checks probabilistic outcomes (505 simulation iterations) but produces wildly different results:\n- Individual run: 60% win rate (PASS)\n- Full suite run 1: 44% win rate (FAIL)  \n- Full suite run 2: 14% win rate (FAIL)\n\nExpected: Player (Burst Damage) should win \u003e50% of the time against Monster (Low Dmg/High Hit)\n\n## Root Cause\nThe test uses randomness without a fixed seed, causing high variance in outcomes. The assertion requires \u003e50% win rate but the actual variance can swing from 14% to 60%.\n\n## Solutions\n1. **Fix RNG seeding**: Use a fixed random seed for deterministic results\n2. **Increase iterations**: More iterations reduce variance (but takes longer)\n3. **Widen acceptance threshold**: Accept 45-55% as \\\"too close to call\\\" and skip assertion\n4. **Statistical significance test**: Use proper hypothesis testing instead of simple \u003e50% check\n\n## Impact\n- Blocks pre-commit hooks (randomly fails commits)\n- Reduces confidence in CI/CD\n- Makes it unclear if simulation changes actually broke balance","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T21:18:33.905696+01:00","updated_at":"2025-12-27T22:58:16.801462+01:00","closed_at":"2025-12-27T22:58:16.801462+01:00","close_reason":"Closed"}
{"id":"Battlesim2-v14","title":"Refactor lib.rs: Extract seed_selection module","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T07:57:48.541242+01:00","updated_at":"2025-12-30T09:21:45.283022+01:00","closed_at":"2025-12-30T09:21:45.283022+01:00","close_reason":"Created seed_selection.rs module with select_interesting_seeds_with_tiers function for 1% granularity bucket selection. Updated lib.rs to use crate::seed_selection::select_interesting_seeds_with_tiers(). Removed old select_interesting_seeds function. All 94 tests pass.","dependencies":[{"issue_id":"Battlesim2-v14","depends_on_id":"Battlesim2-tix","type":"blocks","created_at":"2025-12-30T07:57:48.542256+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-v39","title":"Fix panicking auto_balancer tests on non-wasm32 targets","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-28T12:36:56.308801+01:00","updated_at":"2025-12-28T12:39:24.98993+01:00","closed_at":"2025-12-28T12:39:24.98993+01:00","close_reason":"Restricted console_log init to wasm32 target only"}
{"id":"Battlesim2-v87","title":"Benchmark 10,100 runs for time/space validation","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T22:55:52.983794+01:00","updated_at":"2025-12-29T23:35:33.433664+01:00","closed_at":"2025-12-29T23:35:33.433664+01:00","close_reason":"Created benchmark_10k.rs test suite validating: (1) Phase 1 lightweight survey of 10,100 runs completes in ~25s (within 35s limit), (2) Phase 2 seed selection with 1% granularity completes in \u003c1ms, (3) Full two-pass system selects 111 seeds (11 Tier A + 100 Tier B), (4) 1% bucketing creates 100 equal buckets with median from each. All 4 benchmark tests pass successfully.","dependencies":[{"issue_id":"Battlesim2-v87","depends_on_id":"Battlesim2-b6n","type":"blocks","created_at":"2025-12-29T22:56:02.512484+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-vj6","title":"Update all class templates to 2014 standards","description":"Bring Artificer, Barbarian, Bard, Cleric, Druid, Monk, Paladin, Rogue, Sorcerer, and Warlock templates up to 5e 2014 feature parity (Spell Slots, Class Resources).","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T11:30:48.353566+01:00","updated_at":"2025-12-31T11:30:48.353566+01:00"}
{"id":"Battlesim2-vkn","title":"Optimize Two-Pass memory usage","description":"Profile memory usage of new implementation and verify we're at ~5 MB target. Optimize if needed.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T13:38:13.573097+01:00","updated_at":"2025-12-29T22:49:16.806365+01:00","closed_at":"2025-12-29T22:49:16.806365+01:00","close_reason":"Implemented cache optimizations: (1) Changed HashMap key from (u64,u64) tuple to single u64 using splitmix64 mixing, (2) Reduced cache size from 100k to 5k entries, (3) Added cache stats monitoring. Memory reduced from ~3.5MB to ~350KB (~90% reduction), well within 5MB target."}
{"id":"Battlesim2-vy8","title":"Implement Page Object Models (POM)","description":"Create 'SimulationPage' class (Navigation, Main Actions)\n- Create 'CreatureModal' class (Form interaction)\n- Create 'ResultsPanel' class (Result parsing)\n- Define robust selectors (avoid brittle XPath, use data-testid where possible)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T19:22:28.045877+01:00","updated_at":"2025-12-28T19:26:44.147873+01:00","closed_at":"2025-12-28T19:26:44.147873+01:00","close_reason":"Closed","dependencies":[{"issue_id":"Battlesim2-vy8","depends_on_id":"Battlesim2-9k8","type":"blocks","created_at":"2025-12-28T19:22:36.805889+01:00","created_by":"daemon"}]}
{"id":"Battlesim2-w47","title":"Smart Targeting Integration","description":"Integrate targeting.rs logic into execution.rs to replace get_random_target with intelligent selection (e.g., focus fire on low HP, break concentration).","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-31T11:30:58.717246+01:00","updated_at":"2025-12-31T11:30:58.717246+01:00"}
{"id":"Battlesim2-wpt","title":"Implement AI Action Diagnostics in combat log","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:29:55.422859+01:00","updated_at":"2025-12-26T22:43:30.717651+01:00","closed_at":"2025-12-26T22:43:30.717651+01:00","close_reason":"Integrated skipped action diagnostics with UI warning states.","labels":["backend"],"dependencies":[{"issue_id":"Battlesim2-wpt","depends_on_id":"Battlesim2-1h0","type":"parent-child","created_at":"2025-12-26T18:30:50.865678+01:00","created_by":"daemon"}]}
